<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>System Notes</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2017-03-15T08:31:42.472Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>Wu Dong</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>频繁执行iscsiadm导致iscsid不进行target的重连</title>
    <link href="http://yoursite.com/2017/03/15/iscsiadm-affect-reconnect/"/>
    <id>http://yoursite.com/2017/03/15/iscsiadm-affect-reconnect/</id>
    <published>2017-03-15T08:29:59.000Z</published>
    <updated>2017-03-15T08:31:42.472Z</updated>
    
    <content type="html">&lt;p&gt;open-iscsi&amp;#x5B9E;&amp;#x73B0;&amp;#x4E86;iscsi&amp;#x7684;&amp;#x81EA;&amp;#x52A8;&amp;#x91CD;&amp;#x8FDE;&amp;#xFF0C;&amp;#x5F53;target&amp;#x6240;&amp;#x5728;&amp;#x673A;&amp;#x5668;&amp;#x91CD;&amp;#x542F;&amp;#x6216;&amp;#x8005;target&amp;#x7684;&amp;#x7F51;&amp;#x7EDC;&amp;#x5F02;&amp;#x5E38;&amp;#x65F6;&amp;#xFF0C;open-iscsi&amp;#x90FD;&amp;#x4F1A;&amp;#x4E00;&amp;#x76F4;&amp;#x5C1D;&amp;#x8BD5;connect&amp;#xFF0C;&amp;#x4E00;&amp;#x65E6;&amp;#x5F53;target&amp;#x91CD;&amp;#x5EFA;&amp;#x51FA;&amp;#x6765;&amp;#x540E;&amp;#xFF0C;open-iscsi&amp;#x5C31;&amp;#x80FD;&amp;#x591F;&amp;#x91CD;&amp;#x65B0;login&amp;#x6210;&amp;#x529F;&amp;#x3002;&amp;#x4F46;&amp;#x662F;&amp;#x6D4B;&amp;#x8BD5;&amp;#x65F6;&amp;#x53D1;&amp;#x73B0;&amp;#xFF0C;&amp;#x5F53;&amp;#x9891;&amp;#x7E41;&amp;#x6267;&amp;#x884C;iscsiadm&amp;#x7684;&amp;#x547D;&amp;#x4EE4;&amp;#x65F6;&amp;#xFF0C;&amp;#x4F1A;&amp;#x5BFC;&amp;#x81F4;open-iscsi&amp;#x4E0D;&amp;#x53BB;&amp;#x8FDB;&amp;#x884C;&amp;#x91CD;&amp;#x8FDE;&amp;#x4E86;&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;&amp;#x89C2;&amp;#x5BDF;&amp;#x5230;&amp;#x7684;&amp;#x73B0;&amp;#x8C61;&quot;&gt;&lt;a href=&quot;#&amp;#x89C2;&amp;#x5BDF;&amp;#x5230;&amp;#x7684;&amp;#x73B0;&amp;#x8C61;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x89C2;&amp;#x5BDF;&amp;#x5230;&amp;#x7684;&amp;#x73B0;&amp;#x8C61;&quot;&gt;&lt;/a&gt;&amp;#x89C2;&amp;#x5BDF;&amp;#x5230;&amp;#x7684;&amp;#x73B0;&amp;#x8C61;&lt;/h2&gt;&lt;p&gt;&amp;#x5F53;target&amp;#x5F02;&amp;#x5E38;&amp;#x65F6;&amp;#xFF0C;strace&amp;#x8DDF;&amp;#x8E2A;iscsid&amp;#x8FDB;&amp;#x7A0B;&amp;#x4F1A;&amp;#x53D1;&amp;#x73B0;&amp;#x4E00;&amp;#x76F4;&amp;#x5C1D;&amp;#x8BD5;&amp;#x91CD;&amp;#x8FDE;&amp;#xFF0C;&amp;#x4E0D;&amp;#x8FC7;&amp;#x4E00;&amp;#x76F4;&amp;#x5931;&amp;#x8D25;&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ sudo strace -e connect -p 28022 -t&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Process 28022 attached - interrupt to quit&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15:19:31 connect(10, {sa_family=AF_INET, sin_port=htons(3260), sin_addr=inet_addr(&amp;quot;10.180.0.30&amp;quot;)}, 128) = -1 EINPROGRESS (Operation now in progress)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15:19:34 connect(10, {sa_family=AF_INET, sin_port=htons(3260), sin_addr=inet_addr(&amp;quot;10.180.0.30&amp;quot;)}, 128) = -1 EINPROGRESS (Operation now in progress)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15:19:37 connect(10, {sa_family=AF_INET, sin_port=htons(3260), sin_addr=inet_addr(&amp;quot;10.180.0.30&amp;quot;)}, 128) = -1 EINPROGRESS (Operation now in progress)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15:19:40 connect(10, {sa_family=AF_INET, sin_port=htons(3260), sin_addr=inet_addr(&amp;quot;10.180.0.30&amp;quot;)}, 128) = -1 EINPROGRESS (Operation now in progress)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x6A21;&amp;#x62DF;&amp;#x9891;&amp;#x7E41;&amp;#x6267;&amp;#x884C;iscsiadm&amp;#x7684;&amp;#x547D;&amp;#x4EE4;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ for i in {1..10000};do sudo iscsiadm -m session -P3 2&amp;amp;&amp;gt; /dev/null;done&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x8FD9;&amp;#x4E2A;&amp;#x65F6;&amp;#x5019;&amp;#x53BB;strace&amp;#x8DDF;&amp;#x8E2A;&amp;#x4F1A;&amp;#x53D1;&amp;#x73B0;&amp;#x6CA1;&amp;#x6709;&amp;#x53BB;&amp;#x91CD;&amp;#x8FDE;target&amp;#x7684;&amp;#x4FE1;&amp;#x606F;&amp;#xFF0C;&amp;#x53CD;&amp;#x800C;&amp;#x662F;&amp;#x4E00;&amp;#x4E9B;&amp;#x5947;&amp;#x602A;&amp;#x7684;&amp;#x8BB0;&amp;#x5F55;&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;17:24:12 connect(9, {sa_family=AF_FILE, path=&amp;quot;/var/run/nscd/socket&amp;quot;}, 110) = -1 ENOENT (No such file or directory)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17:24:13 connect(9, {sa_family=AF_FILE, path=&amp;quot;/var/run/nscd/socket&amp;quot;}, 110) = -1 ENOENT (No such file or directory)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17:24:14 connect(9, {sa_family=AF_FILE, path=&amp;quot;/var/run/nscd/socket&amp;quot;}, 110) = -1 ENOENT (No such file or directory)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17:24:14 connect(9, {sa_family=AF_FILE, path=&amp;quot;/var/run/nscd/socket&amp;quot;}, 110) = -1 ENOENT (No such file or directory)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17:24:15 connect(9, {sa_family=AF_FILE, path=&amp;quot;/var/run/nscd/socket&amp;quot;}, 110) = -1 ENOENT (No such file or directory)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;&amp;#x5F00;&amp;#x542F;iscsid&amp;#x7684;debug&amp;#x65E5;&amp;#x5FD7;&quot;&gt;&lt;a href=&quot;#&amp;#x5F00;&amp;#x542F;iscsid&amp;#x7684;debug&amp;#x65E5;&amp;#x5FD7;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x5F00;&amp;#x542F;iscsid&amp;#x7684;debug&amp;#x65E5;&amp;#x5FD7;&quot;&gt;&lt;/a&gt;&amp;#x5F00;&amp;#x542F;iscsid&amp;#x7684;debug&amp;#x65E5;&amp;#x5FD7;&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;sudo /usr/sbin/iscsid -d 8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&amp;#x91CD;&amp;#x590D;&amp;#x4E0A;&amp;#x9762;&amp;#x7684;&amp;#x8FC7;&amp;#x7A0B;&amp;#xFF0C;&amp;#x5F53;&amp;#x9891;&amp;#x7E41;&amp;#x6267;&amp;#x884C;iscsiadm&amp;#x547D;&amp;#x4EE4;&amp;#x65F6;&amp;#xFF0C;iscsid&amp;#x65E5;&amp;#x5FD7;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:26 10-180-0-46 iscsid: poll result 1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:26 10-180-0-46 iscsid: mgmt_ipc_write_rsp: rsp to fd 8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:26 10-180-0-46 iscsid: poll result 1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:26 10-180-0-46 iscsid: mgmt_ipc_write_rsp: rsp to fd 8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:26 10-180-0-46 iscsid: poll result 1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:26 10-180-0-46 iscsid: mgmt_ipc_write_rsp: rsp to fd 8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:26 10-180-0-46 iscsid: poll result 1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:26 10-180-0-46 iscsid: mgmt_ipc_write_rsp: rsp to fd 8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:26 10-180-0-46 iscsid: poll result 1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:26 10-180-0-46 iscsid: mgmt_ipc_write_rsp: rsp to fd 8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x4E00;&amp;#x65E6;&amp;#x505C;&amp;#x6B62;&amp;#x4E86;iscsiadm&amp;#x7684;&amp;#x547D;&amp;#x4EE4;&amp;#xFF0C;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x5230;&amp;#x4E0B;&amp;#x9762;&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&amp;#xFF1A;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;104&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:26 10-180-0-46 iscsid: poll result 1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:26 10-180-0-46 iscsid: mgmt_ipc_write_rsp: rsp to fd 8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:26 10-180-0-46 iscsid: poll result 1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:26 10-180-0-46 iscsid: mgmt_ipc_write_rsp: rsp to fd 8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:27 10-180-0-46 iscsid: thread 01e8e2e8 wait some more&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:28 10-180-0-46 iscsid: thread 01e8e2e8 wait some more&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:28 10-180-0-46 iscsid: thread 01e8e2e8 was scheduled at 33742:8, curtime 33752 q_forw 0x68b330 &amp;amp;pend_list 0x68b330&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:28 10-180-0-46 iscsid: thread 01e8e2e8 now in actor_list&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:28 10-180-0-46 iscsid: exec thread 01e8e2e8 callback&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:28 10-180-0-46 iscsid: iscsi_login_eh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:28 10-180-0-46 iscsid: login failed ISCSI_CONN_STATE_XPT_WAIT/R_STAGE_SESSION_REOPEN 8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:28 10-180-0-46 iscsid: re-opening session 11 (reopen_cnt 8)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:28 10-180-0-46 iscsid: thread 01e8e2e8 delete: state 3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:28 10-180-0-46 iscsid: thread 01e8e320 delete: state 3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:28 10-180-0-46 iscsid: get ev context 0x1e921e0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:28 10-180-0-46 iscsid: set TCP recv window size to 524288, actually got 425984&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:28 10-180-0-46 iscsid: set TCP send window size to 524288, actually got 425984&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:28 10-180-0-46 iscsid: connecting to 10.180.0.30:3260&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:28 10-180-0-46 iscsid: sched conn context 0x1e921e0 event 2, tmo 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:28 10-180-0-46 iscsid: thread 0x1e921e0 schedule: delay 0 state 3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:28 10-180-0-46 iscsid: Setting login timer 0x1e8e2e8 timeout 15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:28 10-180-0-46 iscsid: thread 0x1e8e2e8 schedule: delay 60 state 3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:28 10-180-0-46 iscsid: thread removed&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:28 10-180-0-46 iscsid: thread 01e921e0 removed from poll_list&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 kernel: [8511784.201478]  connection11:0: detected conn error (1020)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: exec thread 01e921e0 callback&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: put ev context 0x1e921e0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: connected local port 34342 to 10.180.0.30:3260&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: in kbind_conn&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: in __kipc_call&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: in kwritev&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: in nlpayload_read&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: in nlpayload_read&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: bound iSCSI connection 11:0 to session 11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: sysfs_attr_get_value: open &amp;apos;/class/iscsi_connection/connection11:0&amp;apos;/&amp;apos;exp_statsn&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: sysfs_attr_get_value: new uncached attribute &amp;apos;/sys/class/iscsi_connection/connection11:0/exp_statsn&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: sysfs_attr_get_value: add to cache &amp;apos;/sys/class/iscsi_connection/connection11:0/exp_statsn&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: sysfs_attr_get_value: cache &amp;apos;/sys/class/iscsi_connection/connection11:0/exp_statsn&amp;apos; with attribute value &amp;apos;440&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: sending login PDU with current stage 0, next stage 1, transit 0x80, isid 0x00023d0b0000 exp_statsn 440&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: &amp;gt;    InitiatorName=iqn.1993-08.org.debian:01:838ab867906c&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: &amp;gt;    InitiatorAlias=10-180-0-46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: &amp;gt;    TargetName=iqn.test.1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: &amp;gt;    SessionType=Normal&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: &amp;gt;    AuthMethod=CHAP,None&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: in ksend_pdu_begin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: send PDU began for hdr 48 bytes and data 144 bytes&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: in kwritev&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: wrote 48 bytes of PDU header&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: in kwritev&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: wrote 144 bytes of PDU data&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: in ksend_pdu_end&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: in __kipc_call&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: in kwritev&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: in nlpayload_read&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: in nlpayload_read&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: send PDU finished for conn 11:0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: thread removed&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: poll result 1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: in ctldev_handle&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: in nl_read&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: ctldev_handle got event type 101&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: get ev context 0x1e921e0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: message real length is 120 bytes, recv_handle 0x1e92230&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: in nlpayload_read&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: sched conn context 0x1e921e0 event 1, tmo 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: thread 0x1e921e0 schedule: delay 0 state 3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: poll result 1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: in ctldev_handle&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: in nl_read&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: ctldev_handle got event type 102&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: get ev context 0x1e942b0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: message real length is 72 bytes, recv_handle 0x1e94300&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: in nlpayload_read&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: sched conn context 0x1e942b0 event 3, tmo 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: thread 0x1e942b0 schedule: delay 0 state 3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: exec thread 01e921e0 callback&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: in krecv_pdu_begin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: recv PDU began, pdu handle 0x1e92268&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: in kread 0 48 0x1e8be58 0x1e92268&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: read 48 bytes of PDU header&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: read 48 PDU header bytes, opcode 0x23, dlength 0, data 0x1e8bec8, max 8192&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: in krecv_pdu_end&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: recv PDU finished for pdu handle 0x0x1e92268&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: put ev context 0x1e921e0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: login response status 0203&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: login_rsp ret (0)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: conn 0 login rejected: initiator error - target not found (02/03)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: iscsi_login_eh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: thread 01e942b0 delete: state 2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: deleting a scheduled/waiting thread!&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: put ev context 0x1e942b0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: login failed ISCSI_CONN_STATE_IN_LOGIN/R_STAGE_SESSION_REOPEN 8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: re-opening session 11 (reopen_cnt 8)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: thread 01e8e2e8 delete: state 1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: deleting a scheduled/waiting thread!&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: thread 01e8e320 delete: state 3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: disconnecting conn 0x1e8be20, fd 8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: in kstop_conn&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: in __kipc_call&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: in kwritev&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: in nlpayload_read&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: in nlpayload_read&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: connection 11:0 is stopped for recovery&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 22 19:37:29 10-180-0-46 iscsid: Waiting 2 seconds before trying to reconnect.&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&quot;open-iscsi&amp;#x7684;&amp;#x90E8;&amp;#x5206;&amp;#x5B9E;&amp;#x73B0;&quot;&gt;&lt;a href=&quot;#open-iscsi&amp;#x7684;&amp;#x90E8;&amp;#x5206;&amp;#x5B9E;&amp;#x73B0;&quot; class=&quot;headerlink&quot; title=&quot;open-iscsi&amp;#x7684;&amp;#x90E8;&amp;#x5206;&amp;#x5B9E;&amp;#x73B0;&quot;&gt;&lt;/a&gt;open-iscsi&amp;#x7684;&amp;#x90E8;&amp;#x5206;&amp;#x5B9E;&amp;#x73B0;&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;void event_loop(struct iscsi_ipc *ipc, int control_fd, int mgmt_ipc_fd)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...........&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		res = poll(poll_array, POLL_MAX, ACTOR_RESOLUTION);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		if (res &amp;gt; 0) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			log_debug(6, &amp;quot;poll result %d&amp;quot;, res);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			if (poll_array[POLL_CTRL].revents)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				ipc-&amp;gt;ctldev_handle();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			if (poll_array[POLL_IPC].revents)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				mgmt_ipc_handle(mgmt_ipc_fd);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		} else if (res &amp;lt; 0) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			if (errno == EINTR) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				log_debug(1, &amp;quot;event_loop interrupted&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			} else {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				log_error(&amp;quot;got poll() error (%d), errno (%d), &amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;					  &amp;quot;exiting&amp;quot;, res, errno);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				break;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		} else&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			actor_poll();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	...........&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;open-iscsi&amp;#x91CC;&amp;#x901A;&amp;#x8FC7;poll&amp;#x7684;&amp;#x8D85;&amp;#x65F6;&amp;#x6765;&amp;#x5B9E;&amp;#x73B0;&amp;#x7684;&amp;#x5B9A;&amp;#x65F6;&amp;#x5668;&amp;#xFF0C;&amp;#x91CD;&amp;#x8FDE;&amp;#x673A;&amp;#x5236;&amp;#x5C31;&amp;#x662F;&amp;#x6CE8;&amp;#x518C;&amp;#x4E86;&amp;#x4E00;&amp;#x4E2A;&amp;#x5B9A;&amp;#x65F6;&amp;#x5668;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5F53;poll&amp;#x8FD4;&amp;#x56DE;0&amp;#xFF08;&amp;#x8868;&amp;#x793A;timeout&amp;#xFF09;&amp;#x65F6;&amp;#xFF0C;&amp;#x5C31;&amp;#x8C03;&amp;#x7528;&amp;#x5230;actor_poll()&amp;#x8FDB;&amp;#x800C;&amp;#x8C03;&amp;#x7528;&amp;#x4E4B;&amp;#x524D;&amp;#x6CE8;&amp;#x518C;&amp;#x7684;&amp;#x56DE;&amp;#x8C03;&amp;#x51FD;&amp;#x6570;&amp;#x3002;&amp;#x5F53;&amp;#x9891;&amp;#x7E41;&amp;#x8C03;&amp;#x7528;iscsiadm&amp;#x547D;&amp;#x4EE4;&amp;#x65F6;&amp;#x5C31;&amp;#x4F1A;&amp;#x89E6;&amp;#x53D1;poll&amp;#x4E8B;&amp;#x4EF6;&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;&amp;#x4E00;&amp;#x76F4;&amp;#x6CA1;&amp;#x6709;&amp;#x53BB;&amp;#x8C03;&amp;#x7528;actor_poll()&amp;#x5BFC;&amp;#x81F4;&amp;#x7684;&amp;#x73B0;&amp;#x8C61;&amp;#x5C31;&amp;#x662F;iscsi&amp;#x6CA1;&amp;#x53BB;&amp;#x91CD;&amp;#x8FDE;&amp;#x3002;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;open-iscsi&amp;#x5B9E;&amp;#x73B0;&amp;#x4E86;iscsi&amp;#x7684;&amp;#x81EA;&amp;#x52A8;&amp;#x91CD;&amp;#x8FDE;&amp;#xFF0C;&amp;#x5F53;target&amp;#x6240;&amp;#x5728;&amp;#x673A;&amp;#x5668;&amp;#x91CD;&amp;#x542F;&amp;#x6216;&amp;#x8005;target&amp;#x7684;&amp;#x7F51;&amp;#x7EDC;&amp;#x5F02;&amp;#x5E38;&amp;#x65F6;&amp;#xFF0C;open-iscsi&amp;#x90FD;&amp;#x4F1A;&amp;#x4E00;&amp;#x76F4;&amp;#x5C1D;&amp;#x8BD5;connect&amp;#xFF0C;&amp;#x4E00;&amp;#x65E6;&amp;#x5F53;target&amp;#x91CD;&amp;#x5EFA;&amp;#x51FA;&amp;#x6765;&amp;#x540E;&amp;#xFF0C;open-iscsi&amp;#x5C31;&amp;#x80FD;&amp;#x591F;&amp;#x91CD;&amp;#x65B0;login&amp;#x6210;&amp;#x529F;&amp;#x3002;&amp;#x4F46;&amp;#x662F;&amp;#x6D4B;&amp;#x8BD5;&amp;#x65F6;&amp;#x53D1;&amp;#x73B0;&amp;#xFF0C;&amp;#x5F53;&amp;#x9891;&amp;#x7E41;&amp;#x6267;&amp;#x884C;iscsiadm&amp;#x7684;&amp;#x547D;&amp;#x4EE4;&amp;#x65F6;&amp;#xFF0C;&amp;#x4F1A;&amp;#x5BFC;&amp;#x81F4;open-iscsi&amp;#x4E0D;&amp;#x53BB;&amp;#x8FDB;&amp;#x884C;&amp;#x91CD;&amp;#x8FDE;&amp;#x4E86;&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;&amp;#x89C2;&amp;#x5BDF;&amp;#x5230;&amp;#x7684;&amp;#x73B0;&amp;#x8C61;&quot;&gt;&lt;a href=&quot;#&amp;#x89C2;&amp;#x5BDF;&amp;#x5230;&amp;#x7684;&amp;#x73B0;&amp;#x8C61;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x89C2;&amp;#x5BDF;&amp;#x5230;&amp;#x7684;&amp;#x73B0;&amp;#x8C61;&quot;&gt;&lt;/a&gt;&amp;#x89C2;&amp;#x5BDF;&amp;#x5230;&amp;#x7684;&amp;#x73B0;&amp;#x8C61;&lt;/h2&gt;&lt;p&gt;&amp;#x5F53;target&amp;#x5F02;&amp;#x5E38;&amp;#x65F6;&amp;#xFF0C;strace&amp;#x8DDF;&amp;#x8E2A;iscsid&amp;#x8FDB;&amp;#x7A0B;&amp;#x4F1A;&amp;#x53D1;&amp;#x73B0;&amp;#x4E00;&amp;#x76F4;&amp;#x5C1D;&amp;#x8BD5;&amp;#x91CD;&amp;#x8FDE;&amp;#xFF0C;&amp;#x4E0D;&amp;#x8FC7;&amp;#x4E00;&amp;#x76F4;&amp;#x5931;&amp;#x8D25;&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ sudo strace -e connect -p 28022 -t&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Process 28022 attached - interrupt to quit&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15:19:31 connect(10, {sa_family=AF_INET, sin_port=htons(3260), sin_addr=inet_addr(&amp;quot;10.180.0.30&amp;quot;)}, 128) = -1 EINPROGRESS (Operation now in progress)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15:19:34 connect(10, {sa_family=AF_INET, sin_port=htons(3260), sin_addr=inet_addr(&amp;quot;10.180.0.30&amp;quot;)}, 128) = -1 EINPROGRESS (Operation now in progress)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15:19:37 connect(10, {sa_family=AF_INET, sin_port=htons(3260), sin_addr=inet_addr(&amp;quot;10.180.0.30&amp;quot;)}, 128) = -1 EINPROGRESS (Operation now in progress)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15:19:40 connect(10, {sa_family=AF_INET, sin_port=htons(3260), sin_addr=inet_addr(&amp;quot;10.180.0.30&amp;quot;)}, 128) = -1 EINPROGRESS (Operation now in progress)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x6A21;&amp;#x62DF;&amp;#x9891;&amp;#x7E41;&amp;#x6267;&amp;#x884C;iscsiadm&amp;#x7684;&amp;#x547D;&amp;#x4EE4;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ for i in {1..10000};do sudo iscsiadm -m session -P3 2&amp;amp;&amp;gt; /dev/null;done&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x8FD9;&amp;#x4E2A;&amp;#x65F6;&amp;#x5019;&amp;#x53BB;strace&amp;#x8DDF;&amp;#x8E2A;&amp;#x4F1A;&amp;#x53D1;&amp;#x73B0;&amp;#x6CA1;&amp;#x6709;&amp;#x53BB;&amp;#x91CD;&amp;#x8FDE;target&amp;#x7684;&amp;#x4FE1;&amp;#x606F;&amp;#xFF0C;&amp;#x53CD;&amp;#x800C;&amp;#x662F;&amp;#x4E00;&amp;#x4E9B;&amp;#x5947;&amp;#x602A;&amp;#x7684;&amp;#x8BB0;&amp;#x5F55;&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;17:24:12 connect(9, {sa_family=AF_FILE, path=&amp;quot;/var/run/nscd/socket&amp;quot;}, 110) = -1 ENOENT (No such file or directory)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17:24:13 connect(9, {sa_family=AF_FILE, path=&amp;quot;/var/run/nscd/socket&amp;quot;}, 110) = -1 ENOENT (No such file or directory)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17:24:14 connect(9, {sa_family=AF_FILE, path=&amp;quot;/var/run/nscd/socket&amp;quot;}, 110) = -1 ENOENT (No such file or directory)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17:24:14 connect(9, {sa_family=AF_FILE, path=&amp;quot;/var/run/nscd/socket&amp;quot;}, 110) = -1 ENOENT (No such file or directory)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17:24:15 connect(9, {sa_family=AF_FILE, path=&amp;quot;/var/run/nscd/socket&amp;quot;}, 110) = -1 ENOENT (No such file or directory)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="iscsi" scheme="http://yoursite.com/categories/iscsi/"/>
    
    
      <category term="iscsi" scheme="http://yoursite.com/tags/iscsi/"/>
    
  </entry>
  
  <entry>
    <title>坏盘导致IO hang问题分析（续）</title>
    <link href="http://yoursite.com/2017/03/15/error-disk-cause-iohang2/"/>
    <id>http://yoursite.com/2017/03/15/error-disk-cause-iohang2/</id>
    <published>2017-03-15T08:21:22.000Z</published>
    <updated>2017-03-15T08:25:51.886Z</updated>
    
    <content type="html">&lt;p&gt;&amp;#x7ECF;&amp;#x8FC7;&amp;#x524D;&amp;#x9762;&amp;#x7684;&amp;#x5206;&amp;#x6790;&amp;#x6D4B;&amp;#x8BD5;&amp;#xFF0C;&amp;#x4F7F;&amp;#x7528;fio&amp;#x76F4;&amp;#x63A5;&amp;#x6D4B;&amp;#x8BD5;&amp;#x88F8;&amp;#x76D8;&amp;#xFF08;direct=1&amp;#xFF09;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x5C06;&amp;#x540E;&amp;#x7AEF;&amp;#x8BBE;&amp;#x5907;suspend&amp;#x4F4F;&amp;#x540E;&amp;#xFF0C;fio&amp;#x7684;IO hang&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x8DDF;&amp;#x524D;&amp;#x9762;&amp;#x8BA1;&amp;#x7B97;&amp;#x7684;&amp;#x4E00;&amp;#x81F4;&amp;#xFF1B;&amp;#x4F46;&amp;#x662F;&amp;#x5F53;&amp;#x5728;&amp;#x865A;&amp;#x62DF;&amp;#x673A;&amp;#x91CC;&amp;#x5BF9;&amp;#x8FD9;&amp;#x5757;&amp;#x76D8;&amp;#x505A;&amp;#x4E86;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;fio&amp;#x6D4B;&amp;#x8BD5;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#xFF08;direct=1&amp;#xFF09;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x5C06;&amp;#x540E;&amp;#x7AEF;&amp;#x8BBE;&amp;#x5907;suspend&amp;#x4F4F;&amp;#x540E;&amp;#xFF0C;fio&amp;#x7684;IO hang&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x591A;&amp;#x4E86;20~30s&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;&amp;#x521D;&amp;#x6B65;&amp;#x5206;&amp;#x6790;&quot;&gt;&lt;a href=&quot;#&amp;#x521D;&amp;#x6B65;&amp;#x5206;&amp;#x6790;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x521D;&amp;#x6B65;&amp;#x5206;&amp;#x6790;&quot;&gt;&lt;/a&gt;&amp;#x521D;&amp;#x6B65;&amp;#x5206;&amp;#x6790;&lt;/h2&gt;&lt;p&gt;&amp;#x4E00;&amp;#x5F00;&amp;#x59CB;&amp;#x6000;&amp;#x7591;&amp;#x662F;&amp;#x7531;&amp;#x4E8E;&amp;#x865A;&amp;#x62DF;&amp;#x673A;&amp;#x8FD9;&amp;#x5C42;&amp;#x7684;&amp;#x4F5C;&amp;#x7528;&amp;#xFF0C;&amp;#x56E0;&amp;#x6B64;&amp;#x8FD8;&amp;#x8C03;&amp;#x6574;&amp;#x8FC7;KVM&amp;#x4F7F;&amp;#x7528;&amp;#x7684;&amp;#x76D8;&amp;#x7684;&amp;#x7F13;&amp;#x5B58;&amp;#x7B56;&amp;#x7565;&amp;#xFF08;none&amp;#x3001;writethrough&amp;#x3001;directsync&amp;#xFF09;&amp;#xFF0C;&amp;#x540C;&amp;#x6837;&amp;#x7684;&amp;#x6D4B;&amp;#x8BD5;&amp;#xFF0C;&amp;#x4ECD;&amp;#x7136;&amp;#x662F;IO hang&amp;#x6BD4;&amp;#x9884;&amp;#x671F;&amp;#x7684;&amp;#x591A;20~30s&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x6253;&amp;#x5F00;iscsi session debug&amp;#x5F00;&amp;#x5173;&amp;#xFF0C;&amp;#x5F00;&amp;#x542F;scsi error&amp;#x548C;timeout&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5206;&amp;#x6790;&amp;#x8FD9;&amp;#x6837;&amp;#x6D4B;&amp;#x8BD5;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&amp;#x4FE1;&amp;#x606F;&amp;#x3002;&amp;#x4E0B;&amp;#x9762;&amp;#x622A;&amp;#x53D6;&amp;#x90E8;&amp;#x5206;&amp;#x65E5;&amp;#x5FD7;&amp;#xFF0C;&amp;#x53D1;&amp;#x73B0;&amp;#x6709;3&amp;#x4E2A;&amp;#x65F6;&amp;#x95F4;&amp;#x70B9;&amp;#xFF1A;16:45:21&amp;#x3001;16:45:31&amp;#x3001;16:45:41&amp;#x6BD4;&amp;#x8F83;&amp;#x5947;&amp;#x602A;&amp;#xFF0C;&amp;#x6CA1;&amp;#x6709;&amp;#x8FDE;&amp;#x7EED;&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&amp;#xFF0C;&amp;#x90FD;&amp;#x6709;10s&amp;#x7684;&amp;#x7A7A;&amp;#x767D;&amp;#x671F;&amp;#x3002;&amp;#x800C;&amp;#x4E14;&amp;#x4ECE;16:45:41&amp;#x5230;16:45:51&amp;#x540E;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x201D;Device offlined - not ready after error recovery&amp;#x201D;&amp;#xFF0C;&amp;#x800C;&amp;#x4E4B;&amp;#x524D;&amp;#x4ECE;&amp;#x88F8;&amp;#x76D8;&amp;#x4E0A;&amp;#x6D4B;&amp;#x8BD5;&amp;#x65F6;&amp;#x662F;&amp;#x6CA1;&amp;#x6709;&amp;#x8FD9;&amp;#x51E0;&amp;#x6B21;10s&amp;#x7684;&amp;#x7A7A;&amp;#x767D;&amp;#x671F;&amp;#xFF0C;&amp;#x800C;&amp;#x4E14;&amp;#x662F;I/O error&amp;#xFF0C;&amp;#x800C;&amp;#x4E0D;&amp;#x662F;device offlined&amp;#x540E;&amp;#x518D;I/O error&amp;#x3002;&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;104&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;105&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;106&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;107&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;108&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;109&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;110&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;111&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;112&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;113&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;114&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;115&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;116&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;117&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;118&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;119&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;120&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;121&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;122&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;123&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;124&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;125&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;126&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;127&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;128&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;129&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;130&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;131&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;132&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;133&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;134&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;135&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;136&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;137&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;138&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;139&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;140&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;141&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;142&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;143&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;144&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;145&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;146&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;147&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;148&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;149&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;150&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;151&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;152&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;153&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;154&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;155&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;156&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;157&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;158&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;159&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;160&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;161&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;162&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;163&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;164&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;165&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;166&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;167&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;168&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;169&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;170&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;171&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;173&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;174&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;175&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;176&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;177&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;178&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;179&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;180&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;181&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;182&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;183&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;184&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;185&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;186&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;187&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;188&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;189&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;190&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;191&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;192&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;193&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;194&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;195&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;196&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;197&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;198&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;199&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;200&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;201&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;202&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;203&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;204&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;205&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;206&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;207&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;208&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;209&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;210&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;211&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;212&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;213&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;214&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;215&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;216&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;217&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;218&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;219&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;220&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;221&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:01 10-180-0-37 bash: HISTORY: PID=17516 UID=2010 sudo dmsetup suspend /dev/mapper/chunk_ebsdisk01_a551bcbe-a6c_1_1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...........&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:02 10-180-0-37 kernel: [3820717.924401]  session50: iscsi_eh_cmd_timed_out scsi cmd ffff881e3dd21780 timedout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:02 10-180-0-37 kernel: [3820717.924415]  session50: iscsi_eh_cmd_timed_out return timer reset&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;.......&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:04 10-180-0-37 kernel: [3820719.927424]  session50: iscsi_eh_cmd_timed_out scsi cmd ffff881e3dd21780 timedout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:04 10-180-0-37 kernel: [3820719.927434]  session50: iscsi_eh_cmd_timed_out return nh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:04 10-180-0-37 kernel: [3820719.927437] Waking error handler thread&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:04 10-180-0-37 kernel: [3820719.927446] Error handler scsi_eh_50 waking up&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:04 10-180-0-37 kernel: [3820719.927620] sd 50:0:0:11: scsi_eh_prt_fail_stats: cmds failed: 0, cancel: 1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:04 10-180-0-37 kernel: [3820719.927627] Total of 1 commands on 1 devices require eh work&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:04 10-180-0-37 kernel: [3820719.927629] scsi_eh_50: aborting cmd:0xffff881e3dd21780&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:04 10-180-0-37 kernel: [3820719.927632]  session50: iscsi_eh_abort aborting sc ffff881e3dd21780&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:04 10-180-0-37 kernel: [3820719.927635]  session50: iscsi_eh_abort aborting [sc ffff881e3dd21780 itt 0x35]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:04 10-180-0-37 kernel: [3820719.927641]  session50: iscsi_exec_task_mgmt_fn tmf set timeout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:04 10-180-0-37 kernel: [3820719.927688] iscsi_trgt: Abort Task (01) issued on tid:2000 lun:11 by sid:7881300190757376 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:04 10-180-0-37 kernel: [3820719.927726]  session50: iscsi_eh_abort abort success [sc ffff881e3dd21780 itt 0x35]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:04 10-180-0-37 kernel: [3820719.927784] scsi_eh_done scmd: ffff881e3dd21780 result: 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:04 10-180-0-37 kernel: [3820719.927791] scsi_send_eh_cmnd: scmd: ffff881e3dd21780, timeleft: 2500&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:04 10-180-0-37 kernel: [3820719.927793] scsi_send_eh_cmnd: scsi_eh_completed_normally 2002&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:04 10-180-0-37 kernel: [3820719.927796] scsi_eh_tur: scmd ffff881e3dd21780 rtn 2002&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:04 10-180-0-37 kernel: [3820719.927798] scsi_eh_50: flush retry cmd: ffff881e3dd21780&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:04 10-180-0-37 kernel: [3820719.927963] scsi_restart_operations: waking up host to restart&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:04 10-180-0-37 kernel: [3820719.928153] Error handler scsi_eh_50 sleeping&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;.............&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:06 10-180-0-37 kernel: [3820721.746537]  session50: iscsi_eh_cmd_timed_out scsi cmd ffff881e3dd21780 timedout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:06 10-180-0-37 kernel: [3820721.746553]  session50: iscsi_eh_cmd_timed_out return timer reset&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...................&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:08 10-180-0-37 kernel: [3820723.745561]  session50: iscsi_eh_cmd_timed_out scsi cmd ffff881e3dd21780 timedout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:08 10-180-0-37 kernel: [3820723.745574]  session50: iscsi_eh_cmd_timed_out return nh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:08 10-180-0-37 kernel: [3820723.745577]  session50: iscsi_eh_cmd_timed_out scsi cmd ffff881e57fee080 timedout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:08 10-180-0-37 kernel: [3820723.745585]  session50: iscsi_eh_cmd_timed_out return timer reset&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;................&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:10 10-180-0-37 kernel: [3820725.744585]  session50: iscsi_eh_cmd_timed_out scsi cmd ffff881e57fee080 timedout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:10 10-180-0-37 kernel: [3820725.744598]  session50: iscsi_eh_cmd_timed_out return nh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:10 10-180-0-37 kernel: [3820725.744602] Waking error handler thread&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:10 10-180-0-37 kernel: [3820725.744606] Error handler scsi_eh_50 waking up&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:10 10-180-0-37 kernel: [3820725.744785] sd 50:0:0:11: scsi_eh_prt_fail_stats: cmds failed: 0, cancel: 2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:10 10-180-0-37 kernel: [3820725.744791] Total of 2 commands on 1 devices require eh work&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:10 10-180-0-37 kernel: [3820725.744793] scsi_eh_50: aborting cmd:0xffff881e3dd21780&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:10 10-180-0-37 kernel: [3820725.744796]  session50: iscsi_eh_abort aborting sc ffff881e3dd21780&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:10 10-180-0-37 kernel: [3820725.744799]  session50: iscsi_eh_abort aborting [sc ffff881e3dd21780 itt 0x2d]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:10 10-180-0-37 kernel: [3820725.744806]  session50: iscsi_exec_task_mgmt_fn tmf set timeout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:10 10-180-0-37 kernel: [3820725.744855] iscsi_trgt: Abort Task (01) issued on tid:2000 lun:11 by sid:7881300190757376 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:10 10-180-0-37 kernel: [3820725.744902]  session50: iscsi_eh_abort abort success [sc ffff881e3dd21780 itt 0x2d]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:10 10-180-0-37 kernel: [3820725.744904] scsi_eh_50: aborting cmd:0xffff881e57fee080&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:10 10-180-0-37 kernel: [3820725.744906]  session50: iscsi_eh_abort aborting sc ffff881e57fee080&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:10 10-180-0-37 kernel: [3820725.744908]  session50: iscsi_eh_abort aborting [sc ffff881e57fee080 itt 0x36]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:10 10-180-0-37 kernel: [3820725.744916]  session50: iscsi_exec_task_mgmt_fn tmf set timeout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:10 10-180-0-37 kernel: [3820725.744936] iscsi_trgt: Abort Task (01) issued on tid:2000 lun:11 by sid:7881300190757376 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:10 10-180-0-37 kernel: [3820725.744959]  session50: iscsi_eh_abort abort success [sc ffff881e57fee080 itt 0x36]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:10 10-180-0-37 kernel: [3820725.745033] scsi_eh_done scmd: ffff881e3dd21780 result: 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:10 10-180-0-37 kernel: [3820725.745040] scsi_send_eh_cmnd: scmd: ffff881e3dd21780, timeleft: 2500&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:10 10-180-0-37 kernel: [3820725.745042] scsi_send_eh_cmnd: scsi_eh_completed_normally 2002&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:10 10-180-0-37 kernel: [3820725.745045] scsi_eh_tur: scmd ffff881e3dd21780 rtn 2002&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:10 10-180-0-37 kernel: [3820725.745046] scsi_eh_50: flush retry cmd: ffff881e3dd21780&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:10 10-180-0-37 kernel: [3820725.745054] scsi_eh_50: flush retry cmd: ffff881e57fee080&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:10 10-180-0-37 kernel: [3820725.745214] scsi_restart_operations: waking up host to restart&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:10 10-180-0-37 kernel: [3820725.745404] Error handler scsi_eh_50 sleeping&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:11 10-180-0-37 kernel: [3820727.007961]  session50: iscsi_eh_cmd_timed_out scsi cmd ffff881e57fee080 timedout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:11 10-180-0-37 kernel: [3820727.007978]  session50: iscsi_eh_cmd_timed_out return timer reset&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:11 10-180-0-37 kernel: [3820727.007981]  session50: iscsi_eh_cmd_timed_out scsi cmd ffff881e3dd21780 timedout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:11 10-180-0-37 kernel: [3820727.007984]  session50: iscsi_eh_cmd_timed_out return timer reset&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;.................&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:13 10-180-0-37 kernel: [3820729.006987]  session50: iscsi_eh_cmd_timed_out scsi cmd ffff881e57fee080 timedout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:13 10-180-0-37 kernel: [3820729.007000]  session50: iscsi_eh_cmd_timed_out return nh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:13 10-180-0-37 kernel: [3820729.007004]  session50: iscsi_eh_cmd_timed_out scsi cmd ffff881e3dd21780 timedout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:13 10-180-0-37 kernel: [3820729.007006]  session50: iscsi_eh_cmd_timed_out return nh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:13 10-180-0-37 kernel: [3820729.007010] Waking error handler thread&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:13 10-180-0-37 kernel: [3820729.007015] Error handler scsi_eh_50 waking up&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:13 10-180-0-37 kernel: [3820729.007194] sd 50:0:0:11: scsi_eh_prt_fail_stats: cmds failed: 0, cancel: 2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:13 10-180-0-37 kernel: [3820729.007201] Total of 2 commands on 1 devices require eh work&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:13 10-180-0-37 kernel: [3820729.007203] scsi_eh_50: aborting cmd:0xffff881e57fee080&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:13 10-180-0-37 kernel: [3820729.007206]  session50: iscsi_eh_abort aborting sc ffff881e57fee080&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:13 10-180-0-37 kernel: [3820729.007208]  session50: iscsi_eh_abort aborting [sc ffff881e57fee080 itt 0x3a]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:13 10-180-0-37 kernel: [3820729.007215]  session50: iscsi_exec_task_mgmt_fn tmf set timeout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:13 10-180-0-37 kernel: [3820729.007264] iscsi_trgt: Abort Task (01) issued on tid:2000 lun:11 by sid:7881300190757376 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:13 10-180-0-37 kernel: [3820729.007304]  session50: iscsi_eh_abort abort success [sc ffff881e57fee080 itt 0x3a]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:13 10-180-0-37 kernel: [3820729.007306] scsi_eh_50: aborting cmd:0xffff881e3dd21780&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:13 10-180-0-37 kernel: [3820729.007308]  session50: iscsi_eh_abort aborting sc ffff881e3dd21780&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:13 10-180-0-37 kernel: [3820729.007310]  session50: iscsi_eh_abort aborting [sc ffff881e3dd21780 itt 0x40]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:13 10-180-0-37 kernel: [3820729.007317]  session50: iscsi_exec_task_mgmt_fn tmf set timeout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:13 10-180-0-37 kernel: [3820729.007340] iscsi_trgt: Abort Task (01) issued on tid:2000 lun:11 by sid:7881300190757376 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:13 10-180-0-37 kernel: [3820729.007359]  session50: iscsi_eh_abort abort success [sc ffff881e3dd21780 itt 0x40]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:13 10-180-0-37 kernel: [3820729.007428] scsi_eh_done scmd: ffff881e57fee080 result: 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:13 10-180-0-37 kernel: [3820729.007435] scsi_send_eh_cmnd: scmd: ffff881e57fee080, timeleft: 2500&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:13 10-180-0-37 kernel: [3820729.007437] scsi_send_eh_cmnd: scsi_eh_completed_normally 2002&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:13 10-180-0-37 kernel: [3820729.007440] scsi_eh_tur: scmd ffff881e57fee080 rtn 2002&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:13 10-180-0-37 kernel: [3820729.007442] scsi_eh_50: flush retry cmd: ffff881e57fee080&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:13 10-180-0-37 kernel: [3820729.007449] scsi_eh_50: flush retry cmd: ffff881e3dd21780&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:13 10-180-0-37 kernel: [3820729.007610] scsi_restart_operations: waking up host to restart&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:13 10-180-0-37 kernel: [3820729.007801] Error handler scsi_eh_50 sleeping&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;..............&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:15 10-180-0-37 kernel: [3820730.982019]  session50: iscsi_eh_cmd_timed_out scsi cmd ffff881e3dd21780 timedout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:15 10-180-0-37 kernel: [3820730.982037]  session50: iscsi_eh_cmd_timed_out return timer reset&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:15 10-180-0-37 kernel: [3820730.982040]  session50: iscsi_eh_cmd_timed_out scsi cmd ffff881e57fee080 timedout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:15 10-180-0-37 kernel: [3820730.982043]  session50: iscsi_eh_cmd_timed_out return timer reset&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:17 10-180-0-37 kernel: [3820732.981042]  session50: iscsi_eh_cmd_timed_out scsi cmd ffff881e3dd21780 timedout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:17 10-180-0-37 kernel: [3820732.981055]  session50: iscsi_eh_cmd_timed_out return nh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:17 10-180-0-37 kernel: [3820732.981060]  session50: iscsi_eh_cmd_timed_out scsi cmd ffff881e57fee080 timedout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:17 10-180-0-37 kernel: [3820732.981062]  session50: iscsi_eh_cmd_timed_out return nh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:17 10-180-0-37 kernel: [3820732.981066] Waking error handler thread&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:17 10-180-0-37 kernel: [3820732.981069] Error handler scsi_eh_50 waking up&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:17 10-180-0-37 kernel: [3820732.981246] sd 50:0:0:11: scsi_eh_prt_fail_stats: cmds failed: 0, cancel: 2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:17 10-180-0-37 kernel: [3820732.981253] Total of 2 commands on 1 devices require eh work&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:17 10-180-0-37 kernel: [3820732.981255] scsi_eh_50: aborting cmd:0xffff881e3dd21780&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:17 10-180-0-37 kernel: [3820732.981258]  session50: iscsi_eh_abort aborting sc ffff881e3dd21780&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:17 10-180-0-37 kernel: [3820732.981260]  session50: iscsi_eh_abort aborting [sc ffff881e3dd21780 itt 0x3e]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:17 10-180-0-37 kernel: [3820732.981267]  session50: iscsi_exec_task_mgmt_fn tmf set timeout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:17 10-180-0-37 kernel: [3820732.981322] iscsi_trgt: Abort Task (01) issued on tid:2000 lun:11 by sid:7881300190757376 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:17 10-180-0-37 kernel: [3820732.981365]  session50: iscsi_eh_abort abort success [sc ffff881e3dd21780 itt 0x3e]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:17 10-180-0-37 kernel: [3820732.981368] scsi_eh_50: aborting cmd:0xffff881e57fee080&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:17 10-180-0-37 kernel: [3820732.981370]  session50: iscsi_eh_abort aborting sc ffff881e57fee080&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:17 10-180-0-37 kernel: [3820732.981373]  session50: iscsi_eh_abort aborting [sc ffff881e57fee080 itt 0x3b]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:17 10-180-0-37 kernel: [3820732.981393]  session50: iscsi_exec_task_mgmt_fn tmf set timeout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:17 10-180-0-37 kernel: [3820732.981420] iscsi_trgt: Abort Task (01) issued on tid:2000 lun:11 by sid:7881300190757376 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:17 10-180-0-37 kernel: [3820732.981439]  session50: iscsi_eh_abort abort success [sc ffff881e57fee080 itt 0x3b]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:17 10-180-0-37 kernel: [3820732.981510] scsi_eh_done scmd: ffff881e3dd21780 result: 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:17 10-180-0-37 kernel: [3820732.981520] scsi_send_eh_cmnd: scmd: ffff881e3dd21780, timeleft: 2500&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:17 10-180-0-37 kernel: [3820732.981523] scsi_send_eh_cmnd: scsi_eh_completed_normally 2002&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:17 10-180-0-37 kernel: [3820732.981526] scsi_eh_tur: scmd ffff881e3dd21780 rtn 2002&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:17 10-180-0-37 kernel: [3820732.981529] scsi_eh_50: flush retry cmd: ffff881e3dd21780&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:17 10-180-0-37 kernel: [3820732.981537] scsi_eh_50: flush retry cmd: ffff881e57fee080&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:17 10-180-0-37 kernel: [3820732.981702] scsi_restart_operations: waking up host to restart&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:17 10-180-0-37 kernel: [3820732.981894] Error handler scsi_eh_50 sleeping&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...............&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:19 10-180-0-37 kernel: [3820734.836136]  session50: iscsi_eh_cmd_timed_out scsi cmd ffff881e57fee080 timedout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:19 10-180-0-37 kernel: [3820734.836155]  session50: iscsi_eh_cmd_timed_out return timer reset&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:19 10-180-0-37 kernel: [3820734.836158]  session50: iscsi_eh_cmd_timed_out scsi cmd ffff881e3dd21780 timedout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:19 10-180-0-37 kernel: [3820734.836160]  session50: iscsi_eh_cmd_timed_out return timer reset&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;................&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:21 10-180-0-37 kernel: [3820736.835160]  session50: iscsi_eh_cmd_timed_out scsi cmd ffff881e57fee080 timedout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:21 10-180-0-37 kernel: [3820736.835174]  session50: iscsi_eh_cmd_timed_out return nh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:21 10-180-0-37 kernel: [3820736.835178]  session50: iscsi_eh_cmd_timed_out scsi cmd ffff881e3dd21780 timedout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:21 10-180-0-37 kernel: [3820736.835180]  session50: iscsi_eh_cmd_timed_out return nh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:21 10-180-0-37 kernel: [3820736.835184] Waking error handler thread&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:21 10-180-0-37 kernel: [3820736.835188] Error handler scsi_eh_50 waking up&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:21 10-180-0-37 kernel: [3820736.835374] sd 50:0:0:11: scsi_eh_prt_fail_stats: cmds failed: 0, cancel: 2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:21 10-180-0-37 kernel: [3820736.835381] Total of 2 commands on 1 devices require eh work&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:21 10-180-0-37 kernel: [3820736.835383] scsi_eh_50: aborting cmd:0xffff881e57fee080&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:21 10-180-0-37 kernel: [3820736.835386]  session50: iscsi_eh_abort aborting sc ffff881e57fee080&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:21 10-180-0-37 kernel: [3820736.835388]  session50: iscsi_eh_abort aborting [sc ffff881e57fee080 itt 0x47]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:21 10-180-0-37 kernel: [3820736.835394]  session50: iscsi_exec_task_mgmt_fn tmf set timeout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:21 10-180-0-37 kernel: [3820736.835438] iscsi_trgt: Abort Task (01) issued on tid:2000 lun:11 by sid:7881300190757376 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:21 10-180-0-37 kernel: [3820736.835474]  session50: iscsi_eh_abort abort success [sc ffff881e57fee080 itt 0x47]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:21 10-180-0-37 kernel: [3820736.835476] scsi_eh_50: aborting cmd:0xffff881e3dd21780&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:21 10-180-0-37 kernel: [3820736.835478]  session50: iscsi_eh_abort aborting sc ffff881e3dd21780&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:21 10-180-0-37 kernel: [3820736.835480]  session50: iscsi_eh_abort aborting [sc ffff881e3dd21780 itt 0x48]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:21 10-180-0-37 kernel: [3820736.835484]  session50: iscsi_exec_task_mgmt_fn tmf set timeout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:21 10-180-0-37 kernel: [3820736.835501] iscsi_trgt: Abort Task (01) issued on tid:2000 lun:11 by sid:7881300190757376 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:21 10-180-0-37 kernel: [3820736.835520]  session50: iscsi_eh_abort abort success [sc ffff881e3dd21780 itt 0x48]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;.............&amp;#x4ECE;&amp;#x8FD9;&amp;#x91CC;&amp;#x5F00;&amp;#x59CB;&amp;#x5C31;&amp;#x662F;&amp;#x7B49;&amp;#x4E86;&amp;#x5DEE;&amp;#x4E0D;&amp;#x591A;10s&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x6267;&amp;#x884C;&amp;#x4E86;&amp;#x4E0B;&amp;#x9762;&amp;#x7684;&amp;#x903B;&amp;#x8F91;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:31 10-180-0-37 kernel: [3820746.830267] scsi_send_eh_cmnd: scmd: ffff881e57fee080, timeleft: 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:31 10-180-0-37 kernel: [3820746.830274]  session50: iscsi_eh_abort aborting sc ffff881e57fee080&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:31 10-180-0-37 kernel: [3820746.830277]  session50: iscsi_eh_abort aborting [sc ffff881e57fee080 itt 0x42]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:31 10-180-0-37 kernel: [3820746.830283]  session50: iscsi_exec_task_mgmt_fn tmf set timeout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:31 10-180-0-37 kernel: [3820746.830325] iscsi_trgt: Abort Task (01) issued on tid:2000 lun:11 by sid:7881300190757376 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:31 10-180-0-37 kernel: [3820746.830364] scsi_eh_done scmd: ffff881e57fee080 result: 50000&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:31 10-180-0-37 kernel: [3820746.830367]  session50: iscsi_eh_abort abort success [sc ffff881e57fee080 itt 0x42]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:31 10-180-0-37 kernel: [3820746.830371] scsi_eh_tur: scmd ffff881e57fee080 rtn 2003&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:31 10-180-0-37 kernel: [3820746.830696] scsi_eh_50: Sending BDR sdev: 0xffff88329ad78800&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:31 10-180-0-37 kernel: [3820746.830698]  session50: iscsi_eh_device_reset LU Reset [sc ffff881e57fee080 lun 11]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:31 10-180-0-37 kernel: [3820746.830702]  session50: iscsi_exec_task_mgmt_fn tmf set timeout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:31 10-180-0-37 kernel: [3820746.830728] iscsi_trgt: Logical Unit Reset (05) issued on tid:2000 lun:11 by sid:7881300190757376 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:31 10-180-0-37 kernel: [3820746.830754]  session50: iscsi_eh_device_reset dev reset result = SUCCESS&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;..........&amp;#x53C8;&amp;#x7B49;10s&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:41 10-180-0-37 kernel: [3820756.825380] scsi_send_eh_cmnd: scmd: ffff881e57fee080, timeleft: 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:41 10-180-0-37 kernel: [3820756.825387]  session50: iscsi_eh_abort aborting sc ffff881e57fee080&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:41 10-180-0-37 kernel: [3820756.825390]  session50: iscsi_eh_abort aborting [sc ffff881e57fee080 itt 0x4e]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:41 10-180-0-37 kernel: [3820756.825397]  session50: iscsi_exec_task_mgmt_fn tmf set timeout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:41 10-180-0-37 kernel: [3820756.825441] iscsi_trgt: Abort Task (01) issued on tid:2000 lun:11 by sid:7881300190757376 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:41 10-180-0-37 kernel: [3820756.825475] scsi_eh_done scmd: ffff881e57fee080 result: 50000&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:41 10-180-0-37 kernel: [3820756.825479]  session50: iscsi_eh_abort abort success [sc ffff881e57fee080 itt 0x4e]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:41 10-180-0-37 kernel: [3820756.825482] scsi_eh_tur: scmd ffff881e57fee080 rtn 2003&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:41 10-180-0-37 kernel: [3820756.825497] scsi_eh_50: Sending target reset to target 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:41 10-180-0-37 kernel: [3820756.825500]  session50: iscsi_eh_target_reset tgt Reset [sc ffff881e57fee080 tgt iqn.com.netease:ebsdisk01.8.0.0]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:41 10-180-0-37 kernel: [3820756.825504]  session50: iscsi_exec_task_mgmt_fn tmf set timeout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:41 10-180-0-37 kernel: [3820756.825534] iscsi_trgt: Target Warm Reset (06) issued on tid:2000 lun:0 by sid:7881300190757376 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:41 10-180-0-37 kernel: [3820756.825561]  session50: iscsi_eh_target_reset tgt iqn.com.netease:ebsdisk01.8.0.0 reset result = SUCCESS&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;.............&amp;#x518D;&amp;#x7B49;10s&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x4ECE;&amp;#x4E0B;&amp;#x9762;&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&amp;#x6765;&amp;#x770B;&amp;#x662F;Device offlined&amp;#x540E;&amp;#x518D;&amp;#x51FA;&amp;#x73B0;I/O error&amp;#xFF0C;&amp;#x800C;&amp;#x4E0D;&amp;#x662F;&amp;#x5148;&amp;#x51FA;&amp;#x73B0;I/O error&amp;#x518D;Device offlined&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x6BD4;&amp;#x8F83;&amp;#x5947;&amp;#x602A;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.820489] scsi_send_eh_cmnd: scmd: ffff881e57fee080, timeleft: 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.820495]  session50: iscsi_eh_abort aborting sc ffff881e57fee080&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.820498]  session50: iscsi_eh_abort aborting [sc ffff881e57fee080 itt 0x55]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.820504]  session50: iscsi_exec_task_mgmt_fn tmf set timeout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.820546] iscsi_trgt: Abort Task (01) issued on tid:2000 lun:11 by sid:7881300190757376 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.820584] scsi_eh_done scmd: ffff881e57fee080 result: 50000&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.820587]  session50: iscsi_eh_abort abort success [sc ffff881e57fee080 itt 0x55]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.820590] scsi_eh_tur: scmd ffff881e57fee080 rtn 2003&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.820593] scsi_eh_50: Sending BRST chan: 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.820594] scsi_try_bus_reset: Snd Bus RST&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.820596] scsi_eh_50: BRST failed chan: 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.820597] scsi_eh_50: Sending HRST&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.820599] scsi_try_host_reset: Snd Host RST&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.820600] scsi_eh_50: HRST failed&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.820603] sd 50:0:0:11: Device offlined - not ready after error recovery&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.820606] sd 50:0:0:11: Device offlined - not ready after error recovery&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.820607] scsi_eh_50: flush finish cmd: ffff881e57fee080&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.820617] sd 50:0:0:11: [sdat] Unhandled error code&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.820619] sd 50:0:0:11: [sdat]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.820621] Result: hostbyte=DID_ABORT driverbyte=DRIVER_OK&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.820623] sd 50:0:0:11: [sdat] CDB:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.820625] Write(10): 2a 00 00 85 31 80 00 00 10 00&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.820633] end_request: I/O error, dev sdat, sector 8728960&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.827377] md/raid1:md388713: Disk failure on sdat, disabling device.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.827377] md/raid1:md388713: Operation continuing on 1 devices.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.827381] scsi_eh_50: flush finish cmd: ffff881e3dd21780&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.827386] sd 50:0:0:11: [sdat] Unhandled error code&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.827387] sd 50:0:0:11: [sdat]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.827388] Result: hostbyte=DID_ABORT driverbyte=DRIVER_OK&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.827389] sd 50:0:0:11: [sdat] CDB:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.827393] Write(10): 2a 00 00 0f 42 80 00 00 80 00&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.827394] end_request: I/O error, dev sdat, sector 1000064&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.827570] scsi_restart_operations: waking up host to restart&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.827760] Error handler scsi_eh_50 sleeping&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.848214] RAID1 conf printout:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.848217]  --- wd:1 rd:2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.848220]  disk 0, wo:0, o:1, dev:sdv&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.848221]  disk 1, wo:1, o:0, dev:sdat&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.881950] RAID1 conf printout:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.881953]  --- wd:1 rd:2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:51 10-180-0-37 kernel: [3820766.881956]  disk 0, wo:0, o:1, dev:sdv&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x53E6;&amp;#x5916;&amp;#x4ECE;scsi cmd&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&amp;#x4FE1;&amp;#x606F;&amp;#x6765;&amp;#x770B;&amp;#xFF0C;&amp;#x8D85;&amp;#x65F6;&amp;#x91CD;&amp;#x8BD5;&amp;#x5904;&amp;#x7406;&amp;#x7684;&amp;#x6709;2&amp;#x4E2A;&amp;#x8BF7;&amp;#x6C42;&amp;#xFF08;&amp;#x4E00;&amp;#x4E2A;&amp;#x662F;lba=1000064 txlen=128&amp;#x7684;&amp;#xFF0C;&amp;#x53E6;&amp;#x5916;&amp;#x4E00;&amp;#x4E2A;&amp;#x662F;lba=912384 txlen=128&amp;#x7684;&amp;#x8BF7;&amp;#x6C42;&amp;#xFF09;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x4ECE;&amp;#x91CD;&amp;#x8BD5;&amp;#x6B21;&amp;#x6570;&amp;#x4E0A;&amp;#x6765;&amp;#x770B;&amp;#xFF0C;&amp;#x5E76;&amp;#x6CA1;&amp;#x6709;&amp;#x5B8C;&amp;#x5168;&amp;#x8D70;&amp;#x5B8C;5&amp;#x6B21;&amp;#x91CD;&amp;#x8BD5;&amp;#xFF0C;&amp;#x4ECE;&amp;#x4E0A;&amp;#x9762;&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&amp;#x6765;&amp;#x770B;&amp;#x5E94;&amp;#x8BE5;&amp;#x662F;device offlined&amp;#x540E;&amp;#x5C31;&amp;#x6CA1;&amp;#x6709;&amp;#x7EE7;&amp;#x7EED;&amp;#x91CD;&amp;#x8BD5;&amp;#x4E86;&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;        &amp;lt;...&amp;gt;-68191 [024] .... 3820716.789544: scsi_dispatch_cmd_start: host_no=50 channel=0 id=0 lun=11 data_sgl=16 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=912384 txlen=128 protect=0 raw=2a 00 00 0d ec 00 00 00 80 00)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;lt;...&amp;gt;-68375 [020] .... 3820716.814538: scsi_dispatch_cmd_start: host_no=50 channel=0 id=0 lun=11 data_sgl=16 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=1000064 txlen=128 protect=0 raw=2a 00 00 0f 42 80 00 00 80 00)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &amp;lt;idle&amp;gt;-0     [012] d.s. 3820717.924396: scsi_dispatch_cmd_timeout: host_no=50 channel=0 id=0 lun=11 data_sgl=16 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 protect=0 raw=2a 00 00 0f 42 80 00 00 80 00) result=(driver=DRIVER_OK host=DID_OK message=COMMAND_COMPLETE status=SAM_STAT_GOOD)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &amp;lt;idle&amp;gt;-0     [012] dNs. 3820719.927417: scsi_dispatch_cmd_timeout: host_no=50 channel=0 id=0 lun=11 data_sgl=16 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=1000064 txlen=128 protect=0 raw=2a 00 00 0f 42 80 00 00 80 00) result=(driver=DRIVER_OK host=DID_TIME_OUT message=COMMAND_COMPLETE status=SAM_STAT_GOOD)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;kworker/27:1H-799   [027] .... 3820719.931530: scsi_dispatch_cmd_start: host_no=50 channel=0 id=0 lun=11 data_sgl=16 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=1000064 txlen=128 protect=0 raw=2a 00 00 0f 42 80 00 00 80 00)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &amp;lt;idle&amp;gt;-0     [027] dNs. 3820721.746530: scsi_dispatch_cmd_timeout: host_no=50 channel=0 id=0 lun=11 data_sgl=16 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=1000064 txlen=128 protect=0 raw=2a 00 00 0f 42 80 00 00 80 00) result=(driver=DRIVER_OK host=DID_OK message=COMMAND_COMPLETE status=SAM_STAT_GOOD)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;lt;...&amp;gt;-68191 [024] .... 3820721.896068: scsi_dispatch_cmd_start: host_no=50 channel=0 id=0 lun=11 data_sgl=2 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=8728960 txlen=16 protect=0 raw=2a 00 00 85 31 80 00 00 10 00)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &amp;lt;idle&amp;gt;-0     [027] dNs. 3820723.745553: scsi_dispatch_cmd_timeout: host_no=50 channel=0 id=0 lun=11 data_sgl=16 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=1000064 txlen=128 protect=0 raw=2a 00 00 0f 42 80 00 00 80 00) result=(driver=DRIVER_OK host=DID_TIME_OUT message=COMMAND_COMPLETE status=SAM_STAT_GOOD)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &amp;lt;idle&amp;gt;-0     [027] dNs. 3820723.745577: scsi_dispatch_cmd_timeout: host_no=50 channel=0 id=0 lun=11 data_sgl=2 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=8728960 txlen=16 protect=0 raw=2a 00 00 85 31 80 00 00 10 00) result=(driver=DRIVER_OK host=DID_OK message=COMMAND_COMPLETE status=SAM_STAT_GOOD)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &amp;lt;idle&amp;gt;-0     [027] dNs. 3820725.744576: scsi_dispatch_cmd_timeout: host_no=50 channel=0 id=0 lun=11 data_sgl=2 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=8728960 txlen=16 protect=0 raw=2a 00 00 85 31 80 00 00 10 00) result=(driver=DRIVER_OK host=DID_TIME_OUT message=COMMAND_COMPLETE status=SAM_STAT_GOOD)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; kworker/5:1H-801   [005] .... 3820725.748667: scsi_dispatch_cmd_start: host_no=50 channel=0 id=0 lun=11 data_sgl=2 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=8728960 txlen=16 protect=0 raw=2a 00 00 85 31 80 00 00 10 00)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; kworker/5:1H-801   [005] .... 3820725.748672: scsi_dispatch_cmd_start: host_no=50 channel=0 id=0 lun=11 data_sgl=16 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=1000064 txlen=128 protect=0 raw=2a 00 00 0f 42 80 00 00 80 00)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &amp;lt;idle&amp;gt;-0     [005] dNs. 3820727.007955: scsi_dispatch_cmd_timeout: host_no=50 channel=0 id=0 lun=11 data_sgl=2 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=8728960 txlen=16 protect=0 raw=2a 00 00 85 31 80 00 00 10 00) result=(driver=DRIVER_OK host=DID_OK message=COMMAND_COMPLETE status=SAM_STAT_GOOD)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &amp;lt;idle&amp;gt;-0     [005] dNs. 3820727.007980: scsi_dispatch_cmd_timeout: host_no=50 channel=0 id=0 lun=11 data_sgl=16 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=1000064 txlen=128 protect=0 raw=2a 00 00 0f 42 80 00 00 80 00) result=(driver=DRIVER_OK host=DID_OK message=COMMAND_COMPLETE status=SAM_STAT_GOOD)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &amp;lt;idle&amp;gt;-0     [005] dNs. 3820729.006980: scsi_dispatch_cmd_timeout: host_no=50 channel=0 id=0 lun=11 data_sgl=2 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=8728960 txlen=16 protect=0 raw=2a 00 00 85 31 80 00 00 10 00) result=(driver=DRIVER_OK host=DID_TIME_OUT message=COMMAND_COMPLETE status=SAM_STAT_GOOD)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &amp;lt;idle&amp;gt;-0     [005] dNs. 3820729.007003: scsi_dispatch_cmd_timeout: host_no=50 channel=0 id=0 lun=11 data_sgl=16 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=1000064 txlen=128 protect=0 raw=2a 00 00 0f 42 80 00 00 80 00) result=(driver=DRIVER_OK host=DID_TIME_OUT message=COMMAND_COMPLETE status=SAM_STAT_GOOD)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; kworker/7:1H-1265  [007] .... 3820729.011093: scsi_dispatch_cmd_start: host_no=50 channel=0 id=0 lun=11 data_sgl=16 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=1000064 txlen=128 protect=0 raw=2a 00 00 0f 42 80 00 00 80 00)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; kworker/7:1H-1265  [007] .... 3820729.011097: scsi_dispatch_cmd_start: host_no=50 channel=0 id=0 lun=11 data_sgl=2 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=8728960 txlen=16 protect=0 raw=2a 00 00 85 31 80 00 00 10 00)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;lt;...&amp;gt;-72525 [007] d.s. 3820730.982012: scsi_dispatch_cmd_timeout: host_no=50 channel=0 id=0 lun=11 data_sgl=16 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=1000064 txlen=128 protect=0 raw=2a 00 00 0f 42 80 00 00 80 00) result=(driver=DRIVER_OK host=DID_OK message=COMMAND_COMPLETE status=SAM_STAT_GOOD)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;lt;...&amp;gt;-72525 [007] d.s. 3820730.982039: scsi_dispatch_cmd_timeout: host_no=50 channel=0 id=0 lun=11 data_sgl=2 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=8728960 txlen=16 protect=0 raw=2a 00 00 85 31 80 00 00 10 00) result=(driver=DRIVER_OK host=DID_OK message=COMMAND_COMPLETE status=SAM_STAT_GOOD)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;lt;...&amp;gt;-108306 [007] d.s. 3820732.981033: scsi_dispatch_cmd_timeout: host_no=50 channel=0 id=0 lun=11 data_sgl=16 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=1000064 txlen=128 protect=0 raw=2a 00 00 0f 42 80 00 00 80 00) result=(driver=DRIVER_OK host=DID_TIME_OUT message=COMMAND_COMPLETE status=SAM_STAT_GOOD)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;lt;...&amp;gt;-108306 [007] d.s. 3820732.981059: scsi_dispatch_cmd_timeout: host_no=50 channel=0 id=0 lun=11 data_sgl=2 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=8728960 txlen=16 protect=0 raw=2a 00 00 85 31 80 00 00 10 00) result=(driver=DRIVER_OK host=DID_TIME_OUT message=COMMAND_COMPLETE status=SAM_STAT_GOOD)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;kworker/19:1H-2058  [019] .... 3820732.985038: scsi_dispatch_cmd_start: host_no=50 channel=0 id=0 lun=11 data_sgl=2 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=8728960 txlen=16 protect=0 raw=2a 00 00 85 31 80 00 00 10 00)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;kworker/19:1H-2058  [019] .... 3820732.985044: scsi_dispatch_cmd_start: host_no=50 channel=0 id=0 lun=11 data_sgl=16 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=1000064 txlen=128 protect=0 raw=2a 00 00 0f 42 80 00 00 80 00)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &amp;lt;idle&amp;gt;-0     [019] dNs. 3820734.836127: scsi_dispatch_cmd_timeout: host_no=50 channel=0 id=0 lun=11 data_sgl=2 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=8728960 txlen=16 protect=0 raw=2a 00 00 85 31 80 00 00 10 00) result=(driver=DRIVER_OK host=DID_OK message=COMMAND_COMPLETE status=SAM_STAT_GOOD)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &amp;lt;idle&amp;gt;-0     [019] dNs. 3820734.836157: scsi_dispatch_cmd_timeout: host_no=50 channel=0 id=0 lun=11 data_sgl=16 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=1000064 txlen=128 protect=0 raw=2a 00 00 0f 42 80 00 00 80 00) result=(driver=DRIVER_OK host=DID_OK message=COMMAND_COMPLETE status=SAM_STAT_GOOD)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &amp;lt;idle&amp;gt;-0     [019] dNs. 3820736.835151: scsi_dispatch_cmd_timeout: host_no=50 channel=0 id=0 lun=11 data_sgl=2 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=8728960 txlen=16 protect=0 raw=2a 00 00 85 31 80 00 00 10 00) result=(driver=DRIVER_OK host=DID_TIME_OUT message=COMMAND_COMPLETE status=SAM_STAT_GOOD)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &amp;lt;idle&amp;gt;-0     [019] dNs. 3820736.835177: scsi_dispatch_cmd_timeout: host_no=50 channel=0 id=0 lun=11 data_sgl=16 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=1000064 txlen=128 protect=0 raw=2a 00 00 0f 42 80 00 00 80 00) result=(driver=DRIVER_OK host=DID_TIME_OUT message=COMMAND_COMPLETE status=SAM_STAT_GOOD)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&quot;&amp;#x591A;3&amp;#x6B21;10s&amp;#x7684;&amp;#x5206;&amp;#x6790;&quot;&gt;&lt;a href=&quot;#&amp;#x591A;3&amp;#x6B21;10s&amp;#x7684;&amp;#x5206;&amp;#x6790;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x591A;3&amp;#x6B21;10s&amp;#x7684;&amp;#x5206;&amp;#x6790;&quot;&gt;&lt;/a&gt;&amp;#x591A;3&amp;#x6B21;10s&amp;#x7684;&amp;#x5206;&amp;#x6790;&lt;/h2&gt;&lt;p&gt;&amp;#x65E2;&amp;#x7136;&amp;#x65E5;&amp;#x5FD7;&amp;#x5206;&amp;#x6790;&amp;#x6765;&amp;#x770B;&amp;#x6CA1;&amp;#x6709;&amp;#x5B8C;&amp;#x6210;&amp;#x6807;&amp;#x51C6;&amp;#x7684;5&amp;#x6B21;&amp;#x8D85;&amp;#x65F6;&amp;#x91CD;&amp;#x8BD5;&amp;#xFF0C;&amp;#x90A3;&amp;#x8BF4;&amp;#x660E;&amp;#x5728;&amp;#x4E2D;&amp;#x95F4;&amp;#x67D0;&amp;#x4E2A;&amp;#x9636;&amp;#x6BB5;&amp;#x8FDB;&amp;#x5165;&amp;#x5230;&amp;#x5176;&amp;#x4ED6;&amp;#x6D41;&amp;#x7A0B;&amp;#x5BFC;&amp;#x81F4;&amp;#x591A;&amp;#x4E86;3&amp;#x6B21;10s&amp;#x7684;&amp;#x8D85;&amp;#x65F6;&amp;#x3002;&amp;#x4E3A;&amp;#x4E86;&amp;#x5206;&amp;#x6790;&amp;#x8FD9;&amp;#x4E2A;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#x5230;&amp;#x5E95;&amp;#x53D1;&amp;#x751F;&amp;#x4E86;&amp;#x4EC0;&amp;#x4E48;&amp;#xFF0C;&amp;#x5C31;&amp;#x53EA;&amp;#x80FD;&amp;#x901A;&amp;#x8FC7;&amp;#x9605;&amp;#x8BFB;linux&amp;#x5185;&amp;#x6838;&amp;#x91CC;scsi error handle&amp;#x8FD9;&amp;#x90E8;&amp;#x5206;&amp;#x4EE3;&amp;#x7801;&amp;#xFF0C;&amp;#x6839;&amp;#x636E;&amp;#x65E5;&amp;#x5FD7;&amp;#x4FE1;&amp;#x606F;&amp;#x6765;&amp;#x8FDB;&amp;#x884C;&amp;#x5206;&amp;#x6790;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x5BF9;&amp;#x6BD4;&amp;#x88F8;&amp;#x76D8;fio&amp;#x6D4B;&amp;#x8BD5;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&amp;#x4FE1;&amp;#x606F;&amp;#x53D1;&amp;#x73B0;&amp;#xFF1A;&amp;#x4ECE;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;fio&amp;#x6D4B;&amp;#x8BD5;&amp;#x65F6;IO hang&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&amp;#x91CC;&amp;#xFF0C;&amp;#x67D0;&amp;#x4E00;&amp;#x6B21;iscsi abort success&amp;#x540E;&amp;#x5C31;&amp;#x7B49;&amp;#x4E86;10s&amp;#xFF0C;&amp;#x800C;&amp;#x88F8;&amp;#x76D8;&amp;#x6D4B;&amp;#x8BD5;&amp;#x65F6;&amp;#x662F;iscsi abort success&amp;#x540E;&amp;#x7D27;&amp;#x8DDF;&amp;#x7740;scsi_eh_done&amp;#x51FD;&amp;#x6570;&amp;#x7684;&amp;#x8C03;&amp;#x7528;&amp;#xFF0C;&amp;#x8BF4;&amp;#x660E;&amp;#x95EE;&amp;#x9898;&amp;#x6709;&amp;#x53EF;&amp;#x80FD;&amp;#x51FA;&amp;#x5728;&amp;#x8FD9;&amp;#x91CC;&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;**&amp;#x4ECE;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;fio&amp;#x6D4B;&amp;#x8BD5;&amp;#x65F6;&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:21 10-180-0-37 kernel: [3820736.835478]  session50: iscsi_eh_abort aborting sc ffff881e3dd21780&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:21 10-180-0-37 kernel: [3820736.835480]  session50: iscsi_eh_abort aborting [sc ffff881e3dd21780 itt 0x48]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:21 10-180-0-37 kernel: [3820736.835484]  session50: iscsi_exec_task_mgmt_fn tmf set timeout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:21 10-180-0-37 kernel: [3820736.835501] iscsi_trgt: Abort Task (01) issued on tid:2000 lun:11 by sid:7881300190757376 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:21 10-180-0-37 kernel: [3820736.835520]  session50: iscsi_eh_abort abort success [sc ffff881e3dd21780 itt 0x48]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;.............&amp;#x4ECE;&amp;#x8FD9;&amp;#x91CC;&amp;#x5F00;&amp;#x59CB;&amp;#x5C31;&amp;#x662F;&amp;#x7B49;&amp;#x4E86;&amp;#x5DEE;&amp;#x4E0D;&amp;#x591A;10s&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:31 10-180-0-37 kernel: [3820746.830267] scsi_send_eh_cmnd: scmd: ffff881e57fee080, timeleft: 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:31 10-180-0-37 kernel: [3820746.830274]  session50: iscsi_eh_abort aborting sc ffff881e57fee080&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:31 10-180-0-37 kernel: [3820746.830277]  session50: iscsi_eh_abort aborting [sc ffff881e57fee080 itt 0x42]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb  9 16:45:31 10-180-0-37 kernel: [3820746.830283]  session50: iscsi_exec_task_mgmt_fn tmf set timeout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;**&amp;#x88F8;&amp;#x76D8;fio&amp;#x6D4B;&amp;#x8BD5;&amp;#x65F6;&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 10 09:49:33 10-180-0-37 kernel: [3882158.817537]  session52: iscsi_eh_abort aborting sc ffff884d6f25c180&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 10 09:49:33 10-180-0-37 kernel: [3882158.817539]  session52: iscsi_eh_abort aborting [sc ffff884d6f25c180 itt 0x23]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 10 09:49:33 10-180-0-37 kernel: [3882158.817544]  session52: iscsi_exec_task_mgmt_fn tmf set timeout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 10 09:49:33 10-180-0-37 kernel: [3882158.817584] iscsi_trgt: Abort Task (01) issued on tid:2000 lun:11 by sid:9007200131154432 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 10 09:49:33 10-180-0-37 kernel: [3882158.817616]  session52: iscsi_eh_abort abort success [sc ffff884d6f25c180 itt 0x23]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;..........&amp;#x8FD9;&amp;#x91CC;&amp;#x662F;&amp;#x7D27;&amp;#x63A5;&amp;#x7740;&amp;#x8C03;&amp;#x7528;&amp;#x4E86;scsi_eh_done&amp;#x51FD;&amp;#x6570;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 10 09:49:33 10-180-0-37 kernel: [3882158.817669] scsi_eh_done scmd: ffff884d6f25c180 result: 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 10 09:49:33 10-180-0-37 kernel: [3882158.817674] scsi_send_eh_cmnd: scmd: ffff884d6f25c180, timeleft: 2500&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 10 09:49:33 10-180-0-37 kernel: [3882158.817676] scsi_send_eh_cmnd: scsi_eh_completed_normally 2002&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 10 09:49:33 10-180-0-37 kernel: [3882158.817679] scsi_eh_tur: scmd ffff884d6f25c180 rtn 2002&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 10 09:49:33 10-180-0-37 kernel: [3882158.817681] scsi_eh_52: flush finish cmd: ffff884d6f25c180&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x5E76;&amp;#x4E14;&amp;#x627E;&amp;#x5230;&amp;#x8FD9;10s&amp;#x7B49;&amp;#x5F85;&amp;#x524D;&amp;#x540E;&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&amp;#xFF0C;&amp;#x53D1;&amp;#x73B0;&amp;#x6253;&amp;#x5370;&amp;#x4E86;&amp;#x4E00;&amp;#x53E5;&amp;#x201D;scsi_send_eh_cmnd: scmd: ffff881e57fee080, timeleft: 0&amp;#x201D;&amp;#xFF0C;&amp;#x627E;&amp;#x5230;&amp;#x4EE3;&amp;#x7801;&amp;#x91CC;&amp;#x7684;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;scsi_send_eh_cmnd&amp;#xFF0C;&amp;#x786E;&amp;#x5B9E;&amp;#x53D1;&amp;#x73B0;&amp;#x6709;&amp;#x4E2A;timeout&amp;#x7684;&amp;#x5730;&amp;#x65B9;&amp;#xFF1A;&amp;#x4E0D;&amp;#x8FC7;&amp;#x4E00;&amp;#x5904;&amp;#x662F;queuecommand&amp;#x5931;&amp;#x8D25;&amp;#x540E;&amp;#x6BCF;&amp;#x6B21;sleep&amp;#x4E00;&amp;#x70B9;&amp;#x65F6;&amp;#x95F4;&amp;#x7136;&amp;#x540E;&amp;#x91CD;&amp;#x8BD5;&amp;#xFF0C;&amp;#x53E6;&amp;#x5916;&amp;#x4E00;&amp;#x5904;&amp;#x662F;queuecommand&amp;#x6210;&amp;#x529F;&amp;#x540E;wait_for_completion_timeout&amp;#x7B49;&amp;#x5F85;cmd&amp;#x5B8C;&amp;#x6210;&amp;#x3002;&amp;#x5E76;&amp;#x4E14;&amp;#x4F20;&amp;#x5165;scsi_send_eh_cmnd&amp;#x7684;&amp;#x53C2;&amp;#x6570;&amp;#x91CC;&amp;#x7684;timeout&amp;#x5C31;&amp;#x662F;SENSE_TIMEOUT&amp;#xFF08;&amp;#x521A;&amp;#x597D;&amp;#x662F;10*HZ&amp;#xFF09;&amp;#x3002;&amp;#x540E;&amp;#x6765;&amp;#x786E;&amp;#x8BA4;&amp;#x5F53;&amp;#x524D;&amp;#x4F7F;&amp;#x7528;&amp;#x7684;&amp;#x5185;&amp;#x6838;&amp;#x7248;&amp;#x672C;3.10.45&amp;#x91CC;&amp;#x8FD9;&amp;#x4E2A;&amp;#x503C;&amp;#x662F;&amp;#x5199;&amp;#x6B7B;&amp;#x7684;&amp;#xFF0C;&amp;#x800C;&amp;#x9AD8;&amp;#x4E00;&amp;#x70B9;&amp;#x7684;&amp;#x5185;&amp;#x6838;&amp;#xFF08;&amp;#x5982;3.14.57&amp;#xFF09;&amp;#x8FD9;&amp;#x4E2A;&amp;#x503C;&amp;#x5C31;&amp;#x662F;&amp;#x53EF;&amp;#x914D;&amp;#x7F6E;&amp;#x7684;&amp;#x53C2;&amp;#x6570;eh_timeout&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;static int scsi_send_eh_cmnd(struct scsi_cmnd *scmd, unsigned char *cmnd,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			     int cmnd_size, int timeout, unsigned sense_bytes)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	struct scsi_device *sdev = scmd-&amp;gt;device;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	struct Scsi_Host *shost = sdev-&amp;gt;host;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	DECLARE_COMPLETION_ONSTACK(done);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	unsigned long timeleft = timeout;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	struct scsi_eh_save ses;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	const unsigned long stall_for = msecs_to_jiffies(100);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	int rtn;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;retry:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	scsi_eh_prep_cmnd(scmd, &amp;amp;ses, cmnd, cmnd_size, sense_bytes);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	shost-&amp;gt;eh_action = &amp;amp;done;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	scsi_log_send(scmd);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	scmd-&amp;gt;scsi_done = scsi_eh_done;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	rtn = shost-&amp;gt;hostt-&amp;gt;queuecommand(shost, scmd);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	if (rtn) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		if (timeleft &amp;gt; stall_for) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			scsi_eh_restore_cmnd(scmd, &amp;amp;ses);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			timeleft -= stall_for;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			msleep(jiffies_to_msecs(stall_for));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			goto retry;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		/* signal not to enter either branch of the if () below */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		timeleft = 0;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		rtn = NEEDS_RETRY;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	} else {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		timeleft = wait_for_completion_timeout(&amp;amp;done, timeout);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	shost-&amp;gt;eh_action = NULL;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	scsi_log_completion(scmd, rtn);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // &amp;#x8FD9;&amp;#x91CC;&amp;#x6253;&amp;#x5370;&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	SCSI_LOG_ERROR_RECOVERY(3,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		printk(&amp;quot;%s: scmd: %p, timeleft: %ld\n&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			__func__, scmd, timeleft));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	..........&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x6709;&amp;#x4E86;&amp;#x8FD9;&amp;#x4E2A;&amp;#x7EBF;&amp;#x7D22;&amp;#xFF0C;&amp;#x5C31;&amp;#x9700;&amp;#x8981;&amp;#x91CD;&amp;#x73B0;&amp;#x51FA;&amp;#x6765;&amp;#x786E;&amp;#x8BA4;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x56E0;&amp;#x4E3A;&amp;#x662F;&amp;#x5185;&amp;#x6838;&amp;#x4EE3;&amp;#x7801;&amp;#xFF0C;&amp;#x4E0D;&amp;#x53EF;&amp;#x80FD;&amp;#x76F4;&amp;#x63A5;&amp;#x53BB;&amp;#x6253;&amp;#x5370;&amp;#x65E5;&amp;#x5FD7;&amp;#x91CD;&amp;#x7F16;&amp;#x8BD1;&amp;#x5185;&amp;#x6838;&amp;#xFF0C;&amp;#x56E0;&amp;#x6B64;&amp;#x796D;&amp;#x51FA;&amp;#x795E;&amp;#x5668;systemtap&amp;#xFF0C;&amp;#x5728;&amp;#x5173;&amp;#x952E;&amp;#x51FD;&amp;#x6570;&amp;#x8C03;&amp;#x7528;&amp;#x5730;&amp;#x65B9;&amp;#x6253;&amp;#x5370;&amp;#x4FE1;&amp;#x606F;&amp;#x3002;&amp;#x4E0B;&amp;#x9762;&amp;#x662F;&amp;#x91CD;&amp;#x73B0;&amp;#x6D4B;&amp;#x8BD5;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;systemtap&amp;#x6253;&amp;#x5370;&amp;#x7684;&amp;#x76F8;&amp;#x5173;&amp;#x65E5;&amp;#x5FD7;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x5230;&amp;#x786E;&amp;#x5B9E;&amp;#x662F;&amp;#x5728;wait_for_completion_timeout&amp;#x8FD9;&amp;#x91CC;&amp;#x7B49;&amp;#x4E86;10s&amp;#x3002;&amp;#x540C;&amp;#x6837;&amp;#x7684;&amp;#x5728;&amp;#x88F8;&amp;#x76D8;fio&amp;#x6D4B;&amp;#x8BD5;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;systemtap&amp;#x6293;&amp;#x53D6;&amp;#x5C31;&amp;#x53D1;&amp;#x73B0;wait_for_completion_timeout&amp;#x6CA1;&amp;#x6709;&amp;#x7B49;&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Fri Feb 10 09:12:55 2017, iscsi_queuecommand call: host_no=56, channel=0, lun=11, dev_id=0, scmd:0xffff880ec9618380&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Fri Feb 10 09:12:55 2017, iscsi_queuecommand return: host_no=56, channel=0, lun=11, dev_id=0, scmd:0xffff880ec9618380, return=0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Fri Feb 10 09:12:55 2017, iscsi_queuecommand call: host_no=56, channel=0, lun=11, dev_id=0, scmd:0xffff8821a2794080&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Fri Feb 10 09:12:55 2017, iscsi_queuecommand return: host_no=56, channel=0, lun=11, dev_id=0, scmd:0xffff8821a2794080, return=0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Fri Feb 10 09:12:59 2017, scsi_send_eh_cmnd enter: host_no=56, channel=0, lun=11, dev_id=0, scmd:0xffff880ec9618380, sense_timeout:2500&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Fri Feb 10 09:12:59 2017, iscsi_queuecommand call: host_no=56, channel=0, lun=11, dev_id=0, scmd:0xffff880ec9618380&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Fri Feb 10 09:12:59 2017, iscsi_queuecommand return: host_no=56, channel=0, lun=11, dev_id=0, scmd:0xffff880ec9618380, return=0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Fri Feb 10 09:12:59 2017, wait_for_completion_timeout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Fri Feb 10 09:13:09 2017, scsi_send_eh_cmnd return: host_no=56, channel=0, lun=11, dev_id=0, scmd:0xffff880ec9618380, sense_timeout:2500&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Fri Feb 10 09:13:09 2017, scsi_send_eh_cmnd enter: host_no=56, channel=0, lun=11, dev_id=0, scmd:0xffff880ec9618380, sense_timeout:2500&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Fri Feb 10 09:13:09 2017, iscsi_queuecommand call: host_no=56, channel=0, lun=11, dev_id=0, scmd:0xffff880ec9618380&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Fri Feb 10 09:13:09 2017, iscsi_queuecommand return: host_no=56, channel=0, lun=11, dev_id=0, scmd:0xffff880ec9618380, return=0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Fri Feb 10 09:13:09 2017, wait_for_completion_timeout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Fri Feb 10 09:13:19 2017, scsi_send_eh_cmnd return: host_no=56, channel=0, lun=11, dev_id=0, scmd:0xffff880ec9618380, sense_timeout:2500&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Fri Feb 10 09:13:19 2017, scsi_send_eh_cmnd enter: host_no=56, channel=0, lun=11, dev_id=0, scmd:0xffff880ec9618380, sense_timeout:2500&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Fri Feb 10 09:13:19 2017, iscsi_queuecommand call: host_no=56, channel=0, lun=11, dev_id=0, scmd:0xffff880ec9618380&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Fri Feb 10 09:13:19 2017, iscsi_queuecommand return: host_no=56, channel=0, lun=11, dev_id=0, scmd:0xffff880ec9618380, return=0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Fri Feb 10 09:13:19 2017, wait_for_completion_timeout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Fri Feb 10 09:13:29 2017, scsi_send_eh_cmnd return: host_no=56, channel=0, lun=11, dev_id=0, scmd:0xffff880ec9618380, sense_timeout:2500&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x7ED3;&amp;#x5408;&amp;#x5185;&amp;#x6838;&amp;#x4EE3;&amp;#x7801;&amp;#x5206;&amp;#x6790;&amp;#xFF0C;&amp;#x5728;scsi_eh_abort_cmds&amp;#x2013;&amp;gt;scsi_eh_test_devices&amp;#x2013;&amp;gt;scsi_eh_tur&amp;#x2013;&amp;gt;scsi_send_eh_cmnd&amp;#x7684;&amp;#x8C03;&amp;#x7528;&amp;#x8DEF;&amp;#x5F84;&amp;#x4E0B;&amp;#xFF0C;&amp;#x5F53;scsi_send_eh_cmnd&amp;#x8D85;&amp;#x65F6;&amp;#x8FD4;&amp;#x56DE;FAILED&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;&amp;#x8FDB;&amp;#x5165;&amp;#x5230;scsi_eh_ready_devs&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x6D41;&amp;#x7A0B;&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;static void scsi_unjam_host(struct Scsi_Host *shost)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	unsigned long flags;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	LIST_HEAD(eh_work_q);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	LIST_HEAD(eh_done_q);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	spin_lock_irqsave(shost-&amp;gt;host_lock, flags);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	list_splice_init(&amp;amp;shost-&amp;gt;eh_cmd_q, &amp;amp;eh_work_q);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	spin_unlock_irqrestore(shost-&amp;gt;host_lock, flags);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	SCSI_LOG_ERROR_RECOVERY(1, scsi_eh_prt_fail_stats(shost, &amp;amp;eh_work_q));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	if (!scsi_eh_get_sense(&amp;amp;eh_work_q, &amp;amp;eh_done_q))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		if (!scsi_eh_abort_cmds(&amp;amp;eh_work_q, &amp;amp;eh_done_q))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			scsi_eh_ready_devs(shost, &amp;amp;eh_work_q, &amp;amp;eh_done_q);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	scsi_eh_flush_done_q(&amp;amp;eh_done_q);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x5728;scsi_eh_ready_devs&amp;#x91CC;&amp;#xFF0C;&amp;#x5C31;&amp;#x4F1A;&amp;#x76F8;&amp;#x7EE7;&amp;#x8C03;&amp;#x7528;scsi_eh_bus_device_reset&amp;#xFF0C;scsi_eh_target_reset&amp;#xFF0C;scsi_eh_bus_reset&amp;#x7B49;&amp;#xFF0C;&amp;#x5C31;&amp;#x5728;scsi_eh_bus_device_reset&amp;#x548C;scsi_eh_target_reset&amp;#x91CC;&amp;#x6700;&amp;#x7EC8;&amp;#x90FD;&amp;#x4F1A;&amp;#x8C03;&amp;#x7528;&amp;#x5230;scsi_eh_tur&amp;#x2013;&amp;gt;scsi_send_eh_cmnd&amp;#x7684;&amp;#x903B;&amp;#x8F91;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x5404;&amp;#x81EA;&amp;#x53C8;&amp;#x7B49;&amp;#x5F85;&amp;#x4E86;10s&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x6700;&amp;#x540E;&amp;#x8D70;&amp;#x5230;&amp;#x4E86;scsi_eh_offline_sdevs&amp;#x5C06;&amp;#x8BBE;&amp;#x5907;&amp;#x79BB;&amp;#x7EBF;&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;&amp;#x603B;&amp;#x7684;&amp;#x5BFC;&amp;#x81F4;&amp;#x4E86;3&amp;#x6B21;10s&amp;#x7684;&amp;#x8D85;&amp;#x65F6;&amp;#xFF0C;&amp;#x4E0E;&amp;#x4E0A;&amp;#x9762;&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&amp;#x543B;&amp;#x5408;&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;void scsi_eh_ready_devs(struct Scsi_Host *shost,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			struct list_head *work_q,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			struct list_head *done_q)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	if (!scsi_eh_stu(shost, work_q, done_q))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		if (!scsi_eh_bus_device_reset(shost, work_q, done_q))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			if (!scsi_eh_target_reset(shost, work_q, done_q))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				if (!scsi_eh_bus_reset(shost, work_q, done_q))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;					if (!scsi_eh_host_reset(work_q, done_q))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;						scsi_eh_offline_sdevs(work_q,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;								      done_q);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&quot;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x53D1;&amp;#x9001;&amp;#x7684;TUR-TEST-UNIT-READY-&amp;#x547D;&amp;#x4EE4;&amp;#x4F1A;&amp;#x8D85;&amp;#x65F6;&quot;&gt;&lt;a href=&quot;#&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x53D1;&amp;#x9001;&amp;#x7684;TUR-TEST-UNIT-READY-&amp;#x547D;&amp;#x4EE4;&amp;#x4F1A;&amp;#x8D85;&amp;#x65F6;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x53D1;&amp;#x9001;&amp;#x7684;TUR(TEST UNIT READY)&amp;#x547D;&amp;#x4EE4;&amp;#x4F1A;&amp;#x8D85;&amp;#x65F6;&quot;&gt;&lt;/a&gt;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x53D1;&amp;#x9001;&amp;#x7684;TUR(TEST UNIT READY)&amp;#x547D;&amp;#x4EE4;&amp;#x4F1A;&amp;#x8D85;&amp;#x65F6;&lt;/h2&gt;&lt;h3 id=&quot;&amp;#x7F51;&amp;#x7EDC;&amp;#x5305;&amp;#x5206;&amp;#x6790;&quot;&gt;&lt;a href=&quot;#&amp;#x7F51;&amp;#x7EDC;&amp;#x5305;&amp;#x5206;&amp;#x6790;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x7F51;&amp;#x7EDC;&amp;#x5305;&amp;#x5206;&amp;#x6790;&quot;&gt;&lt;/a&gt;&amp;#x7F51;&amp;#x7EDC;&amp;#x5305;&amp;#x5206;&amp;#x6790;&lt;/h3&gt;&lt;p&gt;&amp;#x4E3A;&amp;#x4E86;&amp;#x5206;&amp;#x6790;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;scsi_send_eh_cmnd&amp;#x53D1;&amp;#x9001;TUR&amp;#x6307;&amp;#x4EE4;&amp;#x5230;target&amp;#x53BB;&amp;#x5904;&amp;#x7406;&amp;#x4F1A;&amp;#x8D85;&amp;#x65F6;&amp;#xFF0C;&amp;#x9996;&amp;#x5148;&amp;#x60F3;&amp;#x5230;&amp;#x7684;&amp;#x5C31;&amp;#x662F;&amp;#x6293;&amp;#x5305;&amp;#x5206;&amp;#x6790;&amp;#xFF0C;&amp;#x5BF9;&amp;#x6BD4;2&amp;#x79CD;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;&amp;#xFF08;&amp;#x88F8;&amp;#x76D8;&amp;#x6D4B;&amp;#x8BD5;&amp;#x548C;&amp;#x4ECE;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x4E0A;&amp;#x6D4B;&amp;#x8BD5;&amp;#xFF09;&amp;#x7684;&amp;#x5305;&amp;#x5904;&amp;#x7406;&amp;#x6709;&amp;#x4EC0;&amp;#x4E48;&amp;#x4E0D;&amp;#x540C;&amp;#x3002;&lt;br&gt;1&amp;#xFF09;&amp;#x88F8;&amp;#x76D8;&amp;#x6D4B;&amp;#x8BD5;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#xFF0C;tcpdump&amp;#x6293;&amp;#x53D6;&amp;#x5305;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x4F7F;&amp;#x7528;wireshark&amp;#x5206;&amp;#x6790;&lt;br&gt;&lt;img src=&quot;/2017/03/15/error-disk-cause-iohang2/test_naked_TUR_packet.png&quot; alt=&quot;error-disk-cause-iohang2&quot;&gt;&lt;br&gt;2&amp;#xFF09;&amp;#x4ECE;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x4E0A;&amp;#x53BB;&amp;#x6D4B;&amp;#x8BD5;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#xFF0C;tcpdump&amp;#x6293;&amp;#x53D6;&amp;#x5305;&amp;#xFF0C;&amp;#x901A;&amp;#x8FC7;wireshark&amp;#x5206;&amp;#x6790;&lt;br&gt;&lt;img src=&quot;/2017/03/15/error-disk-cause-iohang2/test_fs_TUR_packet.png&quot; alt=&quot;error-disk-cause-iohang2&quot;&gt;&lt;br&gt;&amp;#x4ECE;&amp;#x4E0A;&amp;#x9762;&amp;#x4E24;&amp;#x56FE;&amp;#x7684;&amp;#x5BF9;&amp;#x6BD4;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x53D1;&amp;#x73B0;&amp;#xFF0C;&amp;#x5F53;&amp;#x4ECE;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x6D4B;&amp;#x8BD5;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#x67D0;&amp;#x4E2A;&amp;#x65F6;&amp;#x5019;&amp;#x5F00;&amp;#x59CB;initiator&amp;#x53D1;&amp;#x9001;&amp;#x7ED9;target&amp;#x7684;TUR&amp;#x6D88;&amp;#x606F;&amp;#x6CA1;&amp;#x6709;&amp;#x6536;&amp;#x5230;&amp;#x54CD;&amp;#x5E94;&amp;#xFF0C;&amp;#x65E2;&amp;#x7136;&amp;#x6CA1;&amp;#x6709;&amp;#x54CD;&amp;#x5E94;&amp;#xFF0C;&amp;#x90A3;&amp;#x5C31;&amp;#x8BF4;&amp;#x660E;target&amp;#x7AEF;&amp;#x5904;&amp;#x7406;&amp;#x4E0A;&amp;#x6709;&amp;#x95EE;&amp;#x9898;&amp;#x5BFC;&amp;#x81F4;&amp;#x6CA1;&amp;#x6709;&amp;#x56DE;&amp;#x5305;&amp;#x3002;&lt;/p&gt;
&lt;h3 id=&quot;iscsitarget&amp;#x7AEF;&amp;#x5206;&amp;#x6790;&quot;&gt;&lt;a href=&quot;#iscsitarget&amp;#x7AEF;&amp;#x5206;&amp;#x6790;&quot; class=&quot;headerlink&quot; title=&quot;iscsitarget&amp;#x7AEF;&amp;#x5206;&amp;#x6790;&quot;&gt;&lt;/a&gt;iscsitarget&amp;#x7AEF;&amp;#x5206;&amp;#x6790;&lt;/h3&gt;&lt;p&gt;iscsitarget&amp;#x9ED8;&amp;#x8BA4;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;&amp;#x53EA;&amp;#x6709;error&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&amp;#xFF0C;&amp;#x6BD4;&amp;#x8F83;&amp;#x5C11;&amp;#xFF0C;&amp;#x4E0D;&amp;#x4FBF;&amp;#x4E8E;&amp;#x5206;&amp;#x6790;&amp;#x95EE;&amp;#x9898;&amp;#xFF0C;&amp;#x56E0;&amp;#x6B64;&amp;#x9488;&amp;#x5BF9;TEST UNIT READY&amp;#x6307;&amp;#x4EE4;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x5730;&amp;#x65B9;&amp;#x52A0;&amp;#x4E0A;debug&amp;#x65E5;&amp;#x5FD7;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x91CD;&amp;#x65B0;&amp;#x7F16;&amp;#x8BD1;&amp;#x6A21;&amp;#x5757;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x5F00;&amp;#x542F;iscsitarget&amp;#x81EA;&amp;#x5E26;&amp;#x7684;debug&amp;#x65E5;&amp;#x5FD7;&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;sudo insmod iscsi_trgt.ko debug_enable_flags=255&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x7136;&amp;#x540E;&amp;#x518D;&amp;#x6B21;&amp;#x4ECE;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x5C42;&amp;#x9762;&amp;#x6D4B;&amp;#x8BD5;&amp;#x6765;&amp;#x91CD;&amp;#x73B0;&amp;#xFF0C;&amp;#x91CD;&amp;#x70B9;&amp;#x5173;&amp;#x6CE8;target&amp;#x7AEF;&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:38:41 10-165-160-13 kernel: [2243339.970923] iscsi_trgt: Abort Task (01) issued on tid:1000 lun:0 by sid:281475098149376 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:38:41 10-165-160-13 kernel: [2243339.970935] iscsi_trgt: write_data(347) 0x10000073d0200:0: 48(48)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:38:41 10-165-160-13 kernel: [2243339.971091] iscsi_trgt: Abort Task (01) issued on tid:1000 lun:0 by sid:281475098149376 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:38:41 10-165-160-13 kernel: [2243339.971098] iscsi_trgt: write_data(347) 0x10000073d0200:0: 48(48)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:38:41 10-165-160-13 kernel: [2243339.971232] iscsi_trgt: scsi_cmnd_start(996) 6a000030 0 TEST_UNIT_READY&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:38:41 10-165-160-13 kernel: [2243339.971517] iscsi_trgt: disk_execute_cmnd(638) disk_execute_cmnd 6a000030 0 TEST_UNIT_READY&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:38:41 10-165-160-13 kernel: [2243339.971859] iscsi_trgt: write_data(347) 0x10000073d0200:0: 48(48)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:38:42 10-165-160-13 kernel: [2243340.978354] iscsi_trgt: write_data(347) 0x10000073d0200:0: 48(48)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:38:44 10-165-160-13 kernel: [2243342.981374] iscsi_trgt: Abort Task (01) issued on tid:1000 lun:0 by sid:281475098149376 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:38:44 10-165-160-13 kernel: [2243342.981385] iscsi_trgt: write_data(347) 0x10000073d0200:0: 48(48)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:38:44 10-165-160-13 kernel: [2243342.981489] iscsi_trgt: Abort Task (01) issued on tid:1000 lun:0 by sid:281475098149376 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:38:44 10-165-160-13 kernel: [2243342.981496] iscsi_trgt: write_data(347) 0x10000073d0200:0: 48(48)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:38:44 10-165-160-13 kernel: [2243342.981621] iscsi_trgt: scsi_cmnd_start(996) 74000030 0 TEST_UNIT_READY&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:38:44 10-165-160-13 kernel: [2243342.981914] iscsi_trgt: disk_execute_cmnd(638) disk_execute_cmnd 74000030 0 TEST_UNIT_READY&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:38:44 10-165-160-13 kernel: [2243342.982256] iscsi_trgt: write_data(347) 0x10000073d0200:0: 48(48)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:38:46 10-165-160-13 kernel: [2243344.980338] iscsi_trgt: write_data(347) 0x10000073d0200:0: 48(48)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:38:48 10-165-160-13 kernel: [2243346.979438] iscsi_trgt: Abort Task (01) issued on tid:1000 lun:0 by sid:281475098149376 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:38:48 10-165-160-13 kernel: [2243346.979451] iscsi_trgt: write_data(347) 0x10000073d0200:0: 48(48)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:38:48 10-165-160-13 kernel: [2243346.979570] iscsi_trgt: Abort Task (01) issued on tid:1000 lun:0 by sid:281475098149376 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:38:48 10-165-160-13 kernel: [2243346.979578] iscsi_trgt: write_data(347) 0x10000073d0200:0: 48(48)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:38:48 10-165-160-13 kernel: [2243346.979702] iscsi_trgt: scsi_cmnd_start(996) 7a000030 0 TEST_UNIT_READY&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:38:48 10-165-160-13 kernel: [2243346.979987] iscsi_trgt: disk_execute_cmnd(638) disk_execute_cmnd 7a000030 0 TEST_UNIT_READY&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:38:48 10-165-160-13 kernel: [2243346.980318] iscsi_trgt: write_data(347) 0x10000073d0200:0: 48(48)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:38:50 10-165-160-13 kernel: [2243348.978415] iscsi_trgt: write_data(347) 0x10000073d0200:0: 48(48)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:38:52 10-165-160-13 kernel: [2243350.977497] iscsi_trgt: Abort Task (01) issued on tid:1000 lun:0 by sid:281475098149376 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:38:52 10-165-160-13 kernel: [2243350.977511] iscsi_trgt: write_data(347) 0x10000073d0200:0: 48(48)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:38:52 10-165-160-13 kernel: [2243350.977628] iscsi_trgt: Abort Task (01) issued on tid:1000 lun:0 by sid:281475098149376 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:38:52 10-165-160-13 kernel: [2243350.977635] iscsi_trgt: write_data(347) 0x10000073d0200:0: 48(48)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:38:52 10-165-160-13 kernel: [2243350.977766] iscsi_trgt: scsi_cmnd_start(996) 79000030 0 TEST_UNIT_READY&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;###########&amp;#x8FD9;&amp;#x91CC;&amp;#x53D1;&amp;#x7684;TEST_UNIT_READY&amp;#x6CA1;&amp;#x6709;&amp;#x63A5;&amp;#x4E0B;&amp;#x53BB;&amp;#x8C03;&amp;#x7528;disk_execute_cmnd&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:38:57 10-165-160-13 kernel: [2243355.978980] iscsi_trgt: write_data(347) 0x10000073d0200:0: 48(48)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:39:02 10-165-160-13 kernel: [2243360.972560] iscsi_trgt: Abort Task (01) issued on tid:1000 lun:0 by sid:281475098149376 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:39:02 10-165-160-13 kernel: [2243360.972571] iscsi_trgt: write_data(347) 0x10000073d0200:0: 48(48)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:39:02 10-165-160-13 kernel: [2243360.972741] iscsi_trgt: Logical Unit Reset (05) issued on tid:1000 lun:0 by sid:281475098149376 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:39:02 10-165-160-13 kernel: [2243360.972748] iscsi_trgt: write_data(347) 0x10000073d0200:0: 48(48)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:39:02 10-165-160-13 kernel: [2243360.972887] iscsi_trgt: scsi_cmnd_start(996) 2000030 0 TEST_UNIT_READY&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;###########&amp;#x8FD9;&amp;#x91CC;&amp;#x53D1;&amp;#x7684;TEST_UNIT_READY&amp;#x6CA1;&amp;#x6709;&amp;#x63A5;&amp;#x4E0B;&amp;#x53BB;&amp;#x8C03;&amp;#x7528;disk_execute_cmnd&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:39:07 10-165-160-13 kernel: [2243365.982080] iscsi_trgt: write_data(347) 0x10000073d0200:0: 48(48)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:39:12 10-165-160-13 kernel: [2243370.967665] iscsi_trgt: Abort Task (01) issued on tid:1000 lun:0 by sid:281475098149376 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:39:12 10-165-160-13 kernel: [2243370.967680] iscsi_trgt: write_data(347) 0x10000073d0200:0: 48(48)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:39:12 10-165-160-13 kernel: [2243370.967849] iscsi_trgt: Target Warm Reset (06) issued on tid:1000 lun:0 by sid:281475098149376 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:39:12 10-165-160-13 kernel: [2243370.967857] iscsi_trgt: write_data(347) 0x10000073d0200:0: 48(48)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:39:12 10-165-160-13 kernel: [2243370.968009] iscsi_trgt: scsi_cmnd_start(996) 1000030 0 TEST_UNIT_READY&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;###########&amp;#x8FD9;&amp;#x91CC;&amp;#x53D1;&amp;#x7684;TEST_UNIT_READY&amp;#x6CA1;&amp;#x6709;&amp;#x63A5;&amp;#x4E0B;&amp;#x53BB;&amp;#x8C03;&amp;#x7528;disk_execute_cmnd&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:39:17 10-165-160-13 kernel: [2243375.981201] iscsi_trgt: write_data(347) 0x10000073d0200:0: 48(48)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:39:22 10-165-160-13 kernel: [2243380.962731] iscsi_trgt: Abort Task (01) issued on tid:1000 lun:0 by sid:281475098149376 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 15:39:22 10-165-160-13 kernel: [2243380.962743] iscsi_trgt: write_data(347) 0x10000073d0200:0: 48(48)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x8FD9;&amp;#x91CC;&amp;#x65E5;&amp;#x5FD7;&amp;#x8FD8;&amp;#x4E0D;&amp;#x591F;&amp;#x8BE6;&amp;#x7EC6;&amp;#xFF0C;&amp;#x518D;&amp;#x9488;&amp;#x5BF9;&amp;#x6027;&amp;#x7684;&amp;#x628A;cmnd&amp;#x5904;&amp;#x7406;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#x7684;&amp;#x76F8;&amp;#x5173;&amp;#x4FE1;&amp;#x606F;&amp;#x90FD;&amp;#x6253;&amp;#x5370;&amp;#x51FA;&amp;#x6765;&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:47 10-165-160-13 kernel: [2250662.387487] iscsi_trgt: do_recv(144) 48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:47 10-165-160-13 kernel: [2250662.387489] iscsi_trgt: cmnd_insert_hash(641) ffff885f5a75a830:b0000054&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:47 10-165-160-13 kernel: [2250662.387492] iscsi_trgt: check_cmd_sn(567) cmd_sn(10417) exp_cmd_sn(10417) max_cmd_sn(10449)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:47 10-165-160-13 kernel: [2250662.387494] iscsi_trgt: update_stat_sn(551) 1,350&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:47 10-165-160-13 kernel: [2250662.387495] iscsi_trgt: scsi_cmnd_start(982) scsi command: 00&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:47 10-165-160-13 kernel: [2250662.387498] iscsi_trgt: scsi_cmnd_start(1007) 540000b0 0 TEST_UNIT_READY&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:47 10-165-160-13 kernel: [2250662.394591] iscsi_trgt: cmnd_rx_end(1970) ffff885f5a75a830:1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:47 10-165-160-13 kernel: [2250662.394593] iscsi_trgt: iscsi_session_push_cmnd(1865) ffff885f5a75a830:1 10417,10417&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:47 10-165-160-13 kernel: [2250662.394595] iscsi_trgt: iscsi_cmnd_exec(1620) ffff885f5a75a830,1,10417&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:47 10-165-160-13 kernel: [2250662.394597] iscsi_trgt: iscsi_scsi_queuecmnd(64) ffff885f5a75a830&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:47 10-165-160-13 kernel: [2250662.394600] iscsi_trgt: iscsi_scsi_queuecmnd(76) iscsi_scsi_queuecmnd queue_lock aquired, 540000b0 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:47 10-165-160-13 kernel: [2250662.401931] iscsi_trgt: wthread_queue(35) wthread_queue put cmnd:ffff885f5a75a830 to work_queue, 540000b0 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:47 10-165-160-13 kernel: [2250662.409500] iscsi_trgt: iscsi_scsi_queuecmnd(95) iscsi_scsi_queuecmnd device queue cmnd:ffff885f5a75a830, 540000b0 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:47 10-165-160-13 kernel: [2250662.409540] iscsi_trgt: get_ready_cmnd(53) get_ready_cmnd get cmnd:ffff885f5a75a830 to work_queue, 540000b0 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:47 10-165-160-13 kernel: [2250662.409543] iscsi_trgt: disk_execute_cmnd(638) disk_execute_cmnd 540000b0 0 TEST_UNIT_READY&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:47 10-165-160-13 kernel: [2250662.409546] iscsi_trgt: cmnd_alloc(180) ffff882f2ea0a000:ffff885f889e8488&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:47 10-165-160-13 kernel: [2250662.409549] iscsi_trgt: iscsi_cmnds_init_write(221) ffff885f889e8488:21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:47 10-165-160-13 kernel: [2250662.433261] iscsi_trgt: cmnd_tx_start(1735) ffff885f889e8488:21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:47 10-165-160-13 kernel: [2250662.433268] iscsi_trgt: write_data(347) 0x10000073d0200:0: 48(48)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:47 10-165-160-13 kernel: [2250662.433270] iscsi_trgt: cmnd_tx_end(1810) ffff885f889e8488:21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:47 10-165-160-13 kernel: [2250662.433275] iscsi_trgt: cmnd_release(1693) cmnd_release cmnd:ffff885f889e8488, 21 4 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:47 10-165-160-13 kernel: [2250662.441226] iscsi_trgt: iscsi_cmnd_remove(441) ffff885f889e8488&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:47 10-165-160-13 kernel: [2250662.441229] iscsi_trgt: cmnd_release(1693) cmnd_release cmnd:ffff885f5a75a830, 1 24b 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:47 10-165-160-13 kernel: [2250662.448959] iscsi_trgt: iscsi_cmnd_remove(441) ffff885f5a75a830&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:47 10-165-160-13 kernel: [2250662.448963] iscsi_trgt: cmnd_alloc(180) ffff882f2ea0a000:ffff885f5a75a830&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;.............&amp;#x4E0B;&amp;#x9762;3&amp;#x6B21;&amp;#x662F;TEST_UNIT_READY&amp;#x8BF7;&amp;#x6C42;&amp;#x6CA1;&amp;#x80FD;&amp;#x6B63;&amp;#x5E38;&amp;#x5904;&amp;#x7406;&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:51 10-165-160-13 kernel: [2250666.385455] iscsi_trgt: do_recv(144) 48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:51 10-165-160-13 kernel: [2250666.385457] iscsi_trgt: cmnd_insert_hash(641) ffff885f88a4f120:b000005d&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:51 10-165-160-13 kernel: [2250666.385460] iscsi_trgt: check_cmd_sn(567) cmd_sn(10420) exp_cmd_sn(10420) max_cmd_sn(10452)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:51 10-165-160-13 kernel: [2250666.385461] iscsi_trgt: update_stat_sn(551) 1,354&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:51 10-165-160-13 kernel: [2250666.385463] iscsi_trgt: scsi_cmnd_start(982) scsi command: 00&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:51 10-165-160-13 kernel: [2250666.385466] iscsi_trgt: scsi_cmnd_start(1007) 5d0000b0 0 TEST_UNIT_READY&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:51 10-165-160-13 kernel: [2250666.392490] iscsi_trgt: cmnd_rx_end(1970) ffff885f88a4f120:1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:51 10-165-160-13 kernel: [2250666.392493] iscsi_trgt: iscsi_session_push_cmnd(1865) ffff885f88a4f120:1 10420,10420&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:51 10-165-160-13 kernel: [2250666.392495] iscsi_trgt: iscsi_cmnd_exec(1620) ffff885f88a4f120,1,10420&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:51 10-165-160-13 kernel: [2250666.392496] iscsi_trgt: iscsi_scsi_queuecmnd(64) ffff885f88a4f120&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:51 10-165-160-13 kernel: [2250666.392499] iscsi_trgt: iscsi_scsi_queuecmnd(76) iscsi_scsi_queuecmnd queue_lock aquired, 5d0000b0 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:51 10-165-160-13 kernel: [2250666.399778] iscsi_trgt: wthread_queue(35) wthread_queue put cmnd:ffff885f88a4f120 to work_queue, 5d0000b0 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:51 10-165-160-13 kernel: [2250666.407283] iscsi_trgt: iscsi_scsi_queuecmnd(95) iscsi_scsi_queuecmnd device queue cmnd:ffff885f88a4f120, 5d0000b0 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:40:56 10-165-160-13 kernel: [2250671.370526] iscsi_trgt: cmnd_alloc(180) ffff882f2ea0a000:ffff885f88a4f258&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;..............&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:41:01 10-165-160-13 kernel: [2250676.393762] iscsi_trgt: do_recv(144) 48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:41:01 10-165-160-13 kernel: [2250676.393764] iscsi_trgt: cmnd_insert_hash(641) ffff885f88a4f258:b0000056&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:41:01 10-165-160-13 kernel: [2250676.393766] iscsi_trgt: check_cmd_sn(567) cmd_sn(10421) exp_cmd_sn(10421) max_cmd_sn(10453)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:41:01 10-165-160-13 kernel: [2250676.393768] iscsi_trgt: update_stat_sn(551) 1,357&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:41:01 10-165-160-13 kernel: [2250676.393770] iscsi_trgt: scsi_cmnd_start(982) scsi command: 00&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:41:01 10-165-160-13 kernel: [2250676.393772] iscsi_trgt: scsi_cmnd_start(1007) 560000b0 0 TEST_UNIT_READY&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:41:01 10-165-160-13 kernel: [2250676.400617] iscsi_trgt: cmnd_rx_end(1970) ffff885f88a4f258:1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:41:01 10-165-160-13 kernel: [2250676.400619] iscsi_trgt: iscsi_session_push_cmnd(1865) ffff885f88a4f258:1 10421,10421&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:41:01 10-165-160-13 kernel: [2250676.400621] iscsi_trgt: iscsi_cmnd_exec(1620) ffff885f88a4f258,1,10421&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:41:01 10-165-160-13 kernel: [2250676.400623] iscsi_trgt: iscsi_scsi_queuecmnd(64) ffff885f88a4f258&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:41:01 10-165-160-13 kernel: [2250676.400625] iscsi_trgt: iscsi_scsi_queuecmnd(76) iscsi_scsi_queuecmnd queue_lock aquired, 560000b0 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:41:01 10-165-160-13 kernel: [2250676.407563] iscsi_trgt: wthread_queue(35) wthread_queue put cmnd:ffff885f88a4f258 to work_queue, 560000b0 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:41:01 10-165-160-13 kernel: [2250676.414738] iscsi_trgt: iscsi_scsi_queuecmnd(95) iscsi_scsi_queuecmnd device queue cmnd:ffff885f88a4f258, 560000b0 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:41:06 10-165-160-13 kernel: [2250681.389629] iscsi_trgt: cmnd_alloc(180) ffff882f2ea0a000:ffff885f88a4f390&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...............&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:41:11 10-165-160-13 kernel: [2250686.401385] iscsi_trgt: do_recv(144) 48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:41:11 10-165-160-13 kernel: [2250686.401387] iscsi_trgt: cmnd_insert_hash(641) ffff885f88a4f390:b0000068&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:41:11 10-165-160-13 kernel: [2250686.401389] iscsi_trgt: check_cmd_sn(567) cmd_sn(10422) exp_cmd_sn(10422) max_cmd_sn(10454)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:41:11 10-165-160-13 kernel: [2250686.401391] iscsi_trgt: update_stat_sn(551) 1,35a&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:41:11 10-165-160-13 kernel: [2250686.401393] iscsi_trgt: scsi_cmnd_start(982) scsi command: 00&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:41:11 10-165-160-13 kernel: [2250686.401395] iscsi_trgt: scsi_cmnd_start(1007) 680000b0 0 TEST_UNIT_READY&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:41:11 10-165-160-13 kernel: [2250686.408639] iscsi_trgt: cmnd_rx_end(1970) ffff885f88a4f390:1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:41:11 10-165-160-13 kernel: [2250686.408641] iscsi_trgt: iscsi_session_push_cmnd(1865) ffff885f88a4f390:1 10422,10422&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:41:11 10-165-160-13 kernel: [2250686.408643] iscsi_trgt: iscsi_cmnd_exec(1620) ffff885f88a4f390,1,10422&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:41:11 10-165-160-13 kernel: [2250686.408645] iscsi_trgt: iscsi_scsi_queuecmnd(64) ffff885f88a4f390&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:41:11 10-165-160-13 kernel: [2250686.408647] iscsi_trgt: iscsi_scsi_queuecmnd(76) iscsi_scsi_queuecmnd queue_lock aquired, 680000b0 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:41:11 10-165-160-13 kernel: [2250686.415920] iscsi_trgt: wthread_queue(35) wthread_queue put cmnd:ffff885f88a4f390 to work_queue, 680000b0 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:41:11 10-165-160-13 kernel: [2250686.423196] iscsi_trgt: iscsi_scsi_queuecmnd(95) iscsi_scsi_queuecmnd device queue cmnd:ffff885f88a4f390, 680000b0 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Feb 15 17:41:16 10-165-160-13 kernel: [2250691.384730] iscsi_trgt: cmnd_alloc(180) ffff882f2ea0a000:ffff885f88a4f4c8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...........&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x901A;&amp;#x8FC7;&amp;#x65E5;&amp;#x5FD7;&amp;#x5E76;&amp;#x7ED3;&amp;#x5408;iscsitarget&amp;#x7684;&amp;#x6E90;&amp;#x7801;&amp;#x53EF;&amp;#x4EE5;&amp;#x53D1;&amp;#x73B0;&amp;#xFF0C;TEST_UNIT_READY&amp;#x8BF7;&amp;#x6C42;&amp;#x53D1;&amp;#x9001;&amp;#x5230;target&amp;#x540E;&amp;#xFF0C;&amp;#x7531;target&amp;#x7684;&amp;#x7F51;&amp;#x7EDC;&amp;#x7EBF;&amp;#x7A0B;&amp;#x8FDB;&amp;#x884C;&amp;#x5305;&amp;#x89E3;&amp;#x6790;&amp;#x7B49;&amp;#x5904;&amp;#x7406;&amp;#x540E;&amp;#xFF0C;&amp;#x8C03;&amp;#x7528;wthread_queue&amp;#x5C06;cmnd&amp;#x653E;&amp;#x5230;target&amp;#x7684;work_queue&amp;#x91CC;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x8C03;&amp;#x7528;wake_up()&amp;#x53BB;&amp;#x5524;&amp;#x9192;target&amp;#x7684;IO&amp;#x7EBF;&amp;#x7A0B;&amp;#x53BB;&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#x3002;&amp;#x6B63;&amp;#x5E38;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;IO&amp;#x7EBF;&amp;#x7A0B;&amp;#x88AB;&amp;#x5524;&amp;#x9192;&amp;#x540E;&amp;#x4ECE;work_queue&amp;#x91CC;&amp;#x53D6;cmnd&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x8C03;&amp;#x7528;disk_execute_cmnd&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#x3002;&amp;#x4F46;&amp;#x662F;&amp;#x4ECE;&amp;#x4E0A;&amp;#x9762;&amp;#x65E5;&amp;#x5FD7;&amp;#x91CC;&amp;#x7684;&amp;#x540E;3&amp;#x6B21;TEST UNIT READY&amp;#x8BF7;&amp;#x6C42;&amp;#x5904;&amp;#x7406;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#x53D1;&amp;#x73B0;&amp;#x5F53;&amp;#x628A;cmnd&amp;#x653E;&amp;#x5230;work_queue&amp;#x540E;&amp;#x8C03;&amp;#x7528;wake_up()&amp;#x540E;&amp;#xFF0C;&amp;#x5E76;&amp;#x6CA1;&amp;#x6709;IO&amp;#x7EBF;&amp;#x7A0B;&amp;#x5904;&amp;#x7406;&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&amp;#x4E86;&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;// &amp;#x5C06;cmnd&amp;#x653E;&amp;#x5230;work_queue&amp;#x5E76;wake_up&amp;#x7684;&amp;#x51FD;&amp;#x6570;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;void wthread_queue(struct iscsi_cmnd *cmnd)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	struct worker_thread_info *info = cmnd-&amp;gt;conn-&amp;gt;session-&amp;gt;target-&amp;gt;wthread_info;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	if (!list_empty(&amp;amp;cmnd-&amp;gt;list)) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		struct iscsi_scsi_cmd_hdr *req = cmnd_hdr(cmnd);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		eprintk(&amp;quot;%x %p %x %x %x %x %lx %x\n&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			cmnd_itt(cmnd), req, req-&amp;gt;opcode, req-&amp;gt;scb[0], cmnd-&amp;gt;pdu.datasize,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			be32_to_cpu(req-&amp;gt;data_length), cmnd-&amp;gt;flags, req-&amp;gt;flags);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		if (cmnd-&amp;gt;lun)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			eprintk(&amp;quot;%u\n&amp;quot;, cmnd-&amp;gt;lun-&amp;gt;lun);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		assert(list_empty(&amp;amp;cmnd-&amp;gt;list));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	spin_lock(&amp;amp;info-&amp;gt;wthread_lock);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	// for debug&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	struct iscsi_scsi_cmd_hdr *req = cmnd_hdr(cmnd);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	if (req-&amp;gt;scb[0] == TEST_UNIT_READY)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		eprintk(&amp;quot;wthread_queue put cmnd:%p to work_queue, %x %x\n&amp;quot;, cmnd, cmnd_itt(cmnd), req-&amp;gt;scb[0]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	list_add_tail(&amp;amp;cmnd-&amp;gt;list, &amp;amp;info-&amp;gt;work_queue);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	spin_unlock(&amp;amp;info-&amp;gt;wthread_lock);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	atomic_inc(&amp;amp;cmnd-&amp;gt;conn-&amp;gt;nr_busy_cmnds);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	wake_up(&amp;amp;info-&amp;gt;wthread_sleep);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// target&amp;#x7684;IO&amp;#x5904;&amp;#x7406;&amp;#x7EBF;&amp;#x7A0B;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;static int worker_thread(void *arg)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	struct worker_thread *wt = (struct worker_thread *) arg;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	struct worker_thread_info *info = wt-&amp;gt;w_info;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	struct iscsi_cmnd *cmnd;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	struct iscsi_conn *conn;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	DECLARE_WAITQUEUE(wait, current);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	get_io_context(GFP_KERNEL, -1);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	if (!current-&amp;gt;io_context)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		eprintk(&amp;quot;%s\n&amp;quot;, &amp;quot;Failed to get IO context&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	else if (info-&amp;gt;wthread_ioc)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		copy_io_context(&amp;amp;current-&amp;gt;io_context, &amp;amp;info-&amp;gt;wthread_ioc);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	else&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		info-&amp;gt;wthread_ioc = current-&amp;gt;io_context;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	add_wait_queue(&amp;amp;info-&amp;gt;wthread_sleep, &amp;amp;wait);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	__set_current_state(TASK_RUNNING);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	do {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		while (!list_empty(&amp;amp;info-&amp;gt;work_queue) &amp;amp;&amp;amp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		       (cmnd = get_ready_cmnd(info))) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			conn = cmnd-&amp;gt;conn;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			if (cmnd_tmfabort(cmnd))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				cmnd_release(cmnd, 1);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			else&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				cmnd_execute(cmnd);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			assert(conn);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			atomic_dec(&amp;amp;conn-&amp;gt;nr_busy_cmnds);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		set_current_state(TASK_INTERRUPTIBLE);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		if (list_empty(&amp;amp;info-&amp;gt;work_queue))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			schedule();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        // &amp;#x5982;&amp;#x679C;&amp;#x88AB;&amp;#x5524;&amp;#x9192;&amp;#xFF0C;&amp;#x5E94;&amp;#x8BE5;&amp;#x4F1A;&amp;#x6253;&amp;#x5370;&amp;#x4E0B;&amp;#x9762;&amp;#x8FD9;&amp;#x6761;&amp;#x65E5;&amp;#x5FD7;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		eprintk(&amp;quot;worker_thread:%d, waked up to running\n&amp;quot;, current-&amp;gt;pid);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		__set_current_state(TASK_RUNNING);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	} while (!kthread_should_stop());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	remove_wait_queue(&amp;amp;info-&amp;gt;wthread_sleep, &amp;amp;wait);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	if (current-&amp;gt;io_context) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		struct io_context *ioc = current-&amp;gt;io_context;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		task_lock(current);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		current-&amp;gt;io_context = NULL;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		task_unlock(current);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		put_io_context(ioc);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	return 0;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x8FD9;&amp;#x8BF4;&amp;#x660E;target&amp;#x7684;IO&amp;#x7EBF;&amp;#x7A0B;&amp;#x6CA1;&amp;#x6709;&amp;#x88AB;&amp;#x6210;&amp;#x529F;&amp;#x5524;&amp;#x9192;&amp;#xFF0C;&amp;#x56F0;&amp;#x6270;&amp;#x4E86;&amp;#x4E00;&amp;#x4F1A;&amp;#xFF0C;&amp;#x7ECF;&amp;#x5185;&amp;#x6838;&amp;#x7684;&amp;#x540C;&amp;#x4E8B;&amp;#x63D0;&amp;#x9192;&amp;#x53BB;&amp;#x89C2;&amp;#x5BDF;&amp;#x8FD9;&amp;#x4E9B;IO&amp;#x7EBF;&amp;#x7A0B;&amp;#x90A3;&amp;#x6BB5;&amp;#x65F6;&amp;#x95F4;&amp;#x7684;&amp;#x72B6;&amp;#x6001;(cat /proc/&lt;pid&gt;/status)&amp;#xFF0C;&amp;#x770B;&amp;#x770B;voluntary_ctxt_switches&amp;#xFF08;&amp;#x7EBF;&amp;#x7A0B;&amp;#x4E3B;&amp;#x52A8;&amp;#x5207;&amp;#x6362;&amp;#xFF09;&amp;#x548C;nonvoluntary_ctxt_switches&amp;#xFF08;&amp;#x7EBF;&amp;#x7A0B;&amp;#x88AB;&amp;#x52A8;&amp;#x5207;&amp;#x6362;&amp;#xFF09;&amp;#x8FD9;&amp;#x4E24;&amp;#x9879;&amp;#x6709;&amp;#x6CA1;&amp;#x6709;&amp;#x589E;&amp;#x52A0;&amp;#x3002;&amp;#x56E0;&amp;#x6B64;&amp;#x5199;&amp;#x4E86;&amp;#x4E2A;&amp;#x811A;&amp;#x672C;&amp;#x6BCF;&amp;#x9694;1s cat&amp;#x4E00;&amp;#x4E0B;&amp;#x8FD9;&amp;#x4E9B;&amp;#x7EBF;&amp;#x7A0B;&amp;#x7684;&amp;#x72B6;&amp;#x6001;&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;for i in {1..3600};do for j in {81994..82001};do date &amp;gt;&amp;gt; istiod_$j.txt; sudo cat /proc/$j/status &amp;gt;&amp;gt; istiod_$j.txt;done;sleep 1s;done&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/pid&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;#x7EBF;&amp;#x7A0B;&amp;#x72B6;&amp;#x6001;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Thu Feb 16 09:35:10 CST 2017&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Name:   istiod0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;State:  D (disk sleep)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Tgid:   58434&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Pid:    58434&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PPid:   2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;TracerPid:      0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Uid:    0       0       0       0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Gid:    0       0       0       0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;FDSize: 64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Groups:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Threads:        1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SigQ:   1/3099088&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SigPnd: 0000000000000000&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ShdPnd: 0000000000000000&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SigBlk: 0000000000000000&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SigIgn: ffffffffffffffff&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SigCgt: 0000000000000000&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CapInh: 0000000000000000&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CapPrm: 0000001fffffffff&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CapEff: 0000001fffffffff&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CapBnd: 0000001fffffffff&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Seccomp:        0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Cpus_allowed:   ffff,ffffffff,ffffffff,ffffffff,ffffffff&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Cpus_allowed_list:      0-143&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Mems_allowed:   00000000,00000003&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Mems_allowed_list:      0-1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;voluntary_ctxt_switches:        6172&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nonvoluntary_ctxt_switches:     196&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;**********&amp;#x6301;&amp;#x7EED;10s&amp;#x72B6;&amp;#x6001;&amp;#x548C;switches&amp;#x90FD;&amp;#x6CA1;&amp;#x53D8;&amp;#xFF0C;6172&amp;#x548C;196**********&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Thu Feb 16 09:35:20 CST 2017&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Name:   istiod0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;State:  D (disk sleep)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Tgid:   58434&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Pid:    58434&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PPid:   2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;TracerPid:      0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Uid:    0       0       0       0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Gid:    0       0       0       0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;FDSize: 64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Groups:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Threads:        1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SigQ:   1/3099088&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SigPnd: 0000000000000000&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ShdPnd: 0000000000000000&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SigBlk: 0000000000000000&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SigIgn: ffffffffffffffff&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SigCgt: 0000000000000000&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CapInh: 0000000000000000&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CapPrm: 0000001fffffffff&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CapEff: 0000001fffffffff&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CapBnd: 0000001fffffffff&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Seccomp:        0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Cpus_allowed:   ffff,ffffffff,ffffffff,ffffffff,ffffffff&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Cpus_allowed_list:      0-143&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Mems_allowed:   00000000,00000003&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Mems_allowed_list:      0-1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;voluntary_ctxt_switches:        6173&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nonvoluntary_ctxt_switches:     196&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;************&amp;#x6301;&amp;#x7EED;10s&amp;#x72B6;&amp;#x6001;&amp;#x548C;switches&amp;#x90FD;&amp;#x6CA1;&amp;#x53D8;&amp;#xFF0C;6173&amp;#x548C;196***************&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Thu Feb 16 09:35:30 CST 2017&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Name:   istiod0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;State:  D (disk sleep)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Tgid:   58434&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Pid:    58434&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PPid:   2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;TracerPid:      0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Uid:    0       0       0       0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Gid:    0       0       0       0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;FDSize: 64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Groups:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Threads:        1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SigQ:   1/3099088&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SigPnd: 0000000000000000&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ShdPnd: 0000000000000000&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SigBlk: 0000000000000000&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SigIgn: ffffffffffffffff&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SigCgt: 0000000000000000&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CapInh: 0000000000000000&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CapPrm: 0000001fffffffff&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CapEff: 0000001fffffffff&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CapBnd: 0000001fffffffff&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Seccomp:        0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Cpus_allowed:   ffff,ffffffff,ffffffff,ffffffff,ffffffff&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Cpus_allowed_list:      0-143&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Mems_allowed:   00000000,00000003&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Mems_allowed_list:      0-1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;voluntary_ctxt_switches:        6174&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nonvoluntary_ctxt_switches:     196&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&amp;#x4ECE;&amp;#x72B6;&amp;#x6001;&amp;#x4E0A;&amp;#x770B;&amp;#xFF0C;&amp;#x786E;&amp;#x5B9E;&amp;#x5F02;&amp;#x5E38;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;&amp;#xFF0C;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;IO&amp;#x7EBF;&amp;#x7A0B;&amp;#x7684;ctxt_switches&amp;#x90FD;&amp;#x6CA1;&amp;#x6709;&amp;#x53D8;&amp;#x5316;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x7EBF;&amp;#x7A0B;&amp;#x72B6;&amp;#x6001;&amp;#x5904;&amp;#x4E8E;D(disk sleep)&amp;#x72B6;&amp;#x6001;&amp;#xFF0C;&amp;#x5904;&amp;#x4E8E;D&amp;#x72B6;&amp;#x6001;&amp;#x7684;&amp;#x5185;&amp;#x6838;&amp;#x7EBF;&amp;#x7A0B;&amp;#x90FD;&amp;#x662F;UNINTERRUPTIBLE&amp;#x7684;&amp;#xFF0C;&amp;#x65E0;&amp;#x6CD5;&amp;#x5524;&amp;#x9192;&amp;#x7684;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x4E3A;&amp;#x4E86;&amp;#x5BF9;&amp;#x6BD4;&amp;#xFF0C;&amp;#x5728;&amp;#x88F8;&amp;#x76D8;&amp;#x6D4B;&amp;#x8BD5;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#x4E5F;&amp;#x6293;&amp;#x53D6;&amp;#x4E86;&amp;#x8FD9;&amp;#x4E9B;IO&amp;#x7EBF;&amp;#x7A0B;&amp;#x7684;&amp;#x72B6;&amp;#x6001;&amp;#xFF0C;&amp;#x7ED3;&amp;#x679C;&amp;#x53D1;&amp;#x73B0;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#x6709;&amp;#x4E9B;IO&amp;#x7EBF;&amp;#x7A0B;&amp;#x5904;&amp;#x4E8E;D&amp;#x72B6;&amp;#x6001;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x8FD8;&amp;#x6709;&amp;#x5904;&amp;#x4E8E;S&amp;#x72B6;&amp;#x6001;&amp;#x7684;&amp;#x7EBF;&amp;#x7A0B;&amp;#xFF0C;&amp;#x56E0;&amp;#x6B64;&amp;#x53EF;&amp;#x4EE5;&amp;#x5524;&amp;#x9192;&amp;#x6765;&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x4E3A;&amp;#x4E86;&amp;#x8FDB;&amp;#x4E00;&amp;#x6B65;&amp;#x786E;&amp;#x8BA4;&amp;#x95EE;&amp;#x9898;&amp;#xFF0C;&amp;#x5C06;target&amp;#x7684;IO&amp;#x7EBF;&amp;#x7A0B;&amp;#x6539;&amp;#x6210;1&amp;#x4E2A;&amp;#xFF08;&amp;#x9ED8;&amp;#x8BA4;&amp;#x6BCF;&amp;#x4E2A;target&amp;#x662F;1&amp;#x4E2A;&amp;#x7F51;&amp;#x7EDC;&amp;#x7EBF;&amp;#x7A0B;&amp;#xFF0C;8&amp;#x4E2A;IO&amp;#x7EBF;&amp;#x7A0B;&amp;#xFF09;&amp;#xFF0C;&amp;#x4F7F;&amp;#x7528;&amp;#x4EE5;&amp;#x4E0B;&amp;#x547D;&amp;#x4EE4;&amp;#x53EF;&amp;#x4EE5;&amp;#x4FEE;&amp;#x6539;&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;sudo ietadm --op update --tid=&amp;lt;tid&amp;gt; --params=Wthreads=&amp;lt;N&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x7136;&amp;#x540E;&amp;#x518D;&amp;#x5206;&amp;#x522B;&amp;#x88F8;&amp;#x76D8;&amp;#x6D4B;&amp;#x8BD5;&amp;#x548C;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x4E0A;&amp;#x6D4B;&amp;#x8BD5;&amp;#xFF0C;&amp;#x8FD9;&amp;#x6B21;&amp;#x53D1;&amp;#x73B0;&amp;#x88F8;&amp;#x76D8;&amp;#x6D4B;&amp;#x8BD5;&amp;#x65F6;fio&amp;#x4E5F;&amp;#x662F;&amp;#x591A;hang&amp;#x4E86;3&amp;#x6B21;10s&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;target&amp;#x7684;&amp;#x90A3;&amp;#x4E2A;IO&amp;#x7EBF;&amp;#x7A0B;&amp;#x662F;&amp;#x5904;&amp;#x4E8E;D&amp;#x72B6;&amp;#x6001;&amp;#x7684;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x81F3;&amp;#x6B64;&amp;#xFF0C;&amp;#x57FA;&amp;#x672C;&amp;#x53EF;&amp;#x4EE5;&amp;#x786E;&amp;#x8BA4;&amp;#x662F;&amp;#x7531;&amp;#x4E8E;&amp;#x4ECE;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x6D4B;&amp;#x8BD5;&amp;#x65F6;&amp;#x591A;&amp;#x4F59;&amp;#x7684;sync IO&amp;#x5BFC;&amp;#x81F4;target&amp;#x7684;IO&amp;#x7EBF;&amp;#x7A0B;&amp;#x90FD;D&amp;#x72B6;&amp;#x6001;&amp;#x56E0;&amp;#x6B64;&amp;#x65E0;&amp;#x6CD5;&amp;#x7EE7;&amp;#x7EED;&amp;#x5904;&amp;#x7406;TEST UNIT READY&amp;#x8BF7;&amp;#x6C42;&amp;#x4ECE;&amp;#x800C;&amp;#x5BFC;&amp;#x81F4;initiator&amp;#x7AEF;iscsi&amp;#x8BBE;&amp;#x5907;TUR&amp;#x8BF7;&amp;#x6C42;&amp;#x8D85;&amp;#x65F6;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x65E2;&amp;#x7136;&amp;#x662F;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x591A;&amp;#x7684;sync IO&amp;#x5BFC;&amp;#x81F4;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x6709;&amp;#x6CA1;&amp;#x6709;&amp;#x53EF;&amp;#x80FD;&amp;#x51CF;&amp;#x5C11;&amp;#x5F02;&amp;#x5E38;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;&amp;#x53D1;&amp;#x5230;target&amp;#x7684;IO&amp;#x5462;&amp;#xFF1F;&lt;br&gt;1&amp;#xFF09;&amp;#x4E00;&amp;#x79CD;&amp;#x5C1D;&amp;#x8BD5;&amp;#x662F;&amp;#x8C03;&amp;#x6574;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;flush&amp;#x65F6;&amp;#x95F4;(/proc/sys/vm/dirty_expire_centisecs)&amp;#xFF0C;&amp;#x51CF;&amp;#x5C0F;&amp;#x5237;&amp;#x810F;&amp;#x9875;&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x95F4;&amp;#x9694;&amp;#xFF0C;&amp;#x7ED3;&amp;#x679C;&amp;#x6D4B;&amp;#x8BD5;&amp;#x540E;&amp;#x6CA1;&amp;#x6709;&amp;#x6548;&amp;#x679C;&amp;#xFF1B;&lt;/p&gt;
&lt;p&gt;2&amp;#xFF09;&amp;#x53E6;&amp;#x5916;&amp;#x4E00;&amp;#x79CD;&amp;#x662F;&amp;#x8C03;&amp;#x6574;&amp;#x8FD9;&amp;#x4E2A;iscsi&amp;#x8BBE;&amp;#x5907;&amp;#x7684;queue_depth(/sys/block/sds/device/queue_depth)&amp;#xFF0C;&amp;#x5BF9;&amp;#x4E8E;iscsi&amp;#x8BBE;&amp;#x5907;&amp;#x9ED8;&amp;#x8BA4;&amp;#x7684;queue_depth=32&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x53EF;&amp;#x4EE5;&amp;#x5C06;&amp;#x8FD9;&amp;#x4E2A;&amp;#x8C03;&amp;#x5C0F;&amp;#x6BD4;&amp;#x5982;&amp;#x8C03;&amp;#x6574;&amp;#x5230;1&amp;#xFF0C;&amp;#x6D4B;&amp;#x8BD5;&amp;#x786E;&amp;#x8BA4;&amp;#x5F53;&amp;#x8FD9;&amp;#x4E2A;&amp;#x503C;&amp;#x8C03;&amp;#x5C0F;&amp;#x540E;&amp;#xFF0C;target&amp;#x9ED8;&amp;#x8BA4;8&amp;#x4E2A;IO&amp;#x7EBF;&amp;#x7A0B;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x4ECE;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x53BB;fio&amp;#x6D4B;&amp;#x8BD5;&amp;#xFF0C;&amp;#x7ED3;&amp;#x679C;&amp;#x6CA1;&amp;#x6709;&amp;#x591A;&amp;#x51FA;30s&amp;#x7684;io hang&amp;#x65F6;&amp;#x95F4;&amp;#x3002;&amp;#x8BF4;&amp;#x660E;&amp;#x8FD9;&amp;#x4E2A;&amp;#x8C03;&amp;#x6574;&amp;#x662F;&amp;#x6709;&amp;#x6548;&amp;#x679C;&amp;#x7684;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x8003;&amp;#x8651;&amp;#x5230;queue_depth&amp;#x8C03;&amp;#x5C0F;&amp;#x540E;&amp;#x4F1A;&amp;#x5F71;&amp;#x54CD;IO&amp;#x6027;&amp;#x80FD;&amp;#xFF08;&amp;#x56E0;&amp;#x4E3A;&amp;#x5F53;io&amp;#x961F;&amp;#x5217;&amp;#x8FBE;&amp;#x5230;&amp;#x8FD9;&amp;#x4E2A;&amp;#x503C;&amp;#x540E;&amp;#x76F4;&amp;#x63A5;&amp;#x5728;&amp;#x8BBE;&amp;#x5907;&amp;#x5C42;&amp;#x9762;&amp;#x5C31;&amp;#x963B;&amp;#x6B62;&amp;#x5C06;&amp;#x540E;&amp;#x7EED;io&amp;#x653E;&amp;#x5165;&amp;#x961F;&amp;#x5217;&amp;#x4E86;&amp;#xFF09;&amp;#xFF0C;&amp;#x56E0;&amp;#x6B64;&amp;#x6362;&amp;#x4E2A;&amp;#x89D2;&amp;#x5EA6;&amp;#x53BB;&amp;#x8C03;&amp;#x5927;&amp;#x540E;&amp;#x7AEF;target&amp;#x7684;IO&amp;#x7EBF;&amp;#x7A0B;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;3&amp;#xFF09;&amp;#x90A3;target&amp;#x7684;IO&amp;#x7EBF;&amp;#x7A0B;&amp;#x8C03;&amp;#x6574;&amp;#x5230;&amp;#x591A;&amp;#x5C11;&amp;#x5408;&amp;#x9002;&amp;#x4E86;&amp;#xFF0C;&amp;#x7ECF;&amp;#x8FC7;&amp;#x6D4B;&amp;#x8BD5;&amp;#x8C03;&amp;#x6574;&amp;#x6210;&amp;#x5927;&amp;#x4E8E;queue_depth&amp;#x65F6;&amp;#x6CA1;&amp;#x6709;&amp;#x591A;&amp;#x4F59;&amp;#x7684;30s hang&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x8C03;&amp;#x6574;&amp;#x5230;32&amp;#x6216;&amp;#x8005;30&amp;#xFF0C;&amp;#x6709;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x4E0D;&amp;#x4F1A;&amp;#x591A;&amp;#xFF0C;&amp;#x6709;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x4E5F;&amp;#x662F;&amp;#x4F1A;&amp;#x591A;30s&amp;#xFF0C;&amp;#x56E0;&amp;#x6B64;&amp;#x4FDD;&amp;#x9669;&amp;#x8D77;&amp;#x89C1;&amp;#xFF0C;&amp;#x8C03;&amp;#x5927;&amp;#x6210;&amp;#x7565;&amp;#x5927;&amp;#x4E8E;queue_depth&amp;#xFF0C;&amp;#x6BD4;&amp;#x5982;&amp;#x8BBE;&amp;#x7F6E;&amp;#x6210;40&amp;#x3002;&amp;#x4E0D;&amp;#x8FC7;&amp;#x6BCF;&amp;#x4E2A;target&amp;#x7684;IO&amp;#x7EBF;&amp;#x7A0B;&amp;#x90FD;&amp;#x6539;&amp;#x6210;40&amp;#x4F1A;&amp;#x5BFC;&amp;#x81F4;&amp;#x5185;&amp;#x6838;&amp;#x8D44;&amp;#x6E90;&amp;#x7684;&amp;#x589E;&amp;#x52A0;&amp;#xFF08;&amp;#x8FD9;&amp;#x70B9;&amp;#x8FD8;&amp;#x80FD;&amp;#x63A5;&amp;#x53D7;&amp;#xFF09;&amp;#xFF0C;&amp;#x53E6;&amp;#x5916;&amp;#x53EF;&amp;#x80FD;&amp;#x4F1A;&amp;#x5F71;&amp;#x54CD;&amp;#x6027;&amp;#x80FD;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x6BCF;&amp;#x4E2A;target&amp;#x7684;IO&amp;#x7EBF;&amp;#x7A0B;&amp;#x662F;&amp;#x5171;&amp;#x7528;&amp;#x4E00;&amp;#x4E2A;&amp;#x961F;&amp;#x5217;&amp;#xFF0C;&amp;#x901A;&amp;#x8FC7;spin_lock&amp;#x6765;&amp;#x83B7;&amp;#x53D6;&amp;#x961F;&amp;#x5217;&amp;#x7684;&amp;#x8BBF;&amp;#x95EE;&amp;#xFF0C;&amp;#x56E0;&amp;#x6B64;&amp;#x6D4B;&amp;#x8BD5;&amp;#x65F6;&amp;#x9700;&amp;#x8981;&amp;#x91CD;&amp;#x70B9;&amp;#x5173;&amp;#x6CE8;&amp;#x6027;&amp;#x80FD;&amp;#x4F1A;&amp;#x4E0D;&amp;#x4F1A;&amp;#x6709;&amp;#x6240;&amp;#x5F71;&amp;#x54CD;&amp;#xFF0C;&amp;#x9501;&amp;#x7684;&amp;#x7ADE;&amp;#x4E89;&amp;#x7684;cpu&amp;#x662F;&amp;#x5426;&amp;#x589E;&amp;#x52A0;&amp;#x7B49;&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;&amp;#x9644;&amp;#x5F55;&quot;&gt;&lt;a href=&quot;#&amp;#x9644;&amp;#x5F55;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x9644;&amp;#x5F55;&quot;&gt;&lt;/a&gt;&amp;#x9644;&amp;#x5F55;&lt;/h2&gt;&lt;h3 id=&quot;&amp;#x6392;&amp;#x67E5;&amp;#x95EE;&amp;#x9898;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#x5206;&amp;#x6790;&amp;#x7684;scsi-error-handler&amp;#x90E8;&amp;#x5206;&amp;#x5904;&amp;#x7406;&amp;#x903B;&amp;#x8F91;&quot;&gt;&lt;a href=&quot;#&amp;#x6392;&amp;#x67E5;&amp;#x95EE;&amp;#x9898;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#x5206;&amp;#x6790;&amp;#x7684;scsi-error-handler&amp;#x90E8;&amp;#x5206;&amp;#x5904;&amp;#x7406;&amp;#x903B;&amp;#x8F91;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x6392;&amp;#x67E5;&amp;#x95EE;&amp;#x9898;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#x5206;&amp;#x6790;&amp;#x7684;scsi error handler&amp;#x90E8;&amp;#x5206;&amp;#x5904;&amp;#x7406;&amp;#x903B;&amp;#x8F91;&quot;&gt;&lt;/a&gt;&amp;#x6392;&amp;#x67E5;&amp;#x95EE;&amp;#x9898;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#x5206;&amp;#x6790;&amp;#x7684;scsi error handler&amp;#x90E8;&amp;#x5206;&amp;#x5904;&amp;#x7406;&amp;#x903B;&amp;#x8F91;&lt;/h3&gt;&lt;p&gt;&amp;#x8BE6;&amp;#x7EC6;&amp;#x7684;&amp;#x53EF;&amp;#x4EE5;&amp;#x7ED3;&amp;#x5408;&lt;a href=&quot;https://lwn.net/Articles/644318/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Documentation about scsi_cmnd lifecycle&lt;/a&gt;&amp;#x548C;&amp;#x5185;&amp;#x6838;&amp;#x6E90;&amp;#x7801;&amp;#x6765;&amp;#x770B;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;scsi_error_handler()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+-&amp;gt;scsi_unjam_host()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   +-&amp;gt;scsi_eh_get_sense()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   +-&amp;gt;scsi_eh_abort_cmds()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  +-&amp;gt;rtn=scsi_try_to_abort_cmd()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  |  |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  |  +-&amp;gt;hostt-&amp;gt;eh_abort_handler,iscsi&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x662F;iscsi_eh_abort&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  +-&amp;gt;if rtn == FAST_IO_FAIL, call scsi_eh_finish_cmd() to put cmd to done_q,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  |     else move scmd to check_list&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  +-&amp;gt;scsi_eh_test_devices()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |     |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |     +-&amp;gt;finish_cmds = !scsi_device_online(scmd-&amp;gt;device) ||&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |        (try_stu &amp;amp;&amp;amp; !scsi_eh_try_stu(scmd) &amp;amp;&amp;amp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |        !scsi_eh_tur(scmd)) ||&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |        !scsi_eh_tur(scmd);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |        &amp;#x6211;&amp;#x4EEC;&amp;#x7684;&amp;#x573A;&amp;#x666F;&amp;#x4E0B;try_stu=0,&amp;#x56E0;&amp;#x6B64;&amp;#x8C03;&amp;#x7528;&amp;#x7684;scsi_eh_tur()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |        |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |        +-&amp;gt;scsi_send_eh_cmnd(,,SENSE_TIMEOUT)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |           |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |           +-&amp;gt;rtn=shost-&amp;gt;hostt-&amp;gt;queuecommand(), here is iscsi_queuecommand()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |           +-&amp;gt;wait_for_completion_timeout(,,timeout), here wait timeout=SENSE_TIMEOUT=10s&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |           +-&amp;gt;if timeleft==0 &amp;amp;&amp;amp; !rtn, call scsi_abort_eh_cmnd()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   +-&amp;gt;scsi_eh_ready_devs()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |   (when scsi_eh_abort_cmds() return false then call scsi_eh_ready_devs())&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  +-&amp;gt;scsi_eh_stu()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  +-&amp;gt;scsi_eh_bus_device_reset()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  |  |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  |  +-&amp;gt;scsi_try_bus_device_reset()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  |  +-&amp;gt;scsi_eh_tur()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  |     |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  |     +-&amp;gt;scsi_send_eh_cmnd(,,SENSE_TIMEOUT)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  |        |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  |        +-&amp;gt;scsi_queuecommand()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  |        +-&amp;gt;wait_for_completion_timeout(,,timeout), here wait timeout=SENSE_TIMEOUT=10s&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  |        +-&amp;gt;scsi_abort_eh_cmnd()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  +-&amp;gt;scsi_eh_target_reset()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  |  |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  |  +-&amp;gt;scsi_try_target_reset()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  |  +-&amp;gt;scsi_eh_test_devices()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  |     |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  |     +-&amp;gt;scsi_eh_tur()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  |        |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  |        +-&amp;gt;scsi_send_eh_cmnd(,,SENSE_TIMEOUT)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  |           |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  |           +-&amp;gt;scsi_queuecommand()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  |           +-&amp;gt;wait_for_completion_timeout(,,timeout), here wait timeout=SENSE_TIMEOUT=10s&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  |           +-&amp;gt;scsi_abort_eh_cmnd()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  +-&amp;gt;scsi_eh_bus_reset()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  |  |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  |  +-&amp;gt;scsi_try_bus_reset()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  |  +-&amp;gt;scsi_eh_test_devices()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  +-&amp;gt;scsi_eh_host_reset()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  |  |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  |  +-&amp;gt;scsi_try_host_reset()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  |  +-&amp;gt;scsi_eh_test_devices()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |  +-&amp;gt;scsi_eh_offline_sdevs()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   +-&amp;gt;scsi_eh_flush_done_q()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     (For all the EH commands on the done_q, either requeue them to retry(via&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      scsi_queue_insert()) if eligible, or finish them up to block layer&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      (via scsi_finish_command())&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&quot;systemtap&amp;#x811A;&amp;#x672C;&quot;&gt;&lt;a href=&quot;#systemtap&amp;#x811A;&amp;#x672C;&quot; class=&quot;headerlink&quot; title=&quot;systemtap&amp;#x811A;&amp;#x672C;&quot;&gt;&lt;/a&gt;systemtap&amp;#x811A;&amp;#x672C;&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;104&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;105&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;106&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;107&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;108&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;109&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;110&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;%{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#include &amp;lt;linux/types.h&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#include &amp;lt;scsi/scsi_cmnd.h&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#include &amp;lt;scsi/scsi_device.h&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#include &amp;lt;scsi/scsi_host.h&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#include &amp;lt;scsi/scsi_cmnd.h&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#include &amp;lt;linux/timer.h&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#include &amp;lt;linux/blkdev.h&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;%}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;probe module(&amp;quot;scsi_mod&amp;quot;).function(&amp;quot;scsi_send_eh_cmnd&amp;quot;).call {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	host_no = $scmd-&amp;gt;device-&amp;gt;host-&amp;gt;host_no&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	channel = $scmd-&amp;gt;device-&amp;gt;channel&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	lun = $scmd-&amp;gt;device-&amp;gt;lun&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	dev_id = $scmd-&amp;gt;device-&amp;gt;id&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	/*print_backtrace()*/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	printf(&amp;quot;%s, scsi_send_eh_cmnd enter: host_no=%d, channel=%d, lun=%d, dev_id=%d, scmd:%p, sense_timeout:%d\n&amp;quot;, ctime(gettimeofday_s()), host_no, channel, lun, dev_id, $scmd, $timeout)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;probe module(&amp;quot;scsi_mod&amp;quot;).function(&amp;quot;scsi_send_eh_cmnd&amp;quot;).return {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	host_no = $scmd-&amp;gt;device-&amp;gt;host-&amp;gt;host_no&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	channel = $scmd-&amp;gt;device-&amp;gt;channel&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	lun = $scmd-&amp;gt;device-&amp;gt;lun&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	dev_id = $scmd-&amp;gt;device-&amp;gt;id&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	printf(&amp;quot;%s, scsi_send_eh_cmnd return: host_no=%d, channel=%d, lun=%d, dev_id=%d, scmd:%p, sense_timeout:%d, return:%d\n\n&amp;quot;, ctime(gettimeofday_s()), host_no, channel, lun, dev_id, $scmd, $timeout, $return)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;probe module(&amp;quot;libiscsi&amp;quot;).function(&amp;quot;iscsi_queuecommand&amp;quot;).call {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	host_no = $sc-&amp;gt;device-&amp;gt;host-&amp;gt;host_no&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	channel = $sc-&amp;gt;device-&amp;gt;channel&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	lun = $sc-&amp;gt;device-&amp;gt;lun&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	dev_id = $sc-&amp;gt;device-&amp;gt;id&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	if (host_no == 62 &amp;amp;&amp;amp; channel == 0 &amp;amp;&amp;amp; lun == 11 &amp;amp;&amp;amp; dev_id == 0) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		/*print_backtrace()*/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		printf(&amp;quot;%s, iscsi_queuecommand call: host_no=%d, channel=%d, lun=%d, dev_id=%d, scmd:%p\n&amp;quot;, ctime(gettimeofday_s()), host_no, channel, lun, dev_id, $sc)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	}	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;probe module(&amp;quot;libiscsi&amp;quot;).function(&amp;quot;iscsi_queuecommand&amp;quot;).return {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	host_no = $sc-&amp;gt;device-&amp;gt;host-&amp;gt;host_no&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	channel = $sc-&amp;gt;device-&amp;gt;channel&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	lun = $sc-&amp;gt;device-&amp;gt;lun&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	dev_id = $sc-&amp;gt;device-&amp;gt;id&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	if (host_no == 62 &amp;amp;&amp;amp; channel == 0 &amp;amp;&amp;amp; lun == 11 &amp;amp;&amp;amp; dev_id == 0) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		printf(&amp;quot;%s, iscsi_queuecommand return: host_no=%d, channel=%d, lun=%d, dev_id=%d, scmd:%p, return=%d\n&amp;quot;, ctime(gettimeofday_s()), host_no, channel, lun, dev_id, $sc, $return)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	}	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;probe module(&amp;quot;scsi_mod&amp;quot;).function(&amp;quot;scsi_dispatch_cmd&amp;quot;) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	host_no = $cmd-&amp;gt;device-&amp;gt;host-&amp;gt;host_no&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	channel = $cmd-&amp;gt;device-&amp;gt;channel&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	lun = $cmd-&amp;gt;device-&amp;gt;lun&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	dev_id = $cmd-&amp;gt;device-&amp;gt;id&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	if (host_no == 62 &amp;amp;&amp;amp; channel == 0 &amp;amp;&amp;amp; lun == 11 &amp;amp;&amp;amp; dev_id == 0) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		printf(&amp;quot;%s, scsi_dispatch_cmd: host_no=%d, channel=%d, lun=%d, dev_id=%d, cmd:%p\n&amp;quot;, ctime(gettimeofday_s()), host_no, channel, lun, dev_id, $cmd)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;probe module(&amp;quot;scsi_mod&amp;quot;).function(&amp;quot;scsi_times_out&amp;quot;) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	printf(&amp;quot;%s, scsi_times_out: scmd:%p\n&amp;quot;, ctime(gettimeofday_s()), $req-&amp;gt;special)	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;probe kernel.function(&amp;quot;wait_for_completion_timeout&amp;quot;) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	printf(&amp;quot;%s, wait_for_completion_timeout\n&amp;quot;, ctime(gettimeofday_s()))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;probe module(&amp;quot;scsi_mod&amp;quot;).function(&amp;quot;scsi_eh_test_devices&amp;quot;).call {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	/*print_backtrace()*/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	printf(&amp;quot;%s, scsi_eh_test_devices call: try_stu=%d\n&amp;quot;, ctime(gettimeofday_s()), $try_stu)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;probe module(&amp;quot;scsi_mod&amp;quot;).function(&amp;quot;scsi_eh_test_devices&amp;quot;).return {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	printf(&amp;quot;%s, scsi_eh_test_devices return=%d : try_stu=%d\n&amp;quot;, ctime(gettimeofday_s()), $return, $try_stu)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;probe module(&amp;quot;scsi_mod&amp;quot;).function(&amp;quot;scsi_eh_abort_cmds&amp;quot;) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	printf(&amp;quot;%s, scsi_eh_abort_cmds\n&amp;quot;, ctime(gettimeofday_s()))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;probe module(&amp;quot;scsi_mod&amp;quot;).function(&amp;quot;scsi_eh_bus_device_reset&amp;quot;) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	printf(&amp;quot;%s, scsi_eh_bus_device_reset\n&amp;quot;, ctime(gettimeofday_s()))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;probe module(&amp;quot;scsi_mod&amp;quot;).function(&amp;quot;scsi_eh_target_reset&amp;quot;) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	printf(&amp;quot;%s, scsi_eh_target_reset\n&amp;quot;, ctime(gettimeofday_s()))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;probe module(&amp;quot;scsi_mod&amp;quot;).function(&amp;quot;scsi_eh_host_reset&amp;quot;) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	printf(&amp;quot;%s, scsi_eh_host_reset\n&amp;quot;, ctime(gettimeofday_s()))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;probe module(&amp;quot;scsi_mod&amp;quot;).function(&amp;quot;scsi_eh_bus_reset&amp;quot;) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	printf(&amp;quot;%s, scsi_eh_bus_reset\n&amp;quot;, ctime(gettimeofday_s()))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;probe module(&amp;quot;scsi_mod&amp;quot;).function(&amp;quot;scsi_eh_try_stu&amp;quot;).call {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	printf(&amp;quot;%s, scsi_eh_try_stu call, scmd: %p\n&amp;quot;, ctime(gettimeofday_s()), $scmd)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;probe module(&amp;quot;scsi_mod&amp;quot;).function(&amp;quot;scsi_eh_try_stu&amp;quot;).return {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	printf(&amp;quot;%s, scsi_eh_try_stu return, scmd: %p\n&amp;quot;, ctime(gettimeofday_s()), $scmd)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;probe module(&amp;quot;scsi_mod&amp;quot;).function(&amp;quot;scsi_eh_tur&amp;quot;).call {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	printf(&amp;quot;%s, scsi_eh_tur call, scmd: %p\n&amp;quot;, ctime(gettimeofday_s()), $scmd)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;probe module(&amp;quot;scsi_mod&amp;quot;).function(&amp;quot;scsi_eh_tur&amp;quot;).return {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	printf(&amp;quot;%s, scsi_eh_tur return=%d, scmd: %p\n&amp;quot;, ctime(gettimeofday_s()), $return, $scmd)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;probe module(&amp;quot;scsi_mod&amp;quot;).function(&amp;quot;scsi_eh_stu&amp;quot;) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	printf(&amp;quot;%s, scsi_eh_stu\n&amp;quot;, ctime(gettimeofday_s()))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&amp;#x6267;&amp;#x884C;&amp;#x811A;&amp;#x672C;&amp;#x7684;&amp;#x547D;&amp;#x4EE4;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;sudo stap -g --all-modules scsi.stp&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;#x7ECF;&amp;#x8FC7;&amp;#x524D;&amp;#x9762;&amp;#x7684;&amp;#x5206;&amp;#x6790;&amp;#x6D4B;&amp;#x8BD5;&amp;#xFF0C;&amp;#x4F7F;&amp;#x7528;fio&amp;#x76F4;&amp;#x63A5;&amp;#x6D4B;&amp;#x8BD5;&amp;#x88F8;&amp;#x76D8;&amp;#xFF08;direct=1&amp;#xFF09;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x5C06;&amp;#x540E;&amp;#x7AEF;&amp;#x8BBE;&amp;#x5907;suspend&amp;#x4F4F;&amp;#x540E;&amp;#xFF0C;fio&amp;#x7684;IO hang&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x8DDF;&amp;#x524D;&amp;#x9762;&amp;#x8BA1;&amp;#x7B97;&amp;#x7684;&amp;#x4E00;&amp;#x81F4;&amp;#xFF1B;&amp;#x4F46;&amp;#x662F;&amp;#x5F53;&amp;#x5728;&amp;#x865A;&amp;#x62DF;&amp;#x673A;&amp;#x91CC;&amp;#x5BF9;&amp;#x8FD9;&amp;#x5757;&amp;#x76D8;&amp;#x505A;&amp;#x4E86;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;fio&amp;#x6D4B;&amp;#x8BD5;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#xFF08;direct=1&amp;#xFF09;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x5C06;&amp;#x540E;&amp;#x7AEF;&amp;#x8BBE;&amp;#x5907;suspend&amp;#x4F4F;&amp;#x540E;&amp;#xFF0C;fio&amp;#x7684;IO hang&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x591A;&amp;#x4E86;20~30s&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;&amp;#x521D;&amp;#x6B65;&amp;#x5206;&amp;#x6790;&quot;&gt;&lt;a href=&quot;#&amp;#x521D;&amp;#x6B65;&amp;#x5206;&amp;#x6790;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x521D;&amp;#x6B65;&amp;#x5206;&amp;#x6790;&quot;&gt;&lt;/a&gt;&amp;#x521D;&amp;#x6B65;&amp;#x5206;&amp;#x6790;&lt;/h2&gt;&lt;p&gt;&amp;#x4E00;&amp;#x5F00;&amp;#x59CB;&amp;#x6000;&amp;#x7591;&amp;#x662F;&amp;#x7531;&amp;#x4E8E;&amp;#x865A;&amp;#x62DF;&amp;#x673A;&amp;#x8FD9;&amp;#x5C42;&amp;#x7684;&amp;#x4F5C;&amp;#x7528;&amp;#xFF0C;&amp;#x56E0;&amp;#x6B64;&amp;#x8FD8;&amp;#x8C03;&amp;#x6574;&amp;#x8FC7;KVM&amp;#x4F7F;&amp;#x7528;&amp;#x7684;&amp;#x76D8;&amp;#x7684;&amp;#x7F13;&amp;#x5B58;&amp;#x7B56;&amp;#x7565;&amp;#xFF08;none&amp;#x3001;writethrough&amp;#x3001;directsync&amp;#xFF09;&amp;#xFF0C;&amp;#x540C;&amp;#x6837;&amp;#x7684;&amp;#x6D4B;&amp;#x8BD5;&amp;#xFF0C;&amp;#x4ECD;&amp;#x7136;&amp;#x662F;IO hang&amp;#x6BD4;&amp;#x9884;&amp;#x671F;&amp;#x7684;&amp;#x591A;20~30s&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x6253;&amp;#x5F00;iscsi session debug&amp;#x5F00;&amp;#x5173;&amp;#xFF0C;&amp;#x5F00;&amp;#x542F;scsi error&amp;#x548C;timeout&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5206;&amp;#x6790;&amp;#x8FD9;&amp;#x6837;&amp;#x6D4B;&amp;#x8BD5;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&amp;#x4FE1;&amp;#x606F;&amp;#x3002;&amp;#x4E0B;&amp;#x9762;&amp;#x622A;&amp;#x53D6;&amp;#x90E8;&amp;#x5206;&amp;#x65E5;&amp;#x5FD7;&amp;#xFF0C;&amp;#x53D1;&amp;#x73B0;&amp;#x6709;3&amp;#x4E2A;&amp;#x65F6;&amp;#x95F4;&amp;#x70B9;&amp;#xFF1A;16:45:21&amp;#x3001;16:45:31&amp;#x3001;16:45:41&amp;#x6BD4;&amp;#x8F83;&amp;#x5947;&amp;#x602A;&amp;#xFF0C;&amp;#x6CA1;&amp;#x6709;&amp;#x8FDE;&amp;#x7EED;&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&amp;#xFF0C;&amp;#x90FD;&amp;#x6709;10s&amp;#x7684;&amp;#x7A7A;&amp;#x767D;&amp;#x671F;&amp;#x3002;&amp;#x800C;&amp;#x4E14;&amp;#x4ECE;16:45:41&amp;#x5230;16:45:51&amp;#x540E;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x201D;Device offlined - not ready after error recovery&amp;#x201D;&amp;#xFF0C;&amp;#x800C;&amp;#x4E4B;&amp;#x524D;&amp;#x4ECE;&amp;#x88F8;&amp;#x76D8;&amp;#x4E0A;&amp;#x6D4B;&amp;#x8BD5;&amp;#x65F6;&amp;#x662F;&amp;#x6CA1;&amp;#x6709;&amp;#x8FD9;&amp;#x51E0;&amp;#x6B21;10s&amp;#x7684;&amp;#x7A7A;&amp;#x767D;&amp;#x671F;&amp;#xFF0C;&amp;#x800C;&amp;#x4E14;&amp;#x662F;I/O error&amp;#xFF0C;&amp;#x800C;&amp;#x4E0D;&amp;#x662F;device offlined&amp;#x540E;&amp;#x518D;I/O error&amp;#x3002;&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="storage" scheme="http://yoursite.com/categories/storage/"/>
    
    
      <category term="kernel" scheme="http://yoursite.com/tags/kernel/"/>
    
      <category term="scsi" scheme="http://yoursite.com/tags/scsi/"/>
    
  </entry>
  
  <entry>
    <title>坏盘导致IO hang问题分析</title>
    <link href="http://yoursite.com/2017/03/15/error-disk-cause-iohang/"/>
    <id>http://yoursite.com/2017/03/15/error-disk-cause-iohang/</id>
    <published>2017-03-15T08:09:40.000Z</published>
    <updated>2017-03-15T08:25:44.018Z</updated>
    
    <content type="html">&lt;p&gt;&amp;#x8FD1;&amp;#x671F;&amp;#x7EBF;&amp;#x4E0A;&amp;#x7CFB;&amp;#x7EDF;&amp;#x51FA;&amp;#x73B0;&amp;#x574F;&amp;#x76D8;&amp;#x5BFC;&amp;#x81F4;IO&amp;#x5361;&amp;#x4F4F;&amp;#x7684;&amp;#x95EE;&amp;#x9898;&amp;#xFF0C;&amp;#x6709;&amp;#x4E24;&amp;#x79CD;&amp;#x60C5;&amp;#x51B5;&amp;#xFF1A;&lt;/p&gt;
&lt;p&gt;1&amp;#xFF09;&amp;#x4E00;&amp;#x79CD;&amp;#x662F;&amp;#x51FA;&amp;#x73B0;&amp;#x574F;&amp;#x76D8;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;raid&amp;#x5361;&amp;#x7684;&amp;#x884C;&amp;#x4E3A;&amp;#x6709;&amp;#x6240;&amp;#x5F02;&amp;#x5E38;&amp;#xFF0C;&amp;#x5728;&amp;#x8FD9;&amp;#x53F0;&amp;#x673A;&amp;#x5668;&amp;#x4E0A;&amp;#x7684;&amp;#x6267;&amp;#x884C;raid&amp;#x5361;&amp;#x7684;&amp;#x547D;&amp;#x4EE4;megacli&amp;#x90FD;&amp;#x5361;&amp;#x4F4F;&amp;#xFF0C;&amp;#x89C2;&amp;#x5BDF;&amp;#x5230;&amp;#x8FD9;&amp;#x53F0;&amp;#x673A;&amp;#x5668;&amp;#x4E0A;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x76D8;&amp;#x7684;io&amp;#x90FD;&amp;#x65F6;&amp;#x4E0D;&amp;#x65F6;&amp;#x5F02;&amp;#x5E38;&amp;#x7E41;&amp;#x5FD9;&amp;#xFF08;io&amp;#x4E0D;&amp;#x5927;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;svctm&amp;#x751A;&amp;#x81F3;&amp;#x8FBE;&amp;#x5230;&amp;#x51E0;&amp;#x5343;ms&amp;#xFF09;&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;&amp;#x5BFC;&amp;#x81F4;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;&amp;#x5757;&amp;#x5B58;&amp;#x50A8;&amp;#x7684;&amp;#x5377;IO hang&amp;#x4F4F;&amp;#xFF0C;&amp;#x8868;&amp;#x73B0;&amp;#x5C31;&amp;#x662F;&amp;#x7528;&amp;#x6237;&amp;#x7684;&amp;#x5377;io util 100%&amp;#x8F83;&amp;#x957F;&amp;#x65F6;&amp;#x95F4;&amp;#xFF1B;&lt;/p&gt;
&lt;p&gt;2&amp;#xFF09;&amp;#x53E6;&amp;#x5916;&amp;#x4E00;&amp;#x79CD;&amp;#x60C5;&amp;#x51B5;&amp;#x662F;&amp;#x574F;&amp;#x76D8;&amp;#x540E;&amp;#xFF0C;&amp;#x5C06;&amp;#x574F;&amp;#x76D8;&amp;#x4ECE;raid&amp;#x5361;&amp;#x4E2D;&amp;#x5254;&amp;#x9664;&amp;#xFF08;&amp;#x505A;&amp;#x7684;&amp;#x5355;&amp;#x76D8;raid0&amp;#xFF0C;&amp;#x9ED8;&amp;#x8BA4;WB&amp;#x7F13;&amp;#x5B58;&amp;#x7B56;&amp;#x7565;&amp;#xFF0C;&amp;#x76D8;&amp;#x574F;&amp;#x540E;&amp;#x9700;&amp;#x8981;&amp;#x4ECE;raid&amp;#x5361;&amp;#x91CC;&amp;#x5220;&amp;#x9664;&amp;#x903B;&amp;#x8F91;&amp;#x5377;&amp;#xFF09;&amp;#xFF0C;&amp;#x8FD9;&amp;#x53F0;&amp;#x673A;&amp;#x5668;&amp;#x4E0A;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x76D8;&amp;#x90FD;io&amp;#x5361;&amp;#x4F4F;&amp;#x4E00;&amp;#x4F1A;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;megacli&amp;#x547D;&amp;#x4EE4;&amp;#x4E5F;&amp;#x5361;&amp;#x4F4F;&amp;#x3002;&amp;#x4ECE;&amp;#x800C;&amp;#x4E5F;&amp;#x5BFC;&amp;#x81F4;&amp;#x90E8;&amp;#x5206;&amp;#x7528;&amp;#x6237;&amp;#x7684;&amp;#x5377;io util 100%&amp;#x8F83;&amp;#x957F;&amp;#x65F6;&amp;#x95F4;&amp;#xFF1B;&lt;/p&gt;
&lt;p&gt;&amp;#x60C5;&amp;#x51B5;1&amp;#xFF09;&amp;#x901A;&amp;#x8FC7;&amp;#x6536;&amp;#x96C6;&amp;#x65E5;&amp;#x5FD7;&amp;#x53CD;&amp;#x9988;&amp;#x7ED9;&amp;#x5382;&amp;#x5BB6;&amp;#x786E;&amp;#x8BA4;&amp;#x662F;&amp;#x7531;&amp;#x4E8E;&amp;#x7EBF;&amp;#x4E0A;&amp;#x673A;&amp;#x5668;&amp;#x7684;raid&amp;#x5361;&amp;#x7684;&amp;#x56FA;&amp;#x4EF6;&amp;#x7248;&amp;#x672C;&amp;#x6BD4;&amp;#x8F83;&amp;#x4F4E;&amp;#xFF0C;&amp;#x9700;&amp;#x8981;&amp;#x5347;&amp;#x7EA7;raid&amp;#x5361;&amp;#x56FA;&amp;#x4EF6;&amp;#xFF1B;&lt;br&gt;&amp;#x60C5;&amp;#x51B5;2&amp;#xFF09;&amp;#x56E0;&amp;#x4E3A;&amp;#x574F;&amp;#x76D8;&amp;#x540E;&amp;#xFF0C;raid&amp;#x5361;&amp;#x5C31;&amp;#x8FDB;&amp;#x5165;&amp;#x4FDD;&amp;#x62A4;&amp;#x6A21;&amp;#x5F0F;&amp;#xFF0C;&amp;#x7269;&amp;#x7406;&amp;#x76D8;&amp;#x7684;&amp;#x7F13;&amp;#x5B58;&amp;#x7B56;&amp;#x7565;&amp;#x90FD;&amp;#x4ECE;writeback&amp;#x53D8;&amp;#x6210;writethrough&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5254;&amp;#x9664;&amp;#x574F;&amp;#x76D8;&amp;#x65F6;&amp;#xFF0C;&amp;#x5C31;&amp;#x4F1A;&amp;#x5C06;raid&amp;#x5361;&amp;#x7F13;&amp;#x5B58;&amp;#x91CC;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x8FDB;&amp;#x884C;&amp;#x56DE;&amp;#x5237;&amp;#x5230;&amp;#x78C1;&amp;#x76D8;&amp;#x4E0A;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#x662F;&amp;#x4F1A;&amp;#x6709;&amp;#x77ED;&amp;#x65F6;&amp;#x95F4;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x76D8;io&amp;#x5361;&amp;#x4F4F;&amp;#xFF1B;&lt;/p&gt;
&lt;p&gt;&amp;#x4E0A;&amp;#x9762;&amp;#x4E24;&amp;#x79CD;&amp;#x60C5;&amp;#x51B5;&amp;#xFF0C;&amp;#x7269;&amp;#x7406;&amp;#x76D8;&amp;#x7684;io&amp;#x5361;&amp;#x4F4F;&amp;#x90FD;&amp;#x5728;1&amp;#x5206;&amp;#x949F;&amp;#x5185;&amp;#xFF0C;&amp;#x53EF;&amp;#x662F;&amp;#x4ECE;&amp;#x7528;&amp;#x6237;&amp;#x53CD;&amp;#x9988;&amp;#x6765;&amp;#x770B;&amp;#x7528;&amp;#x6237;&amp;#x5377;&amp;#x7684;io&amp;#x5361;&amp;#x4E86;&amp;#x597D;&amp;#x51E0;&amp;#x5206;&amp;#x949F;&amp;#xFF0C;&amp;#x6BD4;&amp;#x7269;&amp;#x7406;&amp;#x76D8;&amp;#x5361;&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x957F;&amp;#x4E0D;&amp;#x5C11;&amp;#x3002;&amp;#x53E6;&amp;#x5916;&amp;#xFF0C;&amp;#x6211;&amp;#x4EEC;&amp;#x8FD9;&amp;#x4E2A;&amp;#x7EBF;&amp;#x4E0A;&amp;#x73AF;&amp;#x5883;&amp;#x7684;&amp;#x5757;&amp;#x5B58;&amp;#x50A8;&amp;#x91C7;&amp;#x7528;&amp;#x7684;2&amp;#x526F;&amp;#x672C;&amp;#xFF0C;&amp;#x6709;&amp;#x4E9B;&amp;#x5377;&amp;#x7684;&amp;#x5176;&amp;#x4E2D;&amp;#x4E00;&amp;#x4E2A;&amp;#x526F;&amp;#x672C;&amp;#x843D;&amp;#x5728;&amp;#x574F;&amp;#x76D8;&amp;#x7684;&amp;#x673A;&amp;#x5668;&amp;#x4E0A;&amp;#xFF0C;&amp;#x5361;&amp;#x4E86;&amp;#x8FD9;&amp;#x4E48;&amp;#x4E45;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x6CA1;&amp;#x6709;&amp;#x526F;&amp;#x672C;&amp;#x964D;&amp;#x7EA7;&amp;#x3002;&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x7B80;&amp;#x5355;&amp;#x8BF4;&amp;#x4E00;&amp;#x4E0B;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;&amp;#x5757;&amp;#x5B58;&amp;#x50A8;&amp;#x7684;&amp;#x4F7F;&amp;#x7528;&amp;#x65B9;&amp;#x5F0F;&amp;#xFF1A;&amp;#x5B58;&amp;#x50A8;&amp;#x673A;&amp;#x4E0A;&amp;#x91C7;&amp;#x7528;device mapper&amp;#x673A;&amp;#x5236;&amp;#x5C06;&amp;#x7269;&amp;#x7406;&amp;#x76D8;&amp;#x8FDB;&amp;#x884C;&amp;#x5207;&amp;#x7247;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x5B58;&amp;#x50A8;&amp;#x5207;&amp;#x7247;&amp;#x901A;&amp;#x8FC7;iscsi&amp;#x5C06;&amp;#x903B;&amp;#x8F91;&amp;#x8BBE;&amp;#x5907;&amp;#x8F93;&amp;#x51FA;&amp;#x5230;&amp;#x5BBF;&amp;#x4E3B;&amp;#x673A;&amp;#x4E0A;&amp;#xFF08;&amp;#x865A;&amp;#x62DF;&amp;#x673A;&amp;#x6240;&amp;#x5728;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x673A;&amp;#xFF09;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5728;&amp;#x5BBF;&amp;#x4E3B;&amp;#x673A;&amp;#x4E0A;&amp;#x4F7F;&amp;#x7528;&amp;#x8F6F;raid&amp;#x5C06;2&amp;#x4E2A;&amp;#x526F;&amp;#x672C;&amp;#x5206;&amp;#x7247;&amp;#x505A;&amp;#x6210;raid1&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x518D;&amp;#x5C06;1&amp;#x4E2A;&amp;#x6216;&amp;#x591A;&amp;#x4E2A;raid1&amp;#x4F7F;&amp;#x7528;device mapper&amp;#x62FC;&amp;#x6210;1&amp;#x4E2A;&amp;#x903B;&amp;#x8F91;&amp;#x8BBE;&amp;#x5907;&amp;#xFF0C;&amp;#x518D;&amp;#x63D0;&amp;#x4F9B;&amp;#x5230;&amp;#x865A;&amp;#x62DF;&amp;#x673A;&amp;#x8FDB;&amp;#x884C;&amp;#x4F7F;&amp;#x7528;&amp;#x3002;&amp;#x8FD9;&amp;#x6837;&amp;#x5BBF;&amp;#x4E3B;&amp;#x673A;&amp;#x5C31;&amp;#x662F;iscsi&amp;#x7684;initiator&amp;#x7AEF;&amp;#xFF0C;&amp;#x5B58;&amp;#x50A8;&amp;#x673A;&amp;#x5C31;&amp;#x662F;iscsi&amp;#x7684;target&amp;#x7AEF;&amp;#x3002;&amp;#x5176;&amp;#x4E2D;iscsi&amp;#x7684;&amp;#x6062;&amp;#x590D;&amp;#x8D85;&amp;#x65F6;&amp;#x65F6;&amp;#x95F4;replacement_timeout&amp;#x8BBE;&amp;#x7F6E;&amp;#x4E3A;10s&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x6709;&amp;#x4E86;&amp;#x4E0A;&amp;#x9762;&amp;#x7684;&amp;#x80CC;&amp;#x666F;&amp;#x518D;&amp;#x6765;&amp;#x5206;&amp;#x6790;io hang&amp;#x7684;&amp;#x95EE;&amp;#x9898;&amp;#xFF1A;&lt;br&gt;&amp;#x901A;&amp;#x5E38;&amp;#x5982;&amp;#x679C;&amp;#x662F;&amp;#x5BBF;&amp;#x4E3B;&amp;#x673A;&amp;#x548C;&amp;#x5B58;&amp;#x50A8;&amp;#x673A;&amp;#x7684;&amp;#x7F51;&amp;#x7EDC;&amp;#x5F02;&amp;#x5E38;&amp;#xFF0C;iscsi&amp;#x8FDE;&amp;#x63A5;&amp;#x5C31;&amp;#x4F1A;&amp;#x5F02;&amp;#x5E38;&amp;#x8FDB;&amp;#x5165;iscsi&amp;#x6062;&amp;#x590D;&amp;#x9636;&amp;#x6BB5;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x8D85;&amp;#x8FC7;replacement_timeout&amp;#x7684;&amp;#x8BDD;&amp;#x90A3;&amp;#x8FD9;&amp;#x4E2A;&amp;#x526F;&amp;#x672C;&amp;#x76F4;&amp;#x63A5;io&amp;#x62A5;&amp;#x9519;&amp;#x7ED9;&amp;#x8F6F;raid&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x8F6F;raid&amp;#x5C06;&amp;#x8BE5;&amp;#x526F;&amp;#x672C;&amp;#x8BBE;&amp;#x5907;&amp;#x6807;&amp;#x8BB0;&amp;#x4E3A;&amp;#x964D;&amp;#x7EA7;&amp;#xFF0C;&amp;#x964D;&amp;#x7EA7;&amp;#x72B6;&amp;#x6001;&amp;#x4E0B;&amp;#x7684;raid&amp;#x8BFB;&amp;#x5199;&amp;#x90FD;&amp;#x53EA;&amp;#x4F1A;&amp;#x53D1;&amp;#x5230;&amp;#x53E6;&amp;#x5916;&amp;#x4E00;&amp;#x4E2A;&amp;#x597D;&amp;#x7684;&amp;#x6210;&amp;#x5458;&amp;#x8BBE;&amp;#x5907;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x4E0A;&amp;#x9762;&amp;#x4E24;&amp;#x79CD;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;&amp;#x5BFC;&amp;#x81F4;&amp;#x5377;&amp;#x7684;IO hang&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x90FD;&amp;#x6BD4;&amp;#x8F83;&amp;#x957F;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x8BF4;&amp;#x90A3;&amp;#x6BB5;&amp;#x65F6;&amp;#x95F4;&amp;#x5185;&amp;#x4E00;&amp;#x76F4;&amp;#x6CA1;&amp;#x6709;io&amp;#x62A5;&amp;#x9519;&amp;#x7ED9;&amp;#x8F6F;raid&amp;#x6765;&amp;#x89E6;&amp;#x53D1;raid&amp;#x964D;&amp;#x7EA7;&amp;#x3002;&amp;#x90A3;&amp;#x4E48;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x4F1A;&amp;#x5361;&amp;#x8FD9;&amp;#x4E48;&amp;#x957F;&amp;#x65F6;&amp;#x95F4;&amp;#x800C;&amp;#x4E0D;IO&amp;#x62A5;&amp;#x9519;&amp;#x5462;&amp;#xFF1F;&lt;/p&gt;
&lt;h2 id=&quot;&amp;#x6A21;&amp;#x62DF;&amp;#x590D;&amp;#x73B0;&amp;#x574F;&amp;#x76D8;&amp;#x5BFC;&amp;#x81F4;&amp;#x7684;io-hang&quot;&gt;&lt;a href=&quot;#&amp;#x6A21;&amp;#x62DF;&amp;#x590D;&amp;#x73B0;&amp;#x574F;&amp;#x76D8;&amp;#x5BFC;&amp;#x81F4;&amp;#x7684;io-hang&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x6A21;&amp;#x62DF;&amp;#x590D;&amp;#x73B0;&amp;#x574F;&amp;#x76D8;&amp;#x5BFC;&amp;#x81F4;&amp;#x7684;io hang&quot;&gt;&lt;/a&gt;&amp;#x6A21;&amp;#x62DF;&amp;#x590D;&amp;#x73B0;&amp;#x574F;&amp;#x76D8;&amp;#x5BFC;&amp;#x81F4;&amp;#x7684;io hang&lt;/h2&gt;&lt;p&gt;&amp;#x7531;&amp;#x4E8E;&amp;#x7EBF;&amp;#x4E0A;&amp;#x7CFB;&amp;#x7EDF;&amp;#x4E0D;&amp;#x4FBF;&amp;#x4E8E;&amp;#x8C03;&amp;#x8BD5;&amp;#x5206;&amp;#x6790;&amp;#xFF0C;&amp;#x8981;&amp;#x60F3;&amp;#x5728;&amp;#x6D4B;&amp;#x8BD5;&amp;#x73AF;&amp;#x5883;&amp;#x7A33;&amp;#x5B9A;&amp;#x590D;&amp;#x73B0;&amp;#x574F;&amp;#x76D8;&amp;#x4E5F;&amp;#x6BD4;&amp;#x8F83;&amp;#x96BE;&amp;#xFF0C;&amp;#x627E;&amp;#x8FC7;&amp;#x786C;&amp;#x76D8;&amp;#x5382;&amp;#x5BB6;&amp;#x5BFB;&amp;#x6C42;&amp;#x76F8;&amp;#x5173;&amp;#x786C;&amp;#x76D8;&amp;#x9519;&amp;#x8BEF;&amp;#x6CE8;&amp;#x5165;&amp;#x7684;&amp;#x5DE5;&amp;#x5177;&amp;#xFF0C;&amp;#x4E0D;&amp;#x8FC7;&amp;#x6700;&amp;#x540E;&amp;#x5382;&amp;#x5BB6;&amp;#x7ED9;&amp;#x7684;&amp;#x4E5F;&amp;#x662F;&amp;#x6CE8;&amp;#x5165;io&amp;#x9519;&amp;#x8BEF;&amp;#x7684;&amp;#x529E;&amp;#x6CD5;&amp;#xFF0C;&amp;#x800C;&amp;#x4E0D;&amp;#x662F;&amp;#x8BA9;&amp;#x786C;&amp;#x76D8;io&amp;#x5361;&amp;#x4F4F;&amp;#x7684;&amp;#x65B9;&amp;#x6CD5;&amp;#x3002;&amp;#x56E0;&amp;#x6B64;&amp;#xFF0C;&amp;#x4E3A;&amp;#x4E86;&amp;#x7A33;&amp;#x5B9A;&amp;#x590D;&amp;#x73B0;&amp;#x8FD9;&amp;#x79CD;&amp;#x60C5;&amp;#x51B5;&amp;#xFF0C;&amp;#x91C7;&amp;#x7528;device mapper&amp;#x8BBE;&amp;#x5907;&amp;#xFF0C;dm&amp;#x8BBE;&amp;#x5907;&amp;#x63D0;&amp;#x4F9B;suspend&amp;#x64CD;&amp;#x4F5C;&amp;#x6765;hang&amp;#x4F4F;io&amp;#xFF0C;&amp;#x4EE5;&amp;#x6B64;&amp;#x4E3A;&amp;#x57FA;&amp;#x7840;&amp;#xFF0C;&amp;#x501F;&amp;#x52A9;iscsi&amp;#x548C;&amp;#x8F6F;raid&amp;#x6765;&amp;#x6A21;&amp;#x62DF;&amp;#x5757;&amp;#x5B58;&amp;#x50A8;&amp;#x7684;&amp;#x4F7F;&amp;#x7528;&amp;#x65B9;&amp;#x5F0F;&amp;#x3002;&lt;/p&gt;
&lt;h3 id=&quot;1-&amp;#x5728;&amp;#x4E24;&amp;#x53F0;&amp;#x5B58;&amp;#x50A8;&amp;#x673A;&amp;#x5668;&amp;#x5206;&amp;#x522B;&amp;#x521B;&amp;#x5EFA;&amp;#x51FA;&amp;#x4E24;&amp;#x4E2A;device-mapper&amp;#x8BBE;&amp;#x5907;&quot;&gt;&lt;a href=&quot;#1-&amp;#x5728;&amp;#x4E24;&amp;#x53F0;&amp;#x5B58;&amp;#x50A8;&amp;#x673A;&amp;#x5668;&amp;#x5206;&amp;#x522B;&amp;#x521B;&amp;#x5EFA;&amp;#x51FA;&amp;#x4E24;&amp;#x4E2A;device-mapper&amp;#x8BBE;&amp;#x5907;&quot; class=&quot;headerlink&quot; title=&quot;1.&amp;#x5728;&amp;#x4E24;&amp;#x53F0;&amp;#x5B58;&amp;#x50A8;&amp;#x673A;&amp;#x5668;&amp;#x5206;&amp;#x522B;&amp;#x521B;&amp;#x5EFA;&amp;#x51FA;&amp;#x4E24;&amp;#x4E2A;device mapper&amp;#x8BBE;&amp;#x5907;&quot;&gt;&lt;/a&gt;1.&amp;#x5728;&amp;#x4E24;&amp;#x53F0;&amp;#x5B58;&amp;#x50A8;&amp;#x673A;&amp;#x5668;&amp;#x5206;&amp;#x522B;&amp;#x521B;&amp;#x5EFA;&amp;#x51FA;&amp;#x4E24;&amp;#x4E2A;device mapper&amp;#x8BBE;&amp;#x5907;&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;nbs@10-165-160-13:~$ sudo dmsetup create test_chunk_0 &amp;lt;&amp;lt; EOF&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt; 0 20972800 linear /dev/sdf 1006696448&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt; EOF&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nbs@10-165-160-14:~$ sudo dmsetup create test_chunk_1 &amp;lt;&amp;lt; EOF&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt; 0 20972800 linear /dev/sdf 1006696448&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt; EOF&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;2-&amp;#x7136;&amp;#x540E;&amp;#x5206;&amp;#x522B;&amp;#x4F7F;&amp;#x7528;iet&amp;#x5BFC;&amp;#x51FA;chunk&amp;#x8BBE;&amp;#x5907;&quot;&gt;&lt;a href=&quot;#2-&amp;#x7136;&amp;#x540E;&amp;#x5206;&amp;#x522B;&amp;#x4F7F;&amp;#x7528;iet&amp;#x5BFC;&amp;#x51FA;chunk&amp;#x8BBE;&amp;#x5907;&quot; class=&quot;headerlink&quot; title=&quot;2.&amp;#x7136;&amp;#x540E;&amp;#x5206;&amp;#x522B;&amp;#x4F7F;&amp;#x7528;iet&amp;#x5BFC;&amp;#x51FA;chunk&amp;#x8BBE;&amp;#x5907;&quot;&gt;&lt;/a&gt;2.&amp;#x7136;&amp;#x540E;&amp;#x5206;&amp;#x522B;&amp;#x4F7F;&amp;#x7528;iet&amp;#x5BFC;&amp;#x51FA;chunk&amp;#x8BBE;&amp;#x5907;&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;nbs@10-165-160-13:~$ sudo ietadm --op new --tid=1000 --params Name=iqn.test.1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nbs@10-165-160-13:~$ sudo ietadm --op new --tid=1000 --lun=0 --params Path=/dev/mapper/test_chunk_0,Type=blockio&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nbs@10-165-160-13:~$ cat /proc/net/iet/volume&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tid:1000 name:iqn.test.1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	lun:0 state:0 iotype:blockio iomode:wt blocks:20972800 blocksize:512 path:/dev/mapper/test_chunk_0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nbs@10-165-160-14:~$ sudo ietadm --op new --tid=1000 --params Name=iqn.test.2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nbs@10-165-160-14:~$ sudo ietadm --op new --tid=1000 --lun=0 --params Path=/dev/mapper/test_chunk_1,Type=blockio&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nbs@10-165-160-14:~$ cat /proc/net/iet/volume &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tid:1000 name:iqn.test.2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	lun:0 state:0 iotype:blockio iomode:wt blocks:20972800 blocksize:512 path:/dev/mapper/test_chunk_1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;3-&amp;#x5728;&amp;#x5BBF;&amp;#x4E3B;&amp;#x673A;&amp;#x7AEF;&amp;#x4F7F;&amp;#x7528;open-iscsi&amp;#x8FDE;&amp;#x63A5;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;target&quot;&gt;&lt;a href=&quot;#3-&amp;#x5728;&amp;#x5BBF;&amp;#x4E3B;&amp;#x673A;&amp;#x7AEF;&amp;#x4F7F;&amp;#x7528;open-iscsi&amp;#x8FDE;&amp;#x63A5;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;target&quot; class=&quot;headerlink&quot; title=&quot;3.&amp;#x5728;&amp;#x5BBF;&amp;#x4E3B;&amp;#x673A;&amp;#x7AEF;&amp;#x4F7F;&amp;#x7528;open-iscsi&amp;#x8FDE;&amp;#x63A5;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;target&quot;&gt;&lt;/a&gt;3.&amp;#x5728;&amp;#x5BBF;&amp;#x4E3B;&amp;#x673A;&amp;#x7AEF;&amp;#x4F7F;&amp;#x7528;open-iscsi&amp;#x8FDE;&amp;#x63A5;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;target&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;nbs@10-165-160-15:~$ sudo iscsiadm -m discovery -t st -p 10.165.160.13:3260&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10.165.160.13:3260,1 iqn.test.1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10.165.164.13:3260,1 iqn.test.1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10.165.168.13:3260,1 iqn.test.1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10.165.172.13:3260,1 iqn.test.1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nbs@10-165-160-15:~$ sudo iscsiadm -m node -T iqn.test.1 --op=update --name=node.session.timeo.replacement_timeout --value=10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nbs@10-165-160-15:~$ sudo iscsiadm -m node -T iqn.test.1 -p 10.165.160.13:3260 -l&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Logging in to [iface: default, target: iqn.test.1, portal: 10.165.160.13,3260] (multiple)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Login to [iface: default, target: iqn.test.1, portal: 10.165.160.13,3260] successful.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nbs@10-165-160-15:~$ sudo iscsiadm -m discovery -t st -p 10.165.160.14:3260&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10.165.160.14:3260,1 iqn.test.2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10.165.164.14:3260,1 iqn.test.2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10.165.168.14:3260,1 iqn.test.2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10.165.172.14:3260,1 iqn.test.2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nbs@10-165-160-15:~$ sudo iscsiadm -m node -T iqn.test.2 --op=update --name=node.session.timeo.replacement_timeout --value=10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nbs@10-165-160-15:~$ sudo iscsiadm -m node -T iqn.test.2 -p 10.165.160.14:3260 -l&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Logging in to [iface: default, target: iqn.test.2, portal: 10.165.160.14,3260] (multiple)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Login to [iface: default, target: iqn.test.2, portal: 10.165.160.14,3260] successful.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nbs@10-165-160-15:~$ sudo iscsiadm -m session -P3|grep -A1 Lun&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		scsi1 Channel 00 Id 0 Lun: 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			Attached scsi disk sdq		State: running&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;--&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		scsi2 Channel 00 Id 0 Lun: 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			Attached scsi disk sdr		State: running&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;4-&amp;#x5728;&amp;#x5BBF;&amp;#x4E3B;&amp;#x673A;&amp;#x7AEF;&amp;#x4F7F;&amp;#x7528;mdadm&amp;#x521B;&amp;#x5EFA;&amp;#x8F6F;raid&amp;#x8BBE;&amp;#x5907;&quot;&gt;&lt;a href=&quot;#4-&amp;#x5728;&amp;#x5BBF;&amp;#x4E3B;&amp;#x673A;&amp;#x7AEF;&amp;#x4F7F;&amp;#x7528;mdadm&amp;#x521B;&amp;#x5EFA;&amp;#x8F6F;raid&amp;#x8BBE;&amp;#x5907;&quot; class=&quot;headerlink&quot; title=&quot;4.&amp;#x5728;&amp;#x5BBF;&amp;#x4E3B;&amp;#x673A;&amp;#x7AEF;&amp;#x4F7F;&amp;#x7528;mdadm&amp;#x521B;&amp;#x5EFA;&amp;#x8F6F;raid&amp;#x8BBE;&amp;#x5907;&quot;&gt;&lt;/a&gt;4.&amp;#x5728;&amp;#x5BBF;&amp;#x4E3B;&amp;#x673A;&amp;#x7AEF;&amp;#x4F7F;&amp;#x7528;mdadm&amp;#x521B;&amp;#x5EFA;&amp;#x8F6F;raid&amp;#x8BBE;&amp;#x5907;&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;nbs@10-165-160-15:~$ sudo mdadm --create /dev/md/mdtest1 --run --force --metadata=0.9 --assume-clean --bitmap=/home/nbs/wd/mdtest1-bitmap --level=1 --raid-devices=2 /dev/sdq /dev/sdr&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;mdadm: array /dev/md/mdtest1 started.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nbs@10-165-160-15:~$ cat /proc/mdstat &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Personalities : [raid1] &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;md127 : active (auto-read-only) raid1 sdr[1] sdq[0]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      10486336 blocks [2/2] [UU]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      bitmap: 321/321 pages [1284KB], 16KB chunk, file: /home/nbs/wd/mdtest1-bitmap&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;unused devices: &amp;lt;none&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nbs@10-165-160-15:~$ sudo mdadm --readwrite /dev/md127&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nbs@10-165-160-15:~$ cat /proc/mdstat &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Personalities : [raid1] &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;md127 : active raid1 sdr[1] sdq[0]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      10486336 blocks [2/2] [UU]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      bitmap: 0/321 pages [0KB], 16KB chunk, file: /home/nbs/wd/mdtest1-bitmap&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;unused devices: &amp;lt;none&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;5-&amp;#x4F7F;&amp;#x7528;devicemapper&amp;#x518D;&amp;#x5C06;&amp;#x8F6F;raid&amp;#x8BBE;&amp;#x5907;&amp;#x6620;&amp;#x5C04;&amp;#x4E00;&amp;#x6B21;&amp;#xFF0C;&amp;#x505A;&amp;#x6210;&amp;#x8DDF;&amp;#x4E91;&amp;#x786C;&amp;#x76D8;&amp;#x7684;&amp;#x4F7F;&amp;#x7528;&amp;#x65B9;&amp;#x5F0F;&amp;#x4E00;&amp;#x6837;&quot;&gt;&lt;a href=&quot;#5-&amp;#x4F7F;&amp;#x7528;devicemapper&amp;#x518D;&amp;#x5C06;&amp;#x8F6F;raid&amp;#x8BBE;&amp;#x5907;&amp;#x6620;&amp;#x5C04;&amp;#x4E00;&amp;#x6B21;&amp;#xFF0C;&amp;#x505A;&amp;#x6210;&amp;#x8DDF;&amp;#x4E91;&amp;#x786C;&amp;#x76D8;&amp;#x7684;&amp;#x4F7F;&amp;#x7528;&amp;#x65B9;&amp;#x5F0F;&amp;#x4E00;&amp;#x6837;&quot; class=&quot;headerlink&quot; title=&quot;5.&amp;#x4F7F;&amp;#x7528;devicemapper&amp;#x518D;&amp;#x5C06;&amp;#x8F6F;raid&amp;#x8BBE;&amp;#x5907;&amp;#x6620;&amp;#x5C04;&amp;#x4E00;&amp;#x6B21;&amp;#xFF0C;&amp;#x505A;&amp;#x6210;&amp;#x8DDF;&amp;#x4E91;&amp;#x786C;&amp;#x76D8;&amp;#x7684;&amp;#x4F7F;&amp;#x7528;&amp;#x65B9;&amp;#x5F0F;&amp;#x4E00;&amp;#x6837;&quot;&gt;&lt;/a&gt;5.&amp;#x4F7F;&amp;#x7528;devicemapper&amp;#x518D;&amp;#x5C06;&amp;#x8F6F;raid&amp;#x8BBE;&amp;#x5907;&amp;#x6620;&amp;#x5C04;&amp;#x4E00;&amp;#x6B21;&amp;#xFF0C;&amp;#x505A;&amp;#x6210;&amp;#x8DDF;&amp;#x4E91;&amp;#x786C;&amp;#x76D8;&amp;#x7684;&amp;#x4F7F;&amp;#x7528;&amp;#x65B9;&amp;#x5F0F;&amp;#x4E00;&amp;#x6837;&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;nbs@10-165-160-15:~$ sudo dmsetup create nbs_test1 &amp;lt;&amp;lt; EOF&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt; 0 20971520 linear /dev/md127 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt; EOF&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nbs@10-165-160-15:~$ sudo dmsetup table nbs_test1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0 20971520 linear 9:127 0&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;6-&amp;#x4F7F;&amp;#x7528;fio&amp;#x6765;&amp;#x6D4B;&amp;#x8BD5;&amp;#x8FD9;&amp;#x5757;&amp;#x903B;&amp;#x8F91;&amp;#x5377;&amp;#xFF0C;&amp;#x4E3A;&amp;#x4E86;&amp;#x4E0D;&amp;#x4EA7;&amp;#x751F;&amp;#x8FC7;&amp;#x591A;&amp;#x7684;io&amp;#x5F71;&amp;#x54CD;&amp;#x5206;&amp;#x6790;&amp;#xFF0C;&amp;#x91C7;&amp;#x7528;fio&amp;#x7684;rate-iops&amp;#x6765;&amp;#x9650;&amp;#x5236;io&amp;#x6570;&quot;&gt;&lt;a href=&quot;#6-&amp;#x4F7F;&amp;#x7528;fio&amp;#x6765;&amp;#x6D4B;&amp;#x8BD5;&amp;#x8FD9;&amp;#x5757;&amp;#x903B;&amp;#x8F91;&amp;#x5377;&amp;#xFF0C;&amp;#x4E3A;&amp;#x4E86;&amp;#x4E0D;&amp;#x4EA7;&amp;#x751F;&amp;#x8FC7;&amp;#x591A;&amp;#x7684;io&amp;#x5F71;&amp;#x54CD;&amp;#x5206;&amp;#x6790;&amp;#xFF0C;&amp;#x91C7;&amp;#x7528;fio&amp;#x7684;rate-iops&amp;#x6765;&amp;#x9650;&amp;#x5236;io&amp;#x6570;&quot; class=&quot;headerlink&quot; title=&quot;6.&amp;#x4F7F;&amp;#x7528;fio&amp;#x6765;&amp;#x6D4B;&amp;#x8BD5;&amp;#x8FD9;&amp;#x5757;&amp;#x903B;&amp;#x8F91;&amp;#x5377;&amp;#xFF0C;&amp;#x4E3A;&amp;#x4E86;&amp;#x4E0D;&amp;#x4EA7;&amp;#x751F;&amp;#x8FC7;&amp;#x591A;&amp;#x7684;io&amp;#x5F71;&amp;#x54CD;&amp;#x5206;&amp;#x6790;&amp;#xFF0C;&amp;#x91C7;&amp;#x7528;fio&amp;#x7684;rate_iops&amp;#x6765;&amp;#x9650;&amp;#x5236;io&amp;#x6570;&quot;&gt;&lt;/a&gt;6.&amp;#x4F7F;&amp;#x7528;fio&amp;#x6765;&amp;#x6D4B;&amp;#x8BD5;&amp;#x8FD9;&amp;#x5757;&amp;#x903B;&amp;#x8F91;&amp;#x5377;&amp;#xFF0C;&amp;#x4E3A;&amp;#x4E86;&amp;#x4E0D;&amp;#x4EA7;&amp;#x751F;&amp;#x8FC7;&amp;#x591A;&amp;#x7684;io&amp;#x5F71;&amp;#x54CD;&amp;#x5206;&amp;#x6790;&amp;#xFF0C;&amp;#x91C7;&amp;#x7528;fio&amp;#x7684;rate_iops&amp;#x6765;&amp;#x9650;&amp;#x5236;io&amp;#x6570;&lt;/h3&gt;&lt;p&gt;fio&amp;#x914D;&amp;#x7F6E;&amp;#x5982;&amp;#x4E0B;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[global]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#write_iops_log=write_iops_log&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rw=randwrite&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ioengine=libaio&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;direct=1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;iodepth=1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;bsrange=4k-4k&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rate_iops=10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;runtime=18000&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;time_based&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;group_reporting&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[dm-0]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;filename=/dev/dm-0&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&quot;7-&amp;#x5C06;fio&amp;#x8DD1;&amp;#x8D77;&amp;#x6765;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x5728;&amp;#x5BBF;&amp;#x4E3B;&amp;#x673A;&amp;#x4E0A;&amp;#x4F7F;&amp;#x7528;iostat&amp;#x76D1;&amp;#x63A7;dm-0&amp;#x7684;io&amp;#x72B6;&amp;#x51B5;&quot;&gt;&lt;a href=&quot;#7-&amp;#x5C06;fio&amp;#x8DD1;&amp;#x8D77;&amp;#x6765;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x5728;&amp;#x5BBF;&amp;#x4E3B;&amp;#x673A;&amp;#x4E0A;&amp;#x4F7F;&amp;#x7528;iostat&amp;#x76D1;&amp;#x63A7;dm-0&amp;#x7684;io&amp;#x72B6;&amp;#x51B5;&quot; class=&quot;headerlink&quot; title=&quot;7.&amp;#x5C06;fio&amp;#x8DD1;&amp;#x8D77;&amp;#x6765;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x5728;&amp;#x5BBF;&amp;#x4E3B;&amp;#x673A;&amp;#x4E0A;&amp;#x4F7F;&amp;#x7528;iostat&amp;#x76D1;&amp;#x63A7;dm-0&amp;#x7684;io&amp;#x72B6;&amp;#x51B5;&quot;&gt;&lt;/a&gt;7.&amp;#x5C06;fio&amp;#x8DD1;&amp;#x8D77;&amp;#x6765;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x5728;&amp;#x5BBF;&amp;#x4E3B;&amp;#x673A;&amp;#x4E0A;&amp;#x4F7F;&amp;#x7528;iostat&amp;#x76D1;&amp;#x63A7;dm-0&amp;#x7684;io&amp;#x72B6;&amp;#x51B5;&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;iostat -mxt 1 dm-0|tee dm-0.stats&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;8-&amp;#x5C06;&amp;#x5176;&amp;#x4E2D;&amp;#x4E00;&amp;#x53F0;&amp;#x5B58;&amp;#x50A8;&amp;#x673A;&amp;#x4E0A;&amp;#x7684;chunk&amp;#x8BBE;&amp;#x5907;suspend&amp;#x4F4F;&quot;&gt;&lt;a href=&quot;#8-&amp;#x5C06;&amp;#x5176;&amp;#x4E2D;&amp;#x4E00;&amp;#x53F0;&amp;#x5B58;&amp;#x50A8;&amp;#x673A;&amp;#x4E0A;&amp;#x7684;chunk&amp;#x8BBE;&amp;#x5907;suspend&amp;#x4F4F;&quot; class=&quot;headerlink&quot; title=&quot;8.&amp;#x5C06;&amp;#x5176;&amp;#x4E2D;&amp;#x4E00;&amp;#x53F0;&amp;#x5B58;&amp;#x50A8;&amp;#x673A;&amp;#x4E0A;&amp;#x7684;chunk&amp;#x8BBE;&amp;#x5907;suspend&amp;#x4F4F;&quot;&gt;&lt;/a&gt;8.&amp;#x5C06;&amp;#x5176;&amp;#x4E2D;&amp;#x4E00;&amp;#x53F0;&amp;#x5B58;&amp;#x50A8;&amp;#x673A;&amp;#x4E0A;&amp;#x7684;chunk&amp;#x8BBE;&amp;#x5907;suspend&amp;#x4F4F;&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;nbs@10-180-0-30:~/wd$ sudo dmsetup suspend test_chunk_0&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;9-io-hang&amp;#x4F4F;&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x7EDF;&amp;#x8BA1;&quot;&gt;&lt;a href=&quot;#9-io-hang&amp;#x4F4F;&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x7EDF;&amp;#x8BA1;&quot; class=&quot;headerlink&quot; title=&quot;9.io hang&amp;#x4F4F;&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x7EDF;&amp;#x8BA1;&quot;&gt;&lt;/a&gt;9.io hang&amp;#x4F4F;&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x7EDF;&amp;#x8BA1;&lt;/h3&gt;&lt;p&gt;&amp;#x7136;&amp;#x540E;&amp;#x53EF;&amp;#x4EE5;&amp;#x89C2;&amp;#x5BDF;&amp;#x5230;fio&amp;#x7684;io hang&amp;#x4F4F;&amp;#x4E86;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;iostat&amp;#x663E;&amp;#x793A;util 100%&lt;br&gt;fio&amp;#x5F00;&amp;#x59CB;&amp;#x540E;&amp;#x7684;10s&amp;#x65F6;&amp;#x523B;suspend&amp;#x4F4F;chunk&amp;#x8BBE;&amp;#x5907;&amp;#xFF0C;&amp;#x89C2;&amp;#x5BDF;&amp;#x5230;fio&amp;#x6062;&amp;#x590D;&amp;#x6B63;&amp;#x5E38;&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x70B9;&amp;#x662F;eta 04h:53m:36s&amp;#xFF0C;&amp;#x8FD9;&amp;#x662F;fio&amp;#x7684;&amp;#x5012;&amp;#x8BA1;&amp;#x65F6;&amp;#xFF0C;&amp;#x56E0;&amp;#x6B64;&amp;#x7B97;&amp;#x51FA;&amp;#x6765;fio io hang&amp;#x4E86;6m14s&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x5230;&amp;#x5BBF;&amp;#x4E3B;&amp;#x673A;&amp;#x4E0A;&amp;#x8FD9;&amp;#x4E2A;iscsi&amp;#x8BBE;&amp;#x5907;&amp;#x62A5;io error&amp;#x4E86;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;iostat&amp;#x89C2;&amp;#x5BDF;&amp;#x5230;&amp;#x7684;&amp;#x5404;&amp;#x4E2A;&amp;#x65F6;&amp;#x95F4;&amp;#x70B9;&amp;#xFF1A;&lt;br&gt;1&amp;#xFF09;io&amp;#x5F00;&amp;#x59CB;&amp;#x65F6;&amp;#x95F4;&amp;#xFF1A;    04:50:37 PM&lt;br&gt;2&amp;#xFF09;io hang&amp;#x5F00;&amp;#x59CB;&amp;#x65F6;&amp;#x95F4;&amp;#xFF1A; 04:50:47 PM&lt;br&gt;3&amp;#xFF09;io&amp;#x5F00;&amp;#x59CB;&amp;#x6062;&amp;#x590D;&amp;#x65F6;&amp;#x95F4;&amp;#xFF1A;   04:56:58 PM&lt;br&gt;4&amp;#xFF09;&amp;#x56E0;&amp;#x4E3A;&amp;#x662F;sas&amp;#x76D8;&amp;#xFF0C;&amp;#x5806;&amp;#x79EF;&amp;#x7684;io&amp;#x4E00;&amp;#x76F4;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;util &amp;#x8FD8;&amp;#x662F;100%&amp;#xFF0C;&amp;#x6062;&amp;#x590D;&amp;#x6B63;&amp;#x5E38;&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#xFF1A; 04:57:22 PM&lt;br&gt;&amp;#x53EF;&amp;#x4EE5;&amp;#x7B97;&amp;#x51FA;io hang&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x4E3A;6m11s&amp;#xFF0C;&amp;#x8DDF;fio&amp;#x4E0A;&amp;#x89C2;&amp;#x5BDF;&amp;#x5230;&amp;#x7684;&amp;#x5DEE;&amp;#x4E0D;&amp;#x591A;&amp;#x3002;&lt;/p&gt;
&lt;h3 id=&quot;10-&amp;#x8D44;&amp;#x6E90;&amp;#x4F7F;&amp;#x7528;&amp;#x60C5;&amp;#x51B5;&amp;#x76D1;&amp;#x63A7;&quot;&gt;&lt;a href=&quot;#10-&amp;#x8D44;&amp;#x6E90;&amp;#x4F7F;&amp;#x7528;&amp;#x60C5;&amp;#x51B5;&amp;#x76D1;&amp;#x63A7;&quot; class=&quot;headerlink&quot; title=&quot;10.&amp;#x8D44;&amp;#x6E90;&amp;#x4F7F;&amp;#x7528;&amp;#x60C5;&amp;#x51B5;&amp;#x76D1;&amp;#x63A7;&quot;&gt;&lt;/a&gt;10.&amp;#x8D44;&amp;#x6E90;&amp;#x4F7F;&amp;#x7528;&amp;#x60C5;&amp;#x51B5;&amp;#x76D1;&amp;#x63A7;&lt;/h3&gt;&lt;p&gt;&amp;#x7F51;&amp;#x7EDC;&amp;#x8FDE;&amp;#x63A5;&amp;#x72B6;&amp;#x51B5;&amp;#xFF0C;&amp;#x53D1;&amp;#x73B0;&amp;#x4E00;&amp;#x76F4;&amp;#x51FA;&amp;#x9519;&amp;#x540E;&amp;#x91CD;&amp;#x8FDE;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Every 1.0s: sudo ss -apnt |grep 3260                                                                                                                                            &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;FIN-WAIT-1 0      481             10.180.0.46:59440          10.180.0.30:3260&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;FIN-WAIT-1 0      481             10.180.0.46:59446          10.180.0.30:3260&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ESTAB      0      480             10.180.0.46:59451          10.180.0.30:3260   users:((&amp;quot;iscsid&amp;quot;,4237,7))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;FIN-WAIT-1 0      481             10.180.0.46:59444          10.180.0.30:3260&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;FIN-WAIT-1 0      481             10.180.0.46:59442          10.180.0.30:3260&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;FIN-WAIT-1 0      481             10.180.0.46:59449          10.180.0.30:3260&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;target&amp;#x7684;&amp;#x5185;&amp;#x6838;&amp;#x7EBF;&amp;#x7A0B;&amp;#x67D0;&amp;#x4E2A;&amp;#x65F6;&amp;#x95F4;&amp;#x70B9;&amp;#x540E;&amp;#x4E00;&amp;#x76F4;&amp;#x5904;&amp;#x4E8E;cpu 100%&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt; PID USER      PR  NI  VIRT  RES  SHR S  %CPU %MEM    TIME+  COMMAND                                                                                                                                        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3138 root      20   0     0    0    0 R   100  0.0 192:04.28 istd1000&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&quot;&amp;#x6392;&amp;#x67E5;&amp;#x5206;&amp;#x6790;&amp;#x8FC7;&amp;#x7A0B;&quot;&gt;&lt;a href=&quot;#&amp;#x6392;&amp;#x67E5;&amp;#x5206;&amp;#x6790;&amp;#x8FC7;&amp;#x7A0B;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x6392;&amp;#x67E5;&amp;#x5206;&amp;#x6790;&amp;#x8FC7;&amp;#x7A0B;&quot;&gt;&lt;/a&gt;&amp;#x6392;&amp;#x67E5;&amp;#x5206;&amp;#x6790;&amp;#x8FC7;&amp;#x7A0B;&lt;/h2&gt;&lt;h3 id=&quot;iscsi&amp;#x76F8;&amp;#x5173;&amp;#x8D85;&amp;#x65F6;&amp;#x6392;&amp;#x67E5;&quot;&gt;&lt;a href=&quot;#iscsi&amp;#x76F8;&amp;#x5173;&amp;#x8D85;&amp;#x65F6;&amp;#x6392;&amp;#x67E5;&quot; class=&quot;headerlink&quot; title=&quot;iscsi&amp;#x76F8;&amp;#x5173;&amp;#x8D85;&amp;#x65F6;&amp;#x6392;&amp;#x67E5;&quot;&gt;&lt;/a&gt;iscsi&amp;#x76F8;&amp;#x5173;&amp;#x8D85;&amp;#x65F6;&amp;#x6392;&amp;#x67E5;&lt;/h3&gt;&lt;p&gt;&amp;#x6839;&amp;#x636E;&amp;#x4E0A;&amp;#x9762;&amp;#x7684;&amp;#x8D44;&amp;#x6E90;&amp;#x4F7F;&amp;#x7528;&amp;#x60C5;&amp;#x51B5;&amp;#x7684;&amp;#x76D1;&amp;#x63A7;&amp;#x53D1;&amp;#x73B0;&amp;#x5F53;&amp;#x6709;&amp;#x5F02;&amp;#x5E38;&amp;#x65F6;&amp;#xFF0C;iscsi&amp;#x7684;&amp;#x8FDE;&amp;#x63A5;&amp;#x4E00;&amp;#x76F4;&amp;#x5728;&amp;#x91CD;&amp;#x8FDE;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5173;&amp;#x95ED;&amp;#xFF0C;&amp;#x53C8;&amp;#x91CD;&amp;#x8FDE;&amp;#xFF0C;&amp;#x56E0;&amp;#x6B64;&amp;#x9996;&amp;#x5148;&amp;#x5C31;&amp;#x6000;&amp;#x7591;&amp;#x662F;&amp;#x5426;&amp;#x662F;iscsi&amp;#x914D;&amp;#x7F6E;&amp;#x7684;&amp;#x76F8;&amp;#x5173;&amp;#x8D85;&amp;#x65F6;&amp;#x5BFC;&amp;#x81F4;&amp;#x7684;&amp;#xFF0C;iscsi initiator&amp;#x7AEF;&amp;#xFF08;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;openiscsi&amp;#xFF09;&amp;#x7684;&amp;#x76F8;&amp;#x5173;&amp;#x8D85;&amp;#x65F6;&amp;#x603B;&amp;#x5171;&amp;#x6709;&amp;#x4EE5;&amp;#x4E0B;&amp;#x51E0;&amp;#x9879;&amp;#xFF1A;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;node.conn[0].timeo.auth_timeout = 45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;node.conn[0].timeo.login_timeout = 15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;node.conn[0].timeo.logout_timeout = 15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;node.conn[0].timeo.noop_out_interval = 5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;node.conn[0].timeo.noop_out_timeout = 5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;node.session.err_timeo.abort_timeout = 15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;node.session.err_timeo.host_reset_timeout = 60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;node.session.err_timeo.lu_reset_timeout = 30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;node.session.err_timeo.tgt_reset_timeout = 30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;node.session.timeo.replacement_timeout = 10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x8FD9;&amp;#x4E9B;&amp;#x8D85;&amp;#x65F6;&amp;#x7684;&amp;#x542B;&amp;#x4E49;&amp;#x901A;&amp;#x8FC7;&amp;#x540D;&amp;#x5B57;&amp;#x53EF;&amp;#x4EE5;&amp;#x77E5;&amp;#x6653;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x5177;&amp;#x4F53;&amp;#x8BF4;&amp;#x660E;&amp;#xFF0C;&amp;#x8BE6;&amp;#x7EC6;&amp;#x7684;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&lt;a href=&quot;https://github.com/open-iscsi/open-iscsi&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;open-iscsi&amp;#x7684;&amp;#x6587;&amp;#x6863;&lt;/a&gt;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x901A;&amp;#x8FC7;&amp;#x5C06;&amp;#x8FD9;&amp;#x4E9B;&amp;#x8D85;&amp;#x65F6;&amp;#x503C;&amp;#x8C03;&amp;#x5C0F;&amp;#xFF0C;&amp;#x518D;&amp;#x8FDB;&amp;#x884C;&amp;#x6D4B;&amp;#x8BD5;&amp;#xFF0C;&amp;#x4ECD;&amp;#x7136;&amp;#x662F;&amp;#x4E00;&amp;#x6837;&amp;#x7684;&amp;#x6548;&amp;#x679C;&amp;#xFF0C;fio hang&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x4E5F;&amp;#x662F;6&amp;#x5206;&amp;#x591A;&amp;#x949F;&amp;#x3002;&amp;#x8BF4;&amp;#x660E;&amp;#x4E0D;&amp;#x662F;&amp;#x8FD9;&amp;#x4E9B;&amp;#x53C2;&amp;#x6570;&amp;#x5F71;&amp;#x54CD;&amp;#x7684;&amp;#x3002;&lt;/p&gt;
&lt;h3 id=&quot;open-iscsi&amp;#x548C;iscsitarget&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&quot;&gt;&lt;a href=&quot;#open-iscsi&amp;#x548C;iscsitarget&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&quot; class=&quot;headerlink&quot; title=&quot;open-iscsi&amp;#x548C;iscsitarget&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&quot;&gt;&lt;/a&gt;open-iscsi&amp;#x548C;iscsitarget&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&lt;/h3&gt;&lt;p&gt;io hang&amp;#x4F4F;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;iscsitarget&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Jan 13 16:51:48 10-180-0-30 kernel: [2540033.667744] iscsi_trgt: Abort Task (01) issued on tid:1000 lun:0 by sid:281474997486080 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 13 16:52:50 10-180-0-30 kernel: [2540095.762670] iscsi_trgt: Logical Unit Reset (05) issued on tid:1000 lun:0 by sid:281474997486080 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 13 16:53:52 10-180-0-30 kernel: [2540157.745521] iscsi_trgt: Abort Task (01) issued on tid:1000 lun:0 by sid:281474997486080 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 13 16:54:54 10-180-0-30 kernel: [2540219.840457] iscsi_trgt: Logical Unit Reset (05) issued on tid:1000 lun:0 by sid:281474997486080 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 13 16:55:56 10-180-0-30 kernel: [2540281.823308] iscsi_trgt: Abort Task (01) issued on tid:1000 lun:0 by sid:281474997486080 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 13 16:56:58 10-180-0-30 kernel: [2540343.790186] iscsi_trgt: Logical Unit Reset (05) issued on tid:1000 lun:0 by sid:281474997486080 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 13 17:00:48 10-180-0-30 kernel: [2540574.243189] iscsi_trgt: nop_out_start(915) ignore this request 4b000000&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 13 17:00:48 10-180-0-30 kernel: [2540574.244276] iscsi_trgt: cmnd_rx_start(1942) 0 4b000000 -7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 13 17:00:48 10-180-0-30 kernel: [2540574.244999] iscsi_trgt: cmnd_skip_pdu(471) 4b000000 0 0 0&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x4ECE;target&amp;#x7684;&amp;#x9519;&amp;#x8BEF;&amp;#x65E5;&amp;#x5FD7;&amp;#x6765;&amp;#x770B;&amp;#xFF0C;&amp;#x4E5F;&amp;#x53EA;&amp;#x662F;&amp;#x6536;&amp;#x5230;initiator&amp;#x7AEF;&amp;#x53D1;&amp;#x8FC7;&amp;#x6765;&amp;#x7684;abort task&amp;#x6D88;&amp;#x606F;&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x6CA1;&amp;#x6709;&amp;#x660E;&amp;#x663E;&amp;#x7EBF;&amp;#x7D22;&amp;#x3002;&lt;br&gt;&amp;#x53E6;&amp;#x5916;&amp;#x5F00;&amp;#x542F;&amp;#x4E86;open-iscsi&amp;#x7684;debug&amp;#x65E5;&amp;#x5FD7;&amp;#xFF0C;io hang&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#x4F1A;&amp;#x53D1;&amp;#x73B0;&amp;#x5F88;&amp;#x591A;&amp;#x91CD;&amp;#x8FDE;&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&amp;#xFF0C;&amp;#x8DDF;&amp;#x4E4B;&amp;#x524D;&amp;#x7F51;&amp;#x7EDC;&amp;#x8FDE;&amp;#x63A5;&amp;#x72B6;&amp;#x6001;&amp;#x76D1;&amp;#x63A7;&amp;#x7684;&amp;#x4FE1;&amp;#x606F;&amp;#x4E00;&amp;#x81F4;&amp;#x3002;&lt;/p&gt;
&lt;h3 id=&quot;&amp;#x8BBE;&amp;#x5907;&amp;#x7684;timeout&quot;&gt;&lt;a href=&quot;#&amp;#x8BBE;&amp;#x5907;&amp;#x7684;timeout&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x8BBE;&amp;#x5907;&amp;#x7684;timeout&quot;&gt;&lt;/a&gt;&amp;#x8BBE;&amp;#x5907;&amp;#x7684;timeout&lt;/h3&gt;&lt;p&gt;&amp;#x4E00;&amp;#x76F4;&amp;#x6000;&amp;#x7591;&amp;#x662F;&amp;#x67D0;&amp;#x4E2A;&amp;#x9636;&amp;#x6BB5;&amp;#x7684;&amp;#x8D85;&amp;#x65F6;&amp;#x5BFC;&amp;#x81F4;&amp;#xFF0C;&amp;#x65E2;&amp;#x7136;&amp;#x4ECE;iscsi&amp;#x5C42;&amp;#x9762;&amp;#x6CA1;&amp;#x6709;&amp;#x53D1;&amp;#x73B0;&amp;#x660E;&amp;#x663E;&amp;#x7684;&amp;#x7EBF;&amp;#x7D22;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x5C31;&amp;#x8F6C;&amp;#x5230;&amp;#x8BBE;&amp;#x5907;&amp;#x5C42;&amp;#x9762;&amp;#xFF0C;linux&amp;#x7684;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x90FD;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;timeout&amp;#xFF08;/sys/block/&lt;sdxx&gt;/device/timeout&amp;#xFF09;&amp;#xFF0C;&amp;#x5BF9;&amp;#x4E8E;iscsi&amp;#x8FDE;&amp;#x8FC7;&amp;#x6765;&amp;#x7684;&amp;#x8BBE;&amp;#x5907;&amp;#x8FD9;&amp;#x4E2A;&amp;#x8D85;&amp;#x65F6;&amp;#x503C;&amp;#x9ED8;&amp;#x8BA4;&amp;#x662F;30s&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x5C06;&amp;#x8FD9;&amp;#x4E2A;&amp;#x8D85;&amp;#x65F6;&amp;#x65F6;&amp;#x95F4;&amp;#x6539;&amp;#x5C0F;&amp;#x8BD5;&amp;#x8BD5;&amp;#x3002;&lt;/sdxx&gt;&lt;/p&gt;
&lt;p&gt;1&amp;#xFF09;&amp;#x5C06;iscsi&amp;#x8BBE;&amp;#x5907;&amp;#x7684;&amp;#x8D85;&amp;#x65F6;&amp;#x7531;&amp;#x9ED8;&amp;#x8BA4;&amp;#x7684;30s&amp;#x6539;&amp;#x6210;10s&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;echo 10 &amp;gt; /sys/block/sdu/device/timeout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;iostat io hang&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#xFF1A; 	11:03:11 AM&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;iostat io&amp;#x5F00;&amp;#x59CB;&amp;#x6062;&amp;#x590D;&amp;#xFF1A;		11:05:22 AM&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;iostat io&amp;#x6062;&amp;#x590D;&amp;#x6B63;&amp;#x5E38;&amp;#xFF1A;		11:05:31 AM&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#x603B;&amp;#x5171;io hang&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x4E3A;2m10s&amp;#x5DE6;&amp;#x53F3;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;2&amp;#xFF09;&amp;#x5C06;scsi&amp;#x7684;timeout&amp;#x518D;&amp;#x6539;&amp;#x77ED;&amp;#x6210;5s&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;echo 5 &amp;gt; /sys/block/sdw/device/timeout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;iostat io hang&amp;#x5F00;&amp;#x59CB;&amp;#x65F6;&amp;#x95F4;&amp;#xFF1A;	04:31:04 PM&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;iostat io&amp;#x5F00;&amp;#x59CB;&amp;#x6062;&amp;#x590D;&amp;#x65F6;&amp;#x95F4;&amp;#xFF1A;	04:32:13 PM&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;iostat io&amp;#x5B8C;&amp;#x6210;&amp;#x6062;&amp;#x590D;&amp;#x65F6;&amp;#x95F4;&amp;#xFF1A;	04:32:19 PM&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#x603B;&amp;#x5171;io hang&amp;#x7684;&amp;#x65F6;&amp;#x95F4;1m9s&amp;#x5DE6;&amp;#x53F3;&amp;#x3002;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x4E0A;&amp;#x9762;&amp;#x7684;&amp;#x7ED3;&amp;#x679C;&amp;#x663E;&amp;#x793A;&amp;#xFF0C;scsi&amp;#x8BBE;&amp;#x5907;&amp;#x7684;timeout&amp;#x5F71;&amp;#x54CD;&amp;#x4E86;io hang&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#xFF0C;&amp;#x8D85;&amp;#x65F6;&amp;#x6539;&amp;#x5C0F;&amp;#x540E;&amp;#xFF0C;io hang&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x660E;&amp;#x663E;&amp;#x51CF;&amp;#x5C0F;&amp;#x4E86;&amp;#x3002;&amp;#x90A3;&amp;#x4E48;&amp;#x5177;&amp;#x4F53;&amp;#x662F;&amp;#x4EC0;&amp;#x4E48;&amp;#x6837;&amp;#x7684;&amp;#x5173;&amp;#x7CFB;&amp;#x5462;&amp;#xFF1F;&amp;#x4E0B;&amp;#x9762;&amp;#x5C31;&amp;#x7ED3;&amp;#x5408;scsi&amp;#x7684;&amp;#x8C03;&amp;#x8BD5;&amp;#x65E5;&amp;#x5FD7;&amp;#x8FDB;&amp;#x884C;&amp;#x5206;&amp;#x6790;&amp;#x3002;&lt;/p&gt;
&lt;h3 id=&quot;&amp;#x5F00;&amp;#x542F;scsi&amp;#x8C03;&amp;#x8BD5;&amp;#x65E5;&amp;#x5FD7;&quot;&gt;&lt;a href=&quot;#&amp;#x5F00;&amp;#x542F;scsi&amp;#x8C03;&amp;#x8BD5;&amp;#x65E5;&amp;#x5FD7;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x5F00;&amp;#x542F;scsi&amp;#x8C03;&amp;#x8BD5;&amp;#x65E5;&amp;#x5FD7;&quot;&gt;&lt;/a&gt;&amp;#x5F00;&amp;#x542F;scsi&amp;#x8C03;&amp;#x8BD5;&amp;#x65E5;&amp;#x5FD7;&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ scsi_logging_level -s --error 7 --timeout 7 --all 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;New scsi logging level:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/proc/sys/dev/scsi/logging_level = 63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SCSI_LOG_ERROR=7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SCSI_LOG_TIMEOUT=7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SCSI_LOG_SCAN=0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SCSI_LOG_MLQUEUE=0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SCSI_LOG_MLCOMPLETE=0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SCSI_LOG_LLQUEUE=0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SCSI_LOG_LLCOMPLETE=0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SCSI_LOG_HLQUEUE=0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SCSI_LOG_HLCOMPLETE=0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SCSI_LOG_IOCTL=0&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&amp;#x7136;&amp;#x540E;&amp;#x5BF9;&amp;#x6BD4;&amp;#x5BBF;&amp;#x4E3B;&amp;#x673A;&amp;#x4E0A;&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&amp;#xFF0C;&amp;#x4ECE;&amp;#x65E5;&amp;#x5FD7;&amp;#x4E0A;&amp;#x770B;&amp;#x662F;abort cmd&amp;#x540E;&amp;#x8FDB;&amp;#x5165;&amp;#x5230;scsi error handler&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x6D41;&amp;#x7A0B;&amp;#x4E86;&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:48:38 10-180-0-46 -su: HISTORY: PID=4475 UID=2010 sudo fio fio.cfg &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:48:45 10-180-0-46 -su: HISTORY: PID=46333 UID=2010 iostat -mxt 1 dm-0 |tee dm-0.stats&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:00 10-180-0-46 kernel: [5368505.769870] sd 7:0:0:0: [sdu] scmd ffff883373616200 abort scheduled&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:00 10-180-0-46 kernel: [5368505.777865] sd 7:0:0:0: [sdu] aborting command ffff883373616200&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:00 10-180-0-46 kernel: [5368505.777978] sd 7:0:0:0: [sdu] scmd ffff883373616200 retry aborted command&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:12 10-180-0-46 kernel: [5368517.774336] sd 7:0:0:0: [sdu] scmd ffff883373616200 previous abort failed&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:12 10-180-0-46 kernel: [5368517.774342] Waking error handler thread&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:12 10-180-0-46 kernel: [5368517.774346] scsi_eh_7: waking up 0/1/1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:12 10-180-0-46 kernel: [5368517.774355] sd 7:0:0:0: scsi_eh_prt_fail_stats: cmds failed: 1, cancel: 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:12 10-180-0-46 kernel: [5368517.774362] Total of 1 commands on 1 devices require eh work&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:12 10-180-0-46 kernel: [5368517.774365] scsi_eh_7: Sending BDR sdev: 0xffff881fb23ff800&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:12 10-180-0-46 kernel: [5368517.774565] scsi_eh_done scmd: ffff883373616200 result: 2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:12 10-180-0-46 kernel: [5368517.774573] scsi_send_eh_cmnd: scmd: ffff883373616200, timeleft: 2500&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:12 10-180-0-46 kernel: [5368517.774577] scsi_send_eh_cmnd: scsi_eh_completed_normally 2001&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:12 10-180-0-46 kernel: [5368517.774579] scsi_eh_tur: scmd ffff883373616200 rtn 2001&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:12 10-180-0-46 kernel: [5368517.774643] scsi_eh_done scmd: ffff883373616200 result: 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:12 10-180-0-46 kernel: [5368517.774649] scsi_send_eh_cmnd: scmd: ffff883373616200, timeleft: 2500&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:12 10-180-0-46 kernel: [5368517.774650] scsi_send_eh_cmnd: scsi_eh_completed_normally 2002&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:12 10-180-0-46 kernel: [5368517.774653] scsi_eh_tur: scmd ffff883373616200 rtn 2002&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:12 10-180-0-46 kernel: [5368517.774658] scsi_eh_7: flush retry cmd: ffff883373616200&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:12 10-180-0-46 kernel: [5368517.774665] scsi_eh_7 waking up host to restart&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:12 10-180-0-46 kernel: [5368517.774673] scsi_eh_7: sleeping&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:24 10-180-0-46 kernel: [5368529.746792] sd 7:0:0:0: [sdu] scmd ffff883373616200 abort scheduled&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:24 10-180-0-46 kernel: [5368529.754787] sd 7:0:0:0: [sdu] aborting command ffff883373616200&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:24 10-180-0-46 kernel: [5368529.754891] sd 7:0:0:0: [sdu] scmd ffff883373616200 retry aborted command&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:35 10-180-0-46 kernel: [5368540.790899] sd 7:0:0:0: [sdu] scmd ffff883373616200 previous abort failed&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:35 10-180-0-46 kernel: [5368540.790906] Waking error handler thread&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:35 10-180-0-46 kernel: [5368540.790910] scsi_eh_7: waking up 0/1/1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:35 10-180-0-46 kernel: [5368540.790918] sd 7:0:0:0: scsi_eh_prt_fail_stats: cmds failed: 1, cancel: 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:35 10-180-0-46 kernel: [5368540.790925] Total of 1 commands on 1 devices require eh work&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:35 10-180-0-46 kernel: [5368540.790929] scsi_eh_7: Sending BDR sdev: 0xffff881fb23ff800&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:35 10-180-0-46 kernel: [5368540.791141] scsi_eh_done scmd: ffff883373616200 result: 2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:35 10-180-0-46 kernel: [5368540.791150] scsi_send_eh_cmnd: scmd: ffff883373616200, timeleft: 2500&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:35 10-180-0-46 kernel: [5368540.791155] scsi_send_eh_cmnd: scsi_eh_completed_normally 2001&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:35 10-180-0-46 kernel: [5368540.791157] scsi_eh_tur: scmd ffff883373616200 rtn 2001&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:35 10-180-0-46 kernel: [5368540.791224] scsi_eh_done scmd: ffff883373616200 result: 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:35 10-180-0-46 kernel: [5368540.791230] scsi_send_eh_cmnd: scmd: ffff883373616200, timeleft: 2500&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:35 10-180-0-46 kernel: [5368540.791233] scsi_send_eh_cmnd: scsi_eh_completed_normally 2002&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:35 10-180-0-46 kernel: [5368540.791234] scsi_eh_tur: scmd ffff883373616200 rtn 2002&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:35 10-180-0-46 kernel: [5368540.791243] scsi_eh_7: flush retry cmd: ffff883373616200&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:35 10-180-0-46 kernel: [5368540.791249] scsi_eh_7 waking up host to restart&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:35 10-180-0-46 kernel: [5368540.791257] scsi_eh_7: sleeping&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:47 10-180-0-46 kernel: [5368552.763354] sd 7:0:0:0: [sdu] scmd ffff883373616200 abort scheduled&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:47 10-180-0-46 kernel: [5368552.771352] sd 7:0:0:0: [sdu] aborting command ffff883373616200&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:47 10-180-0-46 kernel: [5368552.771471] sd 7:0:0:0: [sdu] scmd ffff883373616200 retry aborted command&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:58 10-180-0-46 kernel: [5368563.807464] sd 7:0:0:0: [sdu] scmd ffff883373616200 previous abort failed&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:58 10-180-0-46 kernel: [5368563.807470] Waking error handler thread&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:58 10-180-0-46 kernel: [5368563.807480] scsi_eh_7: waking up 0/1/1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:58 10-180-0-46 kernel: [5368563.807488] sd 7:0:0:0: scsi_eh_prt_fail_stats: cmds failed: 1, cancel: 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:58 10-180-0-46 kernel: [5368563.807494] Total of 1 commands on 1 devices require eh work&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:58 10-180-0-46 kernel: [5368563.807497] scsi_eh_7: Sending BDR sdev: 0xffff881fb23ff800&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:58 10-180-0-46 kernel: [5368563.807697] scsi_eh_done scmd: ffff883373616200 result: 2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:58 10-180-0-46 kernel: [5368563.807705] scsi_send_eh_cmnd: scmd: ffff883373616200, timeleft: 2500&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:58 10-180-0-46 kernel: [5368563.807710] scsi_send_eh_cmnd: scsi_eh_completed_normally 2001&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:58 10-180-0-46 kernel: [5368563.807712] scsi_eh_tur: scmd ffff883373616200 rtn 2001&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:58 10-180-0-46 kernel: [5368563.807783] scsi_eh_done scmd: ffff883373616200 result: 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:58 10-180-0-46 kernel: [5368563.807790] scsi_send_eh_cmnd: scmd: ffff883373616200, timeleft: 2500&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:58 10-180-0-46 kernel: [5368563.807791] scsi_send_eh_cmnd: scsi_eh_completed_normally 2002&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:58 10-180-0-46 kernel: [5368563.807793] scsi_eh_tur: scmd ffff883373616200 rtn 2002&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:58 10-180-0-46 kernel: [5368563.807798] scsi_eh_7: flush finish cmd: ffff883373616200&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:58 10-180-0-46 kernel: [5368563.807804] sd 7:0:0:0: [sdu] Unhandled error code&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:58 10-180-0-46 kernel: [5368563.807806] sd 7:0:0:0: [sdu]  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:58 10-180-0-46 kernel: [5368563.807808] Result: hostbyte=DID_ERROR driverbyte=DRIVER_OK&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:58 10-180-0-46 kernel: [5368563.807809] sd 7:0:0:0: [sdu] CDB: &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:58 10-180-0-46 kernel: [5368563.807811] Write(10): 2a 00 00 eb b5 80 00 00 08 00&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:58 10-180-0-46 kernel: [5368563.807823] end_request: I/O error, dev sdu, sector 15447424&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:58 10-180-0-46 kernel: [5368563.808900] md/raid1:md127: Disk failure on sdu, disabling device.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:58 10-180-0-46 kernel: [5368563.808900] md/raid1:md127: Operation continuing on 1 devices.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:58 10-180-0-46 kernel: [5368563.808906] scsi_eh_7 waking up host to restart&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:58 10-180-0-46 kernel: [5368563.808912] scsi_eh_7: sleeping&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:58 10-180-0-46 kernel: [5368563.811521] RAID1 conf printout:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:58 10-180-0-46 kernel: [5368563.811523]  --- wd:1 rd:2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:58 10-180-0-46 kernel: [5368563.811525]  disk 0, wo:1, o:0, dev:sdu&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:58 10-180-0-46 kernel: [5368563.811527]  disk 1, wo:0, o:1, dev:sdv&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:58 10-180-0-46 kernel: [5368563.823554] RAID1 conf printout:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:58 10-180-0-46 kernel: [5368563.823556]  --- wd:1 rd:2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:58 10-180-0-46 kernel: [5368563.823558]  disk 1, wo:0, o:1, dev:sdv&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;target&amp;#x7AEF;&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&amp;#xFF1A;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:00 10-180-0-30 kernel: [2863985.237066] iscsi_trgt: Abort Task (01) issued on tid:1000 lun:0 by sid:12384899046375936 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:12 10-180-0-30 kernel: [2863997.233531] iscsi_trgt: Logical Unit Reset (05) issued on tid:1000 lun:0 by sid:12384899046375936 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:24 10-180-0-30 kernel: [2864009.213910] iscsi_trgt: Abort Task (01) issued on tid:1000 lun:0 by sid:12384899046375936 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:35 10-180-0-30 kernel: [2864020.250035] iscsi_trgt: Logical Unit Reset (05) issued on tid:1000 lun:0 by sid:12384899046375936 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:47 10-180-0-30 kernel: [2864032.230419] iscsi_trgt: Abort Task (01) issued on tid:1000 lun:0 by sid:12384899046375936 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 10:49:58 10-180-0-30 kernel: [2864043.266527] iscsi_trgt: Logical Unit Reset (05) issued on tid:1000 lun:0 by sid:12384899046375936 (Function Complete)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x4ECE;&amp;#x4E0A;&amp;#x9762;&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&amp;#x6765;&amp;#x770B;&amp;#xFF0C;&amp;#x662F;&amp;#x7ECF;&amp;#x8FC7;&amp;#x4E86;&amp;#x591A;&amp;#x6B21;abort task&amp;#xFF0C;&amp;#x7136;&amp;#x540E;error handle&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x5177;&amp;#x4F53;&amp;#x6709;&amp;#x4EC0;&amp;#x4E48;&amp;#x6837;&amp;#x7684;&amp;#x5173;&amp;#x7CFB;&amp;#xFF0C;&amp;#x8FD8;&amp;#x662F;&amp;#x5F97;&amp;#x4ECE;linux&amp;#x5185;&amp;#x6838;&amp;#x91CC;&amp;#x8FD9;&amp;#x90E8;&amp;#x5206;&amp;#x4EE3;&amp;#x7801;&amp;#x91CC;&amp;#x627E;&amp;#x7EBF;&amp;#x7D22;&amp;#x3002;&lt;/p&gt;
&lt;h3 id=&quot;&amp;#x4F7F;&amp;#x7528;ftrace&amp;#x6765;&amp;#x8FFD;&amp;#x8E2A;&amp;#x5173;&amp;#x952E;&amp;#x51FD;&amp;#x6570;&amp;#x7684;&amp;#x8C03;&amp;#x7528;&amp;#x4FE1;&amp;#x606F;&quot;&gt;&lt;a href=&quot;#&amp;#x4F7F;&amp;#x7528;ftrace&amp;#x6765;&amp;#x8FFD;&amp;#x8E2A;&amp;#x5173;&amp;#x952E;&amp;#x51FD;&amp;#x6570;&amp;#x7684;&amp;#x8C03;&amp;#x7528;&amp;#x4FE1;&amp;#x606F;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x4F7F;&amp;#x7528;ftrace&amp;#x6765;&amp;#x8FFD;&amp;#x8E2A;&amp;#x5173;&amp;#x952E;&amp;#x51FD;&amp;#x6570;&amp;#x7684;&amp;#x8C03;&amp;#x7528;&amp;#x4FE1;&amp;#x606F;&quot;&gt;&lt;/a&gt;&amp;#x4F7F;&amp;#x7528;ftrace&amp;#x6765;&amp;#x8FFD;&amp;#x8E2A;&amp;#x5173;&amp;#x952E;&amp;#x51FD;&amp;#x6570;&amp;#x7684;&amp;#x8C03;&amp;#x7528;&amp;#x4FE1;&amp;#x606F;&lt;/h3&gt;&lt;p&gt;&amp;#x5728;&amp;#x67E5;&amp;#x9605;linux&amp;#x5185;&amp;#x6838;&amp;#x6E90;&amp;#x7801;&amp;#x7684;&amp;#x540C;&amp;#x65F6;&amp;#xFF0C;&amp;#x4F7F;&amp;#x7528;ftrace&amp;#x6765;&amp;#x8FFD;&amp;#x8E2A;&amp;#x5173;&amp;#x952E;&amp;#x51FD;&amp;#x6570;&amp;#x7684;&amp;#x8C03;&amp;#x7528;&amp;#x65E5;&amp;#x5FD7;&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;sudo mount -t debugfs debugfs /sys/kernel/debug&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;echo 1 &amp;gt; /sys/kernel/debug/tracing/events/scsi/scsi_dispatch_cmd_start/enable&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;echo 1 &amp;gt; /sys/kernel/debug/tracing/events/scsi/scsi_dispatch_cmd_timeout/enable&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#x7136;&amp;#x540E;&amp;#x53EF;&amp;#x4EE5;&amp;#x67E5;&amp;#x770B;/sys/kernel/debug/tracing/trace&amp;#x91CC;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#x6765;&amp;#x770B;&amp;#x65E5;&amp;#x5FD7;&amp;#x4FE1;&amp;#x606F;&amp;#xFF0C;&amp;#x4E0D;&amp;#x8FC7;&amp;#x56E0;&amp;#x4E3A;&amp;#x4F1A;&amp;#x8F93;&amp;#x51FA;&amp;#x6240;&amp;#x6709;&amp;#x8BBE;&amp;#x5907;&amp;#x7684;&amp;#x4FE1;&amp;#x606F;&amp;#xFF0C;&amp;#x6240;&amp;#x6709;&amp;#x6839;&amp;#x636E;scsi&amp;#x53F7;&amp;#x6765;&amp;#x8FDB;&amp;#x884C;&amp;#x8FC7;&amp;#x6EE4;&amp;#x3002;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;grep &amp;quot;host_no=7 channel=0 id=0 lun=0&amp;quot; /sys/kernel/debug/tracing/trace&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x6D4B;&amp;#x8BD5;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;io hang&amp;#x90A3;&amp;#x6BB5;&amp;#x65F6;&amp;#x95F4;&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;       &amp;lt;...&amp;gt;-15169 [005] .... 5387221.071608: scsi_dispatch_cmd_start: host_no=7 channel=0 id=0 lun=0 data_sgl=1 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=3300944 txlen=8 protect=0 raw=2a 00 00 32 5e 50 00 00 08 00)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;lt;idle&amp;gt;-0     [003] dNs. 5387226.715800: scsi_dispatch_cmd_timeout: host_no=7 channel=0 id=0 lun=0 data_sgl=1 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=3300944 txlen=8 protect=0 raw=2a 00 00 32 5e 50 00 00 08 00) result=(driver=DRIVER_OK host=DID_OK message=COMMAND_COMPLETE status=SAM_STAT_GOOD)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;lt;idle&amp;gt;-0     [003] d.s. 5387232.718032: scsi_dispatch_cmd_timeout: host_no=7 channel=0 id=0 lun=0 data_sgl=1 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=3300944 txlen=8 protect=0 raw=2a 00 00 32 5e 50 00 00 08 00) result=(driver=DRIVER_OK host=DID_TIME_OUT message=COMMAND_COMPLETE status=SAM_STAT_GOOD)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;kworker/3:1H-612   [003] .... 5387232.734040: scsi_dispatch_cmd_start: host_no=7 channel=0 id=0 lun=0 data_sgl=1 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=3300944 txlen=8 protect=0 raw=2a 00 00 32 5e 50 00 00 08 00)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;lt;idle&amp;gt;-0     [003] dNs. 5387238.720266: scsi_dispatch_cmd_timeout: host_no=7 channel=0 id=0 lun=0 data_sgl=1 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=3300944 txlen=8 protect=0 raw=2a 00 00 32 5e 50 00 00 08 00) result=(driver=DRIVER_OK host=DID_OK message=COMMAND_COMPLETE status=SAM_STAT_GOOD)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;lt;idle&amp;gt;-0     [003] dNs. 5387244.722500: scsi_dispatch_cmd_timeout: host_no=7 channel=0 id=0 lun=0 data_sgl=1 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=3300944 txlen=8 protect=0 raw=2a 00 00 32 5e 50 00 00 08 00) result=(driver=DRIVER_OK host=DID_TIME_OUT message=COMMAND_COMPLETE status=SAM_STAT_GOOD)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;kworker/5:1H-655   [005] .... 5387244.726522: scsi_dispatch_cmd_start: host_no=7 channel=0 id=0 lun=0 data_sgl=1 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=3300944 txlen=8 protect=0 raw=2a 00 00 32 5e 50 00 00 08 00)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;lt;idle&amp;gt;-0     [005] dNs. 5387250.692735: scsi_dispatch_cmd_timeout: host_no=7 channel=0 id=0 lun=0 data_sgl=1 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=3300944 txlen=8 protect=0 raw=2a 00 00 32 5e 50 00 00 08 00) result=(driver=DRIVER_OK host=DID_OK message=COMMAND_COMPLETE status=SAM_STAT_GOOD)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;lt;idle&amp;gt;-0     [005] dNs. 5387256.710961: scsi_dispatch_cmd_timeout: host_no=7 channel=0 id=0 lun=0 data_sgl=1 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=3300944 txlen=8 protect=0 raw=2a 00 00 32 5e 50 00 00 08 00) result=(driver=DRIVER_OK host=DID_TIME_OUT message=COMMAND_COMPLETE status=SAM_STAT_GOOD)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;kworker/3:1H-612   [003] .... 5387256.726970: scsi_dispatch_cmd_start: host_no=7 channel=0 id=0 lun=0 data_sgl=1 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=3300944 txlen=8 protect=0 raw=2a 00 00 32 5e 50 00 00 08 00)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;lt;idle&amp;gt;-0     [003] dNs. 5387262.729203: scsi_dispatch_cmd_timeout: host_no=7 channel=0 id=0 lun=0 data_sgl=1 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=3300944 txlen=8 protect=0 raw=2a 00 00 32 5e 50 00 00 08 00) result=(driver=DRIVER_OK host=DID_OK message=COMMAND_COMPLETE status=SAM_STAT_GOOD)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;lt;idle&amp;gt;-0     [003] dNs. 5387268.731435: scsi_dispatch_cmd_timeout: host_no=7 channel=0 id=0 lun=0 data_sgl=1 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=3300944 txlen=8 protect=0 raw=2a 00 00 32 5e 50 00 00 08 00) result=(driver=DRIVER_OK host=DID_TIME_OUT message=COMMAND_COMPLETE status=SAM_STAT_GOOD)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;kworker/3:1H-612   [003] .... 5387268.735459: scsi_dispatch_cmd_start: host_no=7 channel=0 id=0 lun=0 data_sgl=1 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=3300944 txlen=8 protect=0 raw=2a 00 00 32 5e 50 00 00 08 00)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;lt;idle&amp;gt;-0     [003] dNs. 5387274.733669: scsi_dispatch_cmd_timeout: host_no=7 channel=0 id=0 lun=0 data_sgl=1 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=3300944 txlen=8 protect=0 raw=2a 00 00 32 5e 50 00 00 08 00) result=(driver=DRIVER_OK host=DID_OK message=COMMAND_COMPLETE status=SAM_STAT_GOOD)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;lt;idle&amp;gt;-0     [003] dNs. 5387280.735902: scsi_dispatch_cmd_timeout: host_no=7 channel=0 id=0 lun=0 data_sgl=1 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=3300944 txlen=8 protect=0 raw=2a 00 00 32 5e 50 00 00 08 00) result=(driver=DRIVER_OK host=DID_TIME_OUT message=COMMAND_COMPLETE status=SAM_STAT_GOOD)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;kworker/3:1H-612   [003] .... 5387280.751909: scsi_dispatch_cmd_start: host_no=7 channel=0 id=0 lun=0 data_sgl=1 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=3300944 txlen=8 protect=0 raw=2a 00 00 32 5e 50 00 00 08 00)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;lt;idle&amp;gt;-0     [003] d.s. 5387286.738133: scsi_dispatch_cmd_timeout: host_no=7 channel=0 id=0 lun=0 data_sgl=1 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=3300944 txlen=8 protect=0 raw=2a 00 00 32 5e 50 00 00 08 00) result=(driver=DRIVER_OK host=DID_OK message=COMMAND_COMPLETE status=SAM_STAT_GOOD)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;lt;idle&amp;gt;-0     [003] dNs. 5387292.740369: scsi_dispatch_cmd_timeout: host_no=7 channel=0 id=0 lun=0 data_sgl=1 prot_sgl=0 prot_op=SCSI_PROT_NORMAL cmnd=(WRITE_10 lba=3300944 txlen=8 protect=0 raw=2a 00 00 32 5e 50 00 00 08 00) result=(driver=DRIVER_OK host=DID_TIME_OUT message=COMMAND_COMPLETE status=SAM_STAT_GOOD)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x4EE5;&amp;#x53CA;&amp;#x8FD9;&amp;#x4E2A;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#x5BBF;&amp;#x4E3B;&amp;#x673A;&amp;#x4E0A;&amp;#x7684;scsi&amp;#x65E5;&amp;#x5FD7;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:00:29 10-180-0-46 bash: HISTORY: PID=3642 UID=0 echo &amp;quot;&amp;quot; &amp;gt; trace&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:00:39 10-180-0-46 -su: HISTORY: PID=4475 UID=2010 sudo fio fio.cfg &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:00:41 10-180-0-46 -su: HISTORY: PID=46333 UID=2010 iostat -mxt 1 dm-0 |tee dm-0.stats&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:00 10-180-0-46 kernel: [5387232.718042] sd 7:0:0:0: [sdu] scmd ffff88377bcb56c0 abort scheduled&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:00 10-180-0-46 kernel: [5387232.726038] sd 7:0:0:0: [sdu] aborting command ffff88377bcb56c0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:00 10-180-0-46 kernel: [5387232.726148] sd 7:0:0:0: [sdu] scmd ffff88377bcb56c0 retry aborted command&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:12 10-180-0-46 kernel: [5387244.722511] sd 7:0:0:0: [sdu] scmd ffff88377bcb56c0 previous abort failed&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:12 10-180-0-46 kernel: [5387244.722518] Waking error handler thread&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:12 10-180-0-46 kernel: [5387244.722521] scsi_eh_7: waking up 0/1/1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:12 10-180-0-46 kernel: [5387244.722531] sd 7:0:0:0: scsi_eh_prt_fail_stats: cmds failed: 1, cancel: 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:12 10-180-0-46 kernel: [5387244.722537] Total of 1 commands on 1 devices require eh work&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:12 10-180-0-46 kernel: [5387244.722541] scsi_eh_7: Sending BDR sdev: 0xffff881fb23ff800&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:12 10-180-0-46 kernel: [5387244.722735] scsi_eh_done scmd: ffff88377bcb56c0 result: 2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:12 10-180-0-46 kernel: [5387244.722743] scsi_send_eh_cmnd: scmd: ffff88377bcb56c0, timeleft: 1250&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:12 10-180-0-46 kernel: [5387244.722746] scsi_send_eh_cmnd: scsi_eh_completed_normally 2001&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:12 10-180-0-46 kernel: [5387244.722749] scsi_eh_tur: scmd ffff88377bcb56c0 rtn 2001&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:12 10-180-0-46 kernel: [5387244.722816] scsi_eh_done scmd: ffff88377bcb56c0 result: 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:12 10-180-0-46 kernel: [5387244.722822] scsi_send_eh_cmnd: scmd: ffff88377bcb56c0, timeleft: 1250&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:12 10-180-0-46 kernel: [5387244.722824] scsi_send_eh_cmnd: scsi_eh_completed_normally 2002&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:12 10-180-0-46 kernel: [5387244.722828] scsi_eh_tur: scmd ffff88377bcb56c0 rtn 2002&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:12 10-180-0-46 kernel: [5387244.722832] scsi_eh_7: flush retry cmd: ffff88377bcb56c0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:12 10-180-0-46 kernel: [5387244.722840] scsi_eh_7 waking up host to restart&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:12 10-180-0-46 kernel: [5387244.722851] scsi_eh_7: sleeping&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:24 10-180-0-46 kernel: [5387256.710972] sd 7:0:0:0: [sdu] scmd ffff88377bcb56c0 abort scheduled&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:24 10-180-0-46 kernel: [5387256.718969] sd 7:0:0:0: [sdu] aborting command ffff88377bcb56c0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:24 10-180-0-46 kernel: [5387256.719133] sd 7:0:0:0: [sdu] scmd ffff88377bcb56c0 retry aborted command&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:36 10-180-0-46 kernel: [5387268.731446] sd 7:0:0:0: [sdu] scmd ffff88377bcb56c0 previous abort failed&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:36 10-180-0-46 kernel: [5387268.731452] Waking error handler thread&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:36 10-180-0-46 kernel: [5387268.731455] scsi_eh_7: waking up 0/1/1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:36 10-180-0-46 kernel: [5387268.731464] sd 7:0:0:0: scsi_eh_prt_fail_stats: cmds failed: 1, cancel: 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:36 10-180-0-46 kernel: [5387268.731470] Total of 1 commands on 1 devices require eh work&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:36 10-180-0-46 kernel: [5387268.731473] scsi_eh_7: Sending BDR sdev: 0xffff881fb23ff800&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:36 10-180-0-46 kernel: [5387268.731668] scsi_eh_done scmd: ffff88377bcb56c0 result: 2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:36 10-180-0-46 kernel: [5387268.731674] scsi_send_eh_cmnd: scmd: ffff88377bcb56c0, timeleft: 1250&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:36 10-180-0-46 kernel: [5387268.731676] scsi_send_eh_cmnd: scsi_eh_completed_normally 2001&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:36 10-180-0-46 kernel: [5387268.731678] scsi_eh_tur: scmd ffff88377bcb56c0 rtn 2001&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:36 10-180-0-46 kernel: [5387268.731742] scsi_eh_done scmd: ffff88377bcb56c0 result: 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:36 10-180-0-46 kernel: [5387268.731747] scsi_send_eh_cmnd: scmd: ffff88377bcb56c0, timeleft: 1250&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:36 10-180-0-46 kernel: [5387268.731748] scsi_send_eh_cmnd: scsi_eh_completed_normally 2002&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:36 10-180-0-46 kernel: [5387268.731750] scsi_eh_tur: scmd ffff88377bcb56c0 rtn 2002&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:36 10-180-0-46 kernel: [5387268.731754] scsi_eh_7: flush retry cmd: ffff88377bcb56c0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:36 10-180-0-46 kernel: [5387268.731761] scsi_eh_7 waking up host to restart&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:36 10-180-0-46 kernel: [5387268.731770] scsi_eh_7: sleeping&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:48 10-180-0-46 kernel: [5387280.735913] sd 7:0:0:0: [sdu] scmd ffff88377bcb56c0 abort scheduled&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:48 10-180-0-46 kernel: [5387280.743906] sd 7:0:0:0: [sdu] aborting command ffff88377bcb56c0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:48 10-180-0-46 kernel: [5387280.744017] sd 7:0:0:0: [sdu] scmd ffff88377bcb56c0 retry aborted command&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:55 10-180-0-46 bash: HISTORY: PID=3642 UID=0 grep &amp;quot;host_no=7 channel=0 id=0 lun=0&amp;quot; trace&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.740380] sd 7:0:0:0: [sdu] scmd ffff88377bcb56c0 previous abort failed&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.740387] Waking error handler thread&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.740391] scsi_eh_7: waking up 0/1/1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.740400] sd 7:0:0:0: scsi_eh_prt_fail_stats: cmds failed: 1, cancel: 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.740405] Total of 1 commands on 1 devices require eh work&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.740408] scsi_eh_7: Sending BDR sdev: 0xffff881fb23ff800&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.740630] scsi_eh_done scmd: ffff88377bcb56c0 result: 2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.740638] scsi_send_eh_cmnd: scmd: ffff88377bcb56c0, timeleft: 1250&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.740642] scsi_send_eh_cmnd: scsi_eh_completed_normally 2001&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.740644] scsi_eh_tur: scmd ffff88377bcb56c0 rtn 2001&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.740716] scsi_eh_done scmd: ffff88377bcb56c0 result: 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.740722] scsi_send_eh_cmnd: scmd: ffff88377bcb56c0, timeleft: 1250&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.740723] scsi_send_eh_cmnd: scsi_eh_completed_normally 2002&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.740727] scsi_eh_tur: scmd ffff88377bcb56c0 rtn 2002&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.740733] scsi_eh_7: flush finish cmd: ffff88377bcb56c0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.740737] sd 7:0:0:0: [sdu] Unhandled error code&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.740739] sd 7:0:0:0: [sdu]  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.740740] Result: hostbyte=DID_ERROR driverbyte=DRIVER_OK&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.740742] sd 7:0:0:0: [sdu] CDB: &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.740747] Write(10): 2a 00 00 32 5e 50 00 00 08 00&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.740755] end_request: I/O error, dev sdu, sector 3300944&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.742331] md/raid1:md127: Disk failure on sdu, disabling device.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.742331] md/raid1:md127: Operation continuing on 1 devices.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.742335] scsi_eh_7 waking up host to restart&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.742343] scsi_eh_7: sleeping&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.745838] RAID1 conf printout:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.745840]  --- wd:1 rd:2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.745842]  disk 0, wo:1, o:0, dev:sdu&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.745843]  disk 1, wo:0, o:1, dev:sdv&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.756382] RAID1 conf printout:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.756384]  --- wd:1 rd:2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.756386]  disk 1, wo:0, o:1, dev:sdv&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x4ECE;trace&amp;#x91CC;&amp;#x770B;&amp;#x5230;scsi&amp;#x547D;&amp;#x4EE4;&amp;#x5728;5387221.071608&amp;#x65F6;&amp;#x95F4;&amp;#x70B9;start&amp;#x4E86;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;5387226.715800&amp;#x8D85;&amp;#x65F6;&amp;#x4E86;&amp;#xFF0C;&amp;#x521A;&amp;#x597D;5s&amp;#x3002;&lt;br&gt;&amp;#x4F46;&amp;#x662F;&amp;#x4ECE;kern&amp;#x7684;log&amp;#x6765;&amp;#x770B;&amp;#xFF0C;&amp;#x662F;5387232.718042&amp;#x624D;&amp;#x6253;&amp;#x51FA;&amp;#x65E5;&amp;#x5FD7;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;trace&amp;#x91CC;&amp;#x7684;&amp;#x7B2C;&amp;#x4E8C;&amp;#x6B21;timeout&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x70B9;&amp;#xFF0C;&amp;#x6BD4;&amp;#x8F83;&amp;#x5947;&amp;#x602A;&amp;#x3002;&amp;#x3002;&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:01:00 10-180-0-46 kernel: [5387232.718042] sd 7:0:0:0: [sdu] scmd ffff88377bcb56c0 abort scheduled&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x80FD;&amp;#x591F;&amp;#x786E;&amp;#x8BA4;&amp;#x7684;&amp;#x4E00;&amp;#x70B9;&amp;#x662F;&amp;#xFF0C;&amp;#x4ECE;trace&amp;#x4FE1;&amp;#x606F;&amp;#x91CC;&amp;#x770B;&amp;#x5230;scsi cmnd&amp;#x91CD;&amp;#x8BD5;&amp;#x4E86;5&amp;#x6B21;&amp;#xFF0C;&amp;#x67E5;&amp;#x9605;&amp;#x5185;&amp;#x6838;&amp;#x4EE3;&amp;#x7801;&amp;#x786E;&amp;#x8BA4;&amp;#x5C31;&amp;#x662F;SD_MAX_RETRIES&amp;#x7684;&amp;#x6B21;&amp;#x6570;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5728;&amp;#x65F6;&amp;#x95F4;&amp;#x70B9;5387292.740369&amp;#x6700;&amp;#x540E;&amp;#x4E00;&amp;#x6B21;timeout&amp;#x3002;&amp;#x521A;&amp;#x597D;&amp;#x8DDF;kern&amp;#x65E5;&amp;#x5FD7;&amp;#x91CC;&amp;#x62A5;io error&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x70B9;&amp;#x543B;&amp;#x5408;&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.740737] sd 7:0:0:0: [sdu] Unhandled error code&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.740739] sd 7:0:0:0: [sdu]  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Jan 17 16:02:00 10-180-0-46 kernel: [5387292.740740] Result: hostbyte=DID_ERROR driverbyte=DRIVER_OK&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x4ECE;scsi&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&amp;#x6765;&amp;#x770B;&amp;#xFF0C;&amp;#x4ECE;5387221.071608&amp;#x8FD9;&amp;#x4E2A;&amp;#x65F6;&amp;#x95F4;&amp;#x70B9;scsi_dispatch_cmd_start&amp;#x5230;&amp;#x6700;&amp;#x540E;&amp;#x4E00;&amp;#x6B21;5387292.740369 scsi_dispatch_cmd_timeout&lt;br&gt;&amp;#x65F6;&amp;#x95F4;&amp;#x5DEE;&amp;#x662F;5387292-5387221=71s&amp;#x3002;&amp;#x8DDF;fio&amp;#x548C;iostat&amp;#x89C2;&amp;#x5BDF;&amp;#x5230;&amp;#x7684;io hang&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x4E00;&amp;#x81F4;&amp;#x3002;&lt;br&gt;&amp;#x6240;&amp;#x4EE5;io hang&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x53EF;&amp;#x4EE5;&amp;#x7B97;&amp;#x51FA;&amp;#x6765;&amp;#x662F;: 2&lt;em&gt;timeout + SD_MAX_RETRIES&lt;/em&gt;(2&lt;em&gt;timeout)&amp;#xFF0C;&amp;#x518D;&amp;#x52A0;&amp;#x4E0A;&amp;#x8D85;&amp;#x65F6;&amp;#x65F6;&amp;#x95F4;1s&amp;#x5185;&amp;#x7684;&amp;#x8BEF;&amp;#x5DEE;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x5C31;&amp;#x8FD8;&amp;#x9700;&amp;#x8981;&amp;#x52A0;&amp;#x4E0A;2&lt;/em&gt;SD_MAX_RETRIES&lt;em&gt;1&amp;#x7684;&amp;#x8BEF;&amp;#x5DEE;&amp;#x65F6;&amp;#x95F4;&amp;#xFF0C;&amp;#x603B;&amp;#x7684;&amp;#x8D85;&amp;#x65F6;&amp;#x65F6;&amp;#x95F4;&amp;#x4E3A;&amp;#xFF1A;&lt;br&gt;2&lt;/em&gt;timeout + SD_MAX_RETRIES&lt;em&gt;(2&lt;/em&gt;timeout) + 2&lt;em&gt;SD_MAX_RETRIES&lt;/em&gt;1&lt;br&gt;&amp;#x6240;&amp;#x4EE5;&amp;#x5F53;timeout&amp;#x8BBE;&amp;#x7F6E;&amp;#x4E3A;5s&amp;#x65F6;&amp;#xFF0C;&amp;#x603B;&amp;#x5171;io hang&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x53EF;&amp;#x4EE5;&amp;#x7B97;&amp;#x51FA;&amp;#x6765;&amp;#x662F;&amp;#xFF1A; 2&lt;em&gt;5 + 5&lt;/em&gt;(2&lt;em&gt;5) + 2&lt;/em&gt;5*1 = 70s&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x671F;&amp;#x95F4;&amp;#x4E3A;&amp;#x4E86;&amp;#x8FDB;&amp;#x4E00;&amp;#x6B65;&amp;#x83B7;&amp;#x53D6;iscsi&amp;#x5185;&amp;#x6838;&amp;#x7684;&amp;#x76F8;&amp;#x5173;&amp;#x65E5;&amp;#x5FD7;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x901A;&amp;#x8FC7;&amp;#x76F8;&amp;#x5173;&amp;#x53C2;&amp;#x6570;&amp;#x8BBE;&amp;#x7F6E;&amp;#xFF1A;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;echo 1 &amp;gt; /sys/module/libiscsi/parameters/debug_libiscsi_conn&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;echo 1 &amp;gt; /sys/module/libiscsi/parameters/debug_libiscsi_eh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;echo 1 &amp;gt; /sys/module/libiscsi/parameters/debug_libiscsi_session&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;echo 1 &amp;gt; /sys/module/libiscsi_tcp/parameters/debug_libiscsi_tcp&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x4E0D;&amp;#x8FC7;&amp;#x6211;&amp;#x4EEC;&amp;#x76EE;&amp;#x524D;&amp;#x53EA;&amp;#x5173;&amp;#x6CE8;&amp;#x9519;&amp;#x8BEF;&amp;#x5904;&amp;#x7406;&amp;#x7684;&amp;#x90E8;&amp;#x5206;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x53EA;&amp;#x7528;&amp;#x5F00;&amp;#x542F;&amp;#x4E00;&amp;#x4E2A;&amp;#xFF1A;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;echo 1 &amp;gt; /sys/module/libiscsi/parameters/debug_libiscsi_eh&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x90A3;&amp;#x4E48;&amp;#x4E0A;&amp;#x9762;&amp;#x4F30;&amp;#x7B97;&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x662F;&amp;#x5426;&amp;#x6B63;&amp;#x786E;&amp;#x5462;&amp;#xFF1F;&amp;#x4E0B;&amp;#x9762;&amp;#x5C31;&amp;#x7ED3;&amp;#x5408;&amp;#x5185;&amp;#x6838;&amp;#x6E90;&amp;#x7801;&amp;#x8FDB;&amp;#x884C;&amp;#x5206;&amp;#x6790;&amp;#x3002;&lt;/p&gt;
&lt;h3 id=&quot;&amp;#x5206;&amp;#x6790;linux&amp;#x5185;&amp;#x6838;scsi&amp;#x547D;&amp;#x4EE4;&amp;#x5904;&amp;#x7406;&amp;#x7684;&amp;#x4EE3;&amp;#x7801;&quot;&gt;&lt;a href=&quot;#&amp;#x5206;&amp;#x6790;linux&amp;#x5185;&amp;#x6838;scsi&amp;#x547D;&amp;#x4EE4;&amp;#x5904;&amp;#x7406;&amp;#x7684;&amp;#x4EE3;&amp;#x7801;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x5206;&amp;#x6790;linux&amp;#x5185;&amp;#x6838;scsi&amp;#x547D;&amp;#x4EE4;&amp;#x5904;&amp;#x7406;&amp;#x7684;&amp;#x4EE3;&amp;#x7801;&quot;&gt;&lt;/a&gt;&amp;#x5206;&amp;#x6790;linux&amp;#x5185;&amp;#x6838;scsi&amp;#x547D;&amp;#x4EE4;&amp;#x5904;&amp;#x7406;&amp;#x7684;&amp;#x4EE3;&amp;#x7801;&lt;/h3&gt;&lt;h4 id=&quot;scsi&amp;#x8BBE;&amp;#x5907;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&quot;&gt;&lt;a href=&quot;#scsi&amp;#x8BBE;&amp;#x5907;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&quot; class=&quot;headerlink&quot; title=&quot;scsi&amp;#x8BBE;&amp;#x5907;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&quot;&gt;&lt;/a&gt;scsi&amp;#x8BBE;&amp;#x5907;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&lt;/h4&gt;&lt;p&gt;&amp;#x5F53;&amp;#x7CFB;&amp;#x7EDF;&amp;#x53D1;&amp;#x73B0;&amp;#x65B0;&amp;#x7684;scsi&amp;#x8BBE;&amp;#x5907;&amp;#xFF0C;&amp;#x4F1A;&amp;#x8FDB;&amp;#x884C;&amp;#x65B0;&amp;#x8BBE;&amp;#x5907;&amp;#x7684;&amp;#x6CE8;&amp;#x518C;&amp;#xFF0C;&amp;#x5176;&amp;#x4E2D;&amp;#x5C31;&amp;#x6D89;&amp;#x53CA;&amp;#x5230;scsi&amp;#x8BBE;&amp;#x5907;&amp;#x7684;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x3002;&amp;#x5728;&amp;#x8FD9;&amp;#x91CC;&amp;#x5C31;&amp;#x6CE8;&amp;#x518C;&amp;#x4E86;&amp;#x8BE5;&amp;#x8BBE;&amp;#x5907;&amp;#x7684;&amp;#x8BF7;&amp;#x6C42;&amp;#x5904;&amp;#x7406;&amp;#x51FD;&amp;#x6570;scsi_request_fn()&amp;#xFF0C;&amp;#x8BF7;&amp;#x6C42;&amp;#x5B8C;&amp;#x6210;&amp;#x51FD;&amp;#x6570;scsi_softirq_done()&amp;#xFF0C;&amp;#x8D85;&amp;#x65F6;&amp;#x5904;&amp;#x7406;&amp;#x51FD;&amp;#x6570;scsi_times_out()&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;scsi_alloc_sdev&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; -&amp;gt;scsi_alloc_queue&amp;#xFF0C;&amp;#x8D4B;&amp;#x503C;&amp;#x7ED9;sdev-&amp;gt;request_queue&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    -&amp;gt;__scsi_alloc_queue(sdev-&amp;gt;host, scsi_request_fn)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       -&amp;gt;blk_init_queue()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         -&amp;gt;blk_init_queue_node()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           -&amp;gt;blk_alloc_queue_node()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             -&amp;gt;setup_timer(&amp;amp;q-&amp;gt;timeout, blk_rq_timed_out_timer, (unsigned long) q)&amp;#x8BBE;&amp;#x7F6E;&amp;#x5B9A;&amp;#x65F6;&amp;#x5668;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    -&amp;gt;blk_queue_prep_rq(q, scsi_prep_fn);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	-&amp;gt;blk_queue_softirq_done(q, scsi_softirq_done);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	-&amp;gt;blk_queue_rq_timed_out(q, scsi_times_out);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	-&amp;gt;blk_queue_lld_busy(q, scsi_lld_busy);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h4 id=&quot;scsi-cmnd&amp;#x8BF7;&amp;#x6C42;&amp;#x4E0B;&amp;#x53D1;&quot;&gt;&lt;a href=&quot;#scsi-cmnd&amp;#x8BF7;&amp;#x6C42;&amp;#x4E0B;&amp;#x53D1;&quot; class=&quot;headerlink&quot; title=&quot;scsi cmnd&amp;#x8BF7;&amp;#x6C42;&amp;#x4E0B;&amp;#x53D1;&quot;&gt;&lt;/a&gt;scsi cmnd&amp;#x8BF7;&amp;#x6C42;&amp;#x4E0B;&amp;#x53D1;&lt;/h4&gt;&lt;p&gt;io&amp;#x5728;&amp;#x5757;&amp;#x5C42;&amp;#x5904;&amp;#x7406;&amp;#x5B8C;&amp;#x6210;&amp;#x540E;&amp;#x4F1A;&amp;#x8C03;&amp;#x7528;q-&amp;gt;request_fn&amp;#x8FDB;&amp;#x884C;&amp;#x5177;&amp;#x4F53;&amp;#x7684;&amp;#x8BBE;&amp;#x5907;&amp;#x9A71;&amp;#x52A8;&amp;#x5C42;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x5BF9;&amp;#x4E8E;scsi&amp;#x8BBE;&amp;#x5907;&amp;#xFF0C;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x5C31;&amp;#x662F;scsi_request_fn&amp;#x5904;&amp;#x7406;&amp;#x51FD;&amp;#x6570;&amp;#x3002;scsi_request_fn&amp;#x8C03;&amp;#x7528;scsi_dipatch_cmd&amp;#xFF0C;&amp;#x7136;&amp;#x540E;hostt-&amp;gt;queuecommand&amp;#x653E;&amp;#x5230;&amp;#x5E95;&amp;#x5C42;&amp;#x9A71;&amp;#x52A8;&amp;#x7684;&amp;#x961F;&amp;#x5217;&amp;#x91CC;&amp;#xFF0C;&amp;#x7531;&amp;#x5E95;&amp;#x5C42;&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;scsi_request_fn&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; -&amp;gt;blk_peek_request&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; -&amp;gt;blk_start_request&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    -&amp;gt;blk_add_timer&amp;#x8BBE;&amp;#x7F6E;&amp;#x8D85;&amp;#x65F6;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; -&amp;gt;scsi_dispatch_cmd&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    -&amp;gt;cmd-&amp;gt;scsi_done = scsi_done&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    -&amp;gt;rtn = host-&amp;gt;hostt-&amp;gt;queuecommand(host, cmd)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h4 id=&quot;scsi-cmnd&amp;#x8BF7;&amp;#x6C42;&amp;#x5B8C;&amp;#x6210;&amp;#x5904;&amp;#x7406;&quot;&gt;&lt;a href=&quot;#scsi-cmnd&amp;#x8BF7;&amp;#x6C42;&amp;#x5B8C;&amp;#x6210;&amp;#x5904;&amp;#x7406;&quot; class=&quot;headerlink&quot; title=&quot;scsi cmnd&amp;#x8BF7;&amp;#x6C42;&amp;#x5B8C;&amp;#x6210;&amp;#x5904;&amp;#x7406;&quot;&gt;&lt;/a&gt;scsi cmnd&amp;#x8BF7;&amp;#x6C42;&amp;#x5B8C;&amp;#x6210;&amp;#x5904;&amp;#x7406;&lt;/h4&gt;&lt;p&gt;&amp;#x5F53;scsi&amp;#x547D;&amp;#x4EE4;&amp;#x7531;&amp;#x5E95;&amp;#x5C42;&amp;#x9A71;&amp;#x52A8;&amp;#x5904;&amp;#x7406;&amp;#x5B8C;&amp;#x6210;&amp;#x540E;&amp;#xFF0C;&amp;#x4F1A;&amp;#x89E6;&amp;#x53D1;&amp;#x8F6F;&amp;#x4E2D;&amp;#x65AD;&amp;#xFF0C;&amp;#x8C03;&amp;#x7528;&amp;#x5BF9;&amp;#x4E8E;&amp;#x7684;&amp;#x8F6F;&amp;#x4E2D;&amp;#x65AD;&amp;#x5904;&amp;#x7406;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;&amp;#x8C03;&amp;#x7528;&amp;#x5230;scsi&amp;#x547D;&amp;#x4EE4;&amp;#x4E00;&amp;#x5F00;&amp;#x59CB;&amp;#x6CE8;&amp;#x518C;&amp;#x7684;&amp;#x5B8C;&amp;#x6210;&amp;#x51FD;&amp;#x6570;scsi_done()&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;scsi_softirq_done()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  is the handler that gets called once the LLD indicates command completed.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  scsi_done()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    -&amp;gt;blk_complete_request()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt;causes softirq&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt;blk_done_softirq()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                -&amp;gt;scsi_softirq_done()&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h4 id=&quot;scsi-cmnd&amp;#x8D85;&amp;#x65F6;&amp;#x7684;&amp;#x8BBE;&amp;#x7F6E;&amp;#x4E0E;&amp;#x5904;&amp;#x7406;&quot;&gt;&lt;a href=&quot;#scsi-cmnd&amp;#x8D85;&amp;#x65F6;&amp;#x7684;&amp;#x8BBE;&amp;#x7F6E;&amp;#x4E0E;&amp;#x5904;&amp;#x7406;&quot; class=&quot;headerlink&quot; title=&quot;scsi cmnd&amp;#x8D85;&amp;#x65F6;&amp;#x7684;&amp;#x8BBE;&amp;#x7F6E;&amp;#x4E0E;&amp;#x5904;&amp;#x7406;&quot;&gt;&lt;/a&gt;scsi cmnd&amp;#x8D85;&amp;#x65F6;&amp;#x7684;&amp;#x8BBE;&amp;#x7F6E;&amp;#x4E0E;&amp;#x5904;&amp;#x7406;&lt;/h4&gt;&lt;p&gt;&amp;#x5728;blk_add_timer&amp;#x91CC;&amp;#x4F1A;&amp;#x8BBE;&amp;#x7F6E;req-&amp;gt;timeout&amp;#xFF08;&amp;#x8D4B;&amp;#x503C;&amp;#x4E3A;q-&amp;gt;rq_timeout&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x503C;&amp;#x662F;&amp;#x5728;sd_probe()&amp;#x91CC;&amp;#x8BBE;&amp;#x7F6E;&amp;#x7684;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;/sys/block/&lt;sdxx&gt;/device/timeout&amp;#x8FD9;&amp;#x4E2A;&amp;#x503C;&amp;#xFF09;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x6DFB;&amp;#x52A0;&amp;#x5230;q-&amp;gt;timeout_list&amp;#xFF0C;&amp;#x7531;&amp;#x5B9A;&amp;#x65F6;&amp;#x5668;&amp;#x5904;&amp;#x7406;&amp;#x51FD;&amp;#x6570;&amp;#x6765;&amp;#x5904;&amp;#x7406;&amp;#x3002;&amp;#x6CE8;&amp;#x610F;&amp;#x8FD9;&amp;#x91CC;&amp;#x91C7;&amp;#x7528;round up to nearest second&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x5B9E;&amp;#x9645;&amp;#x4F1A;&amp;#x53D1;&amp;#x73B0;timeout&amp;#x4F1A;&amp;#x6709;1s&amp;#x5DE6;&amp;#x53F3;&amp;#x7684;&amp;#x8BEF;&amp;#x5DEE;&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;void blk_add_timer(struct request *req)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	struct request_queue *q = req-&amp;gt;q;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	unsigned long expiry;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	if (!q-&amp;gt;rq_timed_out_fn)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		return;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	BUG_ON(!list_empty(&amp;amp;req-&amp;gt;timeout_list));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	/*&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	 * Some LLDs, like scsi, peek at the timeout to prevent a&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	 * command from being retried forever.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	 */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	if (!req-&amp;gt;timeout)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		req-&amp;gt;timeout = q-&amp;gt;rq_timeout;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	req-&amp;gt;deadline = jiffies + req-&amp;gt;timeout;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	list_add_tail(&amp;amp;req-&amp;gt;timeout_list, &amp;amp;q-&amp;gt;timeout_list);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	/*&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	 * If the timer isn&amp;apos;t already pending or this timeout is earlier&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	 * than an existing one, modify the timer. Round up to next nearest&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	 * second.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	 */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	/* &amp;#x6CE8;&amp;#x610F;&amp;#x8FD9;&amp;#x91CC;&amp;#x91C7;&amp;#x7528;round up to nearest second&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x5B9E;&amp;#x9645;&amp;#x4F1A;&amp;#x53D1;&amp;#x73B0;timeout&amp;#x4F1A;&amp;#x6709;1s&amp;#x5DE6;&amp;#x53F3;&amp;#x7684;&amp;#x8BEF;&amp;#x5DEE; */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	expiry = round_jiffies_up(req-&amp;gt;deadline);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	if (!timer_pending(&amp;amp;q-&amp;gt;timeout) ||&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	    time_before(expiry, q-&amp;gt;timeout.expires))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		mod_timer(&amp;amp;q-&amp;gt;timeout, expiry);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/sdxx&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x5728;blk_alloc_queue_node&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x65F6;&amp;#x5C31;&amp;#x8C03;&amp;#x7528;setup_timer&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x4E86;&amp;#x4E00;&amp;#x4E2A;&amp;#x5B9A;&amp;#x65F6;&amp;#x5668;&amp;#xFF08;&amp;#x5BF9;&amp;#x5E94;&amp;#x8D85;&amp;#x65F6;&amp;#x5904;&amp;#x7406;&amp;#x51FD;&amp;#x6570;&amp;#x4E3A;blk_rq_timed_out_timer&amp;#xFF09;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x4E86;q-&amp;gt;timeout_list&amp;#x961F;&amp;#x5217;&amp;#xFF0C;&amp;#x5F53;&amp;#x8D85;&amp;#x65F6;&amp;#x540E;&amp;#x5C31;&amp;#x4F1A;&amp;#x904D;&amp;#x5386;q-&amp;gt;timeout_list&amp;#xFF0C;&amp;#x4ECE;&amp;#x4E2D;&amp;#x53D6;&amp;#x51FA;req&amp;#x8FDB;&amp;#x884C;&amp;#x8D85;&amp;#x65F6;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;void blk_rq_timed_out_timer(unsigned long data)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	struct request_queue *q = (struct request_queue *) data;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	unsigned long flags, next = 0;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	struct request *rq, *tmp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	int next_set = 0;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	spin_lock_irqsave(q-&amp;gt;queue_lock, flags);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	list_for_each_entry_safe(rq, tmp, &amp;amp;q-&amp;gt;timeout_list, timeout_list) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		if (time_after_eq(jiffies, rq-&amp;gt;deadline)) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			list_del_init(&amp;amp;rq-&amp;gt;timeout_list);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			/*&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			 * Check if we raced with end io completion&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			 */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			if (blk_mark_rq_complete(rq))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				continue;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			blk_rq_timed_out(rq);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		} else if (!next_set || time_after(next, rq-&amp;gt;deadline)) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			next = rq-&amp;gt;deadline;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			next_set = 1;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	if (next_set)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		mod_timer(&amp;amp;q-&amp;gt;timeout, round_jiffies_up(next));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	spin_unlock_irqrestore(q-&amp;gt;queue_lock, flags);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;blk_rq_timed_out_timer&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; -&amp;gt;blk_rq_timed_out&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    -&amp;gt;q-&amp;gt;rq_timed_out_fn&amp;#xFF0C;&amp;#x5373;scsi_times_out&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       -&amp;gt;scsi_times_out&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          -&amp;gt;scsi_eh_scmd_add&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             -&amp;gt;scsi_eh_wakeup&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                -&amp;gt;wake_up_process(shost-&amp;gt;ehandler)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&amp;#x56E0;&amp;#x4E3A;&amp;#x4ECE;&amp;#x5B9E;&amp;#x9645;&amp;#x6D4B;&amp;#x8BD5;&amp;#x65F6;&amp;#x89C2;&amp;#x5BDF;&amp;#x5230;&amp;#x662F;&amp;#x8FC7;&amp;#x4E86;&amp;#x4E24;&amp;#x6B21;&amp;#x8D85;&amp;#x65F6;&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x624D;&amp;#x5F00;&amp;#x59CB;&amp;#x91CD;&amp;#x8BD5;&amp;#xFF0C;&amp;#x5230;&amp;#x4E0B;&amp;#x4E00;&amp;#x6B21;&amp;#x91CD;&amp;#x8BD5;&amp;#x4E5F;&amp;#x662F;&amp;#x9694;&amp;#x4E86;&amp;#x4E24;&amp;#x500D;&amp;#x8D85;&amp;#x65F6;&amp;#x65F6;&amp;#x95F4;&amp;#xFF0C;&amp;#x56E0;&amp;#x6B64;&amp;#x91CD;&amp;#x70B9;&amp;#x67E5;&amp;#x770B;scsi_times_out&amp;#x7684;&amp;#x903B;&amp;#x8F91;&amp;#xFF0C;&amp;#x53D1;&amp;#x73B0;&amp;#x5728;&amp;#x8C03;&amp;#x7528;scsi_eh_scmd_add&amp;#x4E4B;&amp;#x524D;&amp;#x662F;&amp;#x5224;&amp;#x65AD;&amp;#x4E86;host-&amp;gt;transportt-&amp;gt;eh_timed_out(scmd)&amp;#x7684;&amp;#x8FD4;&amp;#x56DE;&amp;#x503C;&amp;#x662F;&amp;#x5426;&amp;#x4E3A;BLK_EH_NOT_HANDLED&amp;#x3002;&lt;br&gt;&amp;#x5BF9;&amp;#x4E8E;iscsi&amp;#x6765;&amp;#x8BF4;&amp;#xFF0C;eh_timed_out&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x51FD;&amp;#x6570;&amp;#x662F;iscsi_eh_cmd_timed_out&amp;#xFF0C;&amp;#x5F53;iscsi_eh_cmd_timed_out&amp;#x8FD4;&amp;#x56DE;BLK_EH_RESET_TIMER&amp;#x65F6;&amp;#xFF0C;&amp;#x5BF9;&amp;#x5E94;blk_rq_timed_out&amp;#x91CC;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x662F;&amp;#x7EE7;&amp;#x7EED;&amp;#x52A0;&amp;#x5165;&amp;#x5B9A;&amp;#x65F6;&amp;#x5668;&amp;#x4E2D;&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;enum blk_eh_timer_return scsi_times_out(struct request *req)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	struct scsi_cmnd *scmd = req-&amp;gt;special;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	enum blk_eh_timer_return rtn = BLK_EH_NOT_HANDLED;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	struct Scsi_Host *host = scmd-&amp;gt;device-&amp;gt;host;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	trace_scsi_dispatch_cmd_timeout(scmd);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	scsi_log_completion(scmd, TIMEOUT_ERROR);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	if (host-&amp;gt;transportt-&amp;gt;eh_timed_out)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		rtn = host-&amp;gt;transportt-&amp;gt;eh_timed_out(scmd);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	else if (host-&amp;gt;hostt-&amp;gt;eh_timed_out)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		rtn = host-&amp;gt;hostt-&amp;gt;eh_timed_out(scmd);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	scmd-&amp;gt;result |= DID_TIME_OUT &amp;lt;&amp;lt; 16;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // &amp;#x8FD9;&amp;#x91CC;&amp;#x662F;&amp;#x5F53;rtn== BLK_EH_NOT_HANDLED&amp;#x624D;&amp;#x4F1A;&amp;#x7EE7;&amp;#x7EED;&amp;#x8C03;&amp;#x7528;scsi_eh_scmd_add&amp;#x53BB;&amp;#x5524;&amp;#x9192;error handle&amp;#x5904;&amp;#x7406;&amp;#x7EBF;&amp;#x7A0B;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	if (unlikely(rtn == BLK_EH_NOT_HANDLED &amp;amp;&amp;amp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		     !scsi_eh_scmd_add(scmd, SCSI_EH_CANCEL_CMD)))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		rtn = BLK_EH_HANDLED;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	return rtn;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x662F;&amp;#x6BCF;&amp;#x6B21;&amp;#x7ECF;&amp;#x8FC7;2&amp;#x4E2A;timeout&amp;#x624D;&amp;#x5F00;&amp;#x59CB;&amp;#x91CD;&amp;#x8BD5;&amp;#xFF0C;&amp;#x67E5;&amp;#x770B;&amp;#x5185;&amp;#x6838;&amp;#x4EE3;&amp;#x7801;&amp;#x540E;&amp;#x786E;&amp;#x8BA4;&amp;#x662F;&amp;#x7531;&amp;#x4E8E;iscsi&amp;#x8BBE;&amp;#x5907;&amp;#xFF0C;&amp;#x5728;scsi&amp;#x7684;&amp;#x8D85;&amp;#x65F6;&amp;#x5904;&amp;#x7406;&amp;#x51FD;&amp;#x6570;scsi_times_out&amp;#x4E2D;&amp;#xFF0C;&amp;#x8C03;&amp;#x7528;iscsi&amp;#x7684;iscsi_eh_cmd_timed_out&amp;#x65F6;&amp;#x7B2C;&amp;#x4E00;&amp;#x6B21;&amp;#x68C0;&amp;#x6D4B;&amp;#x5230;&amp;#x4E0D;&amp;#x6EE1;&amp;#x8DB3;&amp;#x5524;&amp;#x9192;scsi&amp;#x7684;error handler&amp;#x7EBF;&amp;#x7A0B;&amp;#x7684;&amp;#x6761;&amp;#x4EF6;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x53C8;&amp;#x52A0;&amp;#x5165;&amp;#x4E86;&amp;#x4E00;&amp;#x6B21;&amp;#x5B9A;&amp;#x65F6;&amp;#x5668;&amp;#x8FDB;&amp;#x884C;&amp;#x7B49;&amp;#x5F85;&amp;#xFF0C;&amp;#x5230;&amp;#x7B2C;&amp;#x4E8C;&amp;#x6B21;&amp;#x8D85;&amp;#x65F6;&amp;#x540E;&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#x624D;&amp;#x6EE1;&amp;#x8DB3;&amp;#x5524;&amp;#x9192;scsi_eh&amp;#x7684;&amp;#x6761;&amp;#x4EF6;&amp;#x3002;&amp;#x56E0;&amp;#x6B64;&amp;#x6BCF;&amp;#x6B21;&amp;#x90FD;&amp;#x662F;&amp;#x7ECF;&amp;#x8FC7;&amp;#x4E86;2&amp;#x6B21;timeout&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x624D;&amp;#x8FDB;&amp;#x884C;&amp;#x7684;&amp;#x91CD;&amp;#x8BD5;&amp;#x3002;&lt;/p&gt;
&lt;h4 id=&quot;&amp;#x91CD;&amp;#x8BD5;&amp;#x6B21;&amp;#x6570;&amp;#x7684;&amp;#x786E;&amp;#x5B9A;&quot;&gt;&lt;a href=&quot;#&amp;#x91CD;&amp;#x8BD5;&amp;#x6B21;&amp;#x6570;&amp;#x7684;&amp;#x786E;&amp;#x5B9A;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x91CD;&amp;#x8BD5;&amp;#x6B21;&amp;#x6570;&amp;#x7684;&amp;#x786E;&amp;#x5B9A;&quot;&gt;&lt;/a&gt;&amp;#x91CD;&amp;#x8BD5;&amp;#x6B21;&amp;#x6570;&amp;#x7684;&amp;#x786E;&amp;#x5B9A;&lt;/h4&gt;&lt;p&gt;&amp;#x4E0B;&amp;#x9762;&amp;#x5148;&amp;#x5217;&amp;#x4E00;&amp;#x4E0B;scsi error handler&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x6D41;&amp;#x7A0B;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;scsi_error_handler&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; -&amp;gt;scsi_unjam_host&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    -&amp;gt;scsi_eh_prt_fail_stats&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    -&amp;gt;scsi_eh_get_sense&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       -&amp;gt;scsi_request_sense&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          -&amp;gt;scsi_send_eh_cmnd&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             -&amp;gt;scmd-&amp;gt;scsi_done = scsi_eh_done&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    -&amp;gt;scsi_eh_abort_cmds&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       -&amp;gt;scsi_try_to_abort_cmd&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          -&amp;gt;hostt-&amp;gt;eh_abort_handler&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#x5BF9;iscsi&amp;#x6765;&amp;#x8BF4;&amp;#x5C31;&amp;#x662F;iscsi_eh_abort&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt;iscsi_exec_task_mgmt_fn&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    -&amp;gt;scsi_eh_flush_done_q&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x5728;scsi_eh_flush_done_q&amp;#x91CC;&amp;#x8FDB;&amp;#x884C;&amp;#x7684;&amp;#x91CD;&amp;#x8BD5;&amp;#x6B21;&amp;#x6570;&amp;#x7684;&amp;#x5224;&amp;#x65AD;&amp;#xFF0C;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x91CD;&amp;#x8BD5;&amp;#x6B21;&amp;#x6570;&amp;#x5C31;&amp;#x662F;SD_MAX_RETRIES&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;void scsi_eh_flush_done_q(struct list_head *done_q)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	struct scsi_cmnd *scmd, *next;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	list_for_each_entry_safe(scmd, next, done_q, eh_entry) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		list_del_init(&amp;amp;scmd-&amp;gt;eh_entry);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		if (scsi_device_online(scmd-&amp;gt;device) &amp;amp;&amp;amp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		    !scsi_noretry_cmd(scmd) &amp;amp;&amp;amp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		    (++scmd-&amp;gt;retries &amp;lt;= scmd-&amp;gt;allowed)) {  //&amp;#x8FD9;&amp;#x91CC;&amp;#x5224;&amp;#x65AD;&amp;#x4E86;&amp;#x91CD;&amp;#x8BD5;&amp;#x6B21;&amp;#x6570;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			SCSI_LOG_ERROR_RECOVERY(3, printk(&amp;quot;%s: flush&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;							  &amp;quot; retry cmd: %p\n&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;							  current-&amp;gt;comm,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;							  scmd));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				scsi_queue_insert(scmd, SCSI_MLQUEUE_EH_RETRY);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		} else {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			/*&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			 * If just we got sense for the device (called&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			 * scsi_eh_get_sense), scmd-&amp;gt;result is already&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			 * set, do not set DRIVER_TIMEOUT.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			 */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			if (!scmd-&amp;gt;result)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				scmd-&amp;gt;result |= (DRIVER_TIMEOUT &amp;lt;&amp;lt; 24);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			SCSI_LOG_ERROR_RECOVERY(3, printk(&amp;quot;%s: flush finish&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;							&amp;quot; cmd: %p\n&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;							current-&amp;gt;comm, scmd));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			scsi_finish_command(scmd);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&quot;&amp;#x5C0F;&amp;#x7ED3;&quot;&gt;&lt;a href=&quot;#&amp;#x5C0F;&amp;#x7ED3;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x5C0F;&amp;#x7ED3;&quot;&gt;&lt;/a&gt;&amp;#x5C0F;&amp;#x7ED3;&lt;/h2&gt;&lt;p&gt;&amp;#x4ECE;&amp;#x4E0A;&amp;#x9762;&amp;#x7684;&amp;#x5206;&amp;#x6790;&amp;#x53EF;&amp;#x4EE5;&amp;#x5F97;&amp;#x51FA;&amp;#xFF0C;io hang&amp;#x7684;&amp;#x6839;&amp;#x672C;&amp;#x539F;&amp;#x56E0;&amp;#x662F;scsi&amp;#x5C42;&amp;#x7684;&amp;#x547D;&amp;#x4EE4;&amp;#x5904;&amp;#x7406;&amp;#x7684;&amp;#x8D85;&amp;#x65F6;&amp;#x548C;&amp;#x91CD;&amp;#x8BD5;&amp;#x5BFC;&amp;#x81F4;&amp;#x7684;&amp;#x3002;&lt;br&gt;&amp;#x5E76;&amp;#x4E14;io hang&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x53EF;&amp;#x4EE5;&amp;#x7B97;&amp;#x51FA;&amp;#x6765;&amp;#x662F;: 2&lt;em&gt;timeout + SD_MAX_RETRIES&lt;/em&gt;(2&lt;em&gt;timeout)&amp;#xFF0C;&amp;#x518D;&amp;#x52A0;&amp;#x4E0A;&amp;#x8D85;&amp;#x65F6;&amp;#x8BA1;&amp;#x65F6;&amp;#x5668;&amp;#x65F6;&amp;#x95F4;1s&amp;#x5DE6;&amp;#x53F3;&amp;#x7684;&amp;#x8BEF;&amp;#x5DEE;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x5C31;&amp;#x8FD8;&amp;#x9700;&amp;#x8981;&amp;#x52A0;&amp;#x4E0A;2&lt;/em&gt;SD_MAX_RETRIES*1&amp;#x7684;&amp;#x8BEF;&amp;#x5DEE;&amp;#x65F6;&amp;#x95F4;&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;io hang&amp;#x7684;&amp;#x65F6;&amp;#x95F4;=2*timeout + SD_MAX_RETRIES*(2*timeout) + 2*SD_MAX_RETRIES*1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;#x8FD1;&amp;#x671F;&amp;#x7EBF;&amp;#x4E0A;&amp;#x7CFB;&amp;#x7EDF;&amp;#x51FA;&amp;#x73B0;&amp;#x574F;&amp;#x76D8;&amp;#x5BFC;&amp;#x81F4;IO&amp;#x5361;&amp;#x4F4F;&amp;#x7684;&amp;#x95EE;&amp;#x9898;&amp;#xFF0C;&amp;#x6709;&amp;#x4E24;&amp;#x79CD;&amp;#x60C5;&amp;#x51B5;&amp;#xFF1A;&lt;/p&gt;
&lt;p&gt;1&amp;#xFF09;&amp;#x4E00;&amp;#x79CD;&amp;#x662F;&amp;#x51FA;&amp;#x73B0;&amp;#x574F;&amp;#x76D8;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;raid&amp;#x5361;&amp;#x7684;&amp;#x884C;&amp;#x4E3A;&amp;#x6709;&amp;#x6240;&amp;#x5F02;&amp;#x5E38;&amp;#xFF0C;&amp;#x5728;&amp;#x8FD9;&amp;#x53F0;&amp;#x673A;&amp;#x5668;&amp;#x4E0A;&amp;#x7684;&amp;#x6267;&amp;#x884C;raid&amp;#x5361;&amp;#x7684;&amp;#x547D;&amp;#x4EE4;megacli&amp;#x90FD;&amp;#x5361;&amp;#x4F4F;&amp;#xFF0C;&amp;#x89C2;&amp;#x5BDF;&amp;#x5230;&amp;#x8FD9;&amp;#x53F0;&amp;#x673A;&amp;#x5668;&amp;#x4E0A;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x76D8;&amp;#x7684;io&amp;#x90FD;&amp;#x65F6;&amp;#x4E0D;&amp;#x65F6;&amp;#x5F02;&amp;#x5E38;&amp;#x7E41;&amp;#x5FD9;&amp;#xFF08;io&amp;#x4E0D;&amp;#x5927;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;svctm&amp;#x751A;&amp;#x81F3;&amp;#x8FBE;&amp;#x5230;&amp;#x51E0;&amp;#x5343;ms&amp;#xFF09;&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;&amp;#x5BFC;&amp;#x81F4;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;&amp;#x5757;&amp;#x5B58;&amp;#x50A8;&amp;#x7684;&amp;#x5377;IO hang&amp;#x4F4F;&amp;#xFF0C;&amp;#x8868;&amp;#x73B0;&amp;#x5C31;&amp;#x662F;&amp;#x7528;&amp;#x6237;&amp;#x7684;&amp;#x5377;io util 100%&amp;#x8F83;&amp;#x957F;&amp;#x65F6;&amp;#x95F4;&amp;#xFF1B;&lt;/p&gt;
&lt;p&gt;2&amp;#xFF09;&amp;#x53E6;&amp;#x5916;&amp;#x4E00;&amp;#x79CD;&amp;#x60C5;&amp;#x51B5;&amp;#x662F;&amp;#x574F;&amp;#x76D8;&amp;#x540E;&amp;#xFF0C;&amp;#x5C06;&amp;#x574F;&amp;#x76D8;&amp;#x4ECE;raid&amp;#x5361;&amp;#x4E2D;&amp;#x5254;&amp;#x9664;&amp;#xFF08;&amp;#x505A;&amp;#x7684;&amp;#x5355;&amp;#x76D8;raid0&amp;#xFF0C;&amp;#x9ED8;&amp;#x8BA4;WB&amp;#x7F13;&amp;#x5B58;&amp;#x7B56;&amp;#x7565;&amp;#xFF0C;&amp;#x76D8;&amp;#x574F;&amp;#x540E;&amp;#x9700;&amp;#x8981;&amp;#x4ECE;raid&amp;#x5361;&amp;#x91CC;&amp;#x5220;&amp;#x9664;&amp;#x903B;&amp;#x8F91;&amp;#x5377;&amp;#xFF09;&amp;#xFF0C;&amp;#x8FD9;&amp;#x53F0;&amp;#x673A;&amp;#x5668;&amp;#x4E0A;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x76D8;&amp;#x90FD;io&amp;#x5361;&amp;#x4F4F;&amp;#x4E00;&amp;#x4F1A;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;megacli&amp;#x547D;&amp;#x4EE4;&amp;#x4E5F;&amp;#x5361;&amp;#x4F4F;&amp;#x3002;&amp;#x4ECE;&amp;#x800C;&amp;#x4E5F;&amp;#x5BFC;&amp;#x81F4;&amp;#x90E8;&amp;#x5206;&amp;#x7528;&amp;#x6237;&amp;#x7684;&amp;#x5377;io util 100%&amp;#x8F83;&amp;#x957F;&amp;#x65F6;&amp;#x95F4;&amp;#xFF1B;&lt;/p&gt;
&lt;p&gt;&amp;#x60C5;&amp;#x51B5;1&amp;#xFF09;&amp;#x901A;&amp;#x8FC7;&amp;#x6536;&amp;#x96C6;&amp;#x65E5;&amp;#x5FD7;&amp;#x53CD;&amp;#x9988;&amp;#x7ED9;&amp;#x5382;&amp;#x5BB6;&amp;#x786E;&amp;#x8BA4;&amp;#x662F;&amp;#x7531;&amp;#x4E8E;&amp;#x7EBF;&amp;#x4E0A;&amp;#x673A;&amp;#x5668;&amp;#x7684;raid&amp;#x5361;&amp;#x7684;&amp;#x56FA;&amp;#x4EF6;&amp;#x7248;&amp;#x672C;&amp;#x6BD4;&amp;#x8F83;&amp;#x4F4E;&amp;#xFF0C;&amp;#x9700;&amp;#x8981;&amp;#x5347;&amp;#x7EA7;raid&amp;#x5361;&amp;#x56FA;&amp;#x4EF6;&amp;#xFF1B;&lt;br&gt;&amp;#x60C5;&amp;#x51B5;2&amp;#xFF09;&amp;#x56E0;&amp;#x4E3A;&amp;#x574F;&amp;#x76D8;&amp;#x540E;&amp;#xFF0C;raid&amp;#x5361;&amp;#x5C31;&amp;#x8FDB;&amp;#x5165;&amp;#x4FDD;&amp;#x62A4;&amp;#x6A21;&amp;#x5F0F;&amp;#xFF0C;&amp;#x7269;&amp;#x7406;&amp;#x76D8;&amp;#x7684;&amp;#x7F13;&amp;#x5B58;&amp;#x7B56;&amp;#x7565;&amp;#x90FD;&amp;#x4ECE;writeback&amp;#x53D8;&amp;#x6210;writethrough&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5254;&amp;#x9664;&amp;#x574F;&amp;#x76D8;&amp;#x65F6;&amp;#xFF0C;&amp;#x5C31;&amp;#x4F1A;&amp;#x5C06;raid&amp;#x5361;&amp;#x7F13;&amp;#x5B58;&amp;#x91CC;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x8FDB;&amp;#x884C;&amp;#x56DE;&amp;#x5237;&amp;#x5230;&amp;#x78C1;&amp;#x76D8;&amp;#x4E0A;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#x662F;&amp;#x4F1A;&amp;#x6709;&amp;#x77ED;&amp;#x65F6;&amp;#x95F4;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x76D8;io&amp;#x5361;&amp;#x4F4F;&amp;#xFF1B;&lt;/p&gt;
&lt;p&gt;&amp;#x4E0A;&amp;#x9762;&amp;#x4E24;&amp;#x79CD;&amp;#x60C5;&amp;#x51B5;&amp;#xFF0C;&amp;#x7269;&amp;#x7406;&amp;#x76D8;&amp;#x7684;io&amp;#x5361;&amp;#x4F4F;&amp;#x90FD;&amp;#x5728;1&amp;#x5206;&amp;#x949F;&amp;#x5185;&amp;#xFF0C;&amp;#x53EF;&amp;#x662F;&amp;#x4ECE;&amp;#x7528;&amp;#x6237;&amp;#x53CD;&amp;#x9988;&amp;#x6765;&amp;#x770B;&amp;#x7528;&amp;#x6237;&amp;#x5377;&amp;#x7684;io&amp;#x5361;&amp;#x4E86;&amp;#x597D;&amp;#x51E0;&amp;#x5206;&amp;#x949F;&amp;#xFF0C;&amp;#x6BD4;&amp;#x7269;&amp;#x7406;&amp;#x76D8;&amp;#x5361;&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x957F;&amp;#x4E0D;&amp;#x5C11;&amp;#x3002;&amp;#x53E6;&amp;#x5916;&amp;#xFF0C;&amp;#x6211;&amp;#x4EEC;&amp;#x8FD9;&amp;#x4E2A;&amp;#x7EBF;&amp;#x4E0A;&amp;#x73AF;&amp;#x5883;&amp;#x7684;&amp;#x5757;&amp;#x5B58;&amp;#x50A8;&amp;#x91C7;&amp;#x7528;&amp;#x7684;2&amp;#x526F;&amp;#x672C;&amp;#xFF0C;&amp;#x6709;&amp;#x4E9B;&amp;#x5377;&amp;#x7684;&amp;#x5176;&amp;#x4E2D;&amp;#x4E00;&amp;#x4E2A;&amp;#x526F;&amp;#x672C;&amp;#x843D;&amp;#x5728;&amp;#x574F;&amp;#x76D8;&amp;#x7684;&amp;#x673A;&amp;#x5668;&amp;#x4E0A;&amp;#xFF0C;&amp;#x5361;&amp;#x4E86;&amp;#x8FD9;&amp;#x4E48;&amp;#x4E45;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x6CA1;&amp;#x6709;&amp;#x526F;&amp;#x672C;&amp;#x964D;&amp;#x7EA7;&amp;#x3002;&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="storage" scheme="http://yoursite.com/categories/storage/"/>
    
    
      <category term="kernel" scheme="http://yoursite.com/tags/kernel/"/>
    
      <category term="scsi" scheme="http://yoursite.com/tags/scsi/"/>
    
  </entry>
  
  <entry>
    <title>ceph中对象读写的顺序性及并发性保证</title>
    <link href="http://yoursite.com/2016/08/29/ceph-io-sequence/"/>
    <id>http://yoursite.com/2016/08/29/ceph-io-sequence/</id>
    <published>2016-08-29T11:54:23.000Z</published>
    <updated>2016-08-29T12:06:00.239Z</updated>
    
    <content type="html">&lt;p&gt;&amp;#x5206;&amp;#x5E03;&amp;#x5F0F;&amp;#x7CFB;&amp;#x7EDF;&amp;#x4E2D;&amp;#x7ECF;&amp;#x5E38;&amp;#x9700;&amp;#x8981;&amp;#x8003;&amp;#x8651;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF08;&amp;#x6216;&amp;#x8005;&amp;#x8BB0;&amp;#x5F55;&amp;#x3001;&amp;#x6587;&amp;#x4EF6;&amp;#x3001;&amp;#x6570;&amp;#x636E;&amp;#x5757;&amp;#x7B49;&amp;#xFF09;&amp;#x7684;&amp;#x8BFB;&amp;#x5199;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x4EE5;&amp;#x53CA;&amp;#x5E76;&amp;#x53D1;&amp;#x8BBF;&amp;#x95EE;&amp;#x95EE;&amp;#x9898;&amp;#x3002;&amp;#x901A;&amp;#x5E38;&amp;#x6765;&amp;#x8BF4;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x4E24;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x6CA1;&amp;#x6709;&amp;#x5171;&amp;#x4EAB;&amp;#x7684;&amp;#x8D44;&amp;#x6E90;&amp;#xFF0C;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x8FDB;&amp;#x884C;&amp;#x5E76;&amp;#x53D1;&amp;#x7684;&amp;#x8BBF;&amp;#x95EE;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x6709;&amp;#x5171;&amp;#x4EAB;&amp;#x7684;&amp;#x90E8;&amp;#x5206;&amp;#xFF0C;&amp;#x5C31;&amp;#x9700;&amp;#x8981;&amp;#x5BF9;&amp;#x8FD9;&amp;#x90E8;&amp;#x5206;&amp;#x8D44;&amp;#x6E90;&amp;#x8FDB;&amp;#x884C;&amp;#x52A0;&amp;#x9501;&amp;#xFF1B;&amp;#x800C;&amp;#x5BF9;&amp;#x4E8E;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x5E76;&amp;#x53D1;&amp;#x8BFB;&amp;#x5199;&amp;#xFF08;&amp;#x5C24;&amp;#x5176;&amp;#x662F;&amp;#x5E76;&amp;#x53D1;&amp;#x5199;&amp;#x66F4;&amp;#x65B0;&amp;#x65F6;&amp;#xFF09;&amp;#xFF0C;&amp;#x5C31;&amp;#x9700;&amp;#x8981;&amp;#x6CE8;&amp;#x610F;&amp;#x987A;&amp;#x5E8F;&amp;#x6027;&amp;#x4EE5;&amp;#x53CA;&amp;#x5E76;&amp;#x53D1;&amp;#x8BBF;&amp;#x95EE;&amp;#x7684;&amp;#x63A7;&amp;#x5236;&amp;#xFF0C;&amp;#x4EE5;&amp;#x514D;&amp;#x6570;&amp;#x636E;&amp;#x9519;&amp;#x4E71;&amp;#x3002;&amp;#x672C;&amp;#x6587;&amp;#x4E3B;&amp;#x8981;&amp;#x5BF9;ceph&amp;#x4E2D;&amp;#x5BF9;&amp;#x8C61;&amp;#x8BFB;&amp;#x5199;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x53CA;&amp;#x5E76;&amp;#x53D1;&amp;#x6027;&amp;#x4FDD;&amp;#x8BC1;&amp;#x673A;&amp;#x5236;&amp;#x8FDB;&amp;#x884C;&amp;#x4ECB;&amp;#x7ECD;&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;PG&amp;#x7684;&amp;#x6982;&amp;#x5FF5;&quot;&gt;&lt;a href=&quot;#PG&amp;#x7684;&amp;#x6982;&amp;#x5FF5;&quot; class=&quot;headerlink&quot; title=&quot;PG&amp;#x7684;&amp;#x6982;&amp;#x5FF5;&quot;&gt;&lt;/a&gt;PG&amp;#x7684;&amp;#x6982;&amp;#x5FF5;&lt;/h1&gt;&lt;p&gt;ceph&amp;#x4E2D;&amp;#x5F15;&amp;#x5165;PG&amp;#xFF08;Placement Group&amp;#xFF09;&amp;#x7684;&amp;#x6982;&amp;#x5FF5;&amp;#xFF0C;&amp;#x8FD9;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x903B;&amp;#x8F91;&amp;#x4E0A;&amp;#x7684;&amp;#x7EC4;&amp;#xFF0C;&amp;#x901A;&amp;#x8FC7;crush&amp;#x7B97;&amp;#x6CD5;&amp;#x6620;&amp;#x5C04;&amp;#x5230;&amp;#x4E00;&amp;#x7EC4;OSD&amp;#x4E0A;&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;PG&amp;#x91CC;&amp;#x5305;&amp;#x542B;&amp;#x5B8C;&amp;#x6574;&amp;#x7684;&amp;#x526F;&amp;#x672C;&amp;#x5173;&amp;#x7CFB;&amp;#xFF0C;&amp;#x6BD4;&amp;#x5982;3&amp;#x4E2A;&amp;#x6570;&amp;#x636E;&amp;#x526F;&amp;#x672C;&amp;#x5206;&amp;#x5E03;&amp;#x5230;&amp;#x4E00;&amp;#x4E2A;PG&amp;#x91CC;&amp;#x7684;3&amp;#x4E2A;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;OSD&amp;#x4E0A;&amp;#x3002;&amp;#x4E0B;&amp;#x9762;&amp;#x5F15;&amp;#x7528;ceph&amp;#x8BBA;&amp;#x6587;&amp;#x4E2D;&amp;#x7684;&amp;#x4E00;&amp;#x5F20;&amp;#x56FE;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x6BD4;&amp;#x8F83;&amp;#x76F4;&amp;#x89C2;&amp;#x7684;&amp;#x7406;&amp;#x89E3;&amp;#x4E86;&amp;#x3002;&amp;#x5C06;&amp;#x6587;&amp;#x4EF6;&amp;#x6309;&amp;#x7167;&amp;#x6307;&amp;#x5B9A;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x5927;&amp;#x5C0F;&amp;#x5206;&amp;#x5272;&amp;#x6210;&amp;#x591A;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x6839;&amp;#x636E;hash&amp;#x6620;&amp;#x5C04;&amp;#x5230;&amp;#x67D0;&amp;#x4E2A;pg&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x518D;&amp;#x6839;&amp;#x636E;crush&amp;#x7B97;&amp;#x6CD5;&amp;#x6620;&amp;#x5C04;&amp;#x5230;&amp;#x540E;&amp;#x7AEF;&amp;#x7684;&amp;#x67D0;&amp;#x51E0;&amp;#x4E2A;osd&amp;#x4E0A;&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2016/08/29/ceph-io-sequence/pg.png&quot; alt=&quot;ceph-io-sequence&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;&amp;#x4E0D;&amp;#x540C;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x5E76;&amp;#x53D1;&amp;#x63A7;&amp;#x5236;&quot;&gt;&lt;a href=&quot;#&amp;#x4E0D;&amp;#x540C;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x5E76;&amp;#x53D1;&amp;#x63A7;&amp;#x5236;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x4E0D;&amp;#x540C;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x5E76;&amp;#x53D1;&amp;#x63A7;&amp;#x5236;&quot;&gt;&lt;/a&gt;&amp;#x4E0D;&amp;#x540C;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x5E76;&amp;#x53D1;&amp;#x63A7;&amp;#x5236;&lt;/h1&gt;&lt;p&gt;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x6709;&amp;#x53EF;&amp;#x80FD;&amp;#x843D;&amp;#x5230;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;pg&amp;#x91CC;&amp;#xFF0C;ceph&amp;#x5B9E;&amp;#x73B0;&amp;#x91CC;&amp;#xFF0C;&amp;#x5728;OSD&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x7EBF;&amp;#x7A0B;&amp;#x4E2D;&amp;#x5C31;&amp;#x4F1A;&amp;#x7ED9;PG&amp;#x52A0;&amp;#x9501;&amp;#xFF0C;&amp;#x4E00;&amp;#x76F4;&amp;#x5230;queue_transactions&amp;#x91CC;&amp;#x628A;&amp;#x4E8B;&amp;#x52A1;&amp;#x653E;&amp;#x5230;journal&amp;#x7684;&amp;#x961F;&amp;#x5217;&amp;#x91CC;&amp;#xFF08;&amp;#x4EE5;filestore&amp;#x4E3A;&amp;#x4F8B;&amp;#xFF09;&amp;#x624D;&amp;#x91CA;&amp;#x653E;PG&amp;#x7684;&amp;#x9501;&amp;#x3002;&amp;#x4ECE;&amp;#x8FD9;&amp;#x91CC;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x51FA;&amp;#xFF0C;&amp;#x5BF9;&amp;#x4E8E;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;PG&amp;#x91CC;&amp;#x7684;&amp;#x4E0D;&amp;#x540C;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;PG&amp;#x9501;&amp;#x6765;&amp;#x8FDB;&amp;#x884C;&amp;#x5E76;&amp;#x53D1;&amp;#x7684;&amp;#x63A7;&amp;#x5236;&amp;#xFF0C;&amp;#x597D;&amp;#x5728;&amp;#x8FD9;&amp;#x4E2A;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#x6CA1;&amp;#x6709;&amp;#x6D89;&amp;#x53CA;&amp;#x5230;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;I/O&amp;#xFF0C;&amp;#x4E0D;&amp;#x4F1A;&amp;#x592A;&amp;#x5F71;&amp;#x54CD;&amp;#x6548;&amp;#x7387;&amp;#xFF1B;&amp;#x5BF9;&amp;#x4E8E;&amp;#x4E0D;&amp;#x540C;PG&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x76F4;&amp;#x63A5;&amp;#x8FDB;&amp;#x884C;&amp;#x5E76;&amp;#x53D1;&amp;#x8BBF;&amp;#x95EE;&amp;#x3002;&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x5E76;&amp;#x53D1;&amp;#x987A;&amp;#x5E8F;&amp;#x63A7;&amp;#x5236;&quot;&gt;&lt;a href=&quot;#&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x5E76;&amp;#x53D1;&amp;#x987A;&amp;#x5E8F;&amp;#x63A7;&amp;#x5236;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x5E76;&amp;#x53D1;&amp;#x987A;&amp;#x5E8F;&amp;#x63A7;&amp;#x5236;&quot;&gt;&lt;/a&gt;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x5E76;&amp;#x53D1;&amp;#x987A;&amp;#x5E8F;&amp;#x63A7;&amp;#x5236;&lt;/h1&gt;&lt;p&gt;&amp;#x4ECE;&amp;#x4E0A;&amp;#x9762;&amp;#x7684;&amp;#x4ECB;&amp;#x7ECD;&amp;#x53EF;&amp;#x4EE5;&amp;#x5F97;&amp;#x77E5;&amp;#xFF0C;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x8BBF;&amp;#x95EE;&amp;#x4E5F;&amp;#x4F1A;&amp;#x53D7;&amp;#x5230;PG&amp;#x9501;&amp;#x7684;&amp;#x9650;&amp;#x5236;&amp;#xFF0C;&amp;#x4F46;&amp;#x8FD9;&amp;#x662F;&amp;#x5728;OSD&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x903B;&amp;#x8F91;&amp;#x91CC;&amp;#x3002;&amp;#x5BF9;&amp;#x4E8E;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x8BBF;&amp;#x95EE;&amp;#xFF0C;&amp;#x8981;&amp;#x8003;&amp;#x8651;&amp;#x7684;&amp;#x60C5;&amp;#x51B5;&amp;#x6BD4;&amp;#x8F83;&amp;#x590D;&amp;#x6742;&amp;#x3002;&amp;#x4ECE;&amp;#x7528;&amp;#x6237;&amp;#x4F7F;&amp;#x7528;&amp;#x573A;&amp;#x666F;&amp;#x4E0A;&amp;#x6765;&amp;#x8BF4;&amp;#xFF0C;&amp;#x6709;&amp;#x4E24;&amp;#x79CD;&amp;#x4F7F;&amp;#x7528;&amp;#x65B9;&amp;#x5F0F;&amp;#x3002;&amp;#x6BD4;&amp;#x5982;&amp;#xFF1A;&lt;br&gt;1&amp;#xFF09;&amp;#x4E00;&amp;#x4E2A;client&amp;#x60C5;&amp;#x51B5;&amp;#xFF0C;&amp;#x5BA2;&amp;#x6237;&amp;#x7AEF;&amp;#x5BF9;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x66F4;&amp;#x65B0;&amp;#x5904;&amp;#x7406;&amp;#x903B;&amp;#x8F91;&amp;#x662F;&amp;#x4E32;&amp;#x884C;&amp;#x7684;&amp;#xFF0C;&amp;#x8981;&amp;#x7B49;&amp;#x524D;&amp;#x4E00;&amp;#x6B21;&amp;#x5199;&amp;#x8BF7;&amp;#x6C42;&amp;#x5B8C;&amp;#x6210;&amp;#xFF0C;&amp;#x518D;&amp;#x8FDB;&amp;#x884C;&amp;#x540E;&amp;#x4E00;&amp;#x6B21;&amp;#x7684;&amp;#x8BFB;&amp;#x53D6;&amp;#x6216;&amp;#x8005;&amp;#x5199;&amp;#x66F4;&amp;#x65B0;&amp;#xFF1B;&lt;br&gt;2&amp;#xFF09;&amp;#x591A;&amp;#x4E2A;client&amp;#x5BF9;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x5E76;&amp;#x53D1;&amp;#x8BBF;&amp;#x95EE;&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;&amp;#x7684;&amp;#x5E94;&amp;#x7528;&amp;#x573A;&amp;#x666F;&amp;#x7C7B;&amp;#x4F3C;&amp;#x4E8E;NFS&amp;#xFF0C;&amp;#x76EE;&amp;#x524D;&amp;#x7684;&amp;#x5206;&amp;#x5E03;&amp;#x5F0F;&amp;#x7CFB;&amp;#x7EDF;&amp;#x91CC;&amp;#x5F88;&amp;#x5C11;&amp;#x80FD;&amp;#x505A;&amp;#x5230;&amp;#xFF0C;&amp;#x6D89;&amp;#x53CA;&amp;#x5230;&amp;#x591A;&amp;#x4E2A;client&amp;#x540C;&amp;#x65F6;&amp;#x66F4;&amp;#x65B0;&amp;#x5E26;&amp;#x6765;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x4E00;&amp;#x81F4;&amp;#x6027;&amp;#x95EE;&amp;#x9898;&amp;#xFF0C;&amp;#x4E00;&amp;#x822C;&amp;#x90FD;&amp;#x9700;&amp;#x8981;&amp;#x96C6;&amp;#x7FA4;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x652F;&amp;#x6301;&amp;#xFF1B;&lt;/p&gt;
&lt;p&gt;&amp;#x5BF9;&amp;#x4E8E;&amp;#x591A;client&amp;#x7684;&amp;#x573A;&amp;#x666F;&amp;#xFF0C;ceph&amp;#x7684;rbd&amp;#x4E5F;&amp;#x662F;&amp;#x4E0D;&amp;#x80FD;&amp;#x4FDD;&amp;#x8BC1;&amp;#x7684;&amp;#xFF0C;cephfs&amp;#x6216;&amp;#x8BB8;&amp;#x53EF;&amp;#x4EE5;&amp;#xFF08;&amp;#x6CA1;&amp;#x6DF1;&amp;#x5165;&amp;#x7814;&amp;#x7A76;&amp;#x8FC7;&amp;#xFF0C;&amp;#x5F85;&amp;#x53D6;&amp;#x8BC1;&amp;#xFF09;&amp;#x3002;&amp;#x56E0;&amp;#x6B64;&amp;#x8FD9;&amp;#x91CC;&amp;#x4E3B;&amp;#x8981;&amp;#x4EE5;&amp;#x5355;client&amp;#x8BBF;&amp;#x95EE;ceph rbd&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x7684;&amp;#x573A;&amp;#x666F;&amp;#x8FDB;&amp;#x884C;&amp;#x9610;&amp;#x8FF0;&amp;#xFF0C;&amp;#x770B;&amp;#x4E00;&amp;#x4E2A;&amp;#x6781;&amp;#x7AEF;&amp;#x7684;&amp;#x4F8B;&amp;#x5B50;&amp;#xFF1A;&lt;strong&gt;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;client&amp;#x5148;&amp;#x540E;&amp;#x53D1;&amp;#x9001;&amp;#x4E86;2&amp;#x6B21;&amp;#x5BF9;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x5F02;&amp;#x6B65;&amp;#x5199;&amp;#x8BF7;&amp;#x6C42;&lt;/strong&gt;&amp;#x3002;&amp;#x4EE5;&amp;#x8FD9;&amp;#x4E2A;&amp;#x4F8B;&amp;#x5B50;&amp;#x5C55;&amp;#x5F00;&amp;#x8FDB;&amp;#x884C;&amp;#x8BF4;&amp;#x660E;&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;tcp&amp;#x6D88;&amp;#x606F;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x6027;&amp;#x4FDD;&amp;#x8BC1;&quot;&gt;&lt;a href=&quot;#tcp&amp;#x6D88;&amp;#x606F;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x6027;&amp;#x4FDD;&amp;#x8BC1;&quot; class=&quot;headerlink&quot; title=&quot;tcp&amp;#x6D88;&amp;#x606F;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x6027;&amp;#x4FDD;&amp;#x8BC1;&quot;&gt;&lt;/a&gt;tcp&amp;#x6D88;&amp;#x606F;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x6027;&amp;#x4FDD;&amp;#x8BC1;&lt;/h2&gt;&lt;p&gt;&amp;#x4E86;&amp;#x89E3;tcp&amp;#x7684;&amp;#x90FD;&amp;#x77E5;&amp;#x9053;&amp;#xFF0C;tcp&amp;#x4F7F;&amp;#x7528;&amp;#x5E8F;&amp;#x53F7;&amp;#x6765;&amp;#x4FDD;&amp;#x8BC1;&amp;#x6D88;&amp;#x606F;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x3002;&amp;#x53D1;&amp;#x9001;&amp;#x65B9;&amp;#x6BCF;&amp;#x6B21;&amp;#x53D1;&amp;#x9001;&amp;#x6570;&amp;#x636E;&amp;#x65F6;&amp;#xFF0C;TCP&amp;#x5C31;&amp;#x7ED9;&amp;#x6BCF;&amp;#x4E2A;&amp;#x6570;&amp;#x636E;&amp;#x5305;&amp;#x5206;&amp;#x914D;&amp;#x4E00;&amp;#x4E2A;&amp;#x5E8F;&amp;#x5217;&amp;#x53F7;&amp;#x5E76;&amp;#x4E14;&amp;#x5728;&amp;#x4E00;&amp;#x4E2A;&amp;#x7279;&amp;#x5B9A;&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x5185;&amp;#x7B49;&amp;#x5F85;&amp;#x63A5;&amp;#x6536;&amp;#x4E3B;&amp;#x673A;&amp;#x5BF9;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5E8F;&amp;#x5217;&amp;#x53F7;&amp;#x8FDB;&amp;#x884C;&amp;#x786E;&amp;#x8BA4;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x53D1;&amp;#x9001;&amp;#x65B9;&amp;#x5728;&amp;#x4E00;&amp;#x4E2A;&amp;#x7279;&amp;#x5B9A;&amp;#x65F6;&amp;#x95F4;&amp;#x5185;&amp;#x6CA1;&amp;#x6709;&amp;#x6536;&amp;#x5230;&amp;#x63A5;&amp;#x6536;&amp;#x65B9;&amp;#x7684;&amp;#x786E;&amp;#x8BA4;&amp;#xFF0C;&amp;#x5219;&amp;#x53D1;&amp;#x9001;&amp;#x65B9;&amp;#x4F1A;&amp;#x91CD;&amp;#x4F20;&amp;#x6B64;&amp;#x6570;&amp;#x636E;&amp;#x5305;&amp;#x3002;&amp;#x63A5;&amp;#x6536;&amp;#x65B9;&amp;#x5229;&amp;#x7528;&amp;#x5E8F;&amp;#x5217;&amp;#x53F7;&amp;#x5BF9;&amp;#x63A5;&amp;#x6536;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x8FDB;&amp;#x884C;&amp;#x786E;&amp;#x8BA4;&amp;#xFF0C;&amp;#x4EE5;&amp;#x4FBF;&amp;#x68C0;&amp;#x6D4B;&amp;#x5BF9;&amp;#x65B9;&amp;#x53D1;&amp;#x9001;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x662F;&amp;#x5426;&amp;#x6709;&amp;#x4E22;&amp;#x5931;&amp;#x6216;&amp;#x8005;&amp;#x4E71;&amp;#x5E8F;&amp;#x7B49;&amp;#xFF0C;&amp;#x63A5;&amp;#x6536;&amp;#x65B9;&amp;#x4E00;&amp;#x65E6;&amp;#x6536;&amp;#x5230;&amp;#x5DF2;&amp;#x7ECF;&amp;#x987A;&amp;#x5E8F;&amp;#x5316;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x5B83;&amp;#x5C31;&amp;#x5C06;&amp;#x8FD9;&amp;#x4E9B;&amp;#x6570;&amp;#x636E;&amp;#x6309;&amp;#x6B63;&amp;#x786E;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x91CD;&amp;#x7EC4;&amp;#x6210;&amp;#x6570;&amp;#x636E;&amp;#x6D41;&amp;#x5E76;&amp;#x4F20;&amp;#x9012;&amp;#x5230;&amp;#x5E94;&amp;#x7528;&amp;#x5C42;&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#x3002;&amp;#x6CE8;&amp;#x610F;&amp;#xFF1A;tcp&amp;#x7684;&amp;#x5E8F;&amp;#x53F7;&amp;#x662F;&amp;#x7528;&amp;#x6765;&amp;#x4FDD;&amp;#x8BC1;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;tcp&amp;#x8FDE;&amp;#x63A5;&amp;#x4E0A;&amp;#x6D88;&amp;#x606F;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x6027;&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;ceph&amp;#x6D88;&amp;#x606F;&amp;#x5C42;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x6027;&amp;#x4FDD;&amp;#x8BC1;&quot;&gt;&lt;a href=&quot;#ceph&amp;#x6D88;&amp;#x606F;&amp;#x5C42;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x6027;&amp;#x4FDD;&amp;#x8BC1;&quot; class=&quot;headerlink&quot; title=&quot;ceph&amp;#x6D88;&amp;#x606F;&amp;#x5C42;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x6027;&amp;#x4FDD;&amp;#x8BC1;&quot;&gt;&lt;/a&gt;ceph&amp;#x6D88;&amp;#x606F;&amp;#x5C42;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x6027;&amp;#x4FDD;&amp;#x8BC1;&lt;/h2&gt;&lt;p&gt;ceph&amp;#x7684;&amp;#x6D88;&amp;#x606F;&amp;#x91CC;&amp;#x6709;&amp;#x4E2A;seq&amp;#x5E8F;&amp;#x53F7;&amp;#xFF0C;&amp;#x4EE5;simple&amp;#x6D88;&amp;#x606F;&amp;#x6A21;&amp;#x578B;&amp;#x4E3A;&amp;#x4F8B;&amp;#xFF0C;Pipe&amp;#x91CC;&amp;#x6709;3&amp;#x4E2A;&amp;#x5E8F;&amp;#x53F7;&amp;#xFF1A;in_seq&amp;#xFF0C;in_seq_acked&amp;#xFF0C;out_seq&amp;#x3002;in_seq&amp;#x662F;&amp;#x5BF9;&amp;#x4E8E;Reader&amp;#x6765;&amp;#x8BF4;&amp;#xFF0C;&amp;#x5DF2;&amp;#x7ECF;&amp;#x6536;&amp;#x5230;&amp;#x7684;&amp;#x6D88;&amp;#x606F;&amp;#x7684;&amp;#x5E8F;&amp;#x53F7;&amp;#xFF1B;in_seq_acked&amp;#x8868;&amp;#x793A;&amp;#x6210;&amp;#x529F;&amp;#x5904;&amp;#x7406;&amp;#x5E76;&amp;#x5E94;&amp;#x7B54;&amp;#x7684;&amp;#x6D88;&amp;#x606F;&amp;#x5E8F;&amp;#x53F7;&amp;#xFF0C;&amp;#x63A5;&amp;#x6536;&amp;#x7AEF;&amp;#x6536;&amp;#x5230;&amp;#x53D1;&amp;#x9001;&amp;#x7AEF;&amp;#x7684;&amp;#x6D88;&amp;#x606F;&amp;#x5E76;&amp;#x5904;&amp;#x7406;&amp;#x5B8C;&amp;#x6210;&amp;#x540E;&amp;#x5C06;ack&amp;#x6210;&amp;#x529F;&amp;#x53D1;&amp;#x5230;&amp;#x53D1;&amp;#x9001;&amp;#x7AEF;&amp;#x540E;&amp;#x8BBE;&amp;#x7F6E;&amp;#x7684;&amp;#xFF1B;out_seq&amp;#x662F;&amp;#x53D1;&amp;#x9001;&amp;#x7AEF;&amp;#x751F;&amp;#x6210;&amp;#x7684;&amp;#xFF0C;&amp;#x4E00;&amp;#x822C;&amp;#x65B0;&amp;#x5EFA;&amp;#x4E00;&amp;#x4E2A;&amp;#x8FDE;&amp;#x63A5;&amp;#x65F6;&amp;#x662F;&amp;#x968F;&amp;#x673A;&amp;#x751F;&amp;#x6210;&amp;#x4E00;&amp;#x4E2A;&amp;#x5E8F;&amp;#x53F7;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x540E;&amp;#x7EED;&amp;#x7684;&amp;#x6D88;&amp;#x606F;&amp;#x53D1;&amp;#x9001;&amp;#x65F6;out_seq&amp;#x9012;&amp;#x589E;&amp;#x8D4B;&amp;#x503C;&amp;#x7ED9;&amp;#x6D88;&amp;#x606F;&amp;#x7684;&amp;#x5E8F;&amp;#x53F7;m-&amp;gt;seq&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2016/08/29/ceph-io-sequence/msg.png&quot; alt=&quot;ceph-io-sequence&quot;&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x5F53;&amp;#x7F51;&amp;#x7EDC;&amp;#x5F02;&amp;#x5E38;&amp;#x5BFC;&amp;#x81F4;tcp&amp;#x8FDE;&amp;#x63A5;&amp;#x4E2D;&amp;#x65AD;&amp;#x540E;&amp;#xFF0C;&amp;#x4F1A;&amp;#x8C03;&amp;#x7528;Pipe::fault&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x5173;&amp;#x95ED;socket&amp;#xFF0C;&amp;#x8C03;&amp;#x7528;requeue_sent&amp;#x628A;&amp;#x6CA1;&amp;#x6709;&amp;#x6536;&amp;#x5230;ack&amp;#x7684;&amp;#x6D88;&amp;#x606F;&amp;#x91CD;&amp;#x65B0;&amp;#x653E;&amp;#x5165;out_q&amp;#x961F;&amp;#x5217;&amp;#x5934;&amp;#xFF08;&amp;#x653E;&amp;#x5728;&amp;#x5934;&amp;#x90E8;&amp;#x4EE5;&amp;#x4FBF;&amp;#x4E8E;&amp;#x53EF;&amp;#x4EE5;&amp;#x4F18;&amp;#x5148;&amp;#x5904;&amp;#x7406;&amp;#xFF09;&amp;#xFF0C;&amp;#x800C;&amp;#x4E14;out_seq&amp;#x4F1A;&amp;#x9012;&amp;#x51CF;&amp;#xFF0C;&amp;#x540E;&amp;#x7EED;&amp;#x4F1A;&amp;#x4E0D;&amp;#x65AD;&amp;#x5C1D;&amp;#x8BD5;&amp;#x91CD;&amp;#x65B0;&amp;#x5EFA;&amp;#x7ACB;&amp;#x8FDE;&amp;#x63A5;&amp;#x3002;&amp;#x8FD9;&amp;#x6837;&amp;#x518D;&amp;#x91CD;&amp;#x65B0;&amp;#x5EFA;&amp;#x7ACB;&amp;#x8FDE;&amp;#x63A5;&amp;#x91CD;&amp;#x53D1;&amp;#x7684;&amp;#x6D88;&amp;#x606F;&amp;#x6240;&amp;#x5E26;&amp;#x7684;seq&amp;#x8FD8;&amp;#x662F;&amp;#x8DDF;&amp;#x4E4B;&amp;#x524D;&amp;#x7684;&amp;#x4E00;&amp;#x6837;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x56E0;&amp;#x4E3A;&amp;#x53D1;&amp;#x9001;&amp;#x7AEF;&amp;#x8FDE;&amp;#x63A5;&amp;#x5F02;&amp;#x5E38;&amp;#x8C03;&amp;#x7528;Pipe::fault&amp;#x91CC;&amp;#x4F1A;&amp;#x5173;&amp;#x95ED;socket&amp;#xFF0C;&amp;#x8FDB;&amp;#x884C;tcp&amp;#x7684;&amp;#x8FDE;&amp;#x63A5;&amp;#x5173;&amp;#x95ED;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x5728;&amp;#x63A5;&amp;#x6536;&amp;#x7AEF;&amp;#x7EE7;&amp;#x7EED;&amp;#x8BFB;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x8BFB;&amp;#x5230;0&amp;#x8BA4;&amp;#x4E3A;tcp_read&amp;#x5931;&amp;#x8D25;&amp;#xFF0C;&amp;#x56E0;&amp;#x6B64;&amp;#x4E5F;&amp;#x4F1A;&amp;#x8C03;&amp;#x7528;Pipe::fault()&amp;#x4ECE;&amp;#x800C;&amp;#x8C03;&amp;#x7528;shutdown_socket&amp;#x53BB;&amp;#x5173;&amp;#x95ED;socket&amp;#x3002;&amp;#x56E0;&amp;#x6B64;&amp;#x5BF9;&amp;#x4E8E;&amp;#x8FDE;&amp;#x63A5;&amp;#x5F02;&amp;#x5E38;&amp;#x65AD;&amp;#x5F00;&amp;#x540E;&amp;#x518D;&amp;#x91CD;&amp;#x65B0;&amp;#x5EFA;&amp;#x7ACB;&amp;#x8FDE;&amp;#x63A5;&amp;#x7684;&amp;#x60C5;&amp;#x51B5;&amp;#xFF0C;in_seq&amp;#x4E5F;&amp;#x4E0D;&amp;#x4F1A;&amp;#x63A5;&amp;#x7740;&amp;#x4E4B;&amp;#x524D;&amp;#x7684;&amp;#x5E8F;&amp;#x53F7;&amp;#xFF0C;&amp;#x4ECD;&amp;#x7136;&amp;#x662F;&amp;#x53D6;&amp;#x51B3;&amp;#x4E8E;&amp;#x53D1;&amp;#x9001;&amp;#x7AEF;&amp;#x751F;&amp;#x6210;&amp;#x7684;out_seq&amp;#x3002;&amp;#x56E0;&amp;#x800C;&amp;#x53EF;&amp;#x4EE5;&amp;#x4FDD;&amp;#x8BC1;&amp;#x6D88;&amp;#x606F;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;pg&amp;#x5C42;&amp;#x987A;&amp;#x5E8F;&amp;#x4FDD;&amp;#x8BC1;&amp;#x53CA;&amp;#x5BF9;&amp;#x8C61;&amp;#x9501;&amp;#x673A;&amp;#x5236;&quot;&gt;&lt;a href=&quot;#pg&amp;#x5C42;&amp;#x987A;&amp;#x5E8F;&amp;#x4FDD;&amp;#x8BC1;&amp;#x53CA;&amp;#x5BF9;&amp;#x8C61;&amp;#x9501;&amp;#x673A;&amp;#x5236;&quot; class=&quot;headerlink&quot; title=&quot;pg&amp;#x5C42;&amp;#x987A;&amp;#x5E8F;&amp;#x4FDD;&amp;#x8BC1;&amp;#x53CA;&amp;#x5BF9;&amp;#x8C61;&amp;#x9501;&amp;#x673A;&amp;#x5236;&quot;&gt;&lt;/a&gt;pg&amp;#x5C42;&amp;#x987A;&amp;#x5E8F;&amp;#x4FDD;&amp;#x8BC1;&amp;#x53CA;&amp;#x5BF9;&amp;#x8C61;&amp;#x9501;&amp;#x673A;&amp;#x5236;&lt;/h2&gt;&lt;p&gt;&amp;#x4ECE;&amp;#x6D88;&amp;#x606F;&amp;#x961F;&amp;#x5217;&amp;#x91CC;&amp;#x53D6;&amp;#x6D88;&amp;#x606F;&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#x65F6;&amp;#xFF0C;osd&amp;#x7AEF;&amp;#x5904;&amp;#x7406;op&amp;#x662F;&amp;#x5212;&amp;#x5206;&amp;#x4E3A;&amp;#x591A;&amp;#x4E2A;shard&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x6BCF;&amp;#x4E2A;shard&amp;#x91CC;&amp;#x53EF;&amp;#x4EE5;&amp;#x914D;&amp;#x7F6E;&amp;#x591A;&amp;#x4E2A;&amp;#x7EBF;&amp;#x7A0B;&amp;#xFF0C;pg&amp;#x6309;&amp;#x7167;&amp;#x53D6;&amp;#x6A21;&amp;#x7684;&amp;#x65B9;&amp;#x5F0F;&amp;#x6620;&amp;#x5C04;&amp;#x5230;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;shard&amp;#x91CC;&amp;#x3002;&amp;#x53E6;&amp;#x5916;osd&amp;#x5728;&amp;#x5904;&amp;#x7406;pg&amp;#x65F6;&amp;#xFF0C;&amp;#x4ECE;&amp;#x6D88;&amp;#x606F;&amp;#x961F;&amp;#x5217;&amp;#x91CC;&amp;#x53D6;&amp;#x51FA;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x5C31;&amp;#x5BF9;pg&amp;#x52A0;&amp;#x4E86;&amp;#x5199;&amp;#x9501;&amp;#x7684;&amp;#xFF0C;&amp;#x800C;&amp;#x4E14;&amp;#x662F;&amp;#x5728;&amp;#x8BF7;&amp;#x6C42;&amp;#x4E0B;&amp;#x53D1;&amp;#x5230;store&amp;#x540E;&amp;#x7AEF;&amp;#x624D;&amp;#x91CA;&amp;#x653E;&amp;#x7684;&amp;#x9501;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x6D88;&amp;#x606F;&amp;#x961F;&amp;#x5217;&amp;#x91CC;&amp;#x8FC7;&amp;#x6765;&amp;#x7684;&amp;#x6D88;&amp;#x606F;&amp;#x6709;&amp;#x5E8F;&amp;#x540E;&amp;#xFF0C;&amp;#x5728;osd&amp;#x7AEF;pg&amp;#x8FD9;&amp;#x4E00;&amp;#x5C42;&amp;#x5904;&amp;#x7406;&amp;#x65F6;&amp;#x4E5F;&amp;#x662F;&amp;#x6709;&amp;#x5E8F;&amp;#x7684;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x5BF9;&amp;#x67D0;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x8FDB;&amp;#x884C;&amp;#x5199;&amp;#x65F6;&amp;#x4F1A;&amp;#x5728;&amp;#x5BF9;&amp;#x8C61;&amp;#x4E0A;&amp;#x8FDB;&amp;#x884C;&amp;#x52A0;&amp;#x9501;&amp;#x64CD;&amp;#x4F5C;ondisk_write_lock()&amp;#xFF0C;&amp;#x5BF9;&amp;#x67D0;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x8BFB;&amp;#x8BF7;&amp;#x6C42;&amp;#x4F1A;&amp;#x5728;&amp;#x5148;&amp;#x5728;&amp;#x5BF9;&amp;#x8C61;&amp;#x4E0A;&amp;#x8FDB;&amp;#x884C;&amp;#x52A0;&amp;#x9501;&amp;#x64CD;&amp;#x4F5C;ondisk_read_lock()&amp;#x3002;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;&amp;#x64CD;&amp;#x4F5C;&amp;#x662F;&amp;#x4E92;&amp;#x65A5;&amp;#x7684;&amp;#xFF0C;&amp;#x5F53;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x6709;&amp;#x5199;&amp;#x64CD;&amp;#x4F5C;&amp;#x8FD8;&amp;#x5728;&amp;#x8FDB;&amp;#x884C;&amp;#x65F6;&amp;#xFF0C;&amp;#x5C1D;&amp;#x8BD5;ondisk_read_lock()&amp;#x4F1A;&amp;#x4E00;&amp;#x76F4;&amp;#x7B49;&amp;#x7740;&amp;#xFF1B;&amp;#x540C;&amp;#x6837;&amp;#x7684;&amp;#xFF0C;&amp;#x5F53;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x6B63;&amp;#x5728;&amp;#x8FDB;&amp;#x884C;&amp;#x8BFB;&amp;#x64CD;&amp;#x4F5C;&amp;#x65F6;&amp;#xFF0C;&amp;#x5C1D;&amp;#x8BD5;ondisk_write_lock()&amp;#x65F6;&amp;#xFF0C;&amp;#x4E5F;&amp;#x662F;&amp;#x4F1A;&amp;#x7B49;&amp;#x3002;&amp;#x4E24;&amp;#x8005;&amp;#x52A0;&amp;#x9501;&amp;#x89E3;&amp;#x9501;&amp;#x7684;&amp;#x5730;&amp;#x65B9;&amp;#x5982;&amp;#x4E0B;&amp;#x56FE;&amp;#x6240;&amp;#x793A;&amp;#xFF1A;&amp;#x8BFB;&amp;#x6570;&amp;#x636E;&amp;#x7684;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#x662F;&amp;#x6301;&amp;#x6709;&amp;#x9501;&amp;#x7684;&amp;#xFF1B;&amp;#x5199;&amp;#x8BF7;&amp;#x6C42;&amp;#x8981;&amp;#x7B49;&amp;#x6570;&amp;#x636E;&amp;#x5199;&amp;#x5230;&amp;#x5E95;&amp;#x5C42;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#xFF08;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7F13;&amp;#x5B58;&amp;#x91CC;&amp;#xFF09;&amp;#x624D;&amp;#x91CA;&amp;#x653E;&amp;#x9501;&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;&amp;#x540E;&amp;#x7EED;&amp;#x5BF9;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x8BFB;&amp;#x53EF;&amp;#x4EE5;&amp;#x76F4;&amp;#x63A5;&amp;#x4ECE;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7F13;&amp;#x5B58;&amp;#x91CC;&amp;#x8BFB;&amp;#x5230;&amp;#xFF08;&amp;#x6216;&amp;#x8005;&amp;#x6570;&amp;#x636E;&amp;#x5237;&amp;#x5230;&amp;#x76D8;&amp;#x4E0A;&amp;#x540E;&amp;#x4ECE;&amp;#x78C1;&amp;#x76D8;&amp;#x4E0A;&amp;#x8BFB;&amp;#x53D6;&amp;#xFF09;&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2016/08/29/ceph-io-sequence/obj_lock.png&quot; alt=&quot;ceph-io-sequence&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&amp;#x6CE8;&amp;#x610F;&lt;/strong&gt;&amp;#xFF1A;&amp;#x8FD9;&amp;#x91CC;&amp;#x7684;&amp;#x4E24;&amp;#x4E2A;&amp;#x9501;&amp;#x64CD;&amp;#x4F5C;&amp;#x9650;&amp;#x5236;&amp;#x7684;&amp;#x662F;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x4E0A;&amp;#x7684;&amp;#x8BFB;&amp;#x548C;&amp;#x5199;&amp;#x7684;&amp;#x5E76;&amp;#x53D1;&amp;#xFF0C;&amp;#x5BF9;&amp;#x4E8E;&amp;#x8BFB;&amp;#x548C;&amp;#x8BFB;&amp;#xFF0C;&amp;#x5199;&amp;#x548C;&amp;#x5199;&amp;#x7684;&amp;#x5E76;&amp;#x53D1;&amp;#x5E76;&amp;#x6CA1;&amp;#x6709;&amp;#x63A7;&amp;#x5236;&amp;#x3002;&amp;#x5BF9;&amp;#x4E8E;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x4E24;&amp;#x4E2A;&amp;#x8BFB;&amp;#x8BF7;&amp;#x6C42;&amp;#x7406;&amp;#x8BBA;&amp;#x6765;&amp;#x8BF4;&amp;#x4E0D;&amp;#x4F1A;&amp;#x51FA;&amp;#x95EE;&amp;#x9898;&amp;#xFF08;&amp;#x5B9E;&amp;#x9645;&amp;#x4E0A;&amp;#x4E0D;&amp;#x4F1A;&amp;#x540C;&amp;#x65F6;&amp;#x53D1;&amp;#x751F;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x4F1A;&amp;#x5148;&amp;#x52A0;PG&amp;#x9501;&amp;#xFF09;&amp;#xFF0C;&amp;#x53EF;&amp;#x662F;&amp;#x5BF9;&amp;#x4E8E;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x4E0A;&amp;#x7684;&amp;#x4E24;&amp;#x4E2A;&amp;#x5199;&amp;#x8BF7;&amp;#x6C42;&amp;#x4F1A;&amp;#x4E0D;&amp;#x4F1A;&amp;#x9020;&amp;#x6210;&amp;#x6570;&amp;#x636E;&amp;#x9519;&amp;#x4E71;&amp;#x5462;&amp;#xFF1F;&amp;#x4E0D;&amp;#x8981;&amp;#x5FD8;&amp;#x4E86;&amp;#xFF0C;&amp;#x5728;&amp;#x8FDB;&amp;#x5165;do_op&amp;#x4E4B;&amp;#x524D;&amp;#x5C31;&lt;strong&gt;&amp;#x5DF2;&amp;#x7ECF;&amp;#x52A0;&amp;#x4E86;PG&amp;#x7684;&amp;#x7684;&amp;#x9501;&lt;/strong&gt;&amp;#xFF0C;&amp;#x800C;&amp;#x4E14;&amp;#x662F;&amp;#x8BF7;&amp;#x6C42;&amp;#x90FD;&amp;#x4E0B;&amp;#x53D1;&amp;#x5230;store&amp;#x5C42;&amp;#x624D;&amp;#x91CA;&amp;#x653E;&amp;#x7684;PG&amp;#x9501;&amp;#xFF0C;&amp;#x56E0;&amp;#x6B64;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;2&amp;#x4E2A;&amp;#x5199;&amp;#x8BF7;&amp;#x6C42;&amp;#xFF0C;&amp;#x662F;&amp;#x4E0D;&amp;#x4F1A;&amp;#x5E76;&amp;#x53D1;&amp;#x8FDB;&amp;#x5165;pg&amp;#x5C42;&amp;#x5904;&amp;#x7406;&amp;#x7684;&amp;#xFF0C;&amp;#x5FC5;&amp;#x5B9A;&amp;#x662F;&amp;#x6309;&amp;#x7167;&amp;#x987A;&amp;#x5E8F;&amp;#x524D;&amp;#x4E00;&amp;#x4E2A;&amp;#x5199;&amp;#x8BF7;&amp;#x6C42;&amp;#x7ECF;&amp;#x8FC7;pg&amp;#x5C42;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x540E;&amp;#xFF0C;&amp;#x5230;&amp;#x8FBE;store&amp;#x5C42;&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#xFF08;&amp;#x7531;&amp;#x53E6;&amp;#x5916;&amp;#x7684;&amp;#x7EBF;&amp;#x7A0B;&amp;#x6765;&amp;#x8FDB;&amp;#x884C;&amp;#xFF09;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x540E;&amp;#x4E00;&amp;#x4E2A;&amp;#x5199;&amp;#x8BF7;&amp;#x6C42;&amp;#x624D;&amp;#x4F1A;&amp;#x8FDB;&amp;#x5165;pg&amp;#x5C42;&amp;#x5904;&amp;#x7406;&amp;#x540E;&amp;#x4E0B;&amp;#x53D1;&amp;#x5230;store&amp;#x5C42;&amp;#x3002;&amp;#x6240;&amp;#x4EE5;&amp;#xFF0C;&lt;strong&gt;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x4E0A;&amp;#x7684;&amp;#x8BFB;&amp;#x5199;&amp;#x8BF7;&amp;#x6C42;&amp;#xFF0C;&amp;#x4E00;&amp;#x5B9A;&amp;#x662F;&amp;#x6309;&amp;#x7167;&amp;#x987A;&amp;#x5E8F;&amp;#x5728;PG&amp;#x5C42;&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&lt;/strong&gt;&amp;#x3002;&amp;#x90A3;&amp;#x4E48;&amp;#x95EE;&amp;#x9898;&amp;#x6765;&amp;#x4E86;&amp;#xFF0C;&lt;strong&gt;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;2&amp;#x6B21;&amp;#x5199;&amp;#x8BF7;&amp;#x6C42;&amp;#x5230;&amp;#x4E86;store&amp;#x5C42;&amp;#x5904;&amp;#x7406;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x4E5F;&amp;#x662F;&amp;#x6709;&amp;#x987A;&amp;#x5E8F;&amp;#x4E0A;&amp;#x7684;&amp;#x4FDD;&amp;#x8BC1;&amp;#x5417;&amp;#xFF1F;&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&quot;store&amp;#x5C42;&amp;#x4FDD;&amp;#x8BC1;&amp;#x987A;&amp;#x5E8F;&quot;&gt;&lt;a href=&quot;#store&amp;#x5C42;&amp;#x4FDD;&amp;#x8BC1;&amp;#x987A;&amp;#x5E8F;&quot; class=&quot;headerlink&quot; title=&quot;store&amp;#x5C42;&amp;#x4FDD;&amp;#x8BC1;&amp;#x987A;&amp;#x5E8F;&quot;&gt;&lt;/a&gt;store&amp;#x5C42;&amp;#x4FDD;&amp;#x8BC1;&amp;#x987A;&amp;#x5E8F;&lt;/h2&gt;&lt;p&gt;ceph&amp;#x7684;store&amp;#x5C42;&amp;#x652F;&amp;#x6301;&amp;#x591A;&amp;#x79CD;&amp;#x5B58;&amp;#x50A8;&amp;#x540E;&amp;#x7AEF;&amp;#xFF0C;&amp;#x4EE5;&amp;#x63D2;&amp;#x4EF6;&amp;#x5316;&amp;#x7684;&amp;#x5F62;&amp;#x5F0F;&amp;#x6765;&amp;#x7BA1;&amp;#x7406;&amp;#xFF0C;&amp;#x4EE5;filestore&amp;#x4E3A;&amp;#x4F8B;&amp;#x6765;&amp;#x8FDB;&amp;#x884C;&amp;#x8BF4;&amp;#x660E;&amp;#xFF0C;filestore&amp;#x6709;&amp;#x51E0;&amp;#x79CD;&amp;#x5199;&amp;#x7684;&amp;#x65B9;&amp;#x5F0F;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x4EE5;filestore journal writeahead&amp;#x4E3A;&amp;#x4F8B;&amp;#x3002;&amp;#x5199;&amp;#x8BF7;&amp;#x6C42;&amp;#x5230;&amp;#x8FBE;filestore&amp;#x540E;&amp;#xFF08;&amp;#x5165;&amp;#x53E3;&amp;#x662F;queue_transactions&amp;#xFF09;&amp;#xFF0C;&amp;#x4F1A;&amp;#x751F;&amp;#x6210;OpSequencer&amp;#xFF08;&amp;#x5982;&amp;#x679C;&amp;#x8FD9;&amp;#x4E2A;pg&amp;#x4E4B;&amp;#x524D;&amp;#x5DF2;&amp;#x7ECF;&amp;#x751F;&amp;#x6210;&amp;#x8FC7;&amp;#x4E86;&amp;#xFF0C;&amp;#x5C31;&amp;#x76F4;&amp;#x63A5;&amp;#x83B7;&amp;#x53D6;&amp;#xFF0C;&lt;strong&gt;&amp;#x6BCF;&amp;#x4E2A;pg&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;osr&amp;#xFF0C;&amp;#x7C7B;&amp;#x578B;&amp;#x4E3A;ObjectStore::Sequencer&amp;#xFF0C;osr-&amp;gt;p&amp;#x5C31;&amp;#x662F;&amp;#x6307;&amp;#x5411;OpSequencer&lt;/strong&gt;&amp;#xFF09;&amp;#xFF0C;OpSequencer&amp;#x5C31;&amp;#x662F;&amp;#x7528;&amp;#x6765;&amp;#x4FDD;&amp;#x8BC1;pg&amp;#x5185;op&amp;#x64CD;&amp;#x4F5C;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x7684;&amp;#xFF0C;&amp;#x540E;&amp;#x9762;&amp;#x4F1A;&amp;#x4ECB;&amp;#x7ECD;&amp;#x5177;&amp;#x4F53;&amp;#x600E;&amp;#x4E48;&amp;#x4F7F;&amp;#x7528;&amp;#x7684;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x5BF9;&amp;#x4E8E;&amp;#x5C01;&amp;#x88C5;&amp;#x7684;&amp;#x5199;&amp;#x8BF7;&amp;#x6C42;&amp;#x7684;&amp;#x4E8B;&amp;#x52A1;&amp;#xFF08;&lt;strong&gt;&amp;#x6BCF;&amp;#x4E2A;op&amp;#x90FD;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;seq&amp;#x5E8F;&amp;#x53F7;&lt;/strong&gt;&amp;#xFF0C;&amp;#x9012;&amp;#x589E;&amp;#x7684;&amp;#xFF09;&amp;#xFF0C;&amp;#x6309;&amp;#x7167;&amp;#x987A;&amp;#x5E8F;&amp;#x4F1A;&amp;#x5148;&amp;#x653E;&amp;#x5230;completions&amp;#xFF0C;&amp;#x518D;&amp;#x653E;&amp;#x5230;writeq&amp;#x91CC;&amp;#x540E;&amp;#xFF08;writeq&amp;#x961F;&amp;#x5C3E;&amp;#xFF09;&amp;#xFF0C;&amp;#x901A;&amp;#x77E5;write_thread&amp;#x53BB;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x5728;write_thread&amp;#x4E2D;&amp;#x4F7F;&amp;#x7528;aio&amp;#x5F02;&amp;#x6B65;&amp;#x5C06;&amp;#x4E8B;&amp;#x52A1;&amp;#x5199;&amp;#x5230;journal&amp;#x91CC;&amp;#xFF0C;&amp;#x5E76;&amp;#x5C06;I/O&amp;#x4FE1;&amp;#x606F;&amp;#x653E;&amp;#x5230;aio_queue&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x4F7F;&amp;#x7528;write_finish_cond&amp;#x901A;&amp;#x77E5;write_finish_thread&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x5728;write_finish_thread&amp;#x91CC;&amp;#x5BF9;&amp;#x4E8E;&amp;#x5DF2;&amp;#x7ECF;&amp;#x5B8C;&amp;#x6210;&amp;#x7684;I/O&amp;#xFF0C;&amp;#x4F1A;&amp;#x6839;&amp;#x636E;&lt;strong&gt;&amp;#x5B8C;&amp;#x6210;&amp;#x7684;op&amp;#x7684;seq&amp;#x5E8F;&amp;#x53F7;&amp;#x6309;&amp;#x5E8F;&amp;#x653E;&amp;#x5230;journal&amp;#x7684;finisher&amp;#x961F;&amp;#x5217;&amp;#x91CC;&amp;#xFF08;&amp;#x56E0;&amp;#x4E3A;aio&amp;#x5E76;&amp;#x4E0D;&amp;#x4FDD;&amp;#x8BC1;&amp;#x987A;&amp;#x5E8F;&amp;#xFF0C;&amp;#x56E0;&amp;#x6B64;&amp;#x91C7;&amp;#x7528;op&amp;#x7684;seq&amp;#x5E8F;&amp;#x53F7;&amp;#x6765;&amp;#x4FDD;&amp;#x8BC1;&amp;#x5B8C;&amp;#x6210;&amp;#x540E;&amp;#x5904;&amp;#x7406;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#xFF09;&lt;/strong&gt;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x67D0;&amp;#x4E2A;op&amp;#x4E4B;&amp;#x524D;&amp;#x7684;op&amp;#x8FD8;&amp;#x672A;&amp;#x5B8C;&amp;#x6210;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x8FD9;&amp;#x4E2A;op&amp;#x4F1A;&amp;#x7B49;&amp;#x5230;&amp;#x5B83;&amp;#x4E4B;&amp;#x524D;&amp;#x7684;op&amp;#x90FD;&amp;#x5B8C;&amp;#x6210;&amp;#x540E;&amp;#x624D;&amp;#x4E00;&amp;#x8D77;&amp;#x653E;&amp;#x5230;finisher&amp;#x961F;&amp;#x5217;&amp;#x91CC;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x5728;journal&amp;#x7684;finisher&amp;#x5904;&amp;#x7406;&amp;#x51FD;&amp;#x6570;&amp;#x91CC;&amp;#xFF0C;&amp;#x4F1A;&amp;#x5C06;op&amp;#x6309;&amp;#x5E8F;&amp;#x653E;&amp;#x5230;OpSequencer&amp;#x7684;&amp;#x961F;&amp;#x5217;&amp;#x91CC;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x4F1A;&amp;#x653E;&amp;#x5230;FileStore::op_wq&amp;#x7684;&amp;#x961F;&amp;#x5217;&amp;#x4E2D;&amp;#xFF0C;FileStore::OpWQ&amp;#x7EBF;&amp;#x7A0B;&amp;#x6C60;&amp;#x8C03;&amp;#x7528;FileStore::_do_op&amp;#xFF0C;&amp;#x5148;&lt;strong&gt;osr-&amp;gt;apply_lock.Lock()&lt;/strong&gt;&amp;#x8FDB;&amp;#x884C;&amp;#x52A0;&amp;#x9501;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x4F1A;&amp;#x4ECE;&amp;#x961F;&amp;#x5217;&amp;#x4E2D;&amp;#x53D6;op&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#xFF08;&amp;#x8C03;&amp;#x7528;osr-&amp;gt;peek_queue()&amp;#xFF0C;&amp;#x5E76;&amp;#x6CA1;&amp;#x6709;dequeue&amp;#xFF09;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x8FDB;&amp;#x884C;&amp;#x5199;&amp;#x6570;&amp;#x636E;&amp;#x5230;filesystem&amp;#x7684;&amp;#x64CD;&amp;#x4F5C;&amp;#x5B8C;&amp;#x6210;&amp;#x540E;&amp;#xFF0C;&amp;#x5728;FileStore::_finish_op&amp;#x91CC;&amp;#x624D;&amp;#x4F1A;osr-&amp;gt;dequeue&amp;#xFF0C;&amp;#x5E76;&lt;strong&gt;osr-&amp;gt;apply_lock.Unlock()&lt;/strong&gt;&amp;#x3002;&amp;#x5373;&amp;#x901A;&amp;#x8FC7;OpSequencer&amp;#x6765;&amp;#x63A7;&amp;#x5236;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;pg&amp;#x5185;&amp;#x5199;I/O&amp;#x5230;filesystem&amp;#x7684;&amp;#x5E76;&amp;#x53D1;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x5BF9;&amp;#x4E8E;&amp;#x4E0D;&amp;#x540C;pg&amp;#x7684;&amp;#x5199;I/O&amp;#x662F;&amp;#x53EF;&amp;#x4EE5;&amp;#x5728;OpWQ&amp;#x7684;&amp;#x7EBF;&amp;#x7A0B;&amp;#x6C60;&amp;#x91CC;&amp;#x5E76;&amp;#x53D1;&amp;#x5904;&amp;#x7406;&amp;#x7684;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x603B;&amp;#x7684;&amp;#x6765;&amp;#x8BF4;&amp;#xFF0C;&lt;strong&gt;FileStore&amp;#x91CC;&amp;#x5148;&amp;#x901A;&amp;#x8FC7;op&amp;#x7684;seq&amp;#x6765;&amp;#x63A7;&amp;#x5236;&amp;#x6301;&amp;#x4E45;&amp;#x5316;&amp;#x5199;&amp;#x5230;journal&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x6027;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x518D;&amp;#x901A;&amp;#x8FC7;OpSequencer&amp;#x6765;&amp;#x4FDD;&amp;#x8BC1;&amp;#x5199;&amp;#x6570;&amp;#x636E;&amp;#x5230;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x6027;&lt;/strong&gt;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x6574;&amp;#x4E2A;&amp;#x5904;&amp;#x7406;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#x90FD;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;FIFO&amp;#x6765;&amp;#x786E;&amp;#x4FDD;&amp;#x51FA;&amp;#x5165;&amp;#x961F;&amp;#x5217;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x3002;&amp;#x7531;&amp;#x6B64;&amp;#x53EF;&amp;#x89C1;&amp;#xFF0C;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;2&amp;#x6B21;&amp;#x5199;&amp;#x8BF7;&amp;#x6C42;&amp;#x6309;&amp;#x7167;&amp;#x987A;&amp;#x5E8F;&amp;#x8FDB;&amp;#x5165;&amp;#x5230;FileStore&amp;#x91CC;&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x4E5F;&amp;#x662F;&amp;#x6309;&amp;#x7167;&amp;#x5148;&amp;#x540E;&amp;#x987A;&amp;#x5E8F;&amp;#x5904;&amp;#x7406;&amp;#x5B8C;&amp;#x6210;&amp;#x7684;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x5728;bluestore&amp;#x91CC;&amp;#x4E5F;&amp;#x6709;OpSequencer&amp;#x8FD9;&amp;#x4E2A;&amp;#x673A;&amp;#x5236;&amp;#xFF0C;&amp;#x6BD4;&amp;#x5982;bluestore&amp;#x91CC;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;OpSequencer&amp;#x6765;&amp;#x4FDD;&amp;#x8BC1;&amp;#x67D0;&amp;#x4E2A;&amp;#x8BF7;&amp;#x6C42;&amp;#x4E4B;&amp;#x524D;&amp;#x7684;&amp;#x8BF7;&amp;#x6C42;&amp;#x8FD8;&amp;#x6CA1;&amp;#x6709;&amp;#x5904;&amp;#x7406;&amp;#x5B8C;&amp;#x4E4B;&amp;#x524D;&amp;#xFF0C;&amp;#x540E;&amp;#x9762;&amp;#x7684;&amp;#x8BF7;&amp;#x6C42;&amp;#x5C31;&amp;#x4E0D;&amp;#x4F1A;&amp;#x5904;&amp;#x7406;&amp;#x3002;&amp;#x56E0;&amp;#x6B64;&amp;#x5BF9;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x4E24;&amp;#x4E2A;&amp;#x5199;&amp;#x8BF7;&amp;#x6C42;&amp;#x4F1A;&amp;#x6309;&amp;#x7167;&amp;#x987A;&amp;#x5E8F;&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#x3002;&amp;#x800C;&amp;#x4E14;&amp;#x5BF9;&amp;#x4E8E;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x8BFB;&amp;#x8BF7;&amp;#x6C42;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x8FD8;&amp;#x6709;&amp;#x672A;&amp;#x5B8C;&amp;#x6210;&amp;#x7684;&amp;#x5199;&amp;#x8BF7;&amp;#x6C42;&amp;#x5728;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x4F1A;&amp;#x7B49;&amp;#x5230;&amp;#x5199;&amp;#x5904;&amp;#x7406;&amp;#x5B8C;&amp;#x6210;&amp;#x624D;&amp;#x80FD;&amp;#x8BFB;&amp;#x53D6;&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;primary&amp;#x53D1;&amp;#x5230;replica&amp;#x7684;&amp;#x8BF7;&amp;#x6C42;&amp;#x987A;&amp;#x5E8F;&quot;&gt;&lt;a href=&quot;#primary&amp;#x53D1;&amp;#x5230;replica&amp;#x7684;&amp;#x8BF7;&amp;#x6C42;&amp;#x987A;&amp;#x5E8F;&quot; class=&quot;headerlink&quot; title=&quot;primary&amp;#x53D1;&amp;#x5230;replica&amp;#x7684;&amp;#x8BF7;&amp;#x6C42;&amp;#x987A;&amp;#x5E8F;&quot;&gt;&lt;/a&gt;primary&amp;#x53D1;&amp;#x5230;replica&amp;#x7684;&amp;#x8BF7;&amp;#x6C42;&amp;#x987A;&amp;#x5E8F;&lt;/h2&gt;&lt;p&gt;&amp;#x6709;&amp;#x4E86;&amp;#x6D88;&amp;#x606F;&amp;#x5C42;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x6027;&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;primary&amp;#x5904;&amp;#x7406;&amp;#x4E0A;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x6027;&amp;#xFF0C;&amp;#x518D;&amp;#x5C06;&amp;#x8BF7;&amp;#x6C42;&amp;#x53D1;&amp;#x7ED9;replica&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x4E5F;&amp;#x662F;&amp;#x6709;&amp;#x5E8F;&amp;#x7684;&amp;#xFF08;&amp;#x5373;&amp;#x5BF9;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x4E24;&amp;#x6B21;&amp;#x5199;&amp;#xFF09;&amp;#xFF0C;replica&amp;#x7AEF;&amp;#x6536;&amp;#x5230;&amp;#x7684;&amp;#x4E24;&amp;#x6B21;&amp;#x5199;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x8DDF;primary&amp;#x7684;&amp;#x4E24;&amp;#x6B21;&amp;#x5199;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x662F;&amp;#x4E00;&amp;#x6837;&amp;#x7684;&amp;#xFF08;&amp;#x7531;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;tcp&amp;#x8FDE;&amp;#x63A5;&amp;#x4E0A;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x6027;&amp;#x548C;ceph&amp;#x6D88;&amp;#x606F;&amp;#x5C42;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x6027;&amp;#x4FDD;&amp;#x8BC1;&amp;#xFF09;&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;replica&amp;#x7AEF;&amp;#x5728;&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#x65F6;&amp;#xFF0C;&amp;#x5230;osd&amp;#x4EE5;&amp;#x53CA;&amp;#x540E;&amp;#x7EED;store&amp;#x5C42;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x4E5F;&amp;#x662F;&amp;#x4FDD;&amp;#x5E8F;&amp;#x7684;&amp;#x3002;&lt;br&gt;&amp;#x8FD9;&amp;#x6837;&amp;#x5C31;&amp;#x4E0D;&amp;#x4F1A;&amp;#x51FA;&amp;#x73B0;primary&amp;#x8DDF;replica&amp;#x4E0A;&amp;#x5BF9;&amp;#x4E8E;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x4E24;&amp;#x6B21;&amp;#x5199;&amp;#x4F1A;&amp;#x4E71;&amp;#x5E8F;&amp;#x5BFC;&amp;#x81F4;&amp;#x4E0D;&amp;#x4E00;&amp;#x81F4;&amp;#x3002;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;#x5206;&amp;#x5E03;&amp;#x5F0F;&amp;#x7CFB;&amp;#x7EDF;&amp;#x4E2D;&amp;#x7ECF;&amp;#x5E38;&amp;#x9700;&amp;#x8981;&amp;#x8003;&amp;#x8651;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF08;&amp;#x6216;&amp;#x8005;&amp;#x8BB0;&amp;#x5F55;&amp;#x3001;&amp;#x6587;&amp;#x4EF6;&amp;#x3001;&amp;#x6570;&amp;#x636E;&amp;#x5757;&amp;#x7B49;&amp;#xFF09;&amp;#x7684;&amp;#x8BFB;&amp;#x5199;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x4EE5;&amp;#x53CA;&amp;#x5E76;&amp;#x53D1;&amp;#x8BBF;&amp;#x95EE;&amp;#x95EE;&amp;#x9898;&amp;#x3002;&amp;#x901A;&amp;#x5E38;&amp;#x6765;&amp;#x8BF4;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x4E24;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x6CA1;&amp;#x6709;&amp;#x5171;&amp;#x4EAB;&amp;#x7684;&amp;#x8D44;&amp;#x6E90;&amp;#xFF0C;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x8FDB;&amp;#x884C;&amp;#x5E76;&amp;#x53D1;&amp;#x7684;&amp;#x8BBF;&amp;#x95EE;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x6709;&amp;#x5171;&amp;#x4EAB;&amp;#x7684;&amp;#x90E8;&amp;#x5206;&amp;#xFF0C;&amp;#x5C31;&amp;#x9700;&amp;#x8981;&amp;#x5BF9;&amp;#x8FD9;&amp;#x90E8;&amp;#x5206;&amp;#x8D44;&amp;#x6E90;&amp;#x8FDB;&amp;#x884C;&amp;#x52A0;&amp;#x9501;&amp;#xFF1B;&amp;#x800C;&amp;#x5BF9;&amp;#x4E8E;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x5E76;&amp;#x53D1;&amp;#x8BFB;&amp;#x5199;&amp;#xFF08;&amp;#x5C24;&amp;#x5176;&amp;#x662F;&amp;#x5E76;&amp;#x53D1;&amp;#x5199;&amp;#x66F4;&amp;#x65B0;&amp;#x65F6;&amp;#xFF09;&amp;#xFF0C;&amp;#x5C31;&amp;#x9700;&amp;#x8981;&amp;#x6CE8;&amp;#x610F;&amp;#x987A;&amp;#x5E8F;&amp;#x6027;&amp;#x4EE5;&amp;#x53CA;&amp;#x5E76;&amp;#x53D1;&amp;#x8BBF;&amp;#x95EE;&amp;#x7684;&amp;#x63A7;&amp;#x5236;&amp;#xFF0C;&amp;#x4EE5;&amp;#x514D;&amp;#x6570;&amp;#x636E;&amp;#x9519;&amp;#x4E71;&amp;#x3002;&amp;#x672C;&amp;#x6587;&amp;#x4E3B;&amp;#x8981;&amp;#x5BF9;ceph&amp;#x4E2D;&amp;#x5BF9;&amp;#x8C61;&amp;#x8BFB;&amp;#x5199;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x53CA;&amp;#x5E76;&amp;#x53D1;&amp;#x6027;&amp;#x4FDD;&amp;#x8BC1;&amp;#x673A;&amp;#x5236;&amp;#x8FDB;&amp;#x884C;&amp;#x4ECB;&amp;#x7ECD;&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;PG&amp;#x7684;&amp;#x6982;&amp;#x5FF5;&quot;&gt;&lt;a href=&quot;#PG&amp;#x7684;&amp;#x6982;&amp;#x5FF5;&quot; class=&quot;headerlink&quot; title=&quot;PG&amp;#x7684;&amp;#x6982;&amp;#x5FF5;&quot;&gt;&lt;/a&gt;PG&amp;#x7684;&amp;#x6982;&amp;#x5FF5;&lt;/h1&gt;&lt;p&gt;ceph&amp;#x4E2D;&amp;#x5F15;&amp;#x5165;PG&amp;#xFF08;Placement Group&amp;#xFF09;&amp;#x7684;&amp;#x6982;&amp;#x5FF5;&amp;#xFF0C;&amp;#x8FD9;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x903B;&amp;#x8F91;&amp;#x4E0A;&amp;#x7684;&amp;#x7EC4;&amp;#xFF0C;&amp;#x901A;&amp;#x8FC7;crush&amp;#x7B97;&amp;#x6CD5;&amp;#x6620;&amp;#x5C04;&amp;#x5230;&amp;#x4E00;&amp;#x7EC4;OSD&amp;#x4E0A;&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;PG&amp;#x91CC;&amp;#x5305;&amp;#x542B;&amp;#x5B8C;&amp;#x6574;&amp;#x7684;&amp;#x526F;&amp;#x672C;&amp;#x5173;&amp;#x7CFB;&amp;#xFF0C;&amp;#x6BD4;&amp;#x5982;3&amp;#x4E2A;&amp;#x6570;&amp;#x636E;&amp;#x526F;&amp;#x672C;&amp;#x5206;&amp;#x5E03;&amp;#x5230;&amp;#x4E00;&amp;#x4E2A;PG&amp;#x91CC;&amp;#x7684;3&amp;#x4E2A;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;OSD&amp;#x4E0A;&amp;#x3002;&amp;#x4E0B;&amp;#x9762;&amp;#x5F15;&amp;#x7528;ceph&amp;#x8BBA;&amp;#x6587;&amp;#x4E2D;&amp;#x7684;&amp;#x4E00;&amp;#x5F20;&amp;#x56FE;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x6BD4;&amp;#x8F83;&amp;#x76F4;&amp;#x89C2;&amp;#x7684;&amp;#x7406;&amp;#x89E3;&amp;#x4E86;&amp;#x3002;&amp;#x5C06;&amp;#x6587;&amp;#x4EF6;&amp;#x6309;&amp;#x7167;&amp;#x6307;&amp;#x5B9A;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x5927;&amp;#x5C0F;&amp;#x5206;&amp;#x5272;&amp;#x6210;&amp;#x591A;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x6839;&amp;#x636E;hash&amp;#x6620;&amp;#x5C04;&amp;#x5230;&amp;#x67D0;&amp;#x4E2A;pg&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x518D;&amp;#x6839;&amp;#x636E;crush&amp;#x7B97;&amp;#x6CD5;&amp;#x6620;&amp;#x5C04;&amp;#x5230;&amp;#x540E;&amp;#x7AEF;&amp;#x7684;&amp;#x67D0;&amp;#x51E0;&amp;#x4E2A;osd&amp;#x4E0A;&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2016/08/29/ceph-io-sequence/pg.png&quot; alt=&quot;ceph-io-sequence&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;&amp;#x4E0D;&amp;#x540C;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x5E76;&amp;#x53D1;&amp;#x63A7;&amp;#x5236;&quot;&gt;&lt;a href=&quot;#&amp;#x4E0D;&amp;#x540C;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x5E76;&amp;#x53D1;&amp;#x63A7;&amp;#x5236;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x4E0D;&amp;#x540C;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x5E76;&amp;#x53D1;&amp;#x63A7;&amp;#x5236;&quot;&gt;&lt;/a&gt;&amp;#x4E0D;&amp;#x540C;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x5E76;&amp;#x53D1;&amp;#x63A7;&amp;#x5236;&lt;/h1&gt;&lt;p&gt;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x6709;&amp;#x53EF;&amp;#x80FD;&amp;#x843D;&amp;#x5230;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;pg&amp;#x91CC;&amp;#xFF0C;ceph&amp;#x5B9E;&amp;#x73B0;&amp;#x91CC;&amp;#xFF0C;&amp;#x5728;OSD&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x7EBF;&amp;#x7A0B;&amp;#x4E2D;&amp;#x5C31;&amp;#x4F1A;&amp;#x7ED9;PG&amp;#x52A0;&amp;#x9501;&amp;#xFF0C;&amp;#x4E00;&amp;#x76F4;&amp;#x5230;queue_transactions&amp;#x91CC;&amp;#x628A;&amp;#x4E8B;&amp;#x52A1;&amp;#x653E;&amp;#x5230;journal&amp;#x7684;&amp;#x961F;&amp;#x5217;&amp;#x91CC;&amp;#xFF08;&amp;#x4EE5;filestore&amp;#x4E3A;&amp;#x4F8B;&amp;#xFF09;&amp;#x624D;&amp;#x91CA;&amp;#x653E;PG&amp;#x7684;&amp;#x9501;&amp;#x3002;&amp;#x4ECE;&amp;#x8FD9;&amp;#x91CC;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x51FA;&amp;#xFF0C;&amp;#x5BF9;&amp;#x4E8E;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;PG&amp;#x91CC;&amp;#x7684;&amp;#x4E0D;&amp;#x540C;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;PG&amp;#x9501;&amp;#x6765;&amp;#x8FDB;&amp;#x884C;&amp;#x5E76;&amp;#x53D1;&amp;#x7684;&amp;#x63A7;&amp;#x5236;&amp;#xFF0C;&amp;#x597D;&amp;#x5728;&amp;#x8FD9;&amp;#x4E2A;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#x6CA1;&amp;#x6709;&amp;#x6D89;&amp;#x53CA;&amp;#x5230;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;I/O&amp;#xFF0C;&amp;#x4E0D;&amp;#x4F1A;&amp;#x592A;&amp;#x5F71;&amp;#x54CD;&amp;#x6548;&amp;#x7387;&amp;#xFF1B;&amp;#x5BF9;&amp;#x4E8E;&amp;#x4E0D;&amp;#x540C;PG&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x76F4;&amp;#x63A5;&amp;#x8FDB;&amp;#x884C;&amp;#x5E76;&amp;#x53D1;&amp;#x8BBF;&amp;#x95EE;&amp;#x3002;&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ceph" scheme="http://yoursite.com/categories/ceph/"/>
    
    
      <category term="ceph" scheme="http://yoursite.com/tags/ceph/"/>
    
  </entry>
  
  <entry>
    <title>ceph bluestore工作流程</title>
    <link href="http://yoursite.com/2016/08/25/bluestore-work-flow/"/>
    <id>http://yoursite.com/2016/08/25/bluestore-work-flow/</id>
    <published>2016-08-25T07:46:12.000Z</published>
    <updated>2016-08-25T07:52:16.183Z</updated>
    
    <content type="html">&lt;p&gt;&amp;#x524D;&amp;#x4E00;&amp;#x7BC7;&amp;#x300A;ceph&amp;#x5B58;&amp;#x50A8;&amp;#x5F15;&amp;#x64CE;bluestore&amp;#x89E3;&amp;#x6790;&amp;#x300B;&amp;#x5DF2;&amp;#x7ECF;&amp;#x5BF9;bluestore&amp;#x6574;&amp;#x4F53;&amp;#x67B6;&amp;#x6784;&amp;#x548C;I/O&amp;#x6620;&amp;#x5C04;&amp;#x903B;&amp;#x8F91;&amp;#x8FDB;&amp;#x884C;&amp;#x4E86;&amp;#x9610;&amp;#x8FF0;&amp;#xFF0C;&amp;#x672C;&amp;#x6587;&amp;#x4E3B;&amp;#x8981;&amp;#x4ECE;bluestore&amp;#x7684;&amp;#x5DE5;&amp;#x4F5C;&amp;#x5904;&amp;#x7406;&amp;#x6D41;&amp;#x7A0B;&amp;#x8FDB;&amp;#x884C;&amp;#x89E3;&amp;#x6790;&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;1-&amp;#x6574;&amp;#x4F53;&amp;#x6D41;&amp;#x7A0B;&quot;&gt;&lt;a href=&quot;#1-&amp;#x6574;&amp;#x4F53;&amp;#x6D41;&amp;#x7A0B;&quot; class=&quot;headerlink&quot; title=&quot;1.&amp;#x6574;&amp;#x4F53;&amp;#x6D41;&amp;#x7A0B;&quot;&gt;&lt;/a&gt;1.&amp;#x6574;&amp;#x4F53;&amp;#x6D41;&amp;#x7A0B;&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;/2016/08/25/bluestore-work-flow/state-machine.png&quot; alt=&quot;bluestore-work-flow&quot;&gt;&lt;br&gt;&amp;#x56FE;&amp;#x4E2D;&amp;#x5C55;&amp;#x793A;&amp;#x4E86;&amp;#x6D41;&amp;#x7A0B;&amp;#x4E2D;&amp;#x7684;&amp;#x5173;&amp;#x952E;&amp;#x8DEF;&amp;#x5F84;&amp;#x53CA;&amp;#x6D89;&amp;#x53CA;&amp;#x5230;&amp;#x7684;&amp;#x7EBF;&amp;#x7A0B;&amp;#x4E0E;&amp;#x961F;&amp;#x5217;&amp;#x3002;&amp;#x4E0B;&amp;#x9762;&amp;#x8BE6;&amp;#x7EC6;&amp;#x9610;&amp;#x8FF0;&amp;#x5DE5;&amp;#x4F5C;&amp;#x6D41;&amp;#x7A0B;&amp;#x3002;&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;1-1-queue-transactions&quot;&gt;&lt;a href=&quot;#1-1-queue-transactions&quot; class=&quot;headerlink&quot; title=&quot;1.1 queue_transactions&quot;&gt;&lt;/a&gt;1.1 queue_transactions&lt;/h2&gt;&lt;p&gt;queue_transactions&amp;#x662F;store&amp;#x7EDF;&amp;#x4E00;&amp;#x7684;&amp;#x5165;&amp;#x53E3;&amp;#xFF0C;&amp;#x5404;&amp;#x4E2A;&amp;#x5B58;&amp;#x50A8;&amp;#x5F15;&amp;#x64CE;&amp;#x5982;filestore&amp;#x3001;kvstore&amp;#x3001;bluestore&amp;#x90FD;&amp;#x5F97;&amp;#x5B9E;&amp;#x73B0;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5165;&amp;#x53E3;&amp;#x3002;&amp;#x5728;queue_transactions&amp;#x91CC;&amp;#x5148;&amp;#x521D;&amp;#x59CB;&amp;#x5316;transaction&amp;#xFF08;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x72B6;&amp;#x6001;&amp;#x4E3A;STATE_PREPARE&amp;#xFF09;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5728;_txc_add_transaction&amp;#x6839;&amp;#x636E;&amp;#x64CD;&amp;#x4F5C;&amp;#x7801;&amp;#x7684;&amp;#x7C7B;&amp;#x578B;&amp;#x8FDB;&amp;#x884C;&amp;#x4E0D;&amp;#x540C;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x5C06;&amp;#x5176;&amp;#x653E;&amp;#x5230;transaction&amp;#x91CC;&amp;#xFF0C;&amp;#x524D;&amp;#x4E00;&amp;#x7BC7;&amp;#x6587;&amp;#x7AE0;&amp;#x91CC;&amp;#x7684;I/O&amp;#x6620;&amp;#x5C04;&amp;#x903B;&amp;#x8F91;&amp;#x5C31;&amp;#x662F;&amp;#x6839;&amp;#x636E;&amp;#x64CD;&amp;#x4F5C;&amp;#x7801;OP_WRITE&amp;#x5728;BlueStore::_write&amp;#x91CC;&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#x3002;BlueStore::_write &amp;#x2013;&amp;gt; BlueStore::_do_write &amp;#x2013;&amp;gt; (_do_write_small/_do_write_big)  &amp;#x2013;&amp;gt; _do_alloc_write &amp;#x5206;&amp;#x914D;&amp;#x7A7A;&amp;#x95F4;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x91C7;&amp;#x7528;aio&amp;#x5C31;&amp;#x4F1A;&amp;#x8C03;&amp;#x7528;bdev-&amp;gt;aio_write&amp;#x51C6;&amp;#x5907;aio&amp;#x7684;&amp;#x7ED3;&amp;#x6784;&amp;#xFF0C;&amp;#x653E;&amp;#x5728;pending_aios&amp;#x91CC;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x4E0D;&amp;#x662F;aio&amp;#x5C31;&amp;#x76F4;&amp;#x63A5;pwrite&amp;#xFF08;&amp;#x5982;&amp;#x679C;&amp;#x662F;&amp;#x975E;direct&amp;#x7684;&amp;#x8FD8;&amp;#x9700;&amp;#x8981;sync&amp;#xFF09;&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;1-2-STATE-PREPARE&quot;&gt;&lt;a href=&quot;#1-2-STATE-PREPARE&quot; class=&quot;headerlink&quot; title=&quot;1.2 STATE_PREPARE&quot;&gt;&lt;/a&gt;1.2 STATE_PREPARE&lt;/h2&gt;&lt;p&gt;_txc_state_proc&amp;#x91CC;&amp;#x5C31;&amp;#x662F;&amp;#x72B6;&amp;#x6001;&amp;#x673A;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x903B;&amp;#x8F91;&amp;#xFF0C;&amp;#x6839;&amp;#x636E;&amp;#x6240;&amp;#x5904;&amp;#x7684;&amp;#x72B6;&amp;#x6001;&amp;#x8FDB;&amp;#x884C;&amp;#x4E0D;&amp;#x540C;&amp;#x9636;&amp;#x6BB5;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x3002;&amp;#x8D77;&amp;#x59CB;&amp;#x72B6;&amp;#x6001;&amp;#x662F;STATE_PREPARE&amp;#xFF0C;&amp;#x5728;&amp;#x8FD9;&amp;#x4E2A;&amp;#x72B6;&amp;#x6001;&amp;#x4E0B;&amp;#x56DE;&amp;#x68C0;&amp;#x67E5;&amp;#x662F;&amp;#x5426;&amp;#x8FD8;&amp;#x6709;&amp;#x672A;&amp;#x5B8C;&amp;#x6210;&amp;#x7684;aio&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x6709;&amp;#x5C31;&amp;#x5C06;&amp;#x72B6;&amp;#x6001;&amp;#x7F6E;&amp;#x4E3A;STATE_AIO_WAIT&amp;#xFF0C;&amp;#x5E76;&amp;#x8C03;&amp;#x7528;_txc_aio_submit&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x5426;&amp;#x5219;&amp;#x5C31;&amp;#x76F4;&amp;#x63A5;&amp;#x8FDB;&amp;#x5165;&amp;#x5230;&amp;#x4E0B;&amp;#x4E00;&amp;#x4E2A;&amp;#x72B6;&amp;#x6001;STATE_AIO_WAIT&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x5728;_txc_aio_submit&amp;#x91CC;&amp;#x5C31;&amp;#x662F;&amp;#x5C31;&amp;#x662F;&amp;#x8C03;&amp;#x7528;bdev-&amp;gt;aio_submit &amp;#x2013;&amp;gt; KernelDevice::aio_submit &amp;#x2013;&amp;gt; io_submit&amp;#x5C06;aio&amp;#x63D0;&amp;#x4EA4;&amp;#x5230;&amp;#x5185;&amp;#x6838;&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#xFF08;&amp;#x6CE8;&amp;#xFF1A;&amp;#x76EE;&amp;#x524D;&amp;#x652F;&amp;#x6301;KernelDevice&amp;#x548C;NVMEDevice&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x4EE5;KernelDevice&amp;#x4E3A;&amp;#x4F8B;&amp;#xFF09;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x4F7F;&amp;#x7528;linux Aio&amp;#x65F6;&amp;#xFF0C;&amp;#x5C06;I/O&amp;#x63D0;&amp;#x4EA4;&amp;#x540E;&amp;#xFF0C;&amp;#x5F53;&amp;#x5185;&amp;#x6838;&amp;#x5904;&amp;#x7406;&amp;#x5B8C;&amp;#x6210;&amp;#x540E;&amp;#x4F1A;&amp;#x901A;&amp;#x77E5;&amp;#x5230;&amp;#x7528;&amp;#x6237;&amp;#x6001;&amp;#xFF0C;&amp;#x4E00;&amp;#x79CD;&amp;#x65B9;&amp;#x5F0F;&amp;#x662F;&amp;#x4F7F;&amp;#x7528;eventfd&amp;#xFF0C;&amp;#x5C06;&amp;#x5176;&amp;#x6CE8;&amp;#x518C;&amp;#x5230;epoll&amp;#x91CC;&amp;#xFF0C;&amp;#x5F53;&amp;#x5185;&amp;#x6838;&amp;#x5904;&amp;#x7406;I/O&amp;#x5B8C;&amp;#x6210;&amp;#x540E;&amp;#x4F1A;&amp;#x89E6;&amp;#x53D1;eventfd&amp;#x7684;&amp;#x4E8B;&amp;#x4EF6;&amp;#x4ECE;&amp;#x800C;&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#xFF1B;&amp;#x53E6;&amp;#x5916;&amp;#x4E00;&amp;#x79CD;&amp;#x65B9;&amp;#x5F0F;&amp;#x662F;&amp;#x7528;&amp;#x4E00;&amp;#x4E2A;&amp;#x5355;&amp;#x72EC;&amp;#x7684;&amp;#x7EBF;&amp;#x7A0B;&amp;#xFF0C;&amp;#x8F6E;&amp;#x8BE2;&amp;#x8C03;&amp;#x7528;io_getevents&amp;#x53BB;&amp;#x83B7;&amp;#x53D6;&amp;#x5B8C;&amp;#x6210;&amp;#x7684;&amp;#x4E8B;&amp;#x4EF6;&amp;#x3002;&amp;#x5728;bluestore&amp;#x91CC;&amp;#x91C7;&amp;#x7528;&amp;#x7684;&amp;#x662F;&amp;#x7B2C;&amp;#x4E8C;&amp;#x79CD;&amp;#x65B9;&amp;#x5F0F;&amp;#xFF0C;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x7EBF;&amp;#x7A0B;&amp;#x662F;KernelDevice::_aio_thread&amp;#xFF0C;&amp;#x5F53;I/O&amp;#x5904;&amp;#x7406;&amp;#x5B8C;&amp;#x540E;&amp;#x4F1A;&amp;#x8C03;&amp;#x7528;&amp;#x56DE;&amp;#x8C03;&amp;#x51FD;&amp;#x6570;aio_cb&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#xFF08;&amp;#x8FD9;&amp;#x4E2A;&amp;#x56DE;&amp;#x8C03;&amp;#x51FD;&amp;#x6570;&amp;#x662F;&amp;#x5728;bluestore&amp;#x542F;&amp;#x52A8;&amp;#x65F6;&amp;#x521B;&amp;#x5EFA;KernelDevice&amp;#x8BBE;&amp;#x7F6E;&amp;#x7684;&amp;#xFF09;&amp;#xFF0C;&amp;#x5728;aio_cb&amp;#x4E2D;&amp;#x8C03;&amp;#x7528;_txc_aio_finish &amp;#x2013;&amp;gt; _txc_state_proc&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;&amp;#x8FDB;&amp;#x5165;&amp;#x5230;&amp;#x4E0B;&amp;#x4E00;&amp;#x4E2A;&amp;#x72B6;&amp;#x6001;STATE_AIO_WAIT&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;1-3-STATE-AIO-WAIT&quot;&gt;&lt;a href=&quot;#1-3-STATE-AIO-WAIT&quot; class=&quot;headerlink&quot; title=&quot;1.3 STATE_AIO_WAIT&quot;&gt;&lt;/a&gt;1.3 STATE_AIO_WAIT&lt;/h2&gt;&lt;p&gt;&amp;#x5728;&amp;#x8FD9;&amp;#x4E2A;&amp;#x72B6;&amp;#x6001;&amp;#x91CC;&amp;#x662F;&amp;#x8C03;&amp;#x7528;_txc_finish_io&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x4F1A;&amp;#x5C06;&amp;#x72B6;&amp;#x6001;&amp;#x8BBE;&amp;#x7F6E;&amp;#x6210;STATE_IO_DONE&amp;#x3002;&amp;#x56E0;&amp;#x4E3A;aio&amp;#x7684;&amp;#x5B8C;&amp;#x6210;&amp;#x53EF;&amp;#x80FD;&amp;#x662F;&amp;#x4E71;&amp;#x5E8F;&amp;#x7684;&amp;#xFF0C;&amp;#x6709;&amp;#x53EF;&amp;#x80FD;&amp;#x540E;&amp;#x63D0;&amp;#x4EA4;&amp;#x7684;I/O&amp;#x5148;&amp;#x5B8C;&amp;#x6210;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x9700;&amp;#x8981;&amp;#x4FDD;&amp;#x8BC1;kv&amp;#x4E8B;&amp;#x52A1;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x6027;&amp;#x3002;bluestore&amp;#x91CC;&amp;#x901A;&amp;#x8FC7;OpSequencer&amp;#x6765;&amp;#x4FDD;&amp;#x8BC1;kv&amp;#x4E8B;&amp;#x52A1;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x6027;&amp;#xFF08;&amp;#x5728;_txc_create&amp;#x91CC;&amp;#x4F1A;&amp;#x5C06;&amp;#x65B0;&amp;#x7684;txc&amp;#x653E;&amp;#x5230;osr-&amp;gt;q&amp;#x91CC;&amp;#xFF0C;&amp;#x5373;q.push_back&amp;#x3002;&amp;#x5728;_osr_reap_done&amp;#x91CC;&amp;#x4ECE;osr-&amp;gt;q&amp;#x91CC;&amp;#x6328;&amp;#x4E2A;&amp;#x5254;&amp;#x9664;&amp;#x5B8C;&amp;#x6210;&amp;#x7684;&amp;#x3002;&amp;#xFF09;&amp;#xFF0C;&amp;#x5728;_txc_finish_io&amp;#x91CC;&amp;#x5C31;&amp;#x662F;&amp;#x5B9E;&amp;#x73B0;&amp;#x901A;&amp;#x8FC7;OpSequencer&amp;#x6765;&amp;#x4FDD;&amp;#x8BC1;&amp;#x6BCF;&amp;#x4E2A;&amp;#x4E8B;&amp;#x52A1;&amp;#x5728;&amp;#x5904;&amp;#x4E8E;&amp;#x67D0;&amp;#x4E2A;&amp;#x72B6;&amp;#x6001;&amp;#x65F6;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x4E8B;&amp;#x52A1;&amp;#x4E4B;&amp;#x524D;&amp;#x7684;&amp;#x4E8B;&amp;#x52A1;&amp;#x4E5F;&amp;#x5FC5;&amp;#x987B;&amp;#x5728;&amp;#x8FD9;&amp;#x4E2A;&amp;#x72B6;&amp;#x6001;&amp;#xFF0C;&amp;#x5373;&amp;#x4F7F;&amp;#x67D0;&amp;#x4E2A;&amp;#x4E8B;&amp;#x52A1;&amp;#x7684;I/O&amp;#x5148;&amp;#x5B8C;&amp;#x6210;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5F97;&amp;#x7B49;&amp;#x5230;&amp;#x5B83;&amp;#x4E4B;&amp;#x524D;&amp;#x7684;&amp;#x4E8B;&amp;#x52A1;&amp;#x7684;I/O&amp;#x4E5F;&amp;#x5B8C;&amp;#x6210;&amp;#x540E;&amp;#x624D;&amp;#x80FD;&amp;#x8FDB;&amp;#x5165;&amp;#x5230;&amp;#x4E0B;&amp;#x4E2A;&amp;#x72B6;&amp;#x6001;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x3002;&lt;br&gt;&amp;#x505A;&amp;#x4E86;&amp;#x8FD9;&amp;#x4E2A;&amp;#x4FDD;&amp;#x8BC1;&amp;#x540E;&amp;#xFF0C;&amp;#x518D;&amp;#x5BF9;&amp;#x6309;&amp;#x5E8F;&amp;#x5BF9;STATE_IO_DONE&amp;#x72B6;&amp;#x6001;&amp;#x7684;&amp;#x4E8B;&amp;#x52A1;&amp;#x8C03;&amp;#x7528;_txc_state_proc&amp;#x8FDB;&amp;#x5165;&amp;#x4E0B;&amp;#x4E00;&amp;#x4E2A;&amp;#x72B6;&amp;#x6001;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;1-4-STATE-IO-DONE&quot;&gt;&lt;a href=&quot;#1-4-STATE-IO-DONE&quot; class=&quot;headerlink&quot; title=&quot;1.4 STATE_IO_DONE&quot;&gt;&lt;/a&gt;1.4 STATE_IO_DONE&lt;/h2&gt;&lt;p&gt;&amp;#x8FDB;&amp;#x5165;&amp;#x8FD9;&amp;#x4E2A;&amp;#x72B6;&amp;#x6001;&amp;#x540E;&amp;#xFF0C;&amp;#x4F1A;&amp;#x8BBE;&amp;#x7F6E;&amp;#x4E0B;&amp;#x4E2A;&amp;#x72B6;&amp;#x6001;&amp;#x4E3A;STATE_KV_QUEUED&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x4F1A;&amp;#x6839;&amp;#x636E;bluestore_sync_transaction&amp;#x548C;bluestore_sync_submit_transaction&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;&amp;#x914D;&amp;#x7F6E;&amp;#x53C2;&amp;#x6570;&amp;#x7684;&amp;#x7EC4;&amp;#x5408;&amp;#x4F5C;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#xFF1A;&lt;br&gt;1&amp;#xFF09;bluestore_sync_transaction&amp;#x4E3A;true&amp;#xFF1A;&amp;#x8868;&amp;#x793A;&amp;#x540C;&amp;#x6B65;&amp;#x63D0;&amp;#x4EA4;kv&amp;#x5230;rocksdb&amp;#x5E76;&amp;#x6301;&amp;#x4E45;&amp;#x5316;&amp;#xFF0C;&amp;#x5BF9;&amp;#x5E94;&amp;#x8C03;&amp;#x7528;_txc_finalize_kv&amp;#x540E;&amp;#x518D;&amp;#x8C03;&amp;#x7528;db-&amp;gt;submit_transaction&amp;#xFF0C;&amp;#x5373;rocksdb::Write&amp;#x5E76;&amp;#x8BBE;&amp;#x7F6E;rocksdb::WriteOptions.sync=true&amp;#xFF1B;&lt;br&gt;2&amp;#xFF09;bluestore_sync_transaction&amp;#x4E3A;false&amp;#xFF0C;bluestore_sync_submit_transaction&amp;#x4E3A;true&amp;#xFF1A;&amp;#x8868;&amp;#x793A;&amp;#x5C06;kv&amp;#x63D0;&amp;#x4EA4;&amp;#x5230;rocksdb&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x4E0D;sync&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x6CA1;&amp;#x6709;&amp;#x843D;&amp;#x76D8;&amp;#xFF0C;&amp;#x5BF9;&amp;#x5E94;&amp;#x8C03;&amp;#x7528;_txc_finalize_kv&amp;#x540E;&amp;#x518D;&amp;#x8C03;&amp;#x7528;db-&amp;gt;submit_transaction_sync&amp;#xFF0C;&amp;#x5373;rocksdb::Write&amp;#xFF0C;&amp;#x4F46;rocksdb::WriteOptions.sync=false&amp;#xFF1B;&lt;br&gt;&amp;#x4E0D;&amp;#x7BA1;&amp;#x91C7;&amp;#x7528;&amp;#x4F55;&amp;#x79CD;&amp;#x5904;&amp;#x7406;&amp;#x65B9;&amp;#x5F0F;&amp;#xFF0C;&amp;#x6700;&amp;#x540E;&amp;#x90FD;&amp;#x4F1A;&amp;#x5C06;&amp;#x4E8B;&amp;#x52A1;&amp;#x653E;&amp;#x5230;kv_queue&amp;#x91CC;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x901A;&amp;#x8FC7;kv_cond&amp;#x901A;&amp;#x77E5;_kv_sync_thread&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;1-5-kv-sync-thread&amp;#x5904;&amp;#x7406;kv-queue&quot;&gt;&lt;a href=&quot;#1-5-kv-sync-thread&amp;#x5904;&amp;#x7406;kv-queue&quot; class=&quot;headerlink&quot; title=&quot;1.5 _kv_sync_thread&amp;#x5904;&amp;#x7406;kv_queue&quot;&gt;&lt;/a&gt;1.5 _kv_sync_thread&amp;#x5904;&amp;#x7406;kv_queue&lt;/h2&gt;&lt;p&gt;_kv_sync_thread&amp;#x7EBF;&amp;#x7A0B;&amp;#x91CC;&amp;#x5C31;&amp;#x662F;&amp;#x5904;&amp;#x7406;kv_queue&amp;#x548C;wal_cleanup_queue&amp;#x91CC;&amp;#x7684;&amp;#x4E8B;&amp;#x52A1;&amp;#x3002;&amp;#x6309;&amp;#x7167;&amp;#x6D41;&amp;#x7A0B;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E00;&amp;#x6B65;&amp;#x8D70;&amp;#x5230;&amp;#x4ECE;kv_queue&amp;#x91CC;&amp;#x53D6;&amp;#x4E8B;&amp;#x52A1;&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#x7684;&amp;#x8FC7;&amp;#x7A0B;&amp;#x3002;&amp;#x5904;&amp;#x7406;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x662F;&amp;#x5C06;kv_queue&amp;#x66FF;&amp;#x6362;&amp;#x7ED9;kv_committing&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x540E;&amp;#x7EED;&amp;#x5BF9;kv_committing&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#x3002;&lt;br&gt;&amp;#x5F53;bluestore_sync_transaction&amp;#x548C;bluestore_sync_submit_transaction&amp;#x90FD;&amp;#x4E3A;false&amp;#x65F6;&amp;#xFF08;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x5728;&amp;#x524D;&amp;#x4E00;&amp;#x4E2A;&amp;#x72B6;&amp;#x6001;&amp;#x91CC;&amp;#x6CA1;&amp;#x505A;&amp;#x4E8B;&amp;#x52A1;&amp;#x76F8;&amp;#x5173;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x76F4;&amp;#x63A5;&amp;#x653E;&amp;#x5230;kv_queue&amp;#x91CC;&amp;#x4E86;&amp;#xFF09;&amp;#xFF0C;&amp;#x4F1A;&amp;#x904D;&amp;#x5386;kv_committing&amp;#x91CC;&amp;#x7684;&amp;#x4E8B;&amp;#x52A1;&amp;#xFF0C;&amp;#x8C03;&amp;#x7528;_txc_finalize_kv&amp;#x5C06;&amp;#x7A7A;&amp;#x95F4;&amp;#x5206;&amp;#x914D;&amp;#x91CA;&amp;#x653E;&amp;#x76F8;&amp;#x5173;&amp;#x7684;&amp;#x5143;&amp;#x6570;&amp;#x636E;&amp;#x5728;kv&amp;#x4E8B;&amp;#x52A1;&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#xFF08;&amp;#x5982;&amp;#x8BBE;&amp;#x7F6E;key&amp;#x3001;&amp;#x5220;&amp;#x9664;key&amp;#x7B49;&amp;#xFF09;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;db-&amp;gt;submit_transaction&amp;#x5C06;kv&amp;#x63D0;&amp;#x4EA4;&amp;#x5230;rocksdb&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x6CA1;&amp;#x6709;&amp;#x843D;&amp;#x76D8;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x7136;&amp;#x540E;&amp;#x90FD;&amp;#x4F1A;&amp;#x8C03;&amp;#x7528;db-&amp;gt;submit_transaction_sync&amp;#x6765;&amp;#x8FDB;&amp;#x884C;&amp;#x63D0;&amp;#x4EA4;&amp;#x5E76;&amp;#x5237;&amp;#x76D8;&amp;#x7684;&amp;#x52A8;&amp;#x4F5C;&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;&amp;#x5373;&amp;#x4F7F;&amp;#x5728;1.4&amp;#x90A3;&amp;#x4E00;&amp;#x6B65;&amp;#x5DF2;&amp;#x7ECF;&amp;#x63D0;&amp;#x4EA4;sync&amp;#x4E86;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x4E5F;&amp;#x4F1A;&amp;#x591A;&amp;#x505A;&amp;#x4E00;&amp;#x6B21;&amp;#xFF0C;&amp;#x4EE5;&amp;#x786E;&amp;#x4FDD;&amp;#x4E0D;&amp;#x7BA1;&amp;#x524D;&amp;#x9762;&amp;#x662F;&amp;#x6CA1;&amp;#x63D0;&amp;#x4EA4;&amp;#x3001;&amp;#x53EA;&amp;#x63D0;&amp;#x4EA4;&amp;#x4E86;&amp;#x6CA1;sync&amp;#x3001;&amp;#x63D0;&amp;#x4EA4;&amp;#x5E76;sync&amp;#x4E86;&amp;#x7684;&amp;#xFF0C;&amp;#x5230;&amp;#x4E86;&amp;#x8FD9;&amp;#x4E00;&amp;#x6B65;&amp;#x64CD;&amp;#x4F5C;&amp;#x540E;&amp;#x4E8B;&amp;#x52A1;&amp;#x90FD;&amp;#x843D;&amp;#x76D8;&amp;#x4E86;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x5BF9;&amp;#x4E8E;&amp;#x6BCF;&amp;#x4E2A;&amp;#x5904;&amp;#x7406;&amp;#x5B8C;&amp;#x7684;&amp;#x4E8B;&amp;#x52A1;&amp;#xFF0C;&amp;#x90FD;&amp;#x4F1A;&amp;#x8C03;&amp;#x7528;_txc_state_proc&amp;#x8FDB;&amp;#x5165;&amp;#x5230;&amp;#x4E0B;&amp;#x4E00;&amp;#x4E2A;&amp;#x72B6;&amp;#x6001;STATE_KV_QUEUED&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;1-6-STATE-KV-QUEUED&quot;&gt;&lt;a href=&quot;#1-6-STATE-KV-QUEUED&quot; class=&quot;headerlink&quot; title=&quot;1.6 STATE_KV_QUEUED&quot;&gt;&lt;/a&gt;1.6 STATE_KV_QUEUED&lt;/h2&gt;&lt;p&gt;&amp;#x8BBE;&amp;#x7F6E;&amp;#x72B6;&amp;#x6001;&amp;#x4E3A;STATE_KV_DONE&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x8C03;&amp;#x7528;_txc_finish_kv&amp;#x5904;&amp;#x7406;onreadable&amp;#x3001;oncommit&amp;#x56DE;&amp;#x8C03;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x5C06;&amp;#x56DE;&amp;#x8C03;&amp;#x653E;&amp;#x5230;finisher queue&amp;#x91CC;&amp;#xFF0C;&amp;#x89E6;&amp;#x53D1;finisher thread&amp;#x53BB;&amp;#x8FDB;&amp;#x884C;&amp;#x56DE;&amp;#x8C03;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#xFF08;&amp;#x5373;&amp;#x5982;&amp;#x679C;&amp;#x5404;&amp;#x4E2A;&amp;#x526F;&amp;#x672C;&amp;#x90FD;&amp;#x5904;&amp;#x7406;&amp;#x5B8C;&amp;#x6210;&amp;#xFF0C;&amp;#x5C31;&amp;#x4F1A;&amp;#x53D1;&amp;#x9001;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x54CD;&amp;#x5E94;&amp;#x7ED9;&amp;#x5BA2;&amp;#x6237;&amp;#x7AEF;&amp;#xFF09;&amp;#x3002;&amp;#x7136;&amp;#x540E;&amp;#x76F4;&amp;#x63A5;&amp;#x8FDB;&amp;#x5165;&amp;#x5230;STATE_KV_DONE&amp;#x72B6;&amp;#x6001;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;1-7-STATE-KV-DONE&quot;&gt;&lt;a href=&quot;#1-7-STATE-KV-DONE&quot; class=&quot;headerlink&quot; title=&quot;1.7 STATE_KV_DONE&quot;&gt;&lt;/a&gt;1.7 STATE_KV_DONE&lt;/h2&gt;&lt;p&gt;&amp;#x5982;&amp;#x679C;&amp;#x6CA1;&amp;#x6709;wal&amp;#x4E8B;&amp;#x52A1;&amp;#x8981;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x5C31;&amp;#x76F4;&amp;#x63A5;&amp;#x8BBE;&amp;#x7F6E;&amp;#x72B6;&amp;#x6001;&amp;#x4E3A;STATE_FINISHING&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x8DF3;&amp;#x51FA;&amp;#x6B64;&amp;#x5904;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x5728;&amp;#x4E0B;&amp;#x4E00;&amp;#x6B21;&amp;#x5904;&amp;#x7406;&amp;#x5230;&amp;#x8BE5;&amp;#x4E8B;&amp;#x52A1;&amp;#x65F6;&amp;#x5224;&amp;#x65AD;&amp;#x5230;&amp;#x72B6;&amp;#x6001;&amp;#x4E3A;STATE_FINISHING&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;&amp;#x8FDB;&amp;#x884C;&amp;#x5B8C;&amp;#x6210;&amp;#x7684;&amp;#x4E00;&amp;#x4E9B;&amp;#x5904;&amp;#x7406;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x4E0B;&amp;#x9762;&amp;#x4E3B;&amp;#x8981;&amp;#x4ECB;&amp;#x7ECD;&amp;#x6709;wal&amp;#x7684;&amp;#x60C5;&amp;#x51B5;&amp;#xFF0C;&amp;#x4E4B;&amp;#x524D;&amp;#x4E00;&amp;#x7BC7;&amp;#x6587;&amp;#x7AE0;&amp;#x8BB2;&amp;#x8FC7;&amp;#x5F53;&amp;#x6709;&amp;#x8986;&amp;#x76D6;&amp;#x5199;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x5C31;&amp;#x4F1A;&amp;#x8FDB;&amp;#x884C;wal&amp;#xFF0C;&amp;#x8BBE;&amp;#x7F6E;&amp;#x72B6;&amp;#x6001;&amp;#x4E3A;STATE_WAL_QUEUED&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x6839;&amp;#x636E;&amp;#x914D;&amp;#x7F6E;&amp;#x53C2;&amp;#x6570;bluestore_sync_wal_apply&amp;#x6709;&amp;#x4E24;&amp;#x79CD;&amp;#x5904;&amp;#x7406;&amp;#x65B9;&amp;#x5F0F;&amp;#xFF1A;&lt;br&gt;1&amp;#xFF09;&amp;#x5F53;bluestore_sync_wal_apply&amp;#x4E3A;false&amp;#xFF0C;&amp;#x5C31;&amp;#x628A;&amp;#x4E8B;&amp;#x52A1;&amp;#x653E;&amp;#x5230;wal_wq&amp;#x4E2D;&amp;#xFF08;&amp;#x4F1A;&amp;#x89E6;&amp;#x53D1;WALWQ threads&amp;#x53BB;&amp;#x5904;&amp;#x7406;&amp;#xFF09;&amp;#xFF0C;&amp;#x7ED3;&amp;#x675F;&amp;#x6B64;&amp;#x6B21;&amp;#x5904;&amp;#x7406;&amp;#xFF1B;&lt;br&gt;2&amp;#xFF09;&amp;#x5F53;bluestore_sync_wal_apply&amp;#x4E3A;true&amp;#x65F6;&amp;#xFF0C;&amp;#x76F4;&amp;#x63A5;&amp;#x8C03;&amp;#x7528;_wal_apply&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#xFF1B;&lt;br&gt;&amp;#x5728;_wal_apply&amp;#x4E2D;&amp;#x4F1A;&amp;#x8BBE;&amp;#x7F6E;&amp;#x72B6;&amp;#x6001;&amp;#x4E3A;STATE_WAL_APPLYING&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x904D;&amp;#x5386;wal&amp;#x4E8B;&amp;#x52A1;&amp;#x4E2D;&amp;#x7684;op&amp;#xFF0C;&amp;#x8C03;&amp;#x7528;_do_wal_op&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x5728;_do_wal_op&amp;#x91CC;&amp;#x8C03;&amp;#x7528;bdev-&amp;gt;aio_write&amp;#x51C6;&amp;#x5907;aio&amp;#x7684;&amp;#x7ED3;&amp;#x6784;&amp;#xFF0C;&amp;#x653E;&amp;#x5728;pending_aios&amp;#x91CC;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x4E0D;&amp;#x662F;aio&amp;#x5C31;&amp;#x76F4;&amp;#x63A5;pwrite&amp;#xFF08;&amp;#x5982;&amp;#x679C;&amp;#x662F;&amp;#x975E;direct&amp;#x7684;&amp;#x8FD8;&amp;#x9700;&amp;#x8981;sync&amp;#xFF09;&amp;#x3002;&lt;br&gt;&amp;#x5F53;wal&amp;#x4E8B;&amp;#x52A1;&amp;#x4E2D;&amp;#x7684;op&amp;#x90FD;&amp;#x5904;&amp;#x7406;&amp;#x5B8C;&amp;#x540E;&amp;#xFF0C;&amp;#x5C31;&amp;#x4F1A;&amp;#x8C03;&amp;#x7528;_txc_state_proc&amp;#x8FDB;&amp;#x5165;&amp;#x5230;&amp;#x4E0B;&amp;#x4E00;&amp;#x4E2A;&amp;#x72B6;&amp;#x6001;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;1-8-WALWQ-threads&quot;&gt;&lt;a href=&quot;#1-8-WALWQ-threads&quot; class=&quot;headerlink&quot; title=&quot;1.8 WALWQ threads&quot;&gt;&lt;/a&gt;1.8 WALWQ threads&lt;/h2&gt;&lt;p&gt;&amp;#x4E0A;&amp;#x9762;&amp;#x8BF4;&amp;#x5230;&amp;#x5728;bluestore_sync_wal_apply&amp;#x4E3A;false&amp;#x65F6;&amp;#xFF0C;wal&amp;#x4E8B;&amp;#x52A1;&amp;#x76F4;&amp;#x63A5;&amp;#x653E;&amp;#x5230;wal_wq&amp;#x4E2D;&amp;#xFF0C;&amp;#x4EA4;&amp;#x7531;WALWQ&amp;#x7684;&amp;#x7EBF;&amp;#x7A0B;&amp;#x6C60;&amp;#x6765;&amp;#x5904;&amp;#x7406;&amp;#x3002;&amp;#x5728;&amp;#x8FD9;&amp;#x4E2A;&amp;#x7EBF;&amp;#x7A0B;&amp;#x6C60;&amp;#x91CC;&amp;#x4E5F;&amp;#x662F;&amp;#x8C03;&amp;#x7528;_wal_apply&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x5177;&amp;#x4F53;&amp;#x5728;&amp;#x4E0A;&amp;#x9762;&amp;#x5DF2;&amp;#x7ECF;&amp;#x8BF4;&amp;#x8FC7;&amp;#x4E86;&amp;#x3002;&amp;#x5904;&amp;#x7406;&amp;#x5B8C;&amp;#x8C03;&amp;#x7528;_txc_state_proc&amp;#x8FDB;&amp;#x5165;&amp;#x5230;&amp;#x4E0B;&amp;#x4E00;&amp;#x4E2A;&amp;#x72B6;&amp;#x6001;STATE_WAL_APPLYING&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;1-9-STATE-WAL-APPLYING&quot;&gt;&lt;a href=&quot;#1-9-STATE-WAL-APPLYING&quot; class=&quot;headerlink&quot; title=&quot;1.9 STATE_WAL_APPLYING&quot;&gt;&lt;/a&gt;1.9 STATE_WAL_APPLYING&lt;/h2&gt;&lt;p&gt;&amp;#x5728;&amp;#x8FD9;&amp;#x4E2A;&amp;#x72B6;&amp;#x6001;&amp;#x4E0B;&amp;#x56DE;&amp;#x68C0;&amp;#x67E5;&amp;#x662F;&amp;#x5426;&amp;#x8FD8;&amp;#x6709;&amp;#x672A;&amp;#x5B8C;&amp;#x6210;&amp;#x7684;aio&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x6709;&amp;#x5C31;&amp;#x5C06;&amp;#x72B6;&amp;#x6001;&amp;#x7F6E;&amp;#x4E3A;STATE_WAL_AIO_WAIT&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x8C03;&amp;#x7528;_txc_aio_submit&amp;#x63D0;&amp;#x4EA4;I/O&amp;#x5230;&amp;#x78C1;&amp;#x76D8;&amp;#xFF0C;&amp;#x5E76;&amp;#x7ED3;&amp;#x675F;&amp;#x6B64;&amp;#x6B21;&amp;#x5904;&amp;#x7406;&amp;#x3002;&amp;#x5426;&amp;#x5219;&amp;#x5C31;&amp;#x5224;&amp;#x65AD;&amp;#x662F;&amp;#x5426;&amp;#x6EE1;&amp;#x8DB3;&amp;#x540E;&amp;#x7EED;&amp;#x72B6;&amp;#x6001;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x662F;&amp;#x5C31;&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x4E0D;&amp;#x662F;&amp;#x5C31;&amp;#x7ED3;&amp;#x675F;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x5728;KernelDevice::_aio_thread&amp;#xFF0C;&amp;#x5F53;I/O&amp;#x5904;&amp;#x7406;&amp;#x5B8C;&amp;#x540E;&amp;#x4F1A;&amp;#x8C03;&amp;#x7528;&amp;#x56DE;&amp;#x8C03;&amp;#x51FD;&amp;#x6570;aio_cb&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x5728;aio_cb&amp;#x4E2D;&amp;#x8C03;&amp;#x7528;_txc_aio_finish &amp;#x2013;&amp;gt; _txc_state_proc&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;&amp;#x8FDB;&amp;#x5165;&amp;#x5230;&amp;#x4E0B;&amp;#x4E00;&amp;#x4E2A;&amp;#x72B6;&amp;#x6001;STATE_WAL_AIO_WAIT&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;1-10-STATE-WAL-AIO-WAIT&quot;&gt;&lt;a href=&quot;#1-10-STATE-WAL-AIO-WAIT&quot; class=&quot;headerlink&quot; title=&quot;1.10 STATE_WAL_AIO_WAIT&quot;&gt;&lt;/a&gt;1.10 STATE_WAL_AIO_WAIT&lt;/h2&gt;&lt;p&gt;&amp;#x5728;&amp;#x8FD9;&amp;#x4E2A;&amp;#x72B6;&amp;#x6001;&amp;#x4E0B;&amp;#xFF0C;&amp;#x8C03;&amp;#x7528;_wal_finish&amp;#xFF0C;&amp;#x8BBE;&amp;#x7F6E;&amp;#x72B6;&amp;#x6001;&amp;#x4E3A;STATE_WAL_CLEANUP&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x653E;&amp;#x5230;wal_cleanup_queue&amp;#x4E2D;&amp;#xFF0C;&amp;#x901A;&amp;#x77E5;_kv_sync_thread&amp;#x53BB;&amp;#x5904;&amp;#x7406;&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;1-11-kv-sync-thread&amp;#x5904;&amp;#x7406;wal-cleanup-queue&quot;&gt;&lt;a href=&quot;#1-11-kv-sync-thread&amp;#x5904;&amp;#x7406;wal-cleanup-queue&quot; class=&quot;headerlink&quot; title=&quot;1.11 _kv_sync_thread&amp;#x5904;&amp;#x7406;wal_cleanup_queue&quot;&gt;&lt;/a&gt;1.11 _kv_sync_thread&amp;#x5904;&amp;#x7406;wal_cleanup_queue&lt;/h2&gt;&lt;p&gt;&amp;#x5904;&amp;#x7406;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x662F;&amp;#x5C06;wal_cleanup_queue&amp;#x66FF;&amp;#x6362;&amp;#x7ED9;wal_cleaning&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x540E;&amp;#x7EED;&amp;#x5BF9;wal_cleaning&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#x3002;&amp;#x5728;1.5&amp;#x8282;&amp;#x91CC;&amp;#x5DF2;&amp;#x7ECF;&amp;#x4ECB;&amp;#x7ECD;&amp;#x8FC7;kv_sync_thread&amp;#x5BF9;kv_queue&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x5176;&amp;#x5B9E;_kv_sync_thread&amp;#x5728;&amp;#x6BCF;&amp;#x6B21;&amp;#x5904;&amp;#x7406;&amp;#x65F6;&amp;#x90FD;&amp;#x662F;&amp;#x540C;&amp;#x65F6;&amp;#x5904;&amp;#x7406;kv_queue&amp;#x548C;wal_cleanup_queue&amp;#x91CC;&amp;#x7684;&amp;#x4E8B;&amp;#x52A1;&amp;#xFF0C;&amp;#x53EA;&amp;#x4E0D;&amp;#x8FC7;&amp;#x672C;&amp;#x6587;&amp;#x662F;&amp;#x6309;&amp;#x7167;&amp;#x903B;&amp;#x8F91;&amp;#x5904;&amp;#x7406;&amp;#x6D41;&amp;#x7A0B;&amp;#x624D;&amp;#x5206;&amp;#x5F00;&amp;#x63CF;&amp;#x8FF0;&amp;#x7684;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x5BF9;&amp;#x4E8E;wal_cleanup_queue&amp;#x91CC;&amp;#x7684;&amp;#x4E8B;&amp;#x52A1;&amp;#xFF0C;&amp;#x4E5F;&amp;#x662F;&amp;#x8C03;&amp;#x7528;_txc_finalize_kv&amp;#x5C06;&amp;#x7A7A;&amp;#x95F4;&amp;#x5206;&amp;#x914D;&amp;#x91CA;&amp;#x653E;&amp;#x76F8;&amp;#x5173;&amp;#x7684;&amp;#x5143;&amp;#x6570;&amp;#x636E;&amp;#x5728;kv&amp;#x4E8B;&amp;#x52A1;&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#xFF08;&amp;#x5982;&amp;#x8BBE;&amp;#x7F6E;key&amp;#x3001;&amp;#x5220;&amp;#x9664;key&amp;#x7B49;&amp;#xFF09;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5728;&amp;#x63A5;&amp;#x4E0B;&amp;#x53BB;&amp;#x7684;db-&amp;gt;submit_transaction_sync&amp;#x4E2D;&amp;#x7EDF;&amp;#x4E00;&amp;#x63D0;&amp;#x4EA4;kv&amp;#x5230;rocksdb&amp;#x5E76;sync&amp;#x843D;&amp;#x76D8;&amp;#x3002;&amp;#x8FD9;&amp;#x6B21;submit_transaction_sync&amp;#x7684;&amp;#x8C03;&amp;#x7528;&amp;#x5BF9;&amp;#x4E8E;kv_queue&amp;#x548C;wal_cleanup_queue&amp;#x4E2D;&amp;#x4E8B;&amp;#x52A1;&amp;#x90FD;&amp;#x662F;&amp;#x4E00;&amp;#x8D77;&amp;#x751F;&amp;#x6548;&amp;#x7684;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x5728;&amp;#x5904;&amp;#x7406;&amp;#x5B8C;&amp;#x6210;&amp;#x540E;&amp;#xFF0C;&amp;#x5BF9;&amp;#x4E8E;wal_cleanning&amp;#x4E2D;&amp;#x7684;&amp;#x4E8B;&amp;#x52A1;&amp;#x90FD;&amp;#x4F1A;&amp;#x8C03;&amp;#x7528;_txc_state_proc&amp;#x8FDB;&amp;#x884C;&amp;#x4E0B;&amp;#x4E00;&amp;#x4E2A;&amp;#x72B6;&amp;#x6001;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;1-12-STATE-WAL-CLEANUP&quot;&gt;&lt;a href=&quot;#1-12-STATE-WAL-CLEANUP&quot; class=&quot;headerlink&quot; title=&quot;1.12 STATE_WAL_CLEANUP&quot;&gt;&lt;/a&gt;1.12 STATE_WAL_CLEANUP&lt;/h2&gt;&lt;p&gt;&amp;#x5728;&amp;#x8FD9;&amp;#x4E2A;&amp;#x72B6;&amp;#x6001;&amp;#x91CC;&amp;#x5C31;&amp;#x662F;&amp;#x8BBE;&amp;#x7F6E;&amp;#x72B6;&amp;#x6001;&amp;#x4E3A;STATE_FINISHING&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x76F4;&amp;#x63A5;&amp;#x8FDB;&amp;#x5165;STATE_FINISHING&amp;#x72B6;&amp;#x6001;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;1-13-STATE-FINISHING&quot;&gt;&lt;a href=&quot;#1-13-STATE-FINISHING&quot; class=&quot;headerlink&quot; title=&quot;1.13 STATE_FINISHING&quot;&gt;&lt;/a&gt;1.13 STATE_FINISHING&lt;/h2&gt;&lt;p&gt;&amp;#x8C03;&amp;#x7528;_txc_finish&amp;#x8FDB;&amp;#x884C;&amp;#x4E00;&amp;#x4E9B;&amp;#x7ED3;&amp;#x675F;&amp;#x72B6;&amp;#x6001;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;2-&amp;#x603B;&amp;#x7ED3;&quot;&gt;&lt;a href=&quot;#2-&amp;#x603B;&amp;#x7ED3;&quot; class=&quot;headerlink&quot; title=&quot;2.&amp;#x603B;&amp;#x7ED3;&quot;&gt;&lt;/a&gt;2.&amp;#x603B;&amp;#x7ED3;&lt;/h1&gt;&lt;p&gt;&amp;#x4ECE;&amp;#x4E0A;&amp;#x9762;&amp;#x7684;&amp;#x6D41;&amp;#x7A0B;&amp;#x5206;&amp;#x6790;&amp;#x53EF;&amp;#x4EE5;&amp;#x77E5;&amp;#x6653;&amp;#xFF0C;&amp;#x4E00;&amp;#x4E2A;I/O&amp;#x5728;bluestore&amp;#x91CC;&amp;#x7ECF;&amp;#x5386;&amp;#x4E86;&amp;#x591A;&amp;#x4E2A;&amp;#x7EBF;&amp;#x7A0B;&amp;#x548C;&amp;#x961F;&amp;#x5217;&amp;#x624D;&amp;#x6700;&amp;#x7EC8;&amp;#x5B8C;&amp;#x6210;&amp;#xFF0C;&amp;#x5BF9;&amp;#x4E8E;&amp;#x975E;WAL&amp;#x7684;&amp;#x5199;&amp;#xFF0C;&amp;#x6BD4;&amp;#x5982;&amp;#x5BF9;&amp;#x9F50;&amp;#x5199;&amp;#x3001;&amp;#x5199;&amp;#x5230;&amp;#x65B0;&amp;#x7684;blob&amp;#x91CC;&amp;#x7B49;&amp;#xFF0C;I/O&amp;#x5148;&amp;#x5199;&amp;#x5230;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x4E0A;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5143;&amp;#x6570;&amp;#x636E;&amp;#x63D0;&amp;#x4EA4;&amp;#x5230;rocksdb&amp;#x5E76;sync&amp;#x4E86;&amp;#xFF0C;&amp;#x624D;&amp;#x8FD4;&amp;#x56DE;&amp;#x5BA2;&amp;#x6237;&amp;#x7AEF;&amp;#x5199;&amp;#x5B8C;&amp;#x6210;&amp;#xFF08;&amp;#x5728;STATE_KV_QUEUED&amp;#x72B6;&amp;#x6001;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#xFF09;&amp;#xFF1B;&amp;#x5BF9;&amp;#x4E8E;WAL&amp;#xFF08;&amp;#x5373;&amp;#x8986;&amp;#x76D6;&amp;#x5199;&amp;#xFF09;&amp;#xFF0C;&amp;#x6CA1;&amp;#x6709;&amp;#x5148;&amp;#x628A;&amp;#x6570;&amp;#x636E;&amp;#x5199;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#xFF0C;&amp;#x800C;&amp;#x662F;&amp;#x5C06;&amp;#x6570;&amp;#x636E;&amp;#x548C;&amp;#x5143;&amp;#x6570;&amp;#x636E;&amp;#x4F5C;&amp;#x4E3A;wal&amp;#x4E00;&amp;#x8D77;&amp;#x63D0;&amp;#x4EA4;&amp;#x5230;rocksdb&amp;#x5E76;sync&amp;#x540E;&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x8FD4;&amp;#x56DE;&amp;#x5BA2;&amp;#x6237;&amp;#x7AEF;&amp;#x5199;&amp;#x6210;&amp;#x529F;&amp;#x4E86;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5728;&amp;#x540E;&amp;#x9762;&amp;#x7684;&amp;#x52A8;&amp;#x4F5C;&amp;#x5C31;&amp;#x662F;&amp;#x5C06;wal&amp;#x91CC;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x518D;&amp;#x5199;&amp;#x5230;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x7684;&amp;#x8FC7;&amp;#x7A0B;&amp;#xFF0C;&amp;#x5BF9;&amp;#x8FD9;&amp;#x4E2A;object&amp;#x7684;&amp;#x8BFB;&amp;#x8BF7;&amp;#x6C42;&amp;#x8981;&amp;#x7B49;&amp;#x5230;&amp;#x628A;&amp;#x6570;&amp;#x636E;&amp;#x5199;&amp;#x5230;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x5B8C;&amp;#x6210;&amp;#x6574;&amp;#x4E2A;wal&amp;#x5199;I/O&amp;#x7684;&amp;#x6D41;&amp;#x7A0B;&amp;#x540E;&amp;#x624D;&amp;#x884C;&amp;#xFF0C;&amp;#x4EE3;&amp;#x7801;&amp;#x91CC;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x662F;_do_read&amp;#x91CC;&amp;#x5148;o-&amp;gt;flush()&amp;#x7684;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;bluestore&amp;#x91CC;&amp;#x7684;wal&amp;#x5C31;&amp;#x7C7B;&amp;#x4F3C;filestore&amp;#x91CC;&amp;#x7684;journal&amp;#x7684;&amp;#x4F5C;&amp;#x7528;&amp;#x3002;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;#x524D;&amp;#x4E00;&amp;#x7BC7;&amp;#x300A;ceph&amp;#x5B58;&amp;#x50A8;&amp;#x5F15;&amp;#x64CE;bluestore&amp;#x89E3;&amp;#x6790;&amp;#x300B;&amp;#x5DF2;&amp;#x7ECF;&amp;#x5BF9;bluestore&amp;#x6574;&amp;#x4F53;&amp;#x67B6;&amp;#x6784;&amp;#x548C;I/O&amp;#x6620;&amp;#x5C04;&amp;#x903B;&amp;#x8F91;&amp;#x8FDB;&amp;#x884C;&amp;#x4E86;&amp;#x9610;&amp;#x8FF0;&amp;#xFF0C;&amp;#x672C;&amp;#x6587;&amp;#x4E3B;&amp;#x8981;&amp;#x4ECE;bluestore&amp;#x7684;&amp;#x5DE5;&amp;#x4F5C;&amp;#x5904;&amp;#x7406;&amp;#x6D41;&amp;#x7A0B;&amp;#x8FDB;&amp;#x884C;&amp;#x89E3;&amp;#x6790;&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;1-&amp;#x6574;&amp;#x4F53;&amp;#x6D41;&amp;#x7A0B;&quot;&gt;&lt;a href=&quot;#1-&amp;#x6574;&amp;#x4F53;&amp;#x6D41;&amp;#x7A0B;&quot; class=&quot;headerlink&quot; title=&quot;1.&amp;#x6574;&amp;#x4F53;&amp;#x6D41;&amp;#x7A0B;&quot;&gt;&lt;/a&gt;1.&amp;#x6574;&amp;#x4F53;&amp;#x6D41;&amp;#x7A0B;&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;/2016/08/25/bluestore-work-flow/state-machine.png&quot; alt=&quot;bluestore-work-flow&quot;&gt;&lt;br&gt;&amp;#x56FE;&amp;#x4E2D;&amp;#x5C55;&amp;#x793A;&amp;#x4E86;&amp;#x6D41;&amp;#x7A0B;&amp;#x4E2D;&amp;#x7684;&amp;#x5173;&amp;#x952E;&amp;#x8DEF;&amp;#x5F84;&amp;#x53CA;&amp;#x6D89;&amp;#x53CA;&amp;#x5230;&amp;#x7684;&amp;#x7EBF;&amp;#x7A0B;&amp;#x4E0E;&amp;#x961F;&amp;#x5217;&amp;#x3002;&amp;#x4E0B;&amp;#x9762;&amp;#x8BE6;&amp;#x7EC6;&amp;#x9610;&amp;#x8FF0;&amp;#x5DE5;&amp;#x4F5C;&amp;#x6D41;&amp;#x7A0B;&amp;#x3002;&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ceph" scheme="http://yoursite.com/categories/ceph/"/>
    
    
      <category term="ceph" scheme="http://yoursite.com/tags/ceph/"/>
    
  </entry>
  
  <entry>
    <title>ceph存储引擎bluestore解析</title>
    <link href="http://yoursite.com/2016/08/19/ceph-bluestore/"/>
    <id>http://yoursite.com/2016/08/19/ceph-bluestore/</id>
    <published>2016-08-19T10:21:56.000Z</published>
    <updated>2016-08-19T11:00:16.496Z</updated>
    
    <content type="html">&lt;p&gt;ceph&amp;#x540E;&amp;#x7AEF;&amp;#x652F;&amp;#x6301;&amp;#x591A;&amp;#x79CD;&amp;#x5B58;&amp;#x50A8;&amp;#x5F15;&amp;#x64CE;&amp;#xFF0C;&amp;#x4EE5;&amp;#x63D2;&amp;#x4EF6;&amp;#x5F0F;&amp;#x7684;&amp;#x65B9;&amp;#x5F0F;&amp;#x6765;&amp;#x8FDB;&amp;#x884C;&amp;#x7BA1;&amp;#x7406;&amp;#x4F7F;&amp;#x7528;&amp;#xFF0C;&amp;#x76EE;&amp;#x524D;&amp;#x652F;&amp;#x6301;filestore&amp;#xFF0C;kvstore&amp;#xFF0C;memstore&amp;#x4EE5;&amp;#x53CA;&amp;#x6700;&amp;#x65B0;&amp;#x7684;bluestore&amp;#xFF0C;&amp;#x76EE;&amp;#x524D;&amp;#x9ED8;&amp;#x8BA4;&amp;#x4F7F;&amp;#x7528;&amp;#x7684;filestore&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x56E0;&amp;#x4E3A;filestore&amp;#x5728;&amp;#x5199;&amp;#x6570;&amp;#x636E;&amp;#x524D;&amp;#x9700;&amp;#x8981;&amp;#x5148;&amp;#x5199;journal&amp;#xFF0C;&amp;#x4F1A;&amp;#x6709;&amp;#x4E00;&amp;#x500D;&amp;#x7684;&amp;#x5199;&amp;#x653E;&amp;#x5927;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;filestore&amp;#x4E00;&amp;#x5F00;&amp;#x59CB;&amp;#x53EA;&amp;#x662F;&amp;#x5BF9;&amp;#x4E8E;&amp;#x673A;&amp;#x68B0;&amp;#x76D8;&amp;#x8FDB;&amp;#x884C;&amp;#x8BBE;&amp;#x8BA1;&amp;#x7684;&amp;#xFF0C;&amp;#x6CA1;&amp;#x6709;&amp;#x4E13;&amp;#x95E8;&amp;#x9488;&amp;#x5BF9;ssd&amp;#x505A;&amp;#x4F18;&amp;#x5316;&amp;#x8003;&amp;#x8651;&amp;#xFF0C;&amp;#x56E0;&amp;#x6B64;&amp;#x8BDE;&amp;#x751F;&amp;#x7684;bluestore&amp;#x521D;&amp;#x8877;&amp;#x5C31;&amp;#x662F;&amp;#x4E3A;&amp;#x4E86;&amp;#x51CF;&amp;#x5C11;&amp;#x5199;&amp;#x653E;&amp;#x5927;&amp;#xFF0C;&amp;#x5E76;&amp;#x9488;&amp;#x5BF9;ssd&amp;#x505A;&amp;#x4F18;&amp;#x5316;&amp;#xFF0C;&amp;#x800C;&amp;#x4E14;&amp;#x76F4;&amp;#x63A5;&amp;#x7BA1;&amp;#x7406;&amp;#x88F8;&amp;#x76D8;&amp;#xFF0C;&amp;#x4ECE;&amp;#x7406;&amp;#x8BBA;&amp;#x4E0A;&amp;#x8FDB;&amp;#x4E00;&amp;#x6B65;&amp;#x51CF;&amp;#x5C11;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x5982;ext4/xfs&amp;#x7B49;&amp;#x90E8;&amp;#x5206;&amp;#x7684;&amp;#x5F00;&amp;#x9500;&amp;#xFF0C;&amp;#x76EE;&amp;#x524D;bluestore&amp;#x8FD8;&amp;#x5904;&amp;#x4E8E;&amp;#x5F00;&amp;#x53D1;&amp;#x4F18;&amp;#x5316;&amp;#x9636;&amp;#x6BB5;&amp;#xFF0C;&amp;#x5728;jewel&amp;#x7248;&amp;#x672C;&amp;#x8FD8;&amp;#x662F;&amp;#x8BD5;&amp;#x7528;&amp;#x7248;&amp;#x672C;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x6700;&amp;#x65B0;&amp;#x7684;master&amp;#x76F8;&amp;#x6BD4;jewel&amp;#x5DF2;&amp;#x7ECF;&amp;#x505A;&amp;#x4E86;&amp;#x5927;&amp;#x7684;&amp;#x91CD;&amp;#x6784;&amp;#xFF0C;&amp;#x9884;&amp;#x671F;&amp;#x4F1A;&amp;#x5728;&amp;#x540E;&amp;#x7EED;&amp;#x7684;&amp;#x5927;&amp;#x7248;&amp;#x672C;&amp;#x4E2D;&amp;#x7A33;&amp;#x5B9A;&amp;#x4E0B;&amp;#x6765;&amp;#x6210;&amp;#x4E3A;&amp;#x9ED8;&amp;#x8BA4;&amp;#x7684;&amp;#x5B58;&amp;#x50A8;&amp;#x5F15;&amp;#x64CE;&amp;#x3002;&amp;#x672C;&amp;#x6587;&amp;#x57FA;&amp;#x4E8E;master&amp;#x5206;&amp;#x652F;&amp;#x5BF9;bluestore&amp;#x5B58;&amp;#x50A8;&amp;#x5F15;&amp;#x64CE;&amp;#x8FDB;&amp;#x884C;&amp;#x5206;&amp;#x6790;&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;bluestore&amp;#x6574;&amp;#x4F53;&amp;#x67B6;&amp;#x6784;&quot;&gt;&lt;a href=&quot;#bluestore&amp;#x6574;&amp;#x4F53;&amp;#x67B6;&amp;#x6784;&quot; class=&quot;headerlink&quot; title=&quot;bluestore&amp;#x6574;&amp;#x4F53;&amp;#x67B6;&amp;#x6784;&quot;&gt;&lt;/a&gt;bluestore&amp;#x6574;&amp;#x4F53;&amp;#x67B6;&amp;#x6784;&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;/2016/08/19/ceph-bluestore/arch.png&quot; alt=&quot;ceph-bluestore&quot;&gt;&lt;/p&gt;
&lt;p&gt;bluestore&amp;#x76F4;&amp;#x63A5;&amp;#x7BA1;&amp;#x7406;&amp;#x88F8;&amp;#x8BBE;&amp;#x5907;&amp;#xFF0C;&amp;#x629B;&amp;#x5F03;&amp;#x4E86;ext4/xfs&amp;#x7B49;&amp;#x672C;&amp;#x5730;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#xFF0C;BlockDevice&amp;#x5B9E;&amp;#x73B0;&amp;#x5728;&amp;#x7528;&amp;#x6237;&amp;#x6001;&amp;#x4E0B;&amp;#x4F7F;&amp;#x7528;linux aio&amp;#x76F4;&amp;#x63A5;&amp;#x5BF9;&amp;#x88F8;&amp;#x8BBE;&amp;#x5907;&amp;#x8FDB;&amp;#x884C;I/O&amp;#x64CD;&amp;#x4F5C;&amp;#x3002;&amp;#x65E2;&amp;#x7136;&amp;#x662F;&amp;#x76F4;&amp;#x63A5;&amp;#x7BA1;&amp;#x7406;&amp;#x88F8;&amp;#x8BBE;&amp;#x5907;&amp;#x5C31;&amp;#x5FC5;&amp;#x7136;&amp;#x9700;&amp;#x8981;&amp;#x8FDB;&amp;#x884C;&amp;#x88F8;&amp;#x8BBE;&amp;#x5907;&amp;#x7684;&amp;#x7A7A;&amp;#x95F4;&amp;#x7BA1;&amp;#x7406;&amp;#xFF0C;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x5C31;&amp;#x662F;Allocator&amp;#xFF0C;&amp;#x76EE;&amp;#x524D;&amp;#x652F;&amp;#x6301;StupidAllocator&amp;#x548C;BitmapAllocator&amp;#x4E24;&amp;#x79CD;&amp;#x5206;&amp;#x914D;&amp;#x5668;&amp;#x3002;&amp;#x76F8;&amp;#x5173;&amp;#x7684;&amp;#x5143;&amp;#x6570;&amp;#x636E;&amp;#x4EE5;kv&amp;#x7684;&amp;#x5F62;&amp;#x5F0F;&amp;#x4FDD;&amp;#x5B58;&amp;#x5230;kv&amp;#x6570;&amp;#x636E;&amp;#x5E93;&amp;#x91CC;&amp;#xFF0C;&amp;#x9ED8;&amp;#x8BA4;&amp;#x4F7F;&amp;#x7528;&amp;#x7684;&amp;#x662F;rocksdb&amp;#xFF0C;&amp;#x7531;&amp;#x4E8E;rocksdb&amp;#x672C;&amp;#x8EAB;&amp;#x662F;&amp;#x57FA;&amp;#x4E8E;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#xFF0C;&amp;#x4E0D;&amp;#x662F;&amp;#x76F4;&amp;#x63A5;&amp;#x64CD;&amp;#x4F5C;&amp;#x88F8;&amp;#x8BBE;&amp;#x5907;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;rocksdb&amp;#x4E5F;&amp;#x6BD4;&amp;#x8F83;&amp;#x7075;&amp;#x6D3B;&amp;#xFF0C;&amp;#x5C06;&amp;#x7CFB;&amp;#x7EDF;&amp;#x76F8;&amp;#x5173;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x62BD;&amp;#x8C61;&amp;#x6210;Env&amp;#xFF0C;&amp;#x7528;&amp;#x6237;&amp;#x53EF;&amp;#x7528;&amp;#x5B9E;&amp;#x73B0;&amp;#x76F8;&amp;#x5E94;&amp;#x7684;&amp;#x63A5;&amp;#x53E3;&amp;#xFF0C;rocksdb&amp;#x9ED8;&amp;#x8BA4;&amp;#x7684;Env&amp;#x662F;PosixEnv&amp;#xFF0C;&amp;#x76F4;&amp;#x63A5;&amp;#x5BF9;&amp;#x63A5;&amp;#x672C;&amp;#x5730;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#xFF0C;&amp;#x4E3A;&amp;#x6B64;&amp;#xFF0C;bluestore&amp;#x5B9E;&amp;#x73B0;&amp;#x4E86;&amp;#x4E00;&amp;#x4E2A;BlueRocksEnv&amp;#xFF0C;&amp;#x7EE7;&amp;#x627F;&amp;#x81EA;EnvWrapper&amp;#xFF0C;&amp;#x6765;&amp;#x4E3A;rocksdb&amp;#x63D0;&amp;#x4F9B;&amp;#x5E95;&amp;#x5C42;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x5C01;&amp;#x88C5;&amp;#xFF0C;&amp;#x4E3A;&amp;#x4E86;&amp;#x5BF9;&amp;#x63A5;BlueRocksEnv&amp;#xFF0C;&amp;#x5B9E;&amp;#x73B0;&amp;#x4E86;&amp;#x4E00;&amp;#x4E2A;&amp;#x5C0F;&amp;#x7684;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;BlueFS&amp;#xFF0C;&amp;#x53EA;&amp;#x5B9E;&amp;#x73B0;rocksdb Env&amp;#x9700;&amp;#x8981;&amp;#x7684;&amp;#x63A5;&amp;#x53E3;&amp;#xFF0C;&amp;#x5728;&amp;#x7CFB;&amp;#x7EDF;&amp;#x542F;&amp;#x52A8;mount&amp;#x8FD9;&amp;#x4E2A;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x5C06;&amp;#x6240;&amp;#x6709;&amp;#x7684;&amp;#x5143;&amp;#x6570;&amp;#x636E;&amp;#x90FD;&amp;#x52A0;&amp;#x8F7D;&amp;#x5230;&amp;#x5185;&amp;#x5B58;&amp;#x4E2D;&amp;#xFF0C;BluesFS&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x548C;&amp;#x65E5;&amp;#x5FD7;&amp;#x6587;&amp;#x4EF6;&amp;#x90FD;&amp;#x901A;&amp;#x8FC7;BlockDevice&amp;#x4FDD;&amp;#x5B58;&amp;#x5230;&amp;#x88F8;&amp;#x8BBE;&amp;#x5907;&amp;#x4E0A;&amp;#xFF0C;BlueFS&amp;#x548C;BlueStore&amp;#x53EF;&amp;#x4EE5;&amp;#x5171;&amp;#x4EAB;&amp;#x88F8;&amp;#x8BBE;&amp;#x5907;&amp;#xFF0C;&amp;#x4E5F;&amp;#x53EF;&amp;#x4EE5;&amp;#x5206;&amp;#x522B;&amp;#x6307;&amp;#x5B9A;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x8BBE;&amp;#x5907;&amp;#x3002;&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;bluestore&amp;#x5143;&amp;#x6570;&amp;#x636E;&quot;&gt;&lt;a href=&quot;#bluestore&amp;#x5143;&amp;#x6570;&amp;#x636E;&quot; class=&quot;headerlink&quot; title=&quot;bluestore&amp;#x5143;&amp;#x6570;&amp;#x636E;&quot;&gt;&lt;/a&gt;bluestore&amp;#x5143;&amp;#x6570;&amp;#x636E;&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;/2016/08/19/ceph-bluestore/metadata.png&quot; alt=&quot;ceph-bluestore&quot;&gt;&lt;br&gt;&amp;#x5728;&amp;#x4E4B;&amp;#x524D;&amp;#x7684;&amp;#x5B58;&amp;#x50A8;&amp;#x5F15;&amp;#x64CE;filestore&amp;#x91CC;&amp;#xFF0C;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x8868;&amp;#x73B0;&amp;#x5F62;&amp;#x5F0F;&amp;#x662F;&amp;#x5BF9;&amp;#x5E94;&amp;#x5230;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x91CC;&amp;#x7684;&amp;#x6587;&amp;#x4EF6;&amp;#xFF0C;&amp;#x9ED8;&amp;#x8BA4;4MB&amp;#x5927;&amp;#x5C0F;&amp;#x7684;&amp;#x6587;&amp;#x4EF6;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x5728;bluestore&amp;#x91CC;&amp;#xFF0C;&amp;#x5DF2;&amp;#x7ECF;&amp;#x6CA1;&amp;#x6709;&amp;#x4F20;&amp;#x7EDF;&amp;#x7684;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#xFF0C;&amp;#x800C;&amp;#x662F;&amp;#x81EA;&amp;#x5DF1;&amp;#x7BA1;&amp;#x7406;&amp;#x88F8;&amp;#x76D8;&amp;#xFF0C;&amp;#x56E0;&amp;#x6B64;&amp;#x9700;&amp;#x8981;&amp;#x6709;&amp;#x5143;&amp;#x6570;&amp;#x636E;&amp;#x6765;&amp;#x7BA1;&amp;#x7406;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x5C31;&amp;#x662F;Onode&amp;#xFF0C;Onode&amp;#x662F;&amp;#x5E38;&amp;#x9A7B;&amp;#x5185;&amp;#x5B58;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#xFF0C;&amp;#x6301;&amp;#x4E45;&amp;#x5316;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x4F1A;&amp;#x4EE5;kv&amp;#x7684;&amp;#x5F62;&amp;#x5F0F;&amp;#x5B58;&amp;#x5230;rocksdb&amp;#x91CC;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x5728;onode&amp;#x91CC;&amp;#x53C8;&amp;#x5206;&amp;#x4E3A;lextent&amp;#xFF0C;&amp;#x8868;&amp;#x793A;&amp;#x903B;&amp;#x8F91;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x5757;&amp;#xFF0C;&amp;#x7528;&amp;#x4E00;&amp;#x4E2A;map&amp;#x6765;&amp;#x8BB0;&amp;#x5F55;&amp;#xFF0C;&amp;#x4E00;&amp;#x4E2A;onode&amp;#x91CC;&amp;#x4F1A;&amp;#x5B58;&amp;#x5728;&amp;#x591A;&amp;#x4E2A;lextent&amp;#xFF0C;lextent&amp;#x901A;&amp;#x8FC7;blob&amp;#x7684;id&amp;#x5BF9;&amp;#x5E94;&amp;#x5230;blob&amp;#xFF08;bluestore_blob_t &amp;#xFF09;&amp;#xFF0C;blob&amp;#x91CC;&amp;#x901A;&amp;#x8FC7;pextent&amp;#x5BF9;&amp;#x5E94;&amp;#x5230;&amp;#x5B9E;&amp;#x9645;&amp;#x7269;&amp;#x7406;&amp;#x76D8;&amp;#x4E0A;&amp;#x7684;&amp;#x533A;&amp;#x57DF;&amp;#xFF08;pextent&amp;#x91CC;&amp;#x5C31;&amp;#x662F;offset&amp;#x548C;length&amp;#x6765;&amp;#x5B9A;&amp;#x4F4D;&amp;#x7269;&amp;#x7406;&amp;#x76D8;&amp;#x7684;&amp;#x4F4D;&amp;#x7F6E;&amp;#x533A;&amp;#x57DF;&amp;#xFF09;&amp;#x3002;&amp;#x4E00;&amp;#x4E2A;onode&amp;#x91CC;&amp;#x7684;&amp;#x591A;&amp;#x4E2A;lextent&amp;#x53EF;&amp;#x80FD;&amp;#x5728;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;blob&amp;#x91CC;&amp;#xFF0C;&amp;#x800C;&amp;#x4E00;&amp;#x4E2A;blob&amp;#x4E5F;&amp;#x53EF;&amp;#x80FD;&amp;#x5BF9;&amp;#x5E94;&amp;#x5230;&amp;#x591A;&amp;#x4E2A;pextent&amp;#x3002;&lt;br&gt;&amp;#x53E6;&amp;#x5916;&amp;#x8FD8;&amp;#x6709;Bnode&amp;#x8FD9;&amp;#x4E2A;&amp;#x5143;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x5B83;&amp;#x662F;&amp;#x7528;&amp;#x6765;&amp;#x8868;&amp;#x793A;&amp;#x591A;&amp;#x4E2A;object&amp;#x53EF;&amp;#x80FD;&amp;#x5171;&amp;#x4EAB;extent&amp;#xFF0C;&amp;#x76EE;&amp;#x524D;&amp;#x5728;&amp;#x505A;&amp;#x4E86;&amp;#x5FEB;&amp;#x7167;&amp;#x540E;&amp;#x5199;I/O&amp;#x89E6;&amp;#x53D1;&amp;#x7684;cow&amp;#x8FDB;&amp;#x884C;clone&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x4F1A;&amp;#x7528;&amp;#x5230;&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;I-O&amp;#x8BFB;&amp;#x5199;&amp;#x6620;&amp;#x5C04;&amp;#x903B;&amp;#x8F91;&quot;&gt;&lt;a href=&quot;#I-O&amp;#x8BFB;&amp;#x5199;&amp;#x6620;&amp;#x5C04;&amp;#x903B;&amp;#x8F91;&quot; class=&quot;headerlink&quot; title=&quot;I/O&amp;#x8BFB;&amp;#x5199;&amp;#x6620;&amp;#x5C04;&amp;#x903B;&amp;#x8F91;&quot;&gt;&lt;/a&gt;I/O&amp;#x8BFB;&amp;#x5199;&amp;#x6620;&amp;#x5C04;&amp;#x903B;&amp;#x8F91;&lt;/h1&gt;&lt;h2 id=&quot;&amp;#x5199;I-O&amp;#x5904;&amp;#x7406;&quot;&gt;&lt;a href=&quot;#&amp;#x5199;I-O&amp;#x5904;&amp;#x7406;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x5199;I/O&amp;#x5904;&amp;#x7406;&quot;&gt;&lt;/a&gt;&amp;#x5199;I/O&amp;#x5904;&amp;#x7406;&lt;/h2&gt;&lt;p&gt;&amp;#x5230;&amp;#x8FBE;bluestore&amp;#x7684;I/O&amp;#x7684;offset&amp;#x548C;length&amp;#x90FD;&amp;#x662F;&amp;#x5BF9;&amp;#x8C61;&amp;#x5185;&amp;#xFF08;onode&amp;#xFF09;&amp;#x7684;&amp;#xFF0C;offset&amp;#x662F;&amp;#x76F8;&amp;#x5BF9;&amp;#x4E8E;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x8D77;&amp;#x59CB;&amp;#x4F4D;&amp;#x7F6E;&amp;#x7684;&amp;#x504F;&amp;#x79FB;&amp;#xFF0C;&amp;#x5728;_do_write&amp;#x91CC;&amp;#x9996;&amp;#x5148;&amp;#x5C31;&amp;#x4F1A;&amp;#x6839;&amp;#x636E;&amp;#x6700;&amp;#x5C0F;&amp;#x5206;&amp;#x914D;&amp;#x5355;&amp;#x4F4D;min_alloc_size&amp;#x8FDB;&amp;#x884C;&amp;#x5224;&amp;#x65AD;&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;&amp;#x5C06;I/O&amp;#x5206;&amp;#x4E3A;&amp;#x5BF9;&amp;#x9F50;&amp;#x548C;&amp;#x975E;&amp;#x5BF9;&amp;#x9F50;&amp;#x7684;&amp;#x3002;&amp;#x5982;&amp;#x4E0B;&amp;#x56FE;&amp;#x6240;&amp;#x793A;&amp;#xFF1A;&lt;br&gt;&lt;img src=&quot;/2016/08/19/ceph-bluestore/iosplit.png&quot; alt=&quot;ceph-bluestore&quot;&gt;&lt;br&gt;&amp;#x5F53;&amp;#x4E00;&amp;#x4E2A;&amp;#x5199;&amp;#x8BF7;&amp;#x6C42;&amp;#x6309;&amp;#x7167;min_alloc_size&amp;#x8FDB;&amp;#x884C;&amp;#x62C6;&amp;#x5206;&amp;#x540E;&amp;#xFF0C;&amp;#x5C31;&amp;#x4F1A;&amp;#x5206;&amp;#x4E3A;&amp;#x5BF9;&amp;#x9F50;&amp;#x5199;&amp;#xFF0C;&amp;#x5BF9;&amp;#x5E94;&amp;#x5230;do_write_big&amp;#xFF0C;&amp;#x975E;&amp;#x5BF9;&amp;#x9F50;&amp;#x5199;&amp;#xFF08;&amp;#x5373;&amp;#x843D;&amp;#x5230;&amp;#x67D0;&amp;#x4E00;&amp;#x4E2A;min_alloc_size&amp;#x533A;&amp;#x95F4;&amp;#x7684;&amp;#x5199;I/O&amp;#xFF08;&amp;#x5BF9;&amp;#x5E94;&amp;#x5230;do_write_small&amp;#xFF09;&amp;#x3002;&lt;/p&gt;
&lt;h3 id=&quot;do-write-big&quot;&gt;&lt;a href=&quot;#do-write-big&quot; class=&quot;headerlink&quot; title=&quot;do_write_big&quot;&gt;&lt;/a&gt;do_write_big&lt;/h3&gt;&lt;p&gt;&amp;#x5BF9;&amp;#x9F50;&amp;#x5230;min_alloc_size&amp;#x7684;&amp;#x5199;&amp;#x8BF7;&amp;#x6C42;&amp;#x5904;&amp;#x7406;&amp;#x8D77;&amp;#x6765;&amp;#x6BD4;&amp;#x8F83;&amp;#x7B80;&amp;#x5355;&amp;#xFF0C;&amp;#x6709;&amp;#x53EF;&amp;#x80FD;&amp;#x662F;&amp;#x591A;&amp;#x4E2A;min_alloc_size&amp;#x7684;&amp;#x5927;&amp;#x5C0F;&amp;#xFF0C;&amp;#x5728;&amp;#x5904;&amp;#x7406;&amp;#x65F6;&amp;#x4F1A;&amp;#x6839;&amp;#x636E;&amp;#x5B9E;&amp;#x9645;&amp;#x5927;&amp;#x5C0F;&amp;#x65B0;&amp;#x751F;&amp;#x6210;lextent&amp;#x548C;blob&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;lextent&amp;#x8DE8;&amp;#x8D8A;&amp;#x7684;&amp;#x533A;&amp;#x57DF;&amp;#x662F;min_alloc_size&amp;#x7684;&amp;#x6574;&amp;#x6570;&amp;#x500D;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x8FD9;&amp;#x6BB5;&amp;#x533A;&amp;#x95F4;&amp;#x662F;&amp;#x4E4B;&amp;#x524D;&amp;#x5199;&amp;#x8FC7;&amp;#x7684;&amp;#xFF0C;&amp;#x4F1A;&amp;#x5C06;&amp;#x4E4B;&amp;#x524D;&amp;#x7684;lextent&amp;#x8BB0;&amp;#x5F55;&amp;#x4E0B;&amp;#x6765;&amp;#x4FBF;&amp;#x4E8E;&amp;#x540E;&amp;#x7EED;&amp;#x7684;&amp;#x7A7A;&amp;#x95F4;&amp;#x56DE;&amp;#x6536;&amp;#x3002;&lt;/p&gt;
&lt;h3 id=&quot;do-write-small&quot;&gt;&lt;a href=&quot;#do-write-small&quot; class=&quot;headerlink&quot; title=&quot;do_write_small&quot;&gt;&lt;/a&gt;do_write_small&lt;/h3&gt;&lt;p&gt;&amp;#x5728;&amp;#x5904;&amp;#x7406;&amp;#x843D;&amp;#x5230;&amp;#x67D0;&amp;#x4E2A;min_alloc_size&amp;#x533A;&amp;#x95F4;&amp;#x7684;&amp;#x5199;&amp;#x8BF7;&amp;#x6C42;&amp;#x65F6;&amp;#xFF0C;&amp;#x4F1A;&amp;#x9996;&amp;#x5148;&amp;#x6839;&amp;#x636E;offset&amp;#x53BB;&amp;#x67E5;&amp;#x627E;&amp;#x6709;&amp;#x6CA1;&amp;#x6709;&amp;#x53EF;&amp;#x4EE5;&amp;#x590D;&amp;#x7528;&amp;#x7684;blob&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x6700;&amp;#x5C0F;&amp;#x5206;&amp;#x914D;&amp;#x5355;&amp;#x5143;&amp;#x662F;min_alloc_size&amp;#xFF0C;&amp;#x9ED8;&amp;#x8BA4;64KB&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x4E00;&amp;#x4E2A;4KB&amp;#x7684;&amp;#x5199;I/O&amp;#x5C31;&amp;#x53EA;&amp;#x4F1A;&amp;#x7528;&amp;#x5230;blob&amp;#x7684;&amp;#x4E00;&amp;#x90E8;&amp;#x5206;&amp;#xFF0C;blob&amp;#x91CC;&amp;#x5269;&amp;#x4F59;&amp;#x7684;&amp;#x8FD8;&amp;#x80FD;&amp;#x653E;&amp;#x5176;&amp;#x4ED6;&amp;#x7684;&amp;#x3002;&lt;/p&gt;
&lt;h4 id=&quot;1&amp;#xFF09;&amp;#x6CA1;&amp;#x6709;&amp;#x627E;&amp;#x5230;&amp;#x53EF;&amp;#x4EE5;&amp;#x590D;&amp;#x7528;&amp;#x7684;blob&amp;#xFF0C;&amp;#x65B0;&amp;#x751F;&amp;#x6210;blob&quot;&gt;&lt;a href=&quot;#1&amp;#xFF09;&amp;#x6CA1;&amp;#x6709;&amp;#x627E;&amp;#x5230;&amp;#x53EF;&amp;#x4EE5;&amp;#x590D;&amp;#x7528;&amp;#x7684;blob&amp;#xFF0C;&amp;#x65B0;&amp;#x751F;&amp;#x6210;blob&quot; class=&quot;headerlink&quot; title=&quot;1&amp;#xFF09;&amp;#x6CA1;&amp;#x6709;&amp;#x627E;&amp;#x5230;&amp;#x53EF;&amp;#x4EE5;&amp;#x590D;&amp;#x7528;&amp;#x7684;blob&amp;#xFF0C;&amp;#x65B0;&amp;#x751F;&amp;#x6210;blob&quot;&gt;&lt;/a&gt;1&amp;#xFF09;&amp;#x6CA1;&amp;#x6709;&amp;#x627E;&amp;#x5230;&amp;#x53EF;&amp;#x4EE5;&amp;#x590D;&amp;#x7528;&amp;#x7684;blob&amp;#xFF0C;&amp;#x65B0;&amp;#x751F;&amp;#x6210;blob&lt;/h4&gt;&lt;p&gt;&lt;img src=&quot;/2016/08/19/ceph-bluestore/newblob.png&quot; alt=&quot;ceph-bluestore&quot;&gt;&lt;br&gt;&amp;#x5728;&amp;#x5904;&amp;#x7406;&amp;#x8FD8;&amp;#x8FD8;&amp;#x9700;&amp;#x8981;&amp;#x6839;&amp;#x636E;offset&amp;#x548C;len&amp;#x662F;&amp;#x5426;&amp;#x5BF9;&amp;#x9F50;&amp;#x5230;block_size&amp;#xFF08;&amp;#x9ED8;&amp;#x8BA4;&amp;#x662F;4KB&amp;#xFF09;&amp;#x8FDB;&amp;#x884C;&amp;#x8865;&amp;#x96F6;&amp;#x5BF9;&amp;#x9F50;&amp;#x7684;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x4E4B;&amp;#x6240;&amp;#x4EE5;&amp;#x9700;&amp;#x8981;&amp;#x8865;&amp;#x9F50;&amp;#x662F;&amp;#x4E0E;&amp;#x540E;&amp;#x7EED;&amp;#x7684;&amp;#x5199;&amp;#x76D8;&amp;#x64CD;&amp;#x4F5C;&amp;#x6709;&amp;#x5173;&amp;#xFF0C;&amp;#x771F;&amp;#x6B63;&amp;#x5199;&amp;#x76D8;&amp;#x65F6;&amp;#x6709;&amp;#x4E24;&amp;#x79CD;&amp;#x65B9;&amp;#x5F0F;&amp;#xFF0C;&amp;#x4E00;&amp;#x79CD;&amp;#x662F;Direct I/O&amp;#x7684;&amp;#x65B9;&amp;#x5F0F;&amp;#xFF0C;&amp;#x8FD9;&amp;#x79CD;&amp;#x8981;&amp;#x6C42;&amp;#x504F;&amp;#x79FB;&amp;#x548C;&amp;#x7F13;&amp;#x51B2;&amp;#x533A;&amp;#x90FD;&amp;#x5BF9;&amp;#x9F50;&amp;#x7684;&amp;#xFF0C;&amp;#x53E6;&amp;#x5916;&amp;#x4E00;&amp;#x79CD;&amp;#x975E;Direct I/O&amp;#xFF0C;&amp;#x5373;Buffered I/O&amp;#xFF0C;&amp;#x8FD9;&amp;#x79CD;&amp;#x53EF;&amp;#x4EE5;&amp;#x4E0D;&amp;#x5BF9;&amp;#x9F50;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x662F;&amp;#x5199;&amp;#x5230;cache&amp;#x91CC;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x518D;sync&amp;#x5237;&amp;#x5230;&amp;#x78C1;&amp;#x76D8;&amp;#x4E0A;&amp;#xFF0C;&amp;#x6BD4;&amp;#x5982;&amp;#x53EA;&amp;#x5199;&amp;#x4E86;100&amp;#x5B57;&amp;#x8282;&amp;#xFF0C;&amp;#x5728;&amp;#x5185;&amp;#x6838;&amp;#x91CC;&amp;#x662F;&amp;#x9700;&amp;#x8981;&amp;#x5148;&amp;#x4ECE;&amp;#x8BBE;&amp;#x5907;&amp;#x4E0A;&amp;#x8BFB;&amp;#x51FA;&amp;#x6765;&amp;#x8865;&amp;#x9F50;&amp;#x6210;&amp;#x4E00;&amp;#x4E2A;&amp;#x5B8C;&amp;#x6574;&amp;#x7684;&amp;#x6247;&amp;#x533A;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x518D;&amp;#x5237;&amp;#x7684;&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;&amp;#x53CD;&amp;#x800C;&amp;#x964D;&amp;#x4F4E;&amp;#x4E86;&amp;#x6548;&amp;#x7387;&amp;#x3002;&amp;#x56E0;&amp;#x6B64;&amp;#x5728;bluestore&amp;#x91CC;&amp;#x76F4;&amp;#x63A5;&amp;#x5904;&amp;#x7406;&amp;#x597D;&amp;#x5BF9;&amp;#x9F50;&amp;#xFF0C;&amp;#x5BF9;&amp;#x4E8E;&amp;#x540E;&amp;#x9762;&amp;#x7684;&amp;#x5199;&amp;#x76D8;&amp;#x6765;&amp;#x8BF4;&amp;#x6BD4;&amp;#x8F83;&amp;#x6709;&amp;#x5229;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x5BF9;&amp;#x9F50;&amp;#x5230;block_size&amp;#xFF0C;&amp;#x662F;&amp;#x4E2A;&amp;#x53EF;&amp;#x914D;&amp;#x7F6E;&amp;#x7684;&amp;#x53C2;&amp;#x6570;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x8FDB;&amp;#x884C;&amp;#x5BF9;&amp;#x9F50;&amp;#x8865;&amp;#x96F6;&amp;#x65F6;&amp;#x5C31;&amp;#x662F;&amp;#x6309;&amp;#x7167;&amp;#x5982;&amp;#x4E0A;&amp;#x56FE;&amp;#x90A3;&amp;#x6837;&amp;#x628A;&amp;#x524D;&amp;#x540E;&amp;#x5BF9;&amp;#x9F50;&amp;#x5230;block_size&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x518D;&amp;#x628A;&amp;#x5BF9;&amp;#x9F50;&amp;#x540E;&amp;#x7684;offset&amp;#x548C;len&amp;#x4F5C;&amp;#x4E3A;lextent&amp;#xFF0C;&amp;#x8FDB;&amp;#x800C;&amp;#x653E;&amp;#x5230;blob&amp;#x91CC;&amp;#x3002;&lt;/p&gt;
&lt;h4 id=&quot;2&amp;#xFF09;&amp;#x627E;&amp;#x5230;&amp;#x53EF;&amp;#x4EE5;&amp;#x590D;&amp;#x7528;&amp;#x7684;blob&quot;&gt;&lt;a href=&quot;#2&amp;#xFF09;&amp;#x627E;&amp;#x5230;&amp;#x53EF;&amp;#x4EE5;&amp;#x590D;&amp;#x7528;&amp;#x7684;blob&quot; class=&quot;headerlink&quot; title=&quot;2&amp;#xFF09;&amp;#x627E;&amp;#x5230;&amp;#x53EF;&amp;#x4EE5;&amp;#x590D;&amp;#x7528;&amp;#x7684;blob&quot;&gt;&lt;/a&gt;2&amp;#xFF09;&amp;#x627E;&amp;#x5230;&amp;#x53EF;&amp;#x4EE5;&amp;#x590D;&amp;#x7528;&amp;#x7684;blob&lt;/h4&gt;&lt;p&gt;&amp;#x5BF9;&amp;#x4E8E;&amp;#x53EF;&amp;#x4EE5;&amp;#x590D;&amp;#x7528;&amp;#x7684;blob&amp;#xFF0C;&amp;#x4E5F;&amp;#x662F;&amp;#x5148;&amp;#x6309;&amp;#x7167;block_size&amp;#x8FDB;&amp;#x884C;&amp;#x5BF9;&amp;#x9F50;&amp;#x8865;&amp;#x96F6;&amp;#x7684;&amp;#x52A8;&amp;#x4F5C;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x518D;&amp;#x5224;&amp;#x65AD;&amp;#x662F;&amp;#x5426;&amp;#x53EF;&amp;#x4EE5;&amp;#x76F4;&amp;#x63A5;&amp;#x4F7F;&amp;#x7528;blob&amp;#x91CC;&amp;#x7A7A;&amp;#x95F2;&amp;#x7684;&amp;#x7A7A;&amp;#x95F4;&amp;#x8FDB;&amp;#x884C;&amp;#x533A;&amp;#x5206;&amp;#x505A;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;a&amp;#xFF09;&amp;#x76F4;&amp;#x63A5;&amp;#x5199;&amp;#x5728;blob&amp;#x672A;&amp;#x4F7F;&amp;#x7528;&amp;#x7684;&amp;#x7A7A;&amp;#x95F4;&amp;#x4E0A;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x8FD9;&amp;#x79CD;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;&amp;#x76F4;&amp;#x63A5;&amp;#x65B0;&amp;#x751F;&amp;#x6210;lextent&amp;#x653E;&amp;#x5230;blob&amp;#x91CC;&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2016/08/19/ceph-bluestore/writetoblob.png&quot; alt=&quot;ceph-bluestore&quot;&gt;&lt;br&gt;&lt;strong&gt;b&amp;#xFF09;&amp;#x8986;&amp;#x76D6;&amp;#x5199;&amp;#x7684;&amp;#x60C5;&amp;#x51B5;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x6BD4;&amp;#x5982;&amp;#x4E0B;&amp;#x9762;&amp;#x7684;&amp;#x8FD9;&amp;#x79CD;&amp;#x60C5;&amp;#x51B5;&amp;#xFF0C;&amp;#x5199;I/O&amp;#x4F1A;&amp;#x8986;&amp;#x76D6;&amp;#x90E8;&amp;#x5206;&amp;#x5DF2;&amp;#x7ECF;&amp;#x5199;&amp;#x8FC7;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2016/08/19/ceph-bluestore/overwrite.png&quot; alt=&quot;ceph-bluestore&quot;&gt;&lt;br&gt;&amp;#x5BF9;&amp;#x4E8E;&amp;#x8FD9;&amp;#x79CD;&amp;#x60C5;&amp;#x51B5;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x5982;&amp;#x4E0B;&amp;#x56FE;&amp;#xFF1A;&amp;#x4E5F;&amp;#x662F;&amp;#x9700;&amp;#x8981;&amp;#x5148;&amp;#x5904;&amp;#x7406;&amp;#x5BF9;&amp;#x9F50;&amp;#x8865;&amp;#x96F6;&amp;#x7684;&amp;#x60C5;&amp;#x51B5;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x8986;&amp;#x76D6;&amp;#x7684;&amp;#x533A;&amp;#x57DF;&amp;#x521A;&amp;#x597D;&amp;#x662F;&amp;#x5DF2;&amp;#x7ECF;&amp;#x5BF9;&amp;#x9F50;&amp;#x5230;block_size&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x5C31;&amp;#x4E0D;&amp;#x9700;&amp;#x8981;&amp;#x4ECE;&amp;#x78C1;&amp;#x76D8;&amp;#x8BFB;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x5982;&amp;#x679C;&amp;#x8986;&amp;#x76D6;&amp;#x7684;&amp;#x533A;&amp;#x57DF;&amp;#x6CA1;&amp;#x6709;&amp;#x5BF9;&amp;#x9F50;&amp;#x5230;block_size&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x5C31;&amp;#x9700;&amp;#x8981;&amp;#x628A;&amp;#x4E0D;&amp;#x5BF9;&amp;#x9F50;&amp;#x7684;&amp;#x90A3;&amp;#x90E8;&amp;#x5206;&amp;#x8BFB;&amp;#x51FA;&amp;#x6765;&amp;#xFF0C;&amp;#x62FC;&amp;#x6210;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x9F50;&amp;#x7684;buffer&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x65B0;&amp;#x751F;&amp;#x6210;lextent&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x4F1A;&amp;#x5BF9;&amp;#x539F;&amp;#x6765;&amp;#x90A3;&amp;#x4E2A;lextent&amp;#x8FDB;&amp;#x884C;&amp;#x8C03;&amp;#x6574;&amp;#xFF0C;&amp;#x4F1A;&amp;#x8BB0;&amp;#x5F55;&amp;#x9700;&amp;#x8981;&amp;#x56DE;&amp;#x6536;&amp;#x7684;&amp;#x90A3;&amp;#x90E8;&amp;#x5206;&amp;#x533A;&amp;#x57DF;&amp;#x3002;&amp;#x5BF9;&amp;#x4E8E;&amp;#x8986;&amp;#x76D6;&amp;#x5199;&amp;#x7684;&amp;#x60C5;&amp;#x51B5;&amp;#xFF0C;&amp;#x90FD;&amp;#x4E0D;&amp;#x662F;&amp;#x76F4;&amp;#x63A5;&amp;#x5199;&amp;#x76D8;&amp;#xFF0C;&amp;#x800C;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;wal&amp;#x5199;&amp;#x5230;rocksdb&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2016/08/19/ceph-bluestore/overwrite_wal.png&quot; alt=&quot;ceph-bluestore&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;&amp;#x6574;&amp;#x4F53;&amp;#x5199;I-O&amp;#x7684;&amp;#x903B;&amp;#x8F91;&quot;&gt;&lt;a href=&quot;#&amp;#x6574;&amp;#x4F53;&amp;#x5199;I-O&amp;#x7684;&amp;#x903B;&amp;#x8F91;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x6574;&amp;#x4F53;&amp;#x5199;I/O&amp;#x7684;&amp;#x903B;&amp;#x8F91;&quot;&gt;&lt;/a&gt;&amp;#x6574;&amp;#x4F53;&amp;#x5199;I/O&amp;#x7684;&amp;#x903B;&amp;#x8F91;&lt;/h3&gt;&lt;p&gt;&amp;#x4E4B;&amp;#x524D;&amp;#x7EC4;&amp;#x5185;&amp;#x540C;&amp;#x4E8B;&amp;#x753B;&amp;#x8FC7;&amp;#x4E00;&amp;#x4E2A;&amp;#x6D41;&amp;#x7A0B;&amp;#x56FE;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x501F;&amp;#x7528;&amp;#x4E00;&amp;#x4E0B;&amp;#x7B97;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x7B80;&amp;#x5355;&amp;#x7684;&amp;#x603B;&amp;#x7ED3;&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2016/08/19/ceph-bluestore/writeflow.png&quot; alt=&quot;ceph-bluestore&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;&amp;#x8BFB;I-O&amp;#x7684;&amp;#x5904;&amp;#x7406;&quot;&gt;&lt;a href=&quot;#&amp;#x8BFB;I-O&amp;#x7684;&amp;#x5904;&amp;#x7406;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x8BFB;I/O&amp;#x7684;&amp;#x5904;&amp;#x7406;&quot;&gt;&lt;/a&gt;&amp;#x8BFB;I/O&amp;#x7684;&amp;#x5904;&amp;#x7406;&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;/2016/08/19/ceph-bluestore/readio.png&quot; alt=&quot;ceph-bluestore&quot;&gt;&lt;br&gt;&amp;#x8BFB;I/O&amp;#x8BF7;&amp;#x6C42;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x65F6;&amp;#x4E5F;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;&amp;#x5BFB;&amp;#x627E;&amp;#x76F8;&amp;#x5173;&amp;#x8054;&amp;#x7684;lextent&amp;#xFF0C;&amp;#x53EF;&amp;#x80FD;&amp;#x4F1A;&amp;#x5B58;&amp;#x5728;&amp;#x7A7A;&amp;#x6D1E;&amp;#x7684;&amp;#x60C5;&amp;#x51B5;&amp;#xFF0C;&amp;#x5373;&amp;#x8BFB;&amp;#x5230;&amp;#x672A;&amp;#x5199;&amp;#x8FC7;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x8FD9;&amp;#x90E8;&amp;#x5206;&amp;#x5C31;&amp;#x76F4;&amp;#x63A5;&amp;#x8865;&amp;#x96F6;&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;clone&amp;#x53CA;extent&amp;#x5171;&amp;#x4EAB;&quot;&gt;&lt;a href=&quot;#clone&amp;#x53CA;extent&amp;#x5171;&amp;#x4EAB;&quot; class=&quot;headerlink&quot; title=&quot;clone&amp;#x53CA;extent&amp;#x5171;&amp;#x4EAB;&quot;&gt;&lt;/a&gt;clone&amp;#x53CA;extent&amp;#x5171;&amp;#x4EAB;&lt;/h2&gt;&lt;p&gt;&amp;#x524D;&amp;#x9762;&amp;#x8BF4;&amp;#x5230;Bnode&amp;#x5C31;&amp;#x662F;&amp;#x7528;&amp;#x6765;&amp;#x8BB0;&amp;#x5F55;&amp;#x5171;&amp;#x4EAB;&amp;#x7684;lextent&amp;#xFF0C;&amp;#x76EE;&amp;#x524D;&amp;#x662F;&amp;#x5728;&amp;#x505A;&amp;#x5B8C;&amp;#x5FEB;&amp;#x7167;&amp;#x540E;&amp;#x5BF9;&amp;#x539F;&amp;#x5377;&amp;#x8FDB;&amp;#x884C;&amp;#x5199;I/O&amp;#x4F1A;&amp;#x89E6;&amp;#x53D1;cow&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;&amp;#x4EA7;&amp;#x751F;clone&amp;#x64CD;&amp;#x4F5C;&amp;#x3002;clone&amp;#x65F6;&amp;#x5C31;&amp;#x662F;&amp;#x5C06;&amp;#x539F;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;blob&amp;#x4ECE;onode-&amp;gt;blob_map&amp;#x79FB;&amp;#x5230;onode-&amp;gt;bnode-&amp;gt;blob_map&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x5C06;blob id&amp;#x7F6E;&amp;#x4E3A;&amp;#x8D1F;&amp;#x7684;&amp;#xFF0C;&amp;#x5E76;&amp;#x8BBE;&amp;#x7F6E;&amp;#x5171;&amp;#x4EAB;&amp;#x6807;&amp;#x8BB0;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5C06;&amp;#x65B0;&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;onode-&amp;gt;bnode&amp;#x6307;&amp;#x5411;&amp;#x539F;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;onode-&amp;gt;bnode&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x7528;&amp;#x539F;onode&amp;#x91CC;&amp;#x7684;lextents&amp;#x91CC;&amp;#x7684;&amp;#x503C;&amp;#x8D4B;&amp;#x7ED9;&amp;#x65B0;&amp;#x7684;onode&amp;#x7684;lextents&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;&amp;#x8FBE;&amp;#x5230;&amp;#x5171;&amp;#x4EAB;extent&amp;#x7684;&amp;#x76EE;&amp;#x7684;&amp;#xFF0C;&amp;#x56FE;&amp;#x793A;&amp;#x4EC5;&amp;#x4F9B;&amp;#x53C2;&amp;#x8003;&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2016/08/19/ceph-bluestore/clone.png&quot; alt=&quot;ceph-bluestore&quot;&gt;&lt;br&gt;&amp;#x5728;clone&amp;#x5B8C;&amp;#x4E4B;&amp;#x540E;&amp;#xFF0C;&amp;#x7EE7;&amp;#x7EED;&amp;#x5BF9;&amp;#x539F;&amp;#x5BF9;&amp;#x8C61;&amp;#x8FDB;&amp;#x884C;&amp;#x5199;I/O&amp;#x64CD;&amp;#x4F5C;&amp;#x65F6;&amp;#xFF0C;&amp;#x5F53;&amp;#x78B0;&amp;#x5230;&amp;#x5171;&amp;#x4EAB;&amp;#x7684;blob&amp;#x65F6;&amp;#x5C31;&amp;#x9700;&amp;#x8981;&amp;#x8DF3;&amp;#x8FC7;&amp;#xFF0C;&amp;#x65B0;&amp;#x751F;&amp;#x6210;blob&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x53D6;&amp;#x6D88;&amp;#x5BF9;&amp;#x539F;&amp;#x6765;&amp;#x90A3;&amp;#x90E8;&amp;#x5206;lextent&amp;#x7684;&amp;#x5F15;&amp;#x7528;&amp;#xFF0C;&amp;#x5728;&amp;#x540E;&amp;#x7EED;&amp;#x7684;&amp;#x7A7A;&amp;#x95F4;&amp;#x91CA;&amp;#x653E;&amp;#x65F6;&amp;#x7684;&amp;#x5224;&amp;#x65AD;&amp;#x4F9D;&amp;#x636E;&amp;#x5C31;&amp;#x662F;&amp;#x5426;&amp;#x8FD8;&amp;#x6709;&amp;#x5F15;&amp;#x7528;&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2016/08/19/ceph-bluestore/cloneio.png&quot; alt=&quot;ceph-bluestore&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;&amp;#x5C0F;&amp;#x7ED3;&quot;&gt;&lt;a href=&quot;#&amp;#x5C0F;&amp;#x7ED3;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x5C0F;&amp;#x7ED3;&quot;&gt;&lt;/a&gt;&amp;#x5C0F;&amp;#x7ED3;&lt;/h1&gt;&lt;p&gt;&amp;#x672C;&amp;#x6587;&amp;#x603B;&amp;#x4F53;&amp;#x4E0A;&amp;#x4ECB;&amp;#x7ECD;&amp;#x4E86;bluestore&amp;#x7684;&amp;#x67B6;&amp;#x6784;&amp;#x3001;&amp;#x76F8;&amp;#x5173;&amp;#x5143;&amp;#x6570;&amp;#x636E;&amp;#x53CA;&amp;#x5185;&amp;#x90E8;I/O&amp;#x6620;&amp;#x5C04;&amp;#x7684;&amp;#x903B;&amp;#x8F91;&amp;#xFF0C;&amp;#x8FD9;&amp;#x8FD8;&amp;#x53EA;&amp;#x662F;bluestore&amp;#x7684;&amp;#x51B0;&amp;#x5C71;&amp;#x4E00;&amp;#x89D2;&amp;#xFF0C;&amp;#x540E;&amp;#x7EED;&amp;#x4F1A;&amp;#x9646;&amp;#x7EED;&amp;#x5BF9;bluestore&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x6D41;&amp;#x7A0B;&amp;#x3001;&amp;#x7A7A;&amp;#x95F4;&amp;#x5206;&amp;#x914D;&amp;#x5668;&amp;#x3001;&amp;#x7F13;&amp;#x5B58;&amp;#x7BA1;&amp;#x7406;&amp;#x3001;&amp;#x538B;&amp;#x7F29;&amp;#x7B49;&amp;#x5B9E;&amp;#x73B0;&amp;#x8FDB;&amp;#x884C;&amp;#x5206;&amp;#x6790;&amp;#x3002;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;ceph&amp;#x540E;&amp;#x7AEF;&amp;#x652F;&amp;#x6301;&amp;#x591A;&amp;#x79CD;&amp;#x5B58;&amp;#x50A8;&amp;#x5F15;&amp;#x64CE;&amp;#xFF0C;&amp;#x4EE5;&amp;#x63D2;&amp;#x4EF6;&amp;#x5F0F;&amp;#x7684;&amp;#x65B9;&amp;#x5F0F;&amp;#x6765;&amp;#x8FDB;&amp;#x884C;&amp;#x7BA1;&amp;#x7406;&amp;#x4F7F;&amp;#x7528;&amp;#xFF0C;&amp;#x76EE;&amp;#x524D;&amp;#x652F;&amp;#x6301;filestore&amp;#xFF0C;kvstore&amp;#xFF0C;memstore&amp;#x4EE5;&amp;#x53CA;&amp;#x6700;&amp;#x65B0;&amp;#x7684;bluestore&amp;#xFF0C;&amp;#x76EE;&amp;#x524D;&amp;#x9ED8;&amp;#x8BA4;&amp;#x4F7F;&amp;#x7528;&amp;#x7684;filestore&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x56E0;&amp;#x4E3A;filestore&amp;#x5728;&amp;#x5199;&amp;#x6570;&amp;#x636E;&amp;#x524D;&amp;#x9700;&amp;#x8981;&amp;#x5148;&amp;#x5199;journal&amp;#xFF0C;&amp;#x4F1A;&amp;#x6709;&amp;#x4E00;&amp;#x500D;&amp;#x7684;&amp;#x5199;&amp;#x653E;&amp;#x5927;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;filestore&amp;#x4E00;&amp;#x5F00;&amp;#x59CB;&amp;#x53EA;&amp;#x662F;&amp;#x5BF9;&amp;#x4E8E;&amp;#x673A;&amp;#x68B0;&amp;#x76D8;&amp;#x8FDB;&amp;#x884C;&amp;#x8BBE;&amp;#x8BA1;&amp;#x7684;&amp;#xFF0C;&amp;#x6CA1;&amp;#x6709;&amp;#x4E13;&amp;#x95E8;&amp;#x9488;&amp;#x5BF9;ssd&amp;#x505A;&amp;#x4F18;&amp;#x5316;&amp;#x8003;&amp;#x8651;&amp;#xFF0C;&amp;#x56E0;&amp;#x6B64;&amp;#x8BDE;&amp;#x751F;&amp;#x7684;bluestore&amp;#x521D;&amp;#x8877;&amp;#x5C31;&amp;#x662F;&amp;#x4E3A;&amp;#x4E86;&amp;#x51CF;&amp;#x5C11;&amp;#x5199;&amp;#x653E;&amp;#x5927;&amp;#xFF0C;&amp;#x5E76;&amp;#x9488;&amp;#x5BF9;ssd&amp;#x505A;&amp;#x4F18;&amp;#x5316;&amp;#xFF0C;&amp;#x800C;&amp;#x4E14;&amp;#x76F4;&amp;#x63A5;&amp;#x7BA1;&amp;#x7406;&amp;#x88F8;&amp;#x76D8;&amp;#xFF0C;&amp;#x4ECE;&amp;#x7406;&amp;#x8BBA;&amp;#x4E0A;&amp;#x8FDB;&amp;#x4E00;&amp;#x6B65;&amp;#x51CF;&amp;#x5C11;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x5982;ext4/xfs&amp;#x7B49;&amp;#x90E8;&amp;#x5206;&amp;#x7684;&amp;#x5F00;&amp;#x9500;&amp;#xFF0C;&amp;#x76EE;&amp;#x524D;bluestore&amp;#x8FD8;&amp;#x5904;&amp;#x4E8E;&amp;#x5F00;&amp;#x53D1;&amp;#x4F18;&amp;#x5316;&amp;#x9636;&amp;#x6BB5;&amp;#xFF0C;&amp;#x5728;jewel&amp;#x7248;&amp;#x672C;&amp;#x8FD8;&amp;#x662F;&amp;#x8BD5;&amp;#x7528;&amp;#x7248;&amp;#x672C;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x6700;&amp;#x65B0;&amp;#x7684;master&amp;#x76F8;&amp;#x6BD4;jewel&amp;#x5DF2;&amp;#x7ECF;&amp;#x505A;&amp;#x4E86;&amp;#x5927;&amp;#x7684;&amp;#x91CD;&amp;#x6784;&amp;#xFF0C;&amp;#x9884;&amp;#x671F;&amp;#x4F1A;&amp;#x5728;&amp;#x540E;&amp;#x7EED;&amp;#x7684;&amp;#x5927;&amp;#x7248;&amp;#x672C;&amp;#x4E2D;&amp;#x7A33;&amp;#x5B9A;&amp;#x4E0B;&amp;#x6765;&amp;#x6210;&amp;#x4E3A;&amp;#x9ED8;&amp;#x8BA4;&amp;#x7684;&amp;#x5B58;&amp;#x50A8;&amp;#x5F15;&amp;#x64CE;&amp;#x3002;&amp;#x672C;&amp;#x6587;&amp;#x57FA;&amp;#x4E8E;master&amp;#x5206;&amp;#x652F;&amp;#x5BF9;bluestore&amp;#x5B58;&amp;#x50A8;&amp;#x5F15;&amp;#x64CE;&amp;#x8FDB;&amp;#x884C;&amp;#x5206;&amp;#x6790;&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;bluestore&amp;#x6574;&amp;#x4F53;&amp;#x67B6;&amp;#x6784;&quot;&gt;&lt;a href=&quot;#bluestore&amp;#x6574;&amp;#x4F53;&amp;#x67B6;&amp;#x6784;&quot; class=&quot;headerlink&quot; title=&quot;bluestore&amp;#x6574;&amp;#x4F53;&amp;#x67B6;&amp;#x6784;&quot;&gt;&lt;/a&gt;bluestore&amp;#x6574;&amp;#x4F53;&amp;#x67B6;&amp;#x6784;&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;/2016/08/19/ceph-bluestore/arch.png&quot; alt=&quot;ceph-bluestore&quot;&gt;&lt;/p&gt;
&lt;p&gt;bluestore&amp;#x76F4;&amp;#x63A5;&amp;#x7BA1;&amp;#x7406;&amp;#x88F8;&amp;#x8BBE;&amp;#x5907;&amp;#xFF0C;&amp;#x629B;&amp;#x5F03;&amp;#x4E86;ext4/xfs&amp;#x7B49;&amp;#x672C;&amp;#x5730;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#xFF0C;BlockDevice&amp;#x5B9E;&amp;#x73B0;&amp;#x5728;&amp;#x7528;&amp;#x6237;&amp;#x6001;&amp;#x4E0B;&amp;#x4F7F;&amp;#x7528;linux aio&amp;#x76F4;&amp;#x63A5;&amp;#x5BF9;&amp;#x88F8;&amp;#x8BBE;&amp;#x5907;&amp;#x8FDB;&amp;#x884C;I/O&amp;#x64CD;&amp;#x4F5C;&amp;#x3002;&amp;#x65E2;&amp;#x7136;&amp;#x662F;&amp;#x76F4;&amp;#x63A5;&amp;#x7BA1;&amp;#x7406;&amp;#x88F8;&amp;#x8BBE;&amp;#x5907;&amp;#x5C31;&amp;#x5FC5;&amp;#x7136;&amp;#x9700;&amp;#x8981;&amp;#x8FDB;&amp;#x884C;&amp;#x88F8;&amp;#x8BBE;&amp;#x5907;&amp;#x7684;&amp;#x7A7A;&amp;#x95F4;&amp;#x7BA1;&amp;#x7406;&amp;#xFF0C;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x5C31;&amp;#x662F;Allocator&amp;#xFF0C;&amp;#x76EE;&amp;#x524D;&amp;#x652F;&amp;#x6301;StupidAllocator&amp;#x548C;BitmapAllocator&amp;#x4E24;&amp;#x79CD;&amp;#x5206;&amp;#x914D;&amp;#x5668;&amp;#x3002;&amp;#x76F8;&amp;#x5173;&amp;#x7684;&amp;#x5143;&amp;#x6570;&amp;#x636E;&amp;#x4EE5;kv&amp;#x7684;&amp;#x5F62;&amp;#x5F0F;&amp;#x4FDD;&amp;#x5B58;&amp;#x5230;kv&amp;#x6570;&amp;#x636E;&amp;#x5E93;&amp;#x91CC;&amp;#xFF0C;&amp;#x9ED8;&amp;#x8BA4;&amp;#x4F7F;&amp;#x7528;&amp;#x7684;&amp;#x662F;rocksdb&amp;#xFF0C;&amp;#x7531;&amp;#x4E8E;rocksdb&amp;#x672C;&amp;#x8EAB;&amp;#x662F;&amp;#x57FA;&amp;#x4E8E;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#xFF0C;&amp;#x4E0D;&amp;#x662F;&amp;#x76F4;&amp;#x63A5;&amp;#x64CD;&amp;#x4F5C;&amp;#x88F8;&amp;#x8BBE;&amp;#x5907;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;rocksdb&amp;#x4E5F;&amp;#x6BD4;&amp;#x8F83;&amp;#x7075;&amp;#x6D3B;&amp;#xFF0C;&amp;#x5C06;&amp;#x7CFB;&amp;#x7EDF;&amp;#x76F8;&amp;#x5173;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x62BD;&amp;#x8C61;&amp;#x6210;Env&amp;#xFF0C;&amp;#x7528;&amp;#x6237;&amp;#x53EF;&amp;#x7528;&amp;#x5B9E;&amp;#x73B0;&amp;#x76F8;&amp;#x5E94;&amp;#x7684;&amp;#x63A5;&amp;#x53E3;&amp;#xFF0C;rocksdb&amp;#x9ED8;&amp;#x8BA4;&amp;#x7684;Env&amp;#x662F;PosixEnv&amp;#xFF0C;&amp;#x76F4;&amp;#x63A5;&amp;#x5BF9;&amp;#x63A5;&amp;#x672C;&amp;#x5730;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#xFF0C;&amp;#x4E3A;&amp;#x6B64;&amp;#xFF0C;bluestore&amp;#x5B9E;&amp;#x73B0;&amp;#x4E86;&amp;#x4E00;&amp;#x4E2A;BlueRocksEnv&amp;#xFF0C;&amp;#x7EE7;&amp;#x627F;&amp;#x81EA;EnvWrapper&amp;#xFF0C;&amp;#x6765;&amp;#x4E3A;rocksdb&amp;#x63D0;&amp;#x4F9B;&amp;#x5E95;&amp;#x5C42;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x5C01;&amp;#x88C5;&amp;#xFF0C;&amp;#x4E3A;&amp;#x4E86;&amp;#x5BF9;&amp;#x63A5;BlueRocksEnv&amp;#xFF0C;&amp;#x5B9E;&amp;#x73B0;&amp;#x4E86;&amp;#x4E00;&amp;#x4E2A;&amp;#x5C0F;&amp;#x7684;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;BlueFS&amp;#xFF0C;&amp;#x53EA;&amp;#x5B9E;&amp;#x73B0;rocksdb Env&amp;#x9700;&amp;#x8981;&amp;#x7684;&amp;#x63A5;&amp;#x53E3;&amp;#xFF0C;&amp;#x5728;&amp;#x7CFB;&amp;#x7EDF;&amp;#x542F;&amp;#x52A8;mount&amp;#x8FD9;&amp;#x4E2A;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x5C06;&amp;#x6240;&amp;#x6709;&amp;#x7684;&amp;#x5143;&amp;#x6570;&amp;#x636E;&amp;#x90FD;&amp;#x52A0;&amp;#x8F7D;&amp;#x5230;&amp;#x5185;&amp;#x5B58;&amp;#x4E2D;&amp;#xFF0C;BluesFS&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x548C;&amp;#x65E5;&amp;#x5FD7;&amp;#x6587;&amp;#x4EF6;&amp;#x90FD;&amp;#x901A;&amp;#x8FC7;BlockDevice&amp;#x4FDD;&amp;#x5B58;&amp;#x5230;&amp;#x88F8;&amp;#x8BBE;&amp;#x5907;&amp;#x4E0A;&amp;#xFF0C;BlueFS&amp;#x548C;BlueStore&amp;#x53EF;&amp;#x4EE5;&amp;#x5171;&amp;#x4EAB;&amp;#x88F8;&amp;#x8BBE;&amp;#x5907;&amp;#xFF0C;&amp;#x4E5F;&amp;#x53EF;&amp;#x4EE5;&amp;#x5206;&amp;#x522B;&amp;#x6307;&amp;#x5B9A;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x8BBE;&amp;#x5907;&amp;#x3002;&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ceph" scheme="http://yoursite.com/categories/ceph/"/>
    
    
      <category term="ceph" scheme="http://yoursite.com/tags/ceph/"/>
    
  </entry>
  
  <entry>
    <title>ceph恢复优化</title>
    <link href="http://yoursite.com/2016/08/02/ceph-recover-optimize/"/>
    <id>http://yoursite.com/2016/08/02/ceph-recover-optimize/</id>
    <published>2016-08-02T11:46:23.000Z</published>
    <updated>2016-08-02T11:55:50.718Z</updated>
    
    <content type="html">&lt;h1 id=&quot;1-&amp;#x80CC;&amp;#x666F;&quot;&gt;&lt;a href=&quot;#1-&amp;#x80CC;&amp;#x666F;&quot; class=&quot;headerlink&quot; title=&quot;1.&amp;#x80CC;&amp;#x666F;&quot;&gt;&lt;/a&gt;1.&amp;#x80CC;&amp;#x666F;&lt;/h1&gt;&lt;p&gt;&amp;#x5728;&amp;#x5BF9;ceph&amp;#x5757;&amp;#x5B58;&amp;#x50A8;&amp;#x8FDB;&amp;#x884C;&amp;#x6027;&amp;#x80FD;&amp;#x6D4B;&amp;#x8BD5;&amp;#x65F6;&amp;#x53D1;&amp;#x73B0;&amp;#xFF0C;&amp;#x5F53;&amp;#x6709;osd&amp;#x91CD;&amp;#x542F;&amp;#x6216;&amp;#x8005;&amp;#x5B58;&amp;#x50A8;&amp;#x673A;&amp;#x91CD;&amp;#x542F;&amp;#x65F6;&amp;#xFF0C;I/O&amp;#x6027;&amp;#x80FD;&amp;#x4F1A;&amp;#x6025;&amp;#x5267;&amp;#x4E0B;&amp;#x964D;&amp;#xFF0C;&amp;#x5C24;&amp;#x5176;&amp;#x5728;&amp;#x968F;&amp;#x673A;&amp;#x5199;&amp;#x7684;&amp;#x8D1F;&amp;#x8F7D;&amp;#x4E0B;&amp;#xFF0C;&amp;#x4E0B;&amp;#x964D;&amp;#x5E45;&amp;#x5EA6;&amp;#x8FBE;&amp;#x5230;90%&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x4F1A;&amp;#x6301;&amp;#x7EED;&amp;#x4E00;&amp;#x6BB5;&amp;#x65F6;&amp;#x5019;&amp;#x624D;&amp;#x6162;&amp;#x6162;&amp;#x6062;&amp;#x590D;&amp;#x5230;&amp;#x6B63;&amp;#x5E38;&amp;#x6C34;&amp;#x5E73;&amp;#x3002;&amp;#x4E00;&amp;#x5F00;&amp;#x59CB;&amp;#x6211;&amp;#x4EEC;&amp;#x4E5F;&amp;#x5C1D;&amp;#x8BD5;&amp;#x5C06;&amp;#x6062;&amp;#x590D;&amp;#x76F8;&amp;#x5173;&amp;#x7684;&amp;#x53C2;&amp;#x6570;&amp;#x8C03;&amp;#x4F4E;&amp;#xFF08;osd_recovery_max_active=1&amp;#x3001;osd_recovery_max_chunk=131072&amp;#x3001;osd_max_backfills=1&amp;#xFF09;&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;&amp;#x8C03;&amp;#x6574;&amp;#x6B63;&amp;#x5E38;I/O&amp;#x548C;&amp;#x6062;&amp;#x590D;I/O&amp;#x7684;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#xFF08;osd_recovery_op_priority=10&amp;#x3001;osd_client_op_priority=63&amp;#xFF09;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x6D4B;&amp;#x8BD5;&amp;#x7ED3;&amp;#x679C;&amp;#x6765;&amp;#x770B;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E9B;&amp;#x53C2;&amp;#x6570;&amp;#x7684;&amp;#x8C03;&amp;#x6574;&amp;#x6CA1;&amp;#x6709;&amp;#x591A;&amp;#x5927;&amp;#x7684;&amp;#x6548;&amp;#x679C;&amp;#xFF0C;&amp;#x968F;&amp;#x673A;&amp;#x5199;&amp;#x8D1F;&amp;#x8F7D;&amp;#x4E0B;&amp;#x6027;&amp;#x80FD;&amp;#x4E0B;&amp;#x964D;&amp;#x4ECD;&amp;#x7136;&amp;#x5F88;&amp;#x5927;&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;2-&amp;#x539F;&amp;#x56E0;&amp;#x5206;&amp;#x6790;&quot;&gt;&lt;a href=&quot;#2-&amp;#x539F;&amp;#x56E0;&amp;#x5206;&amp;#x6790;&quot; class=&quot;headerlink&quot; title=&quot;2.&amp;#x539F;&amp;#x56E0;&amp;#x5206;&amp;#x6790;&quot;&gt;&lt;/a&gt;2.&amp;#x539F;&amp;#x56E0;&amp;#x5206;&amp;#x6790;&lt;/h1&gt;&lt;p&gt;&amp;#x5728;&amp;#x300A;ceph&amp;#x57FA;&amp;#x4E8E;pglog&amp;#x7684;&amp;#x4E00;&amp;#x81F4;&amp;#x6027;&amp;#x534F;&amp;#x8BAE;&amp;#x300B;&amp;#x4E00;&amp;#x6587;&amp;#x4E2D;&amp;#x5206;&amp;#x6790;&amp;#x4E86;ceph&amp;#x7684;&amp;#x4E00;&amp;#x81F4;&amp;#x6027;&amp;#x534F;&amp;#x8BAE;&amp;#xFF0C;&amp;#x4ECE;&amp;#x4E2D;&amp;#x6211;&amp;#x4EEC;&amp;#x5F97;&amp;#x77E5;&amp;#x5728;osd&amp;#x91CD;&amp;#x542F;&amp;#x3001;&amp;#x5B58;&amp;#x50A8;&amp;#x673A;&amp;#x91CD;&amp;#x542F;&amp;#x7B49;&amp;#x573A;&amp;#x666F;&amp;#x4E0B;&amp;#x57FA;&amp;#x4E8E;pglog&amp;#x7684;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x5728;peering&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x4F1A;&amp;#x6839;&amp;#x636E;pglog&amp;#x6765;&amp;#x6784;&amp;#x5EFA;&amp;#x51FA;missing&amp;#x5217;&amp;#x8868;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5728;&amp;#x6062;&amp;#x590D;&amp;#x65F6;&amp;#x6839;&amp;#x636E;missing&amp;#x5217;&amp;#x8868;&amp;#x9010;&amp;#x4E2A;&amp;#x8FDB;&amp;#x884C;&amp;#x6062;&amp;#x590D;&amp;#xFF0C;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x7C92;&amp;#x5EA6;&amp;#x662F;&amp;#x6574;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x5927;&amp;#x5C0F;&amp;#xFF08;&amp;#x9ED8;&amp;#x8BA4;4MB&amp;#xFF0C;&amp;#x6709;&amp;#x53EF;&amp;#x80FD;&amp;#x6709;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x4E0D;&amp;#x8DB3;4MB&amp;#xFF0C;&amp;#x5C31;&amp;#x6309;&amp;#x5BF9;&amp;#x8C61;&amp;#x5927;&amp;#x5C0F;&amp;#xFF09;&amp;#xFF0C;&amp;#x5373;&amp;#x4F7F;&amp;#x53EA;&amp;#x4FEE;&amp;#x6539;&amp;#x4E86;&amp;#x4E00;&amp;#x4E2A;4KB&amp;#xFF0C;&amp;#x4E5F;&amp;#x9700;&amp;#x8981;&amp;#x5C06;4MB&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x62F7;&amp;#x8D1D;&amp;#x8FC7;&amp;#x6765;&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;100&amp;#x4E2A;io&amp;#x5C31;&amp;#x4F1A;&amp;#x8FBE;&amp;#x5230;400MB&amp;#x7684;&amp;#x5E26;&amp;#x5BBD;&amp;#xFF0C;&amp;#x5BF9;&amp;#x7F51;&amp;#x7EDC;&amp;#x53CA;&amp;#x78C1;&amp;#x76D8;&amp;#x4EA7;&amp;#x751F;&amp;#x8F83;&amp;#x5927;&amp;#x7684;&amp;#x5F71;&amp;#x54CD;&amp;#x3002;&amp;#x5F53;&amp;#x5199;io&amp;#x547D;&amp;#x4E2D;&amp;#x6B63;&amp;#x5728;&amp;#x4FEE;&amp;#x590D;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x65F6;&amp;#xFF0C;&amp;#x4E5F;&amp;#x662F;&amp;#x5148;&amp;#x4FEE;&amp;#x590D;&amp;#x539F;&amp;#x6765;4MB&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x5373;&amp;#x9700;&amp;#x8981;&amp;#x5C06;4MB&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x901A;&amp;#x8FC7;&amp;#x7F51;&amp;#x7EDC;&amp;#x62F7;&amp;#x8D1D;&amp;#x8FC7;&amp;#x6765;&amp;#xFF0C;&amp;#x5EF6;&amp;#x8FDF;&amp;#x5C31;&amp;#x4F1A;&amp;#x589E;&amp;#x52A0;&amp;#x5F88;&amp;#x591A;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x518D;&amp;#x5199;&amp;#x5165;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x5BF9;&amp;#x4E8E;&amp;#x968F;&amp;#x673A;&amp;#x5199;&amp;#x7684;&amp;#x573A;&amp;#x666F;&amp;#x5C24;&amp;#x5176;&amp;#x4E25;&amp;#x91CD;&amp;#xFF0C;&amp;#x57FA;&amp;#x672C;&amp;#x90FD;&amp;#x662F;&amp;#x547D;&amp;#x4E2D;&amp;#x7684;&amp;#x60C5;&amp;#x51B5;&amp;#xFF0C;&amp;#x5E26;&amp;#x6765;&amp;#x76F8;&amp;#x5F53;&amp;#x5927;&amp;#x7684;&amp;#x5EF6;&amp;#x8FDF;&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;iops&amp;#x4E0B;&amp;#x964D;&amp;#xFF08;&amp;#x4E0B;&amp;#x964D;&amp;#x5E45;&amp;#x5EA6;80%~90%&amp;#xFF09;&amp;#x3002;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5F71;&amp;#x54CD;&amp;#x65F6;&amp;#x95F4;&amp;#x53D6;&amp;#x51B3;&amp;#x4E8E;&amp;#x4E0A;&amp;#x5C42;&amp;#x7684;&amp;#x4E1A;&amp;#x52A1;&amp;#x91CF;&amp;#x548C;osd&amp;#x505C;&amp;#x670D;&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2016/08/02/ceph-recover-optimize/recover-whole.png&quot; alt=&quot;ceph-recover-optimize&quot;&gt;&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;3-&amp;#x6062;&amp;#x590D;&amp;#x4F18;&amp;#x5316;&quot;&gt;&lt;a href=&quot;#3-&amp;#x6062;&amp;#x590D;&amp;#x4F18;&amp;#x5316;&quot; class=&quot;headerlink&quot; title=&quot;3.&amp;#x6062;&amp;#x590D;&amp;#x4F18;&amp;#x5316;&quot;&gt;&lt;/a&gt;3.&amp;#x6062;&amp;#x590D;&amp;#x4F18;&amp;#x5316;&lt;/h1&gt;&lt;p&gt;&amp;#x56E0;&amp;#x4E3A;pglog&amp;#x91CC;&amp;#x6BCF;&amp;#x6761;&amp;#x8BB0;&amp;#x5F55;&amp;#x91CC;&amp;#x53EA;&amp;#x662F;&amp;#x8BB0;&amp;#x4E86;&amp;#x64CD;&amp;#x4F5C;&amp;#x53CA;&amp;#x7248;&amp;#x672C;&amp;#x7B49;&amp;#x4FE1;&amp;#x606F;&amp;#xFF0C;&amp;#x5E76;&amp;#x6CA1;&amp;#x6709;&amp;#x8BB0;&amp;#x5F55;&amp;#x8FD9;&amp;#x6B21;&amp;#x64CD;&amp;#x4F5C;&amp;#x662F;&amp;#x4FEE;&amp;#x6539;&amp;#x54EA;&amp;#x90E8;&amp;#x5206;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x4F18;&amp;#x5316;&amp;#x7684;&amp;#x529E;&amp;#x6CD5;&amp;#x5C31;&amp;#x662F;&amp;#x5728;pglog&amp;#x91CC;&amp;#x8BB0;&amp;#x5F55;&amp;#x6BCF;&amp;#x6B21;&amp;#x64CD;&amp;#x4F5C;&amp;#x4FEE;&amp;#x6539;&amp;#x7684;&amp;#x533A;&amp;#x95F4;&amp;#xFF0C;&amp;#x8BB0;&amp;#x4E3A;[offset,len]&amp;#xFF08;&amp;#x5B9E;&amp;#x73B0;&amp;#x65F6;pglog&amp;#x7ED3;&amp;#x6784;&amp;#x91CC;&amp;#x5F15;&amp;#x5165;dirty_extents&amp;#x6765;&amp;#x8868;&amp;#x793A;&amp;#xFF09;&amp;#xFF0C;&amp;#x6B63;&amp;#x5E38;&amp;#x5199;I/O&amp;#x5904;&amp;#x7406;&amp;#x65F6;&amp;#xFF0C;&amp;#x4F1A;&amp;#x5199;pglog&amp;#xFF0C;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;MODIFY&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x5728;&amp;#x8FD9;&amp;#x6761;&amp;#x8BB0;&amp;#x5F55;&amp;#x91CC;&amp;#x8BB0;&amp;#x4E0A;&amp;#x4FEE;&amp;#x6539;&amp;#x7684;&amp;#x533A;&amp;#x95F4;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x5F53;&amp;#x4E00;&amp;#x4E2A;osd&amp;#x6545;&amp;#x969C;&amp;#x91CD;&amp;#x542F;&amp;#x540E;&amp;#xFF0C;&amp;#x8FDB;&amp;#x884C;peering&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x5408;&amp;#x5E76;pglog&amp;#x6765;&amp;#x6784;&amp;#x5EFA;missing&amp;#x5217;&amp;#x8868;&amp;#x65F6;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x5C06;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x591A;&amp;#x6B21;&amp;#x4FEE;&amp;#x6539;&amp;#x7684;[offset,len]&amp;#x6C42;&amp;#x4E00;&amp;#x4E2A;&amp;#x5E76;&amp;#x96C6;&amp;#xFF0C;&amp;#x5F97;&amp;#x51FA;&amp;#x6545;&amp;#x969C;&amp;#x671F;&amp;#x95F4;&amp;#x603B;&amp;#x7684;&amp;#x4FEE;&amp;#x6539;&amp;#x533A;&amp;#x95F4;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5728;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x5C31;&amp;#x80FD;&amp;#x591F;&amp;#x6839;&amp;#x636E;&amp;#x8FD9;&amp;#x4E2A;&amp;#x8303;&amp;#x56F4;&amp;#x6765;&amp;#x6062;&amp;#x590D;&amp;#x8FD9;&amp;#x90E8;&amp;#x5206;&amp;#x589E;&amp;#x91CF;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;&amp;#x5927;&amp;#x5E45;&amp;#x5EA6;&amp;#x51CF;&amp;#x5C11;&amp;#x4E86;&amp;#x6062;&amp;#x590D;&amp;#x65F6;&amp;#x7684;&amp;#x7F51;&amp;#x7EDC;&amp;#x548C;&amp;#x78C1;&amp;#x76D8;&amp;#x5E26;&amp;#x5BBD;&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;&amp;#x6B63;&amp;#x5E38;I/O&amp;#x547D;&amp;#x4E2D;&amp;#x6062;&amp;#x590D;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x7B49;&amp;#x5F85;&amp;#x65F6;&amp;#x95F4;&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;&amp;#x5927;&amp;#x5E45;&amp;#x964D;&amp;#x4F4E;&amp;#x5BF9;&amp;#x6B63;&amp;#x5E38;I/O&amp;#x7684;&amp;#x6027;&amp;#x80FD;&amp;#x5F71;&amp;#x54CD;&amp;#xFF08;&amp;#x5C24;&amp;#x5176;&amp;#x662F;&amp;#x5BF9;&amp;#x4E8E;&amp;#x968F;&amp;#x673A;&amp;#x5199;I/O&amp;#x7684;&amp;#x573A;&amp;#x666F;&amp;#xFF09;&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2016/08/02/ceph-recover-optimize/recover-delta.png&quot; alt=&quot;ceph-recover-optimize&quot;&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x9488;&amp;#x5BF9;&amp;#x6211;&amp;#x4EEC;&amp;#x4F7F;&amp;#x7528;&amp;#x7684;&amp;#x5757;&amp;#x5B58;&amp;#x50A8;&amp;#x7684;&amp;#x5E94;&amp;#x7528;&amp;#x573A;&amp;#x666F;&amp;#xFF0C;&amp;#x4E3A;&amp;#x4E86;&amp;#x51CF;&amp;#x5C0F;&amp;#x5B9E;&amp;#x73B0;&amp;#x7684;&amp;#x590D;&amp;#x6742;&amp;#x5EA6;&amp;#xFF0C;&amp;#x5F15;&amp;#x5165;&amp;#x4E00;&amp;#x4E2A;&amp;#x6807;&amp;#x8BB0;can_recover_partial&amp;#x6765;&amp;#x8868;&amp;#x793A;&amp;#x662F;&amp;#x5426;&amp;#x53EF;&amp;#x4EE5;&amp;#x8FDB;&amp;#x884C;&amp;#x90E8;&amp;#x5206;&amp;#x6062;&amp;#x590D;&amp;#xFF0C;&amp;#x9ED8;&amp;#x8BA4;&amp;#x662F;false&amp;#xFF0C;&amp;#x5F53;&amp;#x8FDB;&amp;#x884C;&amp;#x5199;I/O&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x65F6;&amp;#x8BB0;&amp;#x5F55;pglog&amp;#x91CC;&amp;#x7684;[offset,len]&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x6807;&amp;#x8BB0;can_recover_partial&amp;#x4E3A;true&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x6062;&amp;#x590D;&amp;#x65F6;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x6839;&amp;#x636E;&amp;#x8FD9;&amp;#x4E2A;&amp;#x6807;&amp;#x8BB0;&amp;#x53EA;&amp;#x6062;&amp;#x590D;&amp;#x5BF9;&amp;#x8C61;&amp;#x5185;&amp;#x7684;&amp;#x589E;&amp;#x91CF;&amp;#x6570;&amp;#x636E;&amp;#x3002;&amp;#x5BF9;&amp;#x4E8E;&amp;#x65E0;&amp;#x6CD5;&amp;#x5224;&amp;#x65AD;&amp;#x662F;&amp;#x5426;&amp;#x53EF;&amp;#x4EE5;&amp;#x8FDB;&amp;#x884C;&amp;#x90E8;&amp;#x5206;&amp;#x4F18;&amp;#x5316;&amp;#x65F6;&amp;#xFF0C;&amp;#x5C31;&amp;#x56DE;&amp;#x9000;&amp;#x5230;&amp;#x539F;&amp;#x6709;&amp;#x7684;&amp;#x6062;&amp;#x590D;&amp;#x903B;&amp;#x8F91;&amp;#x53BB;&amp;#x6062;&amp;#x590D;&amp;#x6574;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x9700;&amp;#x8981;&amp;#x8003;&amp;#x8651;&amp;#x51E0;&amp;#x79CD;&amp;#x60C5;&amp;#x51B5;&amp;#xFF0C;&amp;#x5305;&amp;#x62EC;&amp;#xFF1A;truncate&amp;#x3001;omap&amp;#x3001;clone&amp;#x3001;EC&amp;#x7B49;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;truncate&lt;/strong&gt;&lt;br&gt;truncate&amp;#x7684;&amp;#x64CD;&amp;#x4F5C;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x5C31;&amp;#x662F;&amp;#x622A;&amp;#x65AD;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x7C7B;&amp;#x6BD4;&amp;#x4E8E;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x91CC;&amp;#x7684;ftruncate&amp;#x7684;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF08;&amp;#x53EF;&amp;#x4EE5;&amp;#x5C06;&amp;#x6587;&amp;#x4EF6;&amp;#x622A;&amp;#x65AD;&amp;#xFF0C;&amp;#x6216;&amp;#x8005;&amp;#x5C06;&amp;#x6587;&amp;#x4EF6;&amp;#x6269;&amp;#x5927;&amp;#xFF09;&amp;#x3002;&amp;#x539F;&amp;#x751F;ceph&amp;#x7684;pglog&amp;#x6CA1;&amp;#x6709;TRUNCATE&amp;#x7684;&amp;#x64CD;&amp;#x4F5C;&amp;#x7801;&amp;#xFF0C;&amp;#x5B83;&amp;#x91CC;&amp;#x9762;&amp;#x7684;truncate&amp;#x64CD;&amp;#x4F5C;&amp;#x90FD;&amp;#x662F;MODIFY&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x5148;&amp;#x88AB;&amp;#x4FEE;&amp;#x6539;&amp;#x4E86;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x53C8;&amp;#x88AB;truncate&amp;#x4E86;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x5728;&amp;#x6062;&amp;#x590D;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x4ECD;&amp;#x7136;&amp;#x662F;&amp;#x6309;&amp;#x7167;&amp;#x8FD9;&amp;#x6574;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x6765;&amp;#x6062;&amp;#x590D;&amp;#xFF0C;&amp;#x6709;&amp;#x53EF;&amp;#x80FD;&amp;#x56E0;&amp;#x4E3A;truncate&amp;#x8FD9;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x53D8;&amp;#x5C0F;&amp;#x4E86;&amp;#xFF08;&amp;#x5C0F;&amp;#x4E8E;4MB&amp;#xFF09;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x4E0D;&amp;#x7528;&amp;#x7BA1;&amp;#xFF0C; &amp;#x76F4;&amp;#x63A5;&amp;#x5C06;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x8BFB;&amp;#x51FA;&amp;#x6765;&amp;#x62F7;&amp;#x8D1D;&amp;#x8FC7;&amp;#x53BB;&amp;#x5C31;&amp;#x884C;&amp;#x4E86;&amp;#x3002;&lt;br&gt;&amp;#x4F46;&amp;#x662F;&amp;#x6211;&amp;#x4EEC;&amp;#x8981;&amp;#x5728;pglog&amp;#x91CC;&amp;#x52A0;&amp;#x5165;[offset, len]&amp;#x6765;&amp;#x8868;&amp;#x793A;&amp;#x4FEE;&amp;#x6539;&amp;#x8303;&amp;#x56F4;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x548C;truncate&amp;#x6DF7;&amp;#x5728;&amp;#x4E00;&amp;#x8D77;&amp;#x540E;&amp;#xFF0C;&amp;#x5C31;&amp;#x9700;&amp;#x8981;&amp;#x505A;&amp;#x533A;&amp;#x5206;&amp;#xFF0C;&amp;#x4E3A;&amp;#x4E86;&amp;#x7B80;&amp;#x5355;&amp;#x8D77;&amp;#x89C1;&amp;#xFF0C;&amp;#x5F53;&amp;#x78B0;&amp;#x5230;truncate&amp;#x64CD;&amp;#x4F5C;&amp;#x65F6;&amp;#xFF0C;&amp;#x5C06;can_recover_partial&amp;#x8BBE;&amp;#x7F6E;&amp;#x6210;false&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;truncate&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x5C31;&amp;#x8DDF;&amp;#x539F;&amp;#x6765;&amp;#x4E00;&amp;#x6837;&amp;#xFF0C;&amp;#x5728;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;&amp;#x4F7F;&amp;#x7528;&amp;#x573A;&amp;#x666F;&amp;#x4E0B;&amp;#xFF0C;trucate&amp;#x64CD;&amp;#x4F5C;&amp;#x4E0D;&amp;#x5E38;&amp;#x89C1;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;omap&lt;/strong&gt;&lt;br&gt;omap&amp;#x5373;objectmap&amp;#xFF0C;&amp;#x7528;&amp;#x6765;&amp;#x8BB0;&amp;#x5F55;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x6269;&amp;#x5C55;&amp;#x5C5E;&amp;#x6027;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;xatrr&amp;#x5C5E;&amp;#x6027;&amp;#x6570;&amp;#x91CF;&amp;#x53CA;&amp;#x957F;&amp;#x5EA6;&amp;#x90FD;&amp;#x6709;&amp;#x9650;&amp;#x5236;&amp;#xFF0C;&amp;#x8D85;&amp;#x8FC7;&amp;#x4E86;&amp;#x5C31;&amp;#x9700;&amp;#x8981;&amp;#x653E;&amp;#x5230;omap&amp;#x4E2D;&amp;#x3002;&amp;#x8BBE;&amp;#x7F6E;omap&amp;#x5C5E;&amp;#x6027;&amp;#x65F6;&amp;#xFF0C;&amp;#x5BF9;&amp;#x5E94;&amp;#x5230;pglog&amp;#x91CC;&amp;#x4E5F;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;MODIFY&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x8BF4;omap&amp;#x5728;&amp;#x591A;&amp;#x526F;&amp;#x672C;&amp;#x95F4;&amp;#x7684;&amp;#x4E00; &amp;#x81F4;&amp;#x6027;&amp;#x4E5F;&amp;#x662F;&amp;#x7531;pglog&amp;#x6765;&amp;#x4FDD;&amp;#x8BC1;&amp;#x7684;&amp;#x3002;&amp;#x5728;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x5408;&amp;#x5E76;pglog&amp;#x6765;&amp;#x6784;&amp;#x5EFA;missing&amp;#x5BF9;&amp;#x8C61;&amp;#x65F6;&amp;#xFF0C;&amp;#x662F;&amp;#x4E0D;&amp;#x533A;&amp;#x5206;&amp;#x5C5E;&amp;#x6027;&amp;#x8FD8;&amp;#x662F;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x90FD;&amp;#x8BA4;&amp;#x4E3A;&amp;#x662F;&amp;#x5BF9;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x4FEE;&amp;#x6539;&amp;#xFF0C;&amp;#x5728;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x90FD;&amp;#x662F;&amp;#x5148;&amp;#x6062;&amp;#x590D;&amp;#x6062;&amp;#x590D;&amp;#x5C5E;&amp;#x6027;&amp;#xFF08;xatrr&amp;#x548C;omap&amp;#xFF09;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x518D;&amp;#x6062;&amp;#x590D;&amp;#x6570;&amp;#x636E;&amp;#x3002;&amp;#x8FD9;&amp;#x6837;&amp;#x7684;&amp;#x8BDD;&amp;#xFF0C;&amp;#x5373;&amp;#x4F7F;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x5728;pglog&amp;#x91CC;&amp;#x53EA;&amp;#x8BBE;&amp;#x7F6E;&amp;#x4E86;&amp;#x5C5E;&amp;#x6027;&amp;#xFF0C;&amp;#x5728;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x4F1A;&amp;#x8FDE;&amp;#x6570;&amp;#x636E;&amp;#x4E00;&amp;#x8D77;&amp;#x6062;&amp;#x590D;&amp;#x8FC7;&amp;#x6765;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5373;&amp;#x662F;&amp;#x591A;&amp;#x4E86;&amp;#x4E00;&amp;#x6B21;&amp;#x6570;&amp;#x636E;&amp;#x7684;&amp;#x62F7;&amp;#x8D1D;&amp;#x3002;&amp;#x5728;&amp;#x5757;&amp;#x5B58;&amp;#x50A8;&amp;#x7684;&amp;#x573A;&amp;#x666F;&amp;#x4E0B;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x4EE3;&amp;#x4EF7;&amp;#x662F;&amp;#x53EF;&amp;#x4EE5;&amp;#x63A5;&amp;#x53D7;&amp;#x7684;&amp;#xFF0C;&amp;#x56E0;&amp;#x6B64;&amp;#x4E0D;&amp;#x5FC5;&amp;#x9488;&amp;#x5BF9;omap&amp;#x505A;&amp;#x7279;&amp;#x6B8A;&amp;#x5904;&amp;#x7406;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;clone&lt;/strong&gt;&lt;br&gt;&amp;#x8FD9;&amp;#x91CC;&amp;#x7684;clone&amp;#x6307;&amp;#x7684;clone&amp;#x5BF9;&amp;#x8C61;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x505A;&amp;#x4E86;&amp;#x5FEB;&amp;#x7167;&amp;#x4E4B;&amp;#x540E;&amp;#x5BF9;&amp;#x539F;&amp;#x5377;&amp;#x8FDB;&amp;#x884C;&amp;#x5199;&amp;#x5165;&amp;#x65F6;&amp;#x89E6;&amp;#x53D1;&amp;#x7684;cow&amp;#x64CD;&amp;#x4F5C;&amp;#x3002;&amp;#x6BCF;&amp;#x6B21;clone&amp;#x64CD;&amp;#x4F5C;&amp;#x4F1A;&amp;#x5728;pglog&amp;#x91CC;&amp;#x8BB0;&amp;#x5F55;&amp;#x4E00;&amp;#x6761;CLONE&amp;#x7684;&amp;#x8BB0;&amp;#x5F55;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5728;filestore&amp;#x91CC;&amp;#x4F1A;&amp;#x6839;&amp;#x636E;&amp;#x8FD9;&amp;#x4E2A;CLONE&amp;#x64CD;&amp;#x4F5C;&amp;#x8FDB;&amp;#x884C;clone_range&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x4ECE;&amp;#x539F;&amp;#x6765;&amp;#x7684;head&amp;#x5BF9;&amp;#x8C61;&amp;#xFF08;&amp;#x8868;&amp;#x793A;&amp;#x5377;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF09;&amp;#xFF0C;&amp;#x62F7;&amp;#x8D1D;&amp;#x6570;&amp;#x636E;&amp;#x5230;&amp;#x65B0;&amp;#x751F;&amp;#x6210;&amp;#x7684;snap&amp;#x5BF9;&amp;#x8C61;&amp;#xFF08;&amp;#x5373;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF09;&amp;#x3002;&amp;#x5728;peering&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x5408;&amp;#x5E76;pglog&amp;#x65F6;&amp;#xFF0C;&amp;#x6CA1;&amp;#x6709;&amp;#x533A;&amp;#x5206;MODIFY&amp;#x548C;CLONE&amp;#x7684;&amp;#xFF0C;&amp;#x90FD;&amp;#x4F1A;&amp;#x6784;&amp;#x5EFA;&amp;#x4E22;&amp;#x5931;&amp;#x5BF9;&amp;#x8C61;&amp;#x653E;&amp;#x5230;missing&amp;#x5217;&amp;#x8868;&amp;#x91CC;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x8BF4;&amp;#x8FD9;&amp;#x4E2A;missing&amp;#x5217;&amp;#x8868;&amp;#x91CC;&amp;#x6709;&amp;#x53EF;&amp;#x80FD;&amp;#x65E2;&amp;#x5305;&amp;#x542B;head&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5305;&amp;#x542B;snap&amp;#x5BF9;&amp;#x8C61;&amp;#x3002;&lt;br&gt;&amp;#x5728;&amp;#x300A;ceph rbd&amp;#x5FEB;&amp;#x7167;&amp;#x539F;&amp;#x7406;&amp;#x89E3;&amp;#x6790;&amp;#x300B;&amp;#x91CC;&amp;#x8BE6;&amp;#x7EC6;&amp;#x4ECB;&amp;#x7ECD;&amp;#x4E86;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;&amp;#x53CA;&amp;#x6545;&amp;#x969C;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x5F15;&amp;#x5165;&amp;#x6062;&amp;#x590D;&amp;#x4F18;&amp;#x5316;&amp;#x540E;&amp;#xFF0C;&amp;#x5BF9;&amp;#x4E8E;snap&amp;#x5BF9;&amp;#x8C61;&amp;#x8FD8;&amp;#x662F;&amp;#x6309;&amp;#x7167;&amp;#x539F;&amp;#x6765;&amp;#x7684;&amp;#x903B;&amp;#x8F91;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x800C;&amp;#x5BF9;&amp;#x4E8E;head&amp;#x5BF9;&amp;#x8C61;&amp;#x5C31;&amp;#x8981;&amp;#x505A;&amp;#x4E0D;&amp;#x540C;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x6309;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x4FEE;&amp;#x6539;&amp;#x533A;&amp;#x95F4;&amp;#x6765;&amp;#x8FDB;&amp;#x884C;&amp;#x6062;&amp;#x590D;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;EC&lt;/strong&gt;&lt;br&gt;&amp;#x5757;&amp;#x5B58;&amp;#x50A8;&amp;#x4E0B;&amp;#x90FD;&amp;#x662F;&amp;#x91C7;&amp;#x7528;&amp;#x591A;&amp;#x526F;&amp;#x672C;&amp;#x7684;&amp;#x7B56;&amp;#x7565;&amp;#xFF0C;&amp;#x800C;&amp;#x4E0D;&amp;#x4F1A;&amp;#x7528;&amp;#x5230;&amp;#x7EA0;&amp;#x5220;&amp;#x7801;&amp;#xFF08;EC&amp;#xFF09;&amp;#xFF0C;&amp;#x4E00;&amp;#x822C;&amp;#x662F;ceph&amp;#x5BF9;&amp;#x8C61;&amp;#x5B58;&amp;#x50A8;&amp;#x91CC;&amp;#x624D;&amp;#x7528;&amp;#x5230;&amp;#x7EA0;&amp;#x5220;&amp;#x7801;&amp;#xFF0C;&amp;#x56E0;&amp;#x6B64;&amp;#x6211;&amp;#x4EEC;&amp;#x4E0D;&amp;#x8003;&amp;#x8651;&amp;#x8FD9;&amp;#x79CD;&amp;#x60C5;&amp;#x51B5;&amp;#xFF0C;&amp;#x9047;&amp;#x5230;&amp;#x7EA0;&amp;#x5220;&amp;#x7801;&amp;#x76F8;&amp;#x5173;&amp;#x7684;&amp;#x5C31;&amp;#x5C31;&amp;#x6309;&amp;#x7167;&amp;#x539F;&amp;#x6709;&amp;#x7684;&amp;#x903B;&amp;#x8F91;&amp;#x8FDB;&amp;#x884C;&amp;#x6062;&amp;#x590D;&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;4-&amp;#x4F18;&amp;#x5316;&amp;#x6548;&amp;#x679C;&quot;&gt;&lt;a href=&quot;#4-&amp;#x4F18;&amp;#x5316;&amp;#x6548;&amp;#x679C;&quot; class=&quot;headerlink&quot; title=&quot;4.&amp;#x4F18;&amp;#x5316;&amp;#x6548;&amp;#x679C;&quot;&gt;&lt;/a&gt;4.&amp;#x4F18;&amp;#x5316;&amp;#x6548;&amp;#x679C;&lt;/h1&gt;&lt;p&gt;&amp;#x4E0B;&amp;#x9762;&amp;#x7684;&amp;#x6D4B;&amp;#x8BD5;&amp;#x7ED3;&amp;#x679C;&amp;#x5BF9;&amp;#x6BD4;&amp;#x4E86;&amp;#x4F18;&amp;#x5316;&amp;#x524D;&amp;#x548C;&amp;#x4F18;&amp;#x5316;&amp;#x540E;&amp;#x7684;&amp;#x6027;&amp;#x80FD;&amp;#xFF08;&amp;#x4E3B;&amp;#x8981;&amp;#x9488;&amp;#x5BF9;&amp;#x968F;&amp;#x673A;&amp;#x8BFB;&amp;#x5199;&amp;#x7684;&amp;#x573A;&amp;#x666F;&amp;#xFF09;&amp;#xFF0C;&amp;#x4ECE;&amp;#x7ED3;&amp;#x679C;&amp;#x4E0A;&amp;#x6765;&amp;#x770B;&amp;#xFF0C;&amp;#x6548;&amp;#x679C;&amp;#x663E;&amp;#x8457;&amp;#xFF1A;&lt;br&gt;1&amp;#xFF09;&amp;#x51CF;&amp;#x5C11;&amp;#x4E86;&amp;#x91CD;&amp;#x542F;osd&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#x5BF9;&amp;#x96C6;&amp;#x7FA4;&amp;#x6B63;&amp;#x5E38;&amp;#x5B58;&amp;#x50A8;I/O&amp;#x6027;&amp;#x80FD;&amp;#x5F71;&amp;#x54CD;&amp;#xFF0C;&amp;#x4ECE;&amp;#x4F18;&amp;#x5316;&amp;#x524D;&amp;#x7684;I/O&amp;#x6027;&amp;#x80FD;&amp;#x4E0B;&amp;#x964D;90%&amp;#x5230;&amp;#x4F18;&amp;#x5316;&amp;#x540E;I/O&amp;#x6027;&amp;#x80FD;&amp;#x53EA;&amp;#x4E0B;&amp;#x964D;10%&amp;#xFF1B;&lt;br&gt;&lt;br&gt;2&amp;#xFF09;&amp;#x7F29;&amp;#x77ED;&amp;#x91CD;&amp;#x542F;&amp;#x6062;&amp;#x590D;&amp;#x6240;&amp;#x9700;&amp;#x8981;&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#xFF0C;&amp;#x91CD;&amp;#x542F;&amp;#x5355;&amp;#x4E2A;osd&amp;#x7684;&amp;#x6062;&amp;#x590D;&amp;#x65F6;&amp;#x95F4;&amp;#x4ECE;10&amp;#x5206;&amp;#x949F;&amp;#x51CF;&amp;#x5C11;&amp;#x5230;40&amp;#x79D2;&amp;#x5DE6;&amp;#x53F3;&amp;#xFF1B;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/2016/08/02/ceph-recover-optimize/perf-before.png&quot; alt=&quot;ceph-recover-optimize&quot;&gt;&lt;br&gt;&lt;img src=&quot;/2016/08/02/ceph-recover-optimize/perf-after.png&quot; alt=&quot;ceph-recover-optimize&quot;&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;1-&amp;#x80CC;&amp;#x666F;&quot;&gt;&lt;a href=&quot;#1-&amp;#x80CC;&amp;#x666F;&quot; class=&quot;headerlink&quot; title=&quot;1.&amp;#x80CC;&amp;#x666F;&quot;&gt;&lt;/a&gt;1.&amp;#x80CC;&amp;#x666F;&lt;/h1&gt;&lt;p&gt;&amp;#x5728;&amp;#x5BF9;ceph&amp;#x5757;&amp;#x5B58;&amp;#x50A8;&amp;#x8FDB;&amp;#x884C;&amp;#x6027;&amp;#x80FD;&amp;#x6D4B;&amp;#x8BD5;&amp;#x65F6;&amp;#x53D1;&amp;#x73B0;&amp;#xFF0C;&amp;#x5F53;&amp;#x6709;osd&amp;#x91CD;&amp;#x542F;&amp;#x6216;&amp;#x8005;&amp;#x5B58;&amp;#x50A8;&amp;#x673A;&amp;#x91CD;&amp;#x542F;&amp;#x65F6;&amp;#xFF0C;I/O&amp;#x6027;&amp;#x80FD;&amp;#x4F1A;&amp;#x6025;&amp;#x5267;&amp;#x4E0B;&amp;#x964D;&amp;#xFF0C;&amp;#x5C24;&amp;#x5176;&amp;#x5728;&amp;#x968F;&amp;#x673A;&amp;#x5199;&amp;#x7684;&amp;#x8D1F;&amp;#x8F7D;&amp;#x4E0B;&amp;#xFF0C;&amp;#x4E0B;&amp;#x964D;&amp;#x5E45;&amp;#x5EA6;&amp;#x8FBE;&amp;#x5230;90%&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x4F1A;&amp;#x6301;&amp;#x7EED;&amp;#x4E00;&amp;#x6BB5;&amp;#x65F6;&amp;#x5019;&amp;#x624D;&amp;#x6162;&amp;#x6162;&amp;#x6062;&amp;#x590D;&amp;#x5230;&amp;#x6B63;&amp;#x5E38;&amp;#x6C34;&amp;#x5E73;&amp;#x3002;&amp;#x4E00;&amp;#x5F00;&amp;#x59CB;&amp;#x6211;&amp;#x4EEC;&amp;#x4E5F;&amp;#x5C1D;&amp;#x8BD5;&amp;#x5C06;&amp;#x6062;&amp;#x590D;&amp;#x76F8;&amp;#x5173;&amp;#x7684;&amp;#x53C2;&amp;#x6570;&amp;#x8C03;&amp;#x4F4E;&amp;#xFF08;osd_recovery_max_active=1&amp;#x3001;osd_recovery_max_chunk=131072&amp;#x3001;osd_max_backfills=1&amp;#xFF09;&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;&amp;#x8C03;&amp;#x6574;&amp;#x6B63;&amp;#x5E38;I/O&amp;#x548C;&amp;#x6062;&amp;#x590D;I/O&amp;#x7684;&amp;#x4F18;&amp;#x5148;&amp;#x7EA7;&amp;#xFF08;osd_recovery_op_priority=10&amp;#x3001;osd_client_op_priority=63&amp;#xFF09;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x6D4B;&amp;#x8BD5;&amp;#x7ED3;&amp;#x679C;&amp;#x6765;&amp;#x770B;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E9B;&amp;#x53C2;&amp;#x6570;&amp;#x7684;&amp;#x8C03;&amp;#x6574;&amp;#x6CA1;&amp;#x6709;&amp;#x591A;&amp;#x5927;&amp;#x7684;&amp;#x6548;&amp;#x679C;&amp;#xFF0C;&amp;#x968F;&amp;#x673A;&amp;#x5199;&amp;#x8D1F;&amp;#x8F7D;&amp;#x4E0B;&amp;#x6027;&amp;#x80FD;&amp;#x4E0B;&amp;#x964D;&amp;#x4ECD;&amp;#x7136;&amp;#x5F88;&amp;#x5927;&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;2-&amp;#x539F;&amp;#x56E0;&amp;#x5206;&amp;#x6790;&quot;&gt;&lt;a href=&quot;#2-&amp;#x539F;&amp;#x56E0;&amp;#x5206;&amp;#x6790;&quot; class=&quot;headerlink&quot; title=&quot;2.&amp;#x539F;&amp;#x56E0;&amp;#x5206;&amp;#x6790;&quot;&gt;&lt;/a&gt;2.&amp;#x539F;&amp;#x56E0;&amp;#x5206;&amp;#x6790;&lt;/h1&gt;&lt;p&gt;&amp;#x5728;&amp;#x300A;ceph&amp;#x57FA;&amp;#x4E8E;pglog&amp;#x7684;&amp;#x4E00;&amp;#x81F4;&amp;#x6027;&amp;#x534F;&amp;#x8BAE;&amp;#x300B;&amp;#x4E00;&amp;#x6587;&amp;#x4E2D;&amp;#x5206;&amp;#x6790;&amp;#x4E86;ceph&amp;#x7684;&amp;#x4E00;&amp;#x81F4;&amp;#x6027;&amp;#x534F;&amp;#x8BAE;&amp;#xFF0C;&amp;#x4ECE;&amp;#x4E2D;&amp;#x6211;&amp;#x4EEC;&amp;#x5F97;&amp;#x77E5;&amp;#x5728;osd&amp;#x91CD;&amp;#x542F;&amp;#x3001;&amp;#x5B58;&amp;#x50A8;&amp;#x673A;&amp;#x91CD;&amp;#x542F;&amp;#x7B49;&amp;#x573A;&amp;#x666F;&amp;#x4E0B;&amp;#x57FA;&amp;#x4E8E;pglog&amp;#x7684;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x5728;peering&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x4F1A;&amp;#x6839;&amp;#x636E;pglog&amp;#x6765;&amp;#x6784;&amp;#x5EFA;&amp;#x51FA;missing&amp;#x5217;&amp;#x8868;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5728;&amp;#x6062;&amp;#x590D;&amp;#x65F6;&amp;#x6839;&amp;#x636E;missing&amp;#x5217;&amp;#x8868;&amp;#x9010;&amp;#x4E2A;&amp;#x8FDB;&amp;#x884C;&amp;#x6062;&amp;#x590D;&amp;#xFF0C;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x7C92;&amp;#x5EA6;&amp;#x662F;&amp;#x6574;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x5927;&amp;#x5C0F;&amp;#xFF08;&amp;#x9ED8;&amp;#x8BA4;4MB&amp;#xFF0C;&amp;#x6709;&amp;#x53EF;&amp;#x80FD;&amp;#x6709;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x4E0D;&amp;#x8DB3;4MB&amp;#xFF0C;&amp;#x5C31;&amp;#x6309;&amp;#x5BF9;&amp;#x8C61;&amp;#x5927;&amp;#x5C0F;&amp;#xFF09;&amp;#xFF0C;&amp;#x5373;&amp;#x4F7F;&amp;#x53EA;&amp;#x4FEE;&amp;#x6539;&amp;#x4E86;&amp;#x4E00;&amp;#x4E2A;4KB&amp;#xFF0C;&amp;#x4E5F;&amp;#x9700;&amp;#x8981;&amp;#x5C06;4MB&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x62F7;&amp;#x8D1D;&amp;#x8FC7;&amp;#x6765;&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;100&amp;#x4E2A;io&amp;#x5C31;&amp;#x4F1A;&amp;#x8FBE;&amp;#x5230;400MB&amp;#x7684;&amp;#x5E26;&amp;#x5BBD;&amp;#xFF0C;&amp;#x5BF9;&amp;#x7F51;&amp;#x7EDC;&amp;#x53CA;&amp;#x78C1;&amp;#x76D8;&amp;#x4EA7;&amp;#x751F;&amp;#x8F83;&amp;#x5927;&amp;#x7684;&amp;#x5F71;&amp;#x54CD;&amp;#x3002;&amp;#x5F53;&amp;#x5199;io&amp;#x547D;&amp;#x4E2D;&amp;#x6B63;&amp;#x5728;&amp;#x4FEE;&amp;#x590D;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x65F6;&amp;#xFF0C;&amp;#x4E5F;&amp;#x662F;&amp;#x5148;&amp;#x4FEE;&amp;#x590D;&amp;#x539F;&amp;#x6765;4MB&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x5373;&amp;#x9700;&amp;#x8981;&amp;#x5C06;4MB&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x901A;&amp;#x8FC7;&amp;#x7F51;&amp;#x7EDC;&amp;#x62F7;&amp;#x8D1D;&amp;#x8FC7;&amp;#x6765;&amp;#xFF0C;&amp;#x5EF6;&amp;#x8FDF;&amp;#x5C31;&amp;#x4F1A;&amp;#x589E;&amp;#x52A0;&amp;#x5F88;&amp;#x591A;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x518D;&amp;#x5199;&amp;#x5165;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x5BF9;&amp;#x4E8E;&amp;#x968F;&amp;#x673A;&amp;#x5199;&amp;#x7684;&amp;#x573A;&amp;#x666F;&amp;#x5C24;&amp;#x5176;&amp;#x4E25;&amp;#x91CD;&amp;#xFF0C;&amp;#x57FA;&amp;#x672C;&amp;#x90FD;&amp;#x662F;&amp;#x547D;&amp;#x4E2D;&amp;#x7684;&amp;#x60C5;&amp;#x51B5;&amp;#xFF0C;&amp;#x5E26;&amp;#x6765;&amp;#x76F8;&amp;#x5F53;&amp;#x5927;&amp;#x7684;&amp;#x5EF6;&amp;#x8FDF;&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;iops&amp;#x4E0B;&amp;#x964D;&amp;#xFF08;&amp;#x4E0B;&amp;#x964D;&amp;#x5E45;&amp;#x5EA6;80%~90%&amp;#xFF09;&amp;#x3002;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5F71;&amp;#x54CD;&amp;#x65F6;&amp;#x95F4;&amp;#x53D6;&amp;#x51B3;&amp;#x4E8E;&amp;#x4E0A;&amp;#x5C42;&amp;#x7684;&amp;#x4E1A;&amp;#x52A1;&amp;#x91CF;&amp;#x548C;osd&amp;#x505C;&amp;#x670D;&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2016/08/02/ceph-recover-optimize/recover-whole.png&quot; alt=&quot;ceph-recover-optimize&quot;&gt;&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ceph" scheme="http://yoursite.com/categories/ceph/"/>
    
    
      <category term="ceph" scheme="http://yoursite.com/tags/ceph/"/>
    
  </entry>
  
  <entry>
    <title>ceph rbd快照原理解析</title>
    <link href="http://yoursite.com/2016/02/28/ceph-rbd-snap/"/>
    <id>http://yoursite.com/2016/02/28/ceph-rbd-snap/</id>
    <published>2016-02-28T08:37:11.000Z</published>
    <updated>2016-05-13T08:58:46.551Z</updated>
    
    <content type="html">&lt;p&gt;&amp;#x524D;&amp;#x6BB5;&amp;#x65F6;&amp;#x95F4;&amp;#x4E00;&amp;#x76F4;&amp;#x5728;&amp;#x7814;&amp;#x7A76;ceph&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x4EE5;&amp;#x53CA;&amp;#x5176;&amp;#x6240;&amp;#x6D89;&amp;#x53CA;&amp;#x7684;&amp;#x6545;&amp;#x969C;&amp;#x6062;&amp;#x590D;&amp;#x903B;&amp;#x8F91;&amp;#xFF0C;ceph&amp;#x5728;&amp;#x8FD9;&amp;#x90E8;&amp;#x5206;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;&amp;#x633A;&amp;#x7CBE;&amp;#x5999;&amp;#x7684;&amp;#xFF0C;&amp;#x867D;&amp;#x7136;&amp;#x4E5F;&amp;#x662F;&amp;#x57FA;&amp;#x4E8E;COW&amp;#x5B9E;&amp;#x73B0;&amp;#x7684;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x7EC6;&amp;#x7EC6;&amp;#x54C1;&amp;#x6765;&amp;#xFF0C;&amp;#x5176;&amp;#x5728;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;&amp;#x5143;&amp;#x6570;&amp;#x636E;&amp;#x7BA1;&amp;#x7406;&amp;#x4EE5;&amp;#x53CA;&amp;#x7236;&amp;#x5B50;&amp;#x5173;&amp;#x7CFB;&amp;#x7684;&amp;#x7EF4;&amp;#x62A4;&amp;#x4E0A;&amp;#x6709;&amp;#x72EC;&amp;#x5230;&amp;#x4E4B;&amp;#x5904;&amp;#xFF0C;&amp;#x672C;&amp;#x6587;&amp;#x5C06;&amp;#x8BE6;&amp;#x7EC6;&amp;#x9610;&amp;#x8FF0;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;&amp;#x539F;&amp;#x7406;&amp;#x4EE5;&amp;#x53CA;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;&amp;#x5728;&amp;#x6062;&amp;#x590D;&amp;#x65F6;&amp;#x5982;&amp;#x4F55;&amp;#x81F3;&amp;#x5173;&amp;#x91CD;&amp;#x8981;&amp;#x7684;&amp;#x4F5C;&amp;#x7528;&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;1-rbd&amp;#x5FEB;&amp;#x7167;&amp;#x7684;&amp;#x76F4;&amp;#x89C2;&amp;#x7406;&amp;#x89E3;&quot;&gt;&lt;a href=&quot;#1-rbd&amp;#x5FEB;&amp;#x7167;&amp;#x7684;&amp;#x76F4;&amp;#x89C2;&amp;#x7406;&amp;#x89E3;&quot; class=&quot;headerlink&quot; title=&quot;1.rbd&amp;#x5FEB;&amp;#x7167;&amp;#x7684;&amp;#x76F4;&amp;#x89C2;&amp;#x7406;&amp;#x89E3;&quot;&gt;&lt;/a&gt;1.rbd&amp;#x5FEB;&amp;#x7167;&amp;#x7684;&amp;#x76F4;&amp;#x89C2;&amp;#x7406;&amp;#x89E3;&lt;/h1&gt;&lt;p&gt;ceph&amp;#x7684;rbd&amp;#x5377;&amp;#x53EF;&amp;#x7528;&amp;#x505A;&amp;#x591A;&amp;#x6B21;&amp;#x5FEB;&amp;#x7167;&amp;#xFF0C;&amp;#x6BCF;&amp;#x6B21;&amp;#x505A;&amp;#x5B8C;&amp;#x5FEB;&amp;#x7167;&amp;#x540E;&amp;#x518D;&amp;#x5BF9;&amp;#x5377;&amp;#x8FDB;&amp;#x884C;&amp;#x5199;&amp;#x5165;&amp;#x65F6;&amp;#x5C31;&amp;#x4F1A;&amp;#x89E6;&amp;#x53D1;COW&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x5373;&amp;#x5148;&amp;#x62F7;&amp;#x8D1D;&amp;#x51FA;&amp;#x539F;&amp;#x6570;&amp;#x636E;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x51FA;&amp;#x6765;&amp;#x751F;&amp;#x6210;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5BF9;&amp;#x539F;&amp;#x6570;&amp;#x636E;&amp;#x5BF9;&amp;#x8C61;&amp;#x8FDB;&amp;#x884C;&amp;#x5199;&amp;#x5165;&amp;#x3002;&amp;#x76F4;&amp;#x89C2;&amp;#x56FE;&amp;#x89E3;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;br&gt;&lt;img src=&quot;/2016/02/28/ceph-rbd-snap/rbd-flow.png&quot; alt=&quot;rbd-flow&quot;&gt;&lt;br&gt;&amp;#x505A;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;&amp;#x64CD;&amp;#x4F5C;&amp;#x662F;&amp;#x5F88;&amp;#x5FEB;&amp;#x7684;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x53EA;&amp;#x66F4;&amp;#x65B0;&amp;#x4E86;&amp;#x5377;&amp;#x7684;&amp;#x5143;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x6DFB;&amp;#x52A0;&amp;#x4E86;&amp;#x4E00;&amp;#x4E9B;&amp;#x5FEB;&amp;#x7167;&amp;#x4FE1;&amp;#x606F;&amp;#xFF08;&amp;#x5305;&amp;#x62EC;&amp;#x8BE5;&amp;#x5377;&amp;#x6709;&amp;#x54EA;&amp;#x4E9B;&amp;#x5FEB;&amp;#x7167;&amp;#xFF0C;&amp;#x5FEB;&amp;#x7167;id&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5377;&amp;#x662F;&amp;#x514B;&amp;#x9686;&amp;#x51FA;&amp;#x6765;&amp;#x7684;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x8FD8;&amp;#x5305;&amp;#x62EC;parent&amp;#x4FE1;&amp;#x606F;&amp;#xFF09;&amp;#x3002;&amp;#x6BCF;&amp;#x4E2A;rbd&amp;#x5377;&amp;#x5728;rados&amp;#x91CC;&amp;#x90FD;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;&lt;strong&gt;rbd_header&lt;/strong&gt;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;rbd_header&amp;#x5BF9;&amp;#x8C61;&amp;#x91CC;&amp;#x9762;&amp;#x6CA1;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x5377;&amp;#x7684;&amp;#x5143;&amp;#x6570;&amp;#x636E;&amp;#x90FD;&amp;#x662F;&amp;#x4F5C;&amp;#x4E3A;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x5C5E;&amp;#x6027;&amp;#x4EE5;omap&amp;#x65B9;&amp;#x5F0F;&amp;#x8BB0;&amp;#x5F55;&amp;#x5230;leveldb&amp;#x91CC;&amp;#xFF08;&amp;#x53EF;&amp;#x4EE5;&amp;#x4F7F;&amp;#x7528;rados -p &lt;pool&gt; listomapvals rbd_header.&lt;id&gt;&amp;#x6765;&amp;#x83B7;&amp;#x5F97;&amp;#x5FEB;&amp;#x7167;&amp;#x76F8;&amp;#x5173;&amp;#x7684;&amp;#x5143;&amp;#x6570;&amp;#x636E;&amp;#x4FE1;&amp;#x606F;&amp;#xFF09;&amp;#x3002;&lt;/id&gt;&lt;/pool&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x5F53;&amp;#x505A;&amp;#x5B8C;&amp;#x5FEB;&amp;#x7167;&amp;#x540E;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x5BF9;&amp;#x539F;&amp;#x5377;&amp;#x8FDB;&amp;#x884C;&amp;#x5199;&amp;#x5165;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x5C31;&amp;#x4F1A;&amp;#x5148;&amp;#x62F7;&amp;#x8D1D;&amp;#x6570;&amp;#x636E;&amp;#x51FA;&amp;#x6765;&amp;#x751F;&amp;#x6210;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF08;&amp;#x5728;&amp;#x4EE3;&amp;#x7801;&amp;#x5B9E;&amp;#x73B0;&amp;#x91CC;&amp;#x5C31;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;clone&amp;#x64CD;&amp;#x4F5C;&amp;#xFF09;&amp;#xFF0C;&amp;#x62F7;&amp;#x8D1D;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x662F;&amp;#x6574;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#xFF08;&amp;#x6709;&amp;#x53EF;&amp;#x80FD;&amp;#x8FD9;&amp;#x4E2A;&amp;#x6570;&amp;#x636E;&amp;#x5BF9;&amp;#x8C61;&amp;#x4E0D;&amp;#x662F;&amp;#x9ED8;&amp;#x8BA4;&amp;#x7684;4MB&amp;#x5927;&amp;#x5C0F;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x6709;&amp;#x591A;&amp;#x5927;&amp;#x62F7;&amp;#x591A;&amp;#x5927;&amp;#xFF09;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x518D;&amp;#x5199;&amp;#x5165;&amp;#x65B0;&amp;#x6570;&amp;#x636E;&amp;#x3002;&amp;#x5728;ceph&amp;#x91CC;&amp;#xFF0C;&amp;#x5377;&amp;#x7684;&amp;#x539F;&amp;#x5BF9;&amp;#x8C61;&amp;#x53EB;&amp;#x505A;&lt;strong&gt;head&amp;#x5BF9;&amp;#x8C61;&lt;/strong&gt;&amp;#xFF0C;&amp;#x800C;&amp;#x5377;&amp;#x4F5C;&amp;#x4E3A;&amp;#x5FEB;&amp;#x7167;&amp;#x540E;&amp;#x901A;&amp;#x8FC7;cow&amp;#x62F7;&amp;#x8D1D;&amp;#x51FA;&amp;#x6765;&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;&amp;#x79F0;&amp;#x4E3A;&lt;strong&gt;snap&amp;#x5BF9;&amp;#x8C61;&lt;/strong&gt;&amp;#x3002;&lt;br&gt;&amp;#x56E0;&amp;#x4E3A;ceph&amp;#x91CC;&amp;#x5BF9;&amp;#x8C61;&amp;#x662F;&amp;#x5199;&amp;#x65F6;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#xFF0C;&amp;#x4E00;&amp;#x4E2A;&amp;#x65B0;&amp;#x521B;&amp;#x5EFA;&amp;#x7684;&amp;#x5377;&amp;#x5982;&amp;#x679C;&amp;#x6BCF;&amp;#x4E00;&amp;#x5199;&amp;#x8FC7;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x5728;rados&amp;#x91CC;&amp;#x662F;&amp;#x6CA1;&amp;#x6709;&amp;#x751F;&amp;#x6210;&amp;#x6570;&amp;#x636E;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#xFF0C;&amp;#x53EA;&amp;#x6709;&amp;#x5F53;&amp;#x6570;&amp;#x636E;&amp;#x5199;&amp;#x5165;&amp;#x65F6;&amp;#xFF0C;&amp;#x624D;&amp;#x5206;&amp;#x914D;&amp;#x51FA;&amp;#x6570;&amp;#x636E;&amp;#x5BF9;&amp;#x8C61;&amp;#x6765;&amp;#x3002;&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;1&amp;#xFF09;&amp;#x56FE;&amp;#x793A;&amp;#x4E2D;&amp;#x4E00;&amp;#x5F00;&amp;#x59CB;&amp;#x5377;&amp;#x5C31;&amp;#x53EA;&amp;#x5199;&amp;#x4E86;&amp;#x524D;8MB&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x53EA;&amp;#x751F;&amp;#x6210;&amp;#x4E86;2&amp;#x4E2A;&amp;#x6570;&amp;#x636E;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x5F53;&amp;#x505A;&amp;#x5B8C;&amp;#x7B2C;&amp;#x4E00;&amp;#x4E2A;&amp;#x5FEB;&amp;#x7167;&amp;#x540E;&amp;#xFF0C;&amp;#x66F4;&amp;#x65B0;&amp;#x539F;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x518D;&amp;#x5BF9;obj1&amp;#x8FDB;&amp;#x884C;&amp;#x5199;&amp;#x5165;&amp;#x524D;&amp;#x5C31;&amp;#x4F1A;&amp;#x62F7;&amp;#x8D1D;&amp;#x751F;&amp;#x6210;obj1-snap1&amp;#xFF1B;&lt;br&gt;2&amp;#xFF09;&amp;#x63A5;&amp;#x7740;&amp;#x505A;&amp;#x7B2C;&amp;#x4E8C;&amp;#x6B21;&amp;#x5FEB;&amp;#x7167;&amp;#xFF0C;&amp;#x66F4;&amp;#x65B0;&amp;#x5143;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5BF9;obj1&amp;#x3001;obj2&amp;#x3001;obj3&amp;#x90FD;&amp;#x8FDB;&amp;#x884C;&amp;#x5199;&amp;#x5165;&amp;#xFF0C;&amp;#x5BF9;&amp;#x4E8E;obj1&amp;#xFF0C;&amp;#x4E3A;&amp;#x5FEB;&amp;#x7167;2&amp;#x751F;&amp;#x6210;obj1-snap2&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x5BF9;&amp;#x4E8E;obj2&amp;#x5C31;&amp;#x6709;&amp;#x6240;&amp;#x4E0D;&amp;#x540C;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;obj2&amp;#x662F;&amp;#x505A;&amp;#x4E86;&amp;#x7B2C;&amp;#x4E8C;&amp;#x6B21;&amp;#x5FEB;&amp;#x7167;&amp;#x540E;&amp;#x624D;&amp;#x8981;&amp;#x8FDB;&amp;#x884C;&amp;#x4FEE;&amp;#x6539;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x8BF4;&amp;#x7B2C;&amp;#x4E00;&amp;#x6B21;&amp;#x5FEB;&amp;#x7167;&amp;#x548C;&amp;#x7B2C;&amp;#x4E8C;&amp;#x6B21;&amp;#x5FEB;&amp;#x7167;&amp;#x4E4B;&amp;#x95F4;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x6CA1;&amp;#x6709;&amp;#x6539;&amp;#x53D8;&amp;#xFF0C;&amp;#x56E0;&amp;#x6B64;&amp;#x53EA;&amp;#x9700;&amp;#x8981;&amp;#x62F7;&amp;#x8D1D;&amp;#x4E00;&amp;#x6B21;&amp;#x5C31;&amp;#x884C;&amp;#x4E86;&amp;#xFF0C;&amp;#x6709;&amp;#x4E24;&amp;#x79CD;&amp;#x505A;&amp;#x6CD5;&amp;#xFF0C;&amp;#x4E00;&amp;#x79CD;&amp;#x662F;&amp;#x4E3A;&amp;#x8F83;&amp;#x8001;&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x751F;&amp;#x6210;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF08;&amp;#x8FD9;&amp;#x91CC;&amp;#x5C31;&amp;#x662F;snap1&amp;#xFF09;&amp;#xFF0C;&amp;#x53E6;&amp;#x5916;&amp;#x4E00;&amp;#x79CD;&amp;#x505A;&amp;#x6CD5;&amp;#x5C31;&amp;#x662F;&amp;#x4E3A;&amp;#x6700;&amp;#x65B0;&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x751F;&amp;#x6210;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF08;&amp;#x5373;snap2&amp;#xFF09;&amp;#x3002;&amp;#x4E24;&amp;#x79CD;&amp;#x505A;&amp;#x6CD5;&amp;#x90FD;&amp;#x53EF;&amp;#x4EE5;&amp;#xFF0C;&amp;#x53EA;&amp;#x8981;&amp;#x8BB0;&amp;#x5F55;&amp;#x4E86;&amp;#x5F15;&amp;#x7528;&amp;#x5173;&amp;#x7CFB;&amp;#xFF0C;&amp;#x7B2C;&amp;#x4E00;&amp;#x79CD;&amp;#x662F;snap2&amp;#x5F15;&amp;#x7528;snap1&amp;#xFF0C;&amp;#x800C;&amp;#x7B2C;&amp;#x4E8C;&amp;#x79CD;&amp;#x662F;snap1&amp;#x5F15;&amp;#x7528;snap2&amp;#xFF0C;&amp;#x5728;ceph&amp;#x91CC;&amp;#x662F;&amp;#x91C7;&amp;#x7528;&amp;#x7B2C;&amp;#x4E8C;&amp;#x79CD;&amp;#x65B9;&amp;#x5F0F;&amp;#x6765;&amp;#x5B9E;&amp;#x73B0;&amp;#x7684;&amp;#xFF0C;&amp;#x56E0;&amp;#x6B64;&amp;#x62F7;&amp;#x8D1D;&amp;#x51FA;obj2-snap2&amp;#x3002;&amp;#x5BF9;&amp;#x4E8E;obj3&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x5377;&amp;#x539F;&amp;#x6765;&amp;#x5C31;&amp;#x6CA1;&amp;#x6709;&amp;#x5199;&amp;#x8FC7;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x65E0;&amp;#x9700;&amp;#x751F;&amp;#x6210;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF1B;&lt;br&gt;3&amp;#xFF09;&amp;#x63A5;&amp;#x7740;&amp;#x505A;&amp;#x7B2C;&amp;#x4E09;&amp;#x6B21;&amp;#x5FEB;&amp;#x7167;&amp;#xFF0C;&amp;#x66F4;&amp;#x65B0;&amp;#x5143;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5BF9;obj2&amp;#x3001;obj3&amp;#x8FDB;&amp;#x884C;&amp;#x5199;&amp;#x5165;&amp;#x65F6;&amp;#xFF0C;&amp;#x751F;&amp;#x6210;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;obj2-snap3&amp;#x3001;obj3-snap3&amp;#xFF1B;&lt;/p&gt;
&lt;h2 id=&quot;2-&amp;#x5FEB;&amp;#x7167;&amp;#x5173;&amp;#x952E;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&quot;&gt;&lt;a href=&quot;#2-&amp;#x5FEB;&amp;#x7167;&amp;#x5173;&amp;#x952E;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&quot; class=&quot;headerlink&quot; title=&quot;2.&amp;#x5FEB;&amp;#x7167;&amp;#x5173;&amp;#x952E;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&quot;&gt;&lt;/a&gt;2.&amp;#x5FEB;&amp;#x7167;&amp;#x5173;&amp;#x952E;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&lt;/h2&gt;&lt;p&gt;&amp;#x4E3A;&amp;#x4E86;&amp;#x4FBF;&amp;#x4E8E;&amp;#x540E;&amp;#x7EED;&amp;#x9610;&amp;#x8FF0;&amp;#xFF0C;&amp;#x9700;&amp;#x8981;&amp;#x5148;&amp;#x4ECB;&amp;#x7ECD;&amp;#x51E0;&amp;#x4E2A;&amp;#x91CD;&amp;#x8981;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#x3002;&lt;br&gt;&amp;#x5728;rbd&amp;#x7AEF;&amp;#xFF0C;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;snap&amp;#x76F8;&amp;#x5173;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&lt;br&gt;&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; SnapContext {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;snapid_t&lt;/span&gt; seq;            &lt;span class=&quot;comment&quot;&gt;// &amp;apos;time&amp;apos; stamp&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;vector&lt;/span&gt;&amp;lt;&lt;span class=&quot;keyword&quot;&gt;snapid_t&lt;/span&gt;&amp;gt; snaps;  &lt;span class=&quot;comment&quot;&gt;// existent snaps, in descending order&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ...............&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x5176;&amp;#x4E2D;seq&amp;#x8868;&amp;#x793A;&amp;#x6700;&amp;#x65B0;&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x5E8F;&amp;#x53F7;&amp;#xFF0C;&amp;#x800C;snaps&amp;#x4FDD;&amp;#x5B58;&amp;#x4E86;&amp;#x8FD9;&amp;#x4E2A;rbd&amp;#x7684;&amp;#x6240;&amp;#x6709;&amp;#x5FEB;&amp;#x7167;&amp;#x5E8F;&amp;#x53F7;&amp;#x3002;&lt;br&gt;&amp;#x5728;librados&amp;#x76F8;&amp;#x5173;&amp;#x7684;&amp;#x7ED3;&amp;#x6784;&amp;#x91CC;&amp;#x8BB0;&amp;#x5F55;&amp;#x4E86;&amp;#x5FEB;&amp;#x7167;&amp;#x4FE1;&amp;#x606F;&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; librados::IoCtxImpl {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ......&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;snapid_t&lt;/span&gt; snap_seq;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ::SnapContext snapc;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ....&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x5176;&amp;#x4E2D;snap_seq&amp;#x7684;&amp;#x542B;&amp;#x4E49;&amp;#xFF1A;&amp;#x5982;&amp;#x679C;&amp;#x662F;&amp;#x5FEB;&amp;#x7167;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;snap_seq&amp;#x5C31;&amp;#x662F;&amp;#x8BE5;snap&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x5E8F;&amp;#x53F7;&amp;#xFF1B;&amp;#x5982;&amp;#x679C;&amp;#x4E0D;&amp;#x662F;&amp;#x5FEB;&amp;#x7167;&amp;#xFF0C;snap_seq&amp;#x5C31;&amp;#x662F;CEPH_NOSNAP&amp;#xFF0C;&amp;#x5728;&amp;#x4EE3;&amp;#x7801;&amp;#x91CC;&amp;#x7ECF;&amp;#x5E38;&amp;#x770B;&amp;#x5230;&amp;#x4F7F;&amp;#x7528;snap_id&amp;#x6765;&amp;#x5224;&amp;#x65AD;&amp;#x662F;&amp;#x5426;&amp;#x662F;CEPH_NOSNAP&amp;#x6765;&amp;#x5224;&amp;#x65AD;&amp;#x662F;&amp;#x5377;&amp;#x7684;head&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x8FD8;&amp;#x662F;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;snap&amp;#x5BF9;&amp;#x8C61;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x5728;OSD&amp;#x7AEF;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5373;&amp;#x662F;ceph&amp;#x7684;&amp;#x670D;&amp;#x52A1;&amp;#x7AEF;&amp;#xFF0C;&amp;#x4F7F;&amp;#x7528;SnapSet&amp;#x6765;&amp;#x4FDD;&amp;#x5B58;&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; SnapSet {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;snapid_t&lt;/span&gt; seq;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;bool&lt;/span&gt; head_exists;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;vector&lt;/span&gt;&amp;lt;&lt;span class=&quot;keyword&quot;&gt;snapid_t&lt;/span&gt;&amp;gt; snaps;    &lt;span class=&quot;comment&quot;&gt;// descending&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;vector&lt;/span&gt;&amp;lt;&lt;span class=&quot;keyword&quot;&gt;snapid_t&lt;/span&gt;&amp;gt; clones;   &lt;span class=&quot;comment&quot;&gt;// ascending&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;map&lt;/span&gt;&amp;lt;&lt;span class=&quot;keyword&quot;&gt;snapid_t&lt;/span&gt;, interval_set&amp;lt;&lt;span class=&quot;keyword&quot;&gt;uint64_t&lt;/span&gt;&amp;gt; &amp;gt; clone_overlap;  &lt;span class=&quot;comment&quot;&gt;// overlap w/ next newest&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;map&lt;/span&gt;&amp;lt;&lt;span class=&quot;keyword&quot;&gt;snapid_t&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;uint64_t&lt;/span&gt;&amp;gt; clone_size;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ......&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x5176;&amp;#x4E2D;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;seq&amp;#xFF1A;&amp;#x8868;&amp;#x793A;&amp;#x6700;&amp;#x65B0;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;&amp;#x5E8F;&amp;#x53F7;&amp;#xFF1B;&lt;/li&gt;
&lt;li&gt;head_exists&amp;#xFF1A;&amp;#x8868;&amp;#x793A;head&amp;#x5BF9;&amp;#x8C61;&amp;#x662F;&amp;#x5426;&amp;#x5B58;&amp;#x5728;&amp;#xFF1B;&lt;/li&gt;
&lt;li&gt;snaps&amp;#xFF1A;&amp;#x4FDD;&amp;#x5B58;&amp;#x6240;&amp;#x6709;&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x5E8F;&amp;#x53F7;&amp;#xFF1B;&lt;/li&gt;
&lt;li&gt;clones&amp;#xFF1A;&amp;#x4FDD;&amp;#x5B58;&amp;#x5728;&amp;#x505A;&amp;#x5B8C;&amp;#x5FEB;&amp;#x7167;&amp;#x540E;&amp;#xFF0C;&amp;#x5BF9;&amp;#x539F;&amp;#x5BF9;&amp;#x8C61;&amp;#x8FDB;&amp;#x884C;&amp;#x5199;&amp;#x5165;&amp;#x65F6;&amp;#x89E6;&amp;#x53D1;cow&amp;#x8FDB;&amp;#x884C;clone&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x5E8F;&amp;#x53F7;&amp;#xFF0C;&amp;#x6CE8;&amp;#x610F;&amp;#x5E76;&amp;#x4E0D;&amp;#x662F;&amp;#x6BCF;&amp;#x4E2A;&amp;#x5FEB;&amp;#x7167;&amp;#x90FD;&amp;#x9700;&amp;#x8981;clone&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x4ECE;&amp;#x524D;&amp;#x9762;&amp;#x7684;&amp;#x56FE;&amp;#x793A;&amp;#x4E2D;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x51FA;&amp;#xFF0C;&amp;#x53EA;&amp;#x6709;&amp;#x505A;&amp;#x5B8C;&amp;#x5FEB;&amp;#x7167;&amp;#x540E;&amp;#xFF0C;&amp;#x5BF9;&amp;#x76F8;&amp;#x5E94;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x8FDB;&amp;#x884C;&amp;#x5199;&amp;#x5165;&amp;#x64CD;&amp;#x4F5C;&amp;#x65F6;&amp;#x624D;&amp;#x4F1A;clone&amp;#x53BB;&amp;#x62F7;&amp;#x8D1D;&amp;#x6570;&amp;#x636E;&amp;#xFF1B;&lt;/li&gt;
&lt;li&gt;clone_overlap&amp;#xFF1A;&amp;#x4E3A;&amp;#x6BCF;&amp;#x4E2A;&amp;#x505A;&amp;#x8FC7;clone&amp;#x52A8;&amp;#x4F5C;&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#xFF0C;&amp;#x8BB0;&amp;#x5F55;&amp;#x5728;&amp;#x5176;clone&amp;#x6570;&amp;#x636E;&amp;#x5BF9;&amp;#x8C61;&amp;#x540E;&amp;#xFF0C;&amp;#x539F;&amp;#x6570;&amp;#x636E;&amp;#x5BF9;&amp;#x8C61;&amp;#x4E0A;&amp;#x672A;&amp;#x5199;&amp;#x8FC7;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x90E8;&amp;#x5206;&amp;#xFF0C;&amp;#x662F;&amp;#x91C7;&amp;#x7528;offset~len&amp;#x7684;&amp;#x65B9;&amp;#x5F0F;&amp;#x8FDB;&amp;#x884C;&amp;#x8BB0;&amp;#x5F55;&amp;#x7684;&amp;#xFF0C;&amp;#x6BD4;&amp;#x5982;{2=[0~1646592,1650688~12288,1667072~577536]}&amp;#xFF1B;&lt;/li&gt;
&lt;li&gt;clone_size&amp;#xFF1A;&amp;#x8868;&amp;#x793A;&amp;#x6BCF;&amp;#x6B21;clone&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x5927;&amp;#x5C0F;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x6709;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x4E00;&amp;#x5F00;&amp;#x59CB;&amp;#x5E76;&amp;#x4E0D;&amp;#x662F;&amp;#x9ED8;&amp;#x8BA4;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x5927;&amp;#x5C0F;&amp;#xFF0C;&amp;#x6BD4;&amp;#x5982;&amp;#x9ED8;&amp;#x8BA4;&amp;#x5BF9;&amp;#x8C61;&amp;#x5927;&amp;#x5C0F;&amp;#x662F;4MB&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x4E00;&amp;#x5F00;&amp;#x59CB;&amp;#x53EA;&amp;#x5199;&amp;#x4E86;&amp;#x524D;2MB&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x5728;&amp;#x505A;&amp;#x5B8C;&amp;#x5FEB;&amp;#x7167;&amp;#x540E;&amp;#x8FDB;&amp;#x884C;&amp;#x65B0;&amp;#x7684;&amp;#x5199;&amp;#x5165;&amp;#x524D;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x5C31;&amp;#x662F;2MB&amp;#x5927;&amp;#x5C0F;&amp;#xFF1B;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&amp;#x4E0B;&amp;#x9762;&amp;#x4EE5;&amp;#x56FE;&amp;#x793A;&amp;#x6765;&amp;#x7B80;&amp;#x5355;&amp;#x63CF;&amp;#x8FF0;&amp;#x5FEB;&amp;#x7167;&amp;#x540E;&amp;#x5BF9;&amp;#x539F;&amp;#x5BF9;&amp;#x8C61;&amp;#x8FDB;&amp;#x884C;&amp;#x5199;&amp;#x5165;&amp;#x65F6;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#xFF1A;&lt;br&gt;&lt;img src=&quot;/2016/02/28/ceph-rbd-snap/snap-write.png&quot; alt=&quot;snap-write&quot;&gt;&lt;br&gt;&lt;strong&gt;&amp;#x4E3A;&amp;#x4E86;&amp;#x76F4;&amp;#x89C2;&amp;#x7406;&amp;#x89E3;&amp;#xFF0C;clone_overlap&amp;#x91C7;&amp;#x7528;[startoffset~endoffset]&amp;#x7684;&amp;#x5F62;&amp;#x5F0F;&amp;#x6765;&amp;#x63CF;&amp;#x8FF0;&amp;#x7684;&amp;#xFF0C;&amp;#x5B9E;&amp;#x9645;&amp;#x5728;&amp;#x4EE3;&amp;#x7801;&amp;#x91CC;&amp;#x5B9E;&amp;#x73B0;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x662F;&amp;#x91C7;&amp;#x7528;[offset~len]&amp;#x7684;&amp;#x5F62;&amp;#x5F0F;&amp;#x3002;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x5982;&amp;#x56FE;&amp;#x793A;&amp;#xFF1A;&amp;#x4E00;&amp;#x4E2A;4MB&amp;#x7684;head&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x5728;&amp;#x505A;&amp;#x5B8C;&amp;#x5FEB;&amp;#x7167;&amp;#x540E;&amp;#x7B2C;&amp;#x4E00;&amp;#x6B21;&amp;#x5199;&amp;#x5165;&amp;#x89E6;&amp;#x53D1;cow&amp;#xFF0C;&amp;#x5728;ceph&amp;#x91CC;&amp;#x5C31;&amp;#x662F;CLONE&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x5C31;&amp;#x4F1A;&amp;#x5C06;&amp;#x8FD9;&amp;#x4E2A;head&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#xFF08;&amp;#x53EF;&amp;#x80FD;&amp;#x4E0D;&amp;#x662F;4MB&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x8FD9;&amp;#x4E2A;head&amp;#x5BF9;&amp;#x8C61;&amp;#x6CA1;&amp;#x6709;&amp;#x5168;&amp;#x90E8;&amp;#x5199;&amp;#x8FC7;&amp;#x4E00;&amp;#x904D;&amp;#xFF09;&amp;#x8BFB;&amp;#x53D6;&amp;#x51FA;&amp;#x6765;&amp;#xFF0C;&amp;#x62F7;&amp;#x8D1D;&amp;#x5230;&amp;#x4E00;&amp;#x4E2A;&amp;#x65B0;&amp;#x751F;&amp;#x6210;&amp;#x7684;snap&amp;#x5BF9;&amp;#x8C61;&amp;#x91CC;&amp;#xFF08;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5C31;&amp;#x662F;snap1&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF09;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5C06;&amp;#x65B0;&amp;#x5199;&amp;#x5165;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#xFF08;&amp;#x6BD4;&amp;#x5982;256k~512k&amp;#x533A;&amp;#x95F4;&amp;#x7684;&amp;#x5C31;&amp;#x662F;&amp;#x65B0;&amp;#x5199;&amp;#x5165;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#xFF09;&amp;#x5199;&amp;#x5230;head&amp;#x5BF9;&amp;#x8C61;&amp;#x4E0A;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x4F1A;&amp;#x66F4;&amp;#x65B0;&amp;#x8FD9;&amp;#x4E2A;head&amp;#x5BF9;&amp;#x8C61;&amp;#x4E0A;&amp;#x7684;clone_overlap[1]&amp;#xFF0C;&amp;#x4E00;&amp;#x5F00;&amp;#x59CB;&amp;#x8FD9;&amp;#x4E2A;clone_overlap[1]&amp;#x662F;&amp;#x6574;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x533A;&amp;#x95F4;&amp;#xFF08;&amp;#x6BD4;&amp;#x5982;[0~4M]&amp;#xFF09;&amp;#xFF0C;&amp;#x6BCF;&amp;#x6B21;&amp;#x65B0;&amp;#x5199;&amp;#x5165;&amp;#x65F6;&amp;#xFF0C;&amp;#x5C31;&amp;#x4ECE;&amp;#x8FD9;&amp;#x4E2A;&amp;#x533A;&amp;#x95F4;&amp;#x91CC;&amp;#x51CF;&amp;#x53BB;&amp;#x5199;&amp;#x5165;&amp;#x7684;&amp;#x533A;&amp;#x95F4;&amp;#xFF0C;&amp;#x6BD4;&amp;#x5982;&amp;#x51CF;&amp;#x53BB;&amp;#x5199;&amp;#x5165;&amp;#x4E86;[256k~512k]&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x5F97;&amp;#x5230;&amp;#x7684;clone_overlap[1]&amp;#x7684;&amp;#x533A;&amp;#x95F4;&amp;#x5C31;&amp;#x662F;[0~256k, 512k~4M]&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x5982;&amp;#x679C;&amp;#x53C8;&amp;#x505A;&amp;#x4E86;&amp;#x4E00;&amp;#x6B21;&amp;#x5FEB;&amp;#x7167;snap2&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x53C8;&amp;#x65B0;&amp;#x5199;&amp;#x5165;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x6BD4;&amp;#x5982;[2M, 2.25M]&amp;#x533A;&amp;#x95F4;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x540C;&amp;#x6837;&amp;#x7684;&amp;#xFF0C;&amp;#x4F1A;&amp;#x5148;clone&amp;#x51FA;snap2&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x4E5F;&amp;#x662F;&amp;#x6574;&amp;#x4E2A;head&amp;#x5BF9;&amp;#x8C61;&amp;#x90FD;&amp;#x62F7;&amp;#x8D1D;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5199;&amp;#x5165;&amp;#x65B0;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x5230;head&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x66F4;&amp;#x65B0;clone_overlap[2]&amp;#x4E3A;[0~2M, 2.25M~4M]&amp;#x3002;&amp;#x540E;&amp;#x7EED;&amp;#x5982;&amp;#x679C;&amp;#x7EE7;&amp;#x7EED;&amp;#x6709;&amp;#x65B0;&amp;#x7684;&amp;#x5199;&amp;#x5165;&amp;#xFF0C;&amp;#x4ECD;&amp;#x7136;&amp;#x662F;&amp;#x5C06;clone_overlap[2]&amp;#x91CC;&amp;#x51CF;&amp;#x53BB;&amp;#x65B0;&amp;#x5199;&amp;#x5165;&amp;#x7684;&amp;#x533A;&amp;#x95F4;&amp;#xFF0C;&amp;#x6700;&amp;#x540E;&amp;#x5982;&amp;#x679C;&amp;#x8FD9;&amp;#x4E2A;4MB&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x5728;&amp;#x5FEB;&amp;#x7167;&amp;#x540E;&amp;#x90FD;&amp;#x5199;&amp;#x8FC7;&amp;#x4E00;&amp;#x904D;&amp;#x540E;&amp;#xFF0C;clone_overlap[2]&amp;#x5C31;&amp;#x4F1A;&amp;#x53D8;&amp;#x6210;&amp;#x7A7A;&amp;#x7684;&amp;#x533A;&amp;#x95F4;[]&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;3-&amp;#x514B;&amp;#x9686;&quot;&gt;&lt;a href=&quot;#3-&amp;#x514B;&amp;#x9686;&quot; class=&quot;headerlink&quot; title=&quot;3.&amp;#x514B;&amp;#x9686;&quot;&gt;&lt;/a&gt;3.&amp;#x514B;&amp;#x9686;&lt;/h1&gt;&lt;p&gt;&amp;#x6709;&amp;#x4E86;&amp;#x5FEB;&amp;#x7167;&amp;#x540E;&amp;#xFF0C;&amp;#x81EA;&amp;#x7136;&amp;#x5C31;&amp;#x60F3;&amp;#x4ECE;&amp;#x5FEB;&amp;#x7167;&amp;#x6062;&amp;#x590D;&amp;#x51FA;&amp;#x6765;&amp;#x4E00;&amp;#x4E2A;&amp;#x65B0;&amp;#x7684;&amp;#x5377;&amp;#x8BBE;&amp;#x5907;&amp;#xFF0C;&amp;#x5728;ceph&amp;#x91CC;&amp;#x5C31;&amp;#x662F;&amp;#x514B;&amp;#x9686;&amp;#x5377;&amp;#x3002;&lt;br&gt;&amp;#x4ECE;&amp;#x5FEB;&amp;#x7167;&amp;#x514B;&amp;#x9686;&amp;#x4E00;&amp;#x4E2A;&amp;#x5377;&amp;#x51FA;&amp;#x6765;&amp;#x540E;&amp;#xFF0C;&amp;#x5728;&amp;#x4F7F;&amp;#x7528;&amp;#x8FD9;&amp;#x4E2A;&amp;#x65B0;&amp;#x5377;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x5728;librbd&amp;#x7AEF;open&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x5C31;&amp;#x4F1A;&amp;#x5C42;&amp;#x5C42;&amp;#x6784;&amp;#x5EFA;&amp;#x51FA;&amp;#x5B83;&amp;#x7684;&amp;#x7236;&amp;#x5B50;&amp;#x5173;&amp;#x7CFB;&amp;#x3002;&lt;br&gt;&amp;#x5728;&amp;#x8FDB;&amp;#x884C;I/O&amp;#x8BF7;&amp;#x6C42;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x65F6;&amp;#x5C31;&amp;#x4F1A;&amp;#x7528;&amp;#x5230;&amp;#x8FD9;&amp;#x4E2A;&amp;#x7236;&amp;#x5B50;&amp;#x5173;&amp;#x7CFB;&amp;#xFF0C;&amp;#x514B;&amp;#x9686;&amp;#x51FA;&amp;#x7684;&amp;#x5377;&amp;#x5728;&amp;#x6CA1;&amp;#x5199;&amp;#x5165;&amp;#x4E4B;&amp;#x524D;&amp;#x56E0;&amp;#x4E3A;COW&amp;#x7684;&amp;#x5173;&amp;#x7CFB;&amp;#xFF0C;&amp;#x5176;&amp;#x6570;&amp;#x636E;&amp;#x90FD;&amp;#x662F;&amp;#x5F15;&amp;#x7528;&amp;#x7684;&amp;#x5B83;&amp;#x7684;&amp;#x7236;&amp;#x5377;&amp;#x548C;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x5728;ceph&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;&amp;#x4E2D;&amp;#xFF0C;&amp;#x5BF9;&amp;#x4E8E;&amp;#x514B;&amp;#x9686;&amp;#x5377;&amp;#x7684;&amp;#x8BFB;&amp;#x5199;&amp;#xFF0C;&amp;#x90FD;&amp;#x662F;&amp;#x5148;&amp;#x53BB;&amp;#x627E;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5377;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x672A;&amp;#x627E;&amp;#x5230;&amp;#xFF0C;&amp;#x5C31;&amp;#x518D;&amp;#x627E;parent&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;&amp;#x5C42;&amp;#x5C42;&amp;#x5F80;&amp;#x4E0A;&amp;#xFF0C;&amp;#x76F4;&amp;#x5230;&amp;#x627E;&amp;#x5230;&amp;#x5BF9;&amp;#x8C61;&amp;#x4E3A;&amp;#x6B62;&amp;#x3002;&lt;strong&gt;&amp;#x5E94;&amp;#x8BE5;&amp;#x662F;&amp;#x5148;&amp;#x627E;&amp;#x81EA;&amp;#x5DF1;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x627E;&amp;#x4E0D;&amp;#x5230;&amp;#xFF0C;&amp;#x518D;&amp;#x627E;&amp;#x5176;&amp;#x6240;&amp;#x57FA;&amp;#x4E8E;&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x518D;&amp;#x627E;&amp;#x4E0D;&amp;#x5230;&amp;#x5C31;&amp;#x627E;&amp;#x6E90;&amp;#x5377;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF08;&amp;#x5373;&amp;#x5B83;&amp;#x7684;parent&amp;#xFF09;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x6E90;&amp;#x5377;&amp;#x5BF9;&amp;#x8C61;&amp;#x4E5F;&amp;#x6CA1;&amp;#x6709;&amp;#x5E76;&amp;#x4E14;&amp;#x5B83;&amp;#x4E5F;&amp;#x662F;&amp;#x4ECE;&amp;#x53E6;&amp;#x5916;&amp;#x4E00;&amp;#x4E2A;&amp;#x5FEB;&amp;#x7167;&amp;#x514B;&amp;#x9686;&amp;#x51FA;&amp;#x6765;&amp;#x7684;&amp;#xFF0C;&amp;#x5C31;&amp;#x4F1A;&amp;#x7EE7;&amp;#x7EED;&amp;#x5F80;&amp;#x4E0A;&amp;#x627E;&lt;/strong&gt;&amp;#x3002;&amp;#x800C;&amp;#x4E14;&amp;#x8FD9;&amp;#x4E2A;&amp;#x8FC7;&amp;#x7A0B;&amp;#x53EF;&amp;#x80FD;&amp;#x6D89;&amp;#x53CA;&amp;#x5230;&amp;#x591A;&amp;#x6B21;librbd&amp;#x4E0E;rados&amp;#x7684;&amp;#x4EA4;&amp;#x4E92;&amp;#xFF0C;&amp;#x90FD;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;&amp;#x7F51;&amp;#x7EDC;&amp;#xFF0C;&amp;#x4E00;&amp;#x65E6;&amp;#x5FEB;&amp;#x7167;&amp;#x514B;&amp;#x9686;&amp;#x94FE;&amp;#x6BD4;&amp;#x8F83;&amp;#x957F;&amp;#xFF0C;&amp;#x6548;&amp;#x7387;&amp;#x5C31;&amp;#x5F88;&amp;#x4F4E;&amp;#x3002;&amp;#x800C;ceph&amp;#x63D0;&amp;#x4F9B;&amp;#x514B;&amp;#x9686;&amp;#x5377;&amp;#x7684;flatten&amp;#x7684;&amp;#x529F;&amp;#x80FD;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x5148;&amp;#x5C06;&amp;#x5168;&amp;#x90E8;&amp;#x6570;&amp;#x636E;&amp;#x90FD;&amp;#x62F7;&amp;#x8D1D;&amp;#x4E00;&amp;#x4EFD;&amp;#xFF0C;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x5C06;&amp;#x94FE;&amp;#x65AD;&amp;#x6389;&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;&amp;#x907F;&amp;#x514D;&amp;#x53BB;&amp;#x5FEB;&amp;#x7167;&amp;#x6216;&amp;#x6E90;&amp;#x5377;&amp;#x4E0A;&amp;#x62FF;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;flatten&amp;#x672C;&amp;#x8EAB;&amp;#x5C31;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x6BD4;&amp;#x8F83;&amp;#x8017;&amp;#x65F6;&amp;#x7684;&amp;#x64CD;&amp;#x4F5C;&amp;#x3002;&lt;br&gt;&amp;#x5173;&amp;#x4E8E;ceph librbd&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x4E5F;&amp;#x6709;&amp;#x8FC7;&amp;#x4E0D;&amp;#x5C11;&amp;#x8BA8;&amp;#x8BBA;&amp;#xFF0C;&amp;#x738B;&amp;#x8C6A;&amp;#x8FC8;&amp;#x5728;&amp;#x300A;&amp;#x89E3;&amp;#x6790;ceph&amp;#xFF1A;librbd&amp;#x7684;&amp;#x514B;&amp;#x9686;&amp;#x95EE;&amp;#x9898;&amp;#x300B;&amp;#x4E2D;&amp;#x63D0;&amp;#x5230;&amp;#x8FC7;&amp;#x4E24;&amp;#x79CD;&amp;#x6539;&amp;#x8FDB;&amp;#x65B9;&amp;#x6CD5;&amp;#x3002;&amp;#x4ECE;&amp;#x8FD9;&amp;#x4E2A;&amp;#x514B;&amp;#x9686;&amp;#x5377;&amp;#x7684;I/O&amp;#x8BFB;&amp;#x5199;&amp;#x6D41;&amp;#x7A0B;&amp;#x4E2D;&amp;#x53EF;&amp;#x4EE5;&amp;#x53D1;&amp;#x73B0;&amp;#xFF0C;&amp;#x5728;OSD&amp;#x7AEF;&amp;#x662F;&amp;#x4FDD;&amp;#x5B58;&amp;#x4E86;&amp;#x5377;&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x53CA;&amp;#x7236;&amp;#x5B50;&amp;#x5173;&amp;#x7CFB;&amp;#x7684;&amp;#xFF0C;&amp;#x5176;&amp;#x5B9E;&amp;#x76F4;&amp;#x63A5;&amp;#x5728;OSD&amp;#x7AEF;&amp;#x5E94;&amp;#x8BE5;&amp;#x5C31;&amp;#x80FD;&amp;#x591F;&amp;#x76F4;&amp;#x63A5;&amp;#x627E;&amp;#x5230;&amp;#x8981;&amp;#x8BFB;&amp;#x53D6;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#xFF0C;&amp;#x800C;&amp;#x4E0D;&amp;#x7528;&amp;#x7ECF;&amp;#x8FC7;&amp;#x591A;&amp;#x6B21;librbd&amp;#x4E0E;rados&amp;#x7684;&amp;#x4EA4;&amp;#x4E92;&amp;#xFF0C;&amp;#x5F53;&amp;#x7136;&amp;#x8FD9;&amp;#x53EA;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x521D;&amp;#x6B65;&amp;#x7684;&amp;#x60F3;&amp;#x6CD5;&amp;#xFF0C;ceph&amp;#x672C;&amp;#x8EAB;&amp;#x5DF2;&amp;#x7ECF;&amp;#x5F88;&amp;#x590D;&amp;#x6742;&amp;#x4E86;&amp;#xFF0C;&amp;#x9700;&amp;#x8981;&amp;#x8003;&amp;#x8651;&amp;#x7684;&amp;#x60C5;&amp;#x51B5;&amp;#x4E5F;&amp;#x6BD4;&amp;#x8F83;&amp;#x591A;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x4E0B;&amp;#x9762;&amp;#x7ED3;&amp;#x5408;&amp;#x4E24;&amp;#x4E2A;&amp;#x573A;&amp;#x666F;&amp;#x6765;&amp;#x7B80;&amp;#x5355;&amp;#x8BF4;&amp;#x660E;&amp;#x4E0B;&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2016/02/28/ceph-rbd-snap/con1.png&quot; alt=&quot;con1&quot;&gt;&lt;br&gt;&lt;strong&gt;&amp;#x573A;&amp;#x666F;1&lt;/strong&gt;&amp;#xFF1A;&lt;br&gt;1&amp;#xFF09;&amp;#x4E00;&amp;#x4E2A;&amp;#x5377;&amp;#x5199;&amp;#x4E86;&amp;#x4E00;&amp;#x90E8;&amp;#x5206;&amp;#x6570;&amp;#x636E;&amp;#xFF08;&amp;#x6BD4;&amp;#x5982;3&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x5DF2;&amp;#x5199;&amp;#x8FC7;&amp;#xFF09;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x505A;&amp;#x4E86;&amp;#x5FEB;&amp;#x7167;snap1&amp;#xFF0C;&amp;#x63A5;&amp;#x7740;&amp;#x5BF9;&amp;#x539F;&amp;#x5377;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;obj1&amp;#x7EE7;&amp;#x7EED;&amp;#x5199;&amp;#x5165;&amp;#xFF0C;&amp;#x89E6;&amp;#x53D1;cow&amp;#xFF0C;&amp;#x62F7;&amp;#x8D1D;&amp;#x51FA;snap1&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;obj1-snap1&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5BF9;&amp;#x5377;&amp;#x505A;&amp;#x5FEB;&amp;#x7167;snap2&amp;#xFF0C;&amp;#x63A5;&amp;#x7740;&amp;#x5199;&amp;#x5165;obj2&amp;#x548C;obj3&amp;#xFF0C;&amp;#x89E6;&amp;#x53D1;cow&amp;#xFF0C;&amp;#x62F7;&amp;#x8D1D;&amp;#x51FA;snap2&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;obj2-snap2, obj3-snap2&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x4ECE;snap2&amp;#x514B;&amp;#x9686;&amp;#x51FA;&amp;#x4E00;&amp;#x4E2A;&amp;#x5377;clone&amp;#xFF1B;&lt;br&gt;2&amp;#xFF09;&amp;#x8BFB;&amp;#x514B;&amp;#x9686;&amp;#x5377;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x65F6;&amp;#xFF0C;&amp;#x6BD4;&amp;#x5982;&amp;#x8BFB;obj1-clone&amp;#xFF0C;librbd&amp;#x53D1;&amp;#x9001;&amp;#x8BF7;&amp;#x6C42;&amp;#x5230;rados&amp;#xFF0C;&amp;#x5728;osd&amp;#x7AEF;&amp;#x5904;&amp;#x7406;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x6CA1;&amp;#x6709;&amp;#x627E;&amp;#x5230;obj1-clone&amp;#xFF0C;&amp;#x8FD4;&amp;#x56DE;ENONET&amp;#x7ED9;librbd&amp;#xFF0C;&amp;#x7136;&amp;#x540E;librbd&amp;#x63A5;&amp;#x7740;&amp;#x53BB;&amp;#x627E;&amp;#x514B;&amp;#x9686;&amp;#x5377;&amp;#x7684;parent&amp;#xFF0C;&amp;#x627E;&amp;#x5230;snap2&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x53D1;&amp;#x9001;&amp;#x8BF7;&amp;#x6C42;&amp;#x53BB;&amp;#x8BFB;obj1-snap2&amp;#xFF0C;&amp;#x5728;osd&amp;#x7AEF;&amp;#x5904;&amp;#x7406;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x6839;&amp;#x636E;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5FEB;&amp;#x7167;id&amp;#x53BB;&amp;#x5224;&amp;#x65AD;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5FEB;&amp;#x7167;id&amp;#x6BD4;&amp;#x5BF9;&amp;#x8C61;&amp;#x4E0A;&amp;#x6240;&amp;#x6301;&amp;#x6709;&amp;#x7684;snapset&amp;#x91CC;&amp;#x7684;&amp;#x6700;&amp;#x65B0;&amp;#x7684;&amp;#x5FEB;&amp;#x7167;id&amp;#x8FD8;&amp;#x8981;&amp;#x65B0;&amp;#xFF08;&amp;#x8BF4;&amp;#x660E;&amp;#x5728;&amp;#x505A;&amp;#x5B8C;&amp;#x5FEB;&amp;#x7167;2&amp;#x540E;&amp;#x5E76;&amp;#x6CA1;&amp;#x6709;&amp;#x5BF9;obj1&amp;#x8FDB;&amp;#x884C;&amp;#x5199;&amp;#x5165;&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;&amp;#x5BF9;&amp;#x8C61;obj1&amp;#x7684;snapset&amp;#x5C31;&amp;#x6CA1;&amp;#x6709;&amp;#x66F4;&amp;#x65B0;&amp;#xFF09;&amp;#xFF0C;&amp;#x8FD9;&amp;#x65F6;&amp;#x5982;&amp;#x679C;head&amp;#x5BF9;&amp;#x8C61;&amp;#x5B58;&amp;#x5728;&amp;#xFF08;&amp;#x8FD9;&amp;#x91CC;&amp;#x5C31;&amp;#x662F;obj1&amp;#xFF09;&amp;#x5219;&amp;#x76F4;&amp;#x63A5;&amp;#x8BFB;&amp;#x53D6;head&amp;#x5BF9;&amp;#x8C61;&amp;#xFF08;&amp;#x5373;obj1&amp;#xFF09;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#xFF1B;&amp;#x5426;&amp;#x5219;&amp;#x5C31;&amp;#x76F4;&amp;#x63A5;&amp;#x8FD4;&amp;#x56DE;ENOENT&amp;#x7ED9;librbd&amp;#xFF0C;librbd&amp;#x7AEF;&amp;#x5C31;&amp;#x4F1A;&amp;#x6784;&amp;#x9020;&amp;#x4E00;&amp;#x4E2A;&amp;#x96F6;&amp;#x6570;&amp;#x636E;&amp;#x8FD4;&amp;#x56DE;&amp;#x7ED9;client&amp;#xFF0C;&amp;#x8FD9;&amp;#x79CD;&amp;#x60C5;&amp;#x51B5;&amp;#x8BF4;&amp;#x660E;&amp;#x6E90;head&amp;#x5BF9;&amp;#x8C61;&amp;#x5728;&amp;#x505A;&amp;#x5FEB;&amp;#x7167;2&amp;#x4E4B;&amp;#x524D;&amp;#x5C31;&amp;#x4E0D;&amp;#x5B58;&amp;#x5728;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/2016/02/28/ceph-rbd-snap/con2.png&quot; alt=&quot;con2&quot;&gt;&lt;br&gt;&lt;strong&gt;&amp;#x573A;&amp;#x666F;2&lt;/strong&gt;&amp;#xFF1A;&lt;br&gt;1&amp;#xFF09;&amp;#x4E00;&amp;#x4E2A;&amp;#x5377;&amp;#x5199;&amp;#x4E86;&amp;#x4E00;&amp;#x90E8;&amp;#x5206;&amp;#x6570;&amp;#x636E;&amp;#xFF08;&amp;#x6BD4;&amp;#x5982;3&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x5DF2;&amp;#x5199;&amp;#x8FC7;&amp;#xFF09;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x505A;&amp;#x4E86;&amp;#x5FEB;&amp;#x7167;snap1&amp;#xFF0C;&amp;#x63A5;&amp;#x7740;&amp;#x5BF9;&amp;#x539F;&amp;#x5377;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;obj1&amp;#x548C;obj2&amp;#x7EE7;&amp;#x7EED;&amp;#x5199;&amp;#x5165;&amp;#xFF0C;&amp;#x89E6;&amp;#x53D1;cow&amp;#xFF0C;&amp;#x62F7;&amp;#x8D1D;&amp;#x51FA;snap1&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;obj1-snap1&amp;#x548C;obj2-snap1&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5BF9;&amp;#x5377;&amp;#x505A;&amp;#x5FEB;&amp;#x7167;snap2&amp;#xFF0C;&amp;#x63A5;&amp;#x7740;&amp;#x5199;&amp;#x5165;obj2&amp;#x548C;obj3&amp;#xFF0C;&amp;#x89E6;&amp;#x53D1;cow&amp;#xFF0C;&amp;#x62F7;&amp;#x8D1D;&amp;#x51FA;snap2&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;obj2-snap2, obj3-snap2&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x4ECE;snap1&amp;#x514B;&amp;#x9686;&amp;#x51FA;&amp;#x4E00;&amp;#x4E2A;&amp;#x5377;clone&amp;#xFF1B;&lt;br&gt;2&amp;#xFF09;&amp;#x8BFB;&amp;#x53D6;clone&amp;#x5377;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x6BD4;&amp;#x5982;obj3-clone&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x53D1;&amp;#x8BF7;&amp;#x6C42;&amp;#x5230;rados&amp;#xFF0C;&amp;#x5728;osd&amp;#x7AEF;&amp;#x6CA1;&amp;#x6709;&amp;#x627E;&amp;#x5230;&amp;#x8BE5;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x8FD4;&amp;#x56DE;ENONENT&amp;#x7ED9;librbd&amp;#xFF0C;librbd&amp;#x518D;&amp;#x8BF7;&amp;#x6C42;&amp;#x5176;&amp;#x7236;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;obj3-snap1&amp;#xFF0C;&amp;#x5728;osd&amp;#x7AEF;&amp;#x67E5;&amp;#x627E;obj3-snap1&amp;#x8FD9;&amp;#x4E2A;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;&amp;#x65F6;&amp;#xFF0C;&amp;#x662F;&amp;#x4ECE;snapset&amp;#x7684;clones&amp;#x91CC;&amp;#x627E;&amp;#x7684;&amp;#xFF0C;clones&amp;#x91CC;&amp;#x662F;&amp;#x5DF2;&amp;#x7ECF;&amp;#x505A;&amp;#x8FC7;cow&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;id&amp;#xFF0C;&amp;#x6BD4;&amp;#x5982;clones=[1,2,3,6,7]&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x5982;&amp;#x679C;&amp;#x627E;snapid=2&amp;#x5C31;&amp;#x76F4;&amp;#x63A5;&amp;#x627E;&amp;#x5230;&amp;#x4E86;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x627E;snapid=4&amp;#x7684;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x5C31;&amp;#x627E;&amp;#x5230;snapid=6&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x904D;&amp;#x5386;clones&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x8981;&amp;#x627E;&amp;#x5230;&amp;#x521A;&amp;#x597D;&amp;#x5927;&amp;#x4E8E;&amp;#x7B49;&amp;#x4E8E;&amp;#x6307;&amp;#x5B9A;snapid&amp;#x7684;&amp;#x90A3;&amp;#x4E2A;id&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x903B;&amp;#x8F91;&amp;#x662F;&amp;#x5728;find_object_context&amp;#x91CC;&amp;#x5B9E;&amp;#x73B0;&amp;#x7684;&amp;#x3002;&amp;#x8FD9;&amp;#x91CC;obj3&amp;#x7684;clones&amp;#x91CC;&amp;#x662F;[2]&amp;#xFF0C;&amp;#x6839;&amp;#x636E;snapid=1&amp;#x627E;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x5C31;&amp;#x627E;&amp;#x5230;&amp;#x4E86;snapid=2&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x3002;&lt;br&gt;3&amp;#xFF09;ceph&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;cow&amp;#x903B;&amp;#x8F91;&amp;#x91CC;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x662F;&amp;#x8001;&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x5F15;&amp;#x7528;&amp;#x65B0;&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x6BD4;&amp;#x5982;&amp;#x505A;&amp;#x4E86;2&amp;#x6B21;&amp;#x5FEB;&amp;#x7167;&amp;#x540E;&amp;#xFF0C;&amp;#x518D;&amp;#x5199;&amp;#x5165;&amp;#x6570;&amp;#x636E;&amp;#x65F6;&amp;#x89E6;&amp;#x53D1;&amp;#x7684;cow&amp;#x751F;&amp;#x6210;&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;snapid&amp;#x5C31;&amp;#x662F;&amp;#x6700;&amp;#x65B0;&amp;#x7684;id&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;snapid=2&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;&amp;#x5FEB;&amp;#x7167;1&amp;#x5C31;&amp;#x5F15;&amp;#x7528;&amp;#x5FEB;&amp;#x7167;2&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x4ECE;&amp;#x4E0A;&amp;#x9762;&amp;#x4E24;&amp;#x79CD;&amp;#x573A;&amp;#x666F;&amp;#x4E2D;&amp;#x53EF;&amp;#x4EE5;&amp;#x5F97;&amp;#x77E5;&amp;#xFF0C;&amp;#x5BF9;&amp;#x4E8E;&amp;#x4E00;&amp;#x4E2A;&amp;#x514B;&amp;#x9686;&amp;#x5377;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x5176;&amp;#x7236;&amp;#x5377;&amp;#x4E0D;&amp;#x662F;&amp;#x4ECE;&amp;#x5176;&amp;#x4ED6;&amp;#x5FEB;&amp;#x7167;&amp;#x514B;&amp;#x9686;&amp;#x51FA;&amp;#x6765;&amp;#x7684;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x5BF9;&amp;#x8FD9;&amp;#x4E2A;&amp;#x514B;&amp;#x9686;&amp;#x5377;&amp;#x7684;&amp;#x8BFB;&amp;#x64CD;&amp;#x4F5C;&amp;#x65F6;&amp;#xFF0C;librbd&amp;#x548C;osd&amp;#x6700;&amp;#x591A;&amp;#x7ECF;&amp;#x8FC7;&amp;#x4E24;&amp;#x6B21;&amp;#x4EA4;&amp;#x4E92;&amp;#xFF08;&amp;#x514B;&amp;#x9686;&amp;#x5377;&amp;#x6570;&amp;#x636E;&amp;#x5BF9;&amp;#x8C61;&amp;#x5B58;&amp;#x5728;&amp;#x65F6;&amp;#x5C31;&amp;#x76F4;&amp;#x63A5;&amp;#x8BFB;&amp;#x53D6;&amp;#xFF0C;&amp;#x4E0D;&amp;#x5B58;&amp;#x5728;&amp;#x65F6;&amp;#x5C31;&amp;#x53BB;&amp;#x8BFB;&amp;#x5176;parent&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x8FD8;&amp;#x662F;&amp;#x8BFB;&amp;#x4E0D;&amp;#x5230;&amp;#x5C31;&amp;#x662F;&amp;#x6784;&amp;#x9020;&amp;#x96F6;&amp;#x6570;&amp;#x636E;&amp;#xFF09;&amp;#x3002;&amp;#x4F46;&amp;#x662F;&amp;#x5982;&amp;#x679C;&amp;#x5176;&amp;#x7236;&amp;#x5377;&amp;#x4E5F;&amp;#x662F;&amp;#x4ECE;&amp;#x5FEB;&amp;#x7167;&amp;#x514B;&amp;#x9686;&amp;#x51FA;&amp;#x6765;&amp;#x7684;&amp;#x8BDD;&amp;#xFF0C;&amp;#x5C31;&amp;#x53EF;&amp;#x80FD;&amp;#x5B58;&amp;#x5728;&amp;#x591A;&amp;#x4E8E;2&amp;#x6B21;&amp;#x7684;&amp;#x4EA4;&amp;#x4E92;&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;4-&amp;#x6709;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x6062;&amp;#x590D;&quot;&gt;&lt;a href=&quot;#4-&amp;#x6709;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x6062;&amp;#x590D;&quot; class=&quot;headerlink&quot; title=&quot;4.&amp;#x6709;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x6062;&amp;#x590D;&quot;&gt;&lt;/a&gt;4.&amp;#x6709;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x6062;&amp;#x590D;&lt;/h1&gt;&lt;p&gt;&amp;#x5728;ceph&amp;#x7684;&amp;#x57FA;&amp;#x4E8E;pglog&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x6062;&amp;#x590D;&amp;#x903B;&amp;#x8F91;&amp;#x91CC;&amp;#x90FD;&amp;#x662F;&amp;#x4E0E;snap&amp;#x5BF9;&amp;#x8C61;&amp;#x6709;&amp;#x6240;&amp;#x5173;&amp;#x8054;&amp;#x7684;&amp;#x3002;&amp;#x6062;&amp;#x590D;&amp;#x5206;&amp;#x4E3A;&amp;#x4E24;&amp;#x79CD;&amp;#xFF1A;&amp;#x4E00;&amp;#x79CD;&amp;#x662F;&amp;#x6062;&amp;#x590D;primary&amp;#x4E0A;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x4E00;&amp;#x79CD;&amp;#x662F;&amp;#x6062;&amp;#x590D;replica&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x5728;&amp;#x8FDB;&amp;#x884C;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x4E0D;&amp;#x7BA1;&amp;#x662F;&amp;#x8981;&amp;#x6062;&amp;#x590D;replica&amp;#x4E0A;&amp;#x7684;&amp;#x8FD8;&amp;#x662F;primary&amp;#x4E0A;&amp;#x7684;&amp;#x90FD;&amp;#x662F;&amp;#x7531;primary&amp;#x53D1;&amp;#x8D77;&amp;#x7684;&amp;#xFF0C;&amp;#x8981;&amp;#x6062;&amp;#x590D;replica&amp;#x7684;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x7531;primary push&amp;#x5230;replica&amp;#x4E0A;&amp;#xFF1B;&amp;#x8981;&amp;#x6062;&amp;#x590D;primary&amp;#x81EA;&amp;#x5DF1;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x4ECE;replica pull&amp;#x8FC7;&amp;#x6765;&amp;#x3002;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;&amp;#x8FC7;&amp;#x7A0B;&amp;#x90FD;&amp;#x4F1A;&amp;#x7531;primay&amp;#x5148;&amp;#x8BA1;&amp;#x7B97;&amp;#x51FA;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&lt;strong&gt;data_subsets&lt;/strong&gt;&amp;#x548C;&lt;strong&gt;clone_subsets&lt;/strong&gt;&amp;#xFF0C;&amp;#x5176;&amp;#x4E2D;data_subsets&amp;#x5C31;&amp;#x662F;&amp;#x9700;&amp;#x8981;&amp;#x901A;&amp;#x8FC7;&amp;#x7F51;&amp;#x7EDC;&amp;#x4F20;&amp;#x8F93;&amp;#x8FC7;&amp;#x53BB;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x800C;clone_subsets&amp;#x5C31;&amp;#x662F;&amp;#x53EF;&amp;#x4EE5;&amp;#x4ECE;&amp;#x672C;&amp;#x5730;&amp;#x62F7;&amp;#x8D1D;&amp;#x7684;&amp;#x3002;&lt;br&gt;&lt;strong&gt;&amp;#x4E3A;&amp;#x4E86;&amp;#x63CF;&amp;#x8FF0;&amp;#x65B9;&amp;#x4FBF;&amp;#xFF0C;&amp;#x540E;&amp;#x7EED;&amp;#x7684;data_subsets&amp;#x548C;clone_subsets&amp;#x90FD;&amp;#x662F;&amp;#x91C7;&amp;#x7528;[startoffset~endoffset]&amp;#x7684;&amp;#x5F62;&amp;#x5F0F;&amp;#x6765;&amp;#x63CF;&amp;#x8FF0;&amp;#x7684;&amp;#xFF0C;&amp;#x5B9E;&amp;#x9645;&amp;#x5728;&amp;#x4EE3;&amp;#x7801;&amp;#x91CC;&amp;#x5B9E;&amp;#x73B0;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x662F;&amp;#x91C7;&amp;#x7528;[offset~len]&amp;#x7684;&amp;#x5F62;&amp;#x5F0F;&lt;/strong&gt;&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;4-1&amp;#x6062;&amp;#x590D;replica&quot;&gt;&lt;a href=&quot;#4-1&amp;#x6062;&amp;#x590D;replica&quot; class=&quot;headerlink&quot; title=&quot;4.1&amp;#x6062;&amp;#x590D;replica&quot;&gt;&lt;/a&gt;4.1&amp;#x6062;&amp;#x590D;replica&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;/2016/02/28/ceph-rbd-snap/recover-replica.png&quot; alt=&quot;recover-replica&quot;&gt;&lt;br&gt;&amp;#x6062;&amp;#x590D;replica&amp;#x65F6;&amp;#x662F;&amp;#x5148;&amp;#x6062;&amp;#x590D;snap&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x518D;&amp;#x6062;&amp;#x590D;&amp;#x5176;head&amp;#x5BF9;&amp;#x8C61;&amp;#x3002; &lt;/p&gt;
&lt;h3 id=&quot;1&amp;#xFF09;&amp;#x5BF9;&amp;#x4E8E;snap&amp;#x5BF9;&amp;#x8C61;&quot;&gt;&lt;a href=&quot;#1&amp;#xFF09;&amp;#x5BF9;&amp;#x4E8E;snap&amp;#x5BF9;&amp;#x8C61;&quot; class=&quot;headerlink&quot; title=&quot;1&amp;#xFF09;&amp;#x5BF9;&amp;#x4E8E;snap&amp;#x5BF9;&amp;#x8C61;&quot;&gt;&lt;/a&gt;1&amp;#xFF09;&amp;#x5BF9;&amp;#x4E8E;snap&amp;#x5BF9;&amp;#x8C61;&lt;/h3&gt;&lt;p&gt;&amp;#x6839;&amp;#x636E;pglog&amp;#x6784;&amp;#x5EFA;&amp;#x51FA;&amp;#x7684;missing&amp;#x5217;&amp;#x8868;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#xFF0C;&amp;#x6309;&amp;#x7167;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x65B0;&amp;#x65E7;&amp;#xFF0C;&amp;#x5148;&amp;#x6062;&amp;#x590D;&amp;#x8F83;&amp;#x8001;&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x6700;&amp;#x540E;&amp;#x662F;&amp;#x6700;&amp;#x65B0;&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x3002;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;a&amp;#xFF09;&amp;#x5982;&amp;#x679C;&amp;#x5F85;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;&amp;#x5C31;&amp;#x662F;&amp;#x7B2C;&amp;#x4E00;&amp;#x6B21;&amp;#x5FEB;&amp;#x7167;&amp;#x540E;&amp;#x4EA7;&amp;#x751F;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x8BF4;&amp;#x660E;&amp;#x5B83;&amp;#x662F;replica&amp;#x6302;&amp;#x6389;&amp;#x4E4B;&amp;#x540E;&amp;#x505A;&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x4EA7;&amp;#x751F;&amp;#x7684;&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;&amp;#x5C31;&amp;#x9700;&amp;#x8981;&amp;#x5168;&amp;#x91CF;&amp;#x6062;&amp;#x590D;&amp;#xFF0C;&amp;#x5373;{data_subsets=[0, size]&amp;#xFF0C;clone_subsets=[]}&amp;#xFF0C;&amp;#x5176;&amp;#x4E2D;size&amp;#x8868;&amp;#x793A;&amp;#x5F53;&amp;#x65F6;&amp;#x505A;&amp;#x5FEB;&amp;#x7167;&amp;#x65F6;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E2A;head&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x5927;&amp;#x5C0F;&amp;#xFF0C;&amp;#x4E00;&amp;#x822C;head&amp;#x5BF9;&amp;#x8C61;&amp;#x90FD;&amp;#x5199;&amp;#x8FC7;&amp;#x4E00;&amp;#x904D;&amp;#x540E;&amp;#x5C31;&amp;#x662F;4MB&amp;#xFF1B;&lt;/li&gt;
&lt;li&gt;b&amp;#xFF09;&amp;#x5982;&amp;#x679C;&amp;#x5F85;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;&amp;#x662F;&amp;#x7B2C;n&amp;#x6B21;&amp;#xFF08;n&amp;gt;=2&amp;#xFF09;&amp;#x5FEB;&amp;#x7167;&amp;#x540E;&amp;#x4EA7;&amp;#x751F;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;clone_subsets&amp;#x5C31;&amp;#x662F;&amp;#x6839;&amp;#x636E;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;&amp;#x7236;&amp;#x8F88;&amp;#x548C;&amp;#x5B50;&amp;#x5B59;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;clone_overlap&amp;#x8BA1;&amp;#x7B97;&amp;#x7684;&amp;#x4E00;&amp;#x4E2A;&amp;#x4EA4;&amp;#x96C6;&amp;#xFF0C;&amp;#x800C;data_subsets&amp;#x5C31;&amp;#x662F;&amp;#x7528;[0~size]&amp;#x51CF;&amp;#x53BB;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5FEB;&amp;#x7167;&amp;#x7236;&amp;#x8F88;&amp;#x548C;&amp;#x5B50;&amp;#x5B59;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;clone_overlap&amp;#x7684;&amp;#x5E76;&amp;#x96C6;&amp;#x5F97;&amp;#x5230;&amp;#x7684;&amp;#x533A;&amp;#x95F4;&amp;#xFF08;&amp;#x5177;&amp;#x4F53;&amp;#x8BA1;&amp;#x7B97;&amp;#x8FC7;&amp;#x7A0B;&amp;#x53C2;&amp;#x8003;&amp;#x6E90;&amp;#x7801;&amp;#x7684;calc_clone_subsets&amp;#x51FD;&amp;#x6570;&amp;#xFF09;&amp;#xFF0C;&amp;#x6BD4;&amp;#x5982;&amp;#x56FE;&amp;#x793A;&amp;#x4E0A;&amp;#x5BF9;&amp;#x4E8E;snap2&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x8BA1;&amp;#x7B97;&amp;#x5F97;&amp;#x5230;&amp;#x7684;&amp;#x5C31;&amp;#x662F;{data_subsets=[256k~512k], clone_subsets[1]=[0~256k, 512k~4M]}&amp;#xFF1B;&lt;/li&gt;
&lt;li&gt;c&amp;#xFF09;&amp;#x7136;&amp;#x540E;&amp;#x5BF9;&amp;#x4E8E;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;data_subsets&amp;#x90E8;&amp;#x5206;&amp;#xFF0C;&amp;#x5C31;&amp;#x9700;&amp;#x8981;&amp;#x901A;&amp;#x8FC7;&amp;#x7F51;&amp;#x7EDC;&amp;#x4ECE;primary push&amp;#x8FC7;&amp;#x53BB;&amp;#x5199;&amp;#x5230;replica&amp;#x7684;&amp;#x672C;&amp;#x5730;&amp;#xFF0C;&amp;#x5BF9;&amp;#x4E8E;clone_subsets&amp;#x5C31;&amp;#x4F1A;&amp;#x4ECE;replica&amp;#x672C;&amp;#x5730;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;snap&amp;#x5BF9;&amp;#x8C61;&amp;#x53BB;clone_range&amp;#xFF0C;&amp;#x5373;&amp;#x5728;&amp;#x672C;&amp;#x5730;&amp;#x5C06;snap1&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x90E8;&amp;#x5206;&amp;#x6570;&amp;#x636E;&amp;#x62F7;&amp;#x8D1D;&amp;#x7ED9;snap2&amp;#x5BF9;&amp;#x8C61;&amp;#xFF1B;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;2&amp;#xFF09;&amp;#x5BF9;&amp;#x4E8E;head&amp;#x5BF9;&amp;#x8C61;&quot;&gt;&lt;a href=&quot;#2&amp;#xFF09;&amp;#x5BF9;&amp;#x4E8E;head&amp;#x5BF9;&amp;#x8C61;&quot; class=&quot;headerlink&quot; title=&quot;2&amp;#xFF09;&amp;#x5BF9;&amp;#x4E8E;head&amp;#x5BF9;&amp;#x8C61;&quot;&gt;&lt;/a&gt;2&amp;#xFF09;&amp;#x5BF9;&amp;#x4E8E;head&amp;#x5BF9;&amp;#x8C61;&lt;/h3&gt;&lt;p&gt;&amp;#x904D;&amp;#x5386;&amp;#x5176;&amp;#x6240;&amp;#x6709;&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x6839;&amp;#x636E;&amp;#x8FD9;&amp;#x4E9B;snap&amp;#x7684;clone_overlap&amp;#x8BA1;&amp;#x7B97;&amp;#x5F97;&amp;#x5230;&amp;#x7684;&amp;#x4E00;&amp;#x4E2A;&amp;#x4EA4;&amp;#x96C6;&amp;#x4F5C;&amp;#x4E3A;clone_subsets&amp;#xFF0C;&amp;#x800C;data_subsets&amp;#x5C31;&amp;#x662F;&amp;#x7528;[0~size]&amp;#x51CF;&amp;#x53BB;&amp;#x8FD9;&amp;#x4E9B;clone_overlap&amp;#x7684;&amp;#x5E76;&amp;#x96C6;&amp;#xFF08;&amp;#x5177;&amp;#x4F53;&amp;#x8BA1;&amp;#x7B97;&amp;#x8FC7;&amp;#x7A0B;&amp;#x53C2;&amp;#x8003;&amp;#x6E90;&amp;#x7801;&amp;#x7684;calc_head_subsets&amp;#x51FD;&amp;#x6570;&amp;#xFF09;&amp;#xFF0C;&amp;#x6BD4;&amp;#x5982;&amp;#x56FE;&amp;#x793A;&amp;#x4E0A;&amp;#x5BF9;&amp;#x4E8E;head&amp;#x5BF9;&amp;#x8C61;&amp;#x8BA1;&amp;#x7B97;&amp;#x5F97;&amp;#x5230;&amp;#x7684;&amp;#x5C31;&amp;#x662F;{data_subsets=[2M~2.25M], clone_subsets[2]=[0~256k, 512k~4M], clone_subsets[1]=[0~256k, 512k~2M, 2.25M~4M]}&amp;#x3002;&lt;br&gt;&amp;#x7136;&amp;#x540E;data_subsets&amp;#x7684;&amp;#x90E8;&amp;#x5206;&amp;#xFF0C;&amp;#x5C31;&amp;#x4ECE;&amp;#x672C;&amp;#x5730;&amp;#x8BFB;&amp;#x51FA;&amp;#x6765;&amp;#xFF0C;push&amp;#x5230;replica&amp;#xFF0C;&amp;#x800C;clone_subsets&amp;#x7684;&amp;#x90E8;&amp;#x5206;&amp;#x5C31;&amp;#x662F;&amp;#x5728;replica&amp;#x7AEF;&amp;#x4ECE;&amp;#x81EA;&amp;#x5DF1;&amp;#x672C;&amp;#x5730;&amp;#x7684;snap&amp;#x5BF9;&amp;#x8C61;&amp;#x4E0A;&amp;#x8BFB;&amp;#x53D6;&amp;#x51FA;&amp;#x6765;&amp;#x62F7;&amp;#x8D1D;&amp;#x7ED9;head&amp;#x5BF9;&amp;#x8C61;&amp;#x3002; &lt;/p&gt;
&lt;p&gt;&amp;#x6BD4;&amp;#x8F83;&amp;#x5947;&amp;#x602A;&amp;#x7684;&amp;#x662F;&amp;#xFF0C;&lt;strong&gt;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x4F1A;&amp;#x4ECE;&amp;#x591A;&amp;#x4E2A;&amp;#x5FEB;&amp;#x7167;&amp;#x53BB;&amp;#x62F7;&amp;#x8D1D;&amp;#x6570;&amp;#x636E;&amp;#x5230;head&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x53EA;&amp;#x7528;&amp;#x6700;&amp;#x65B0;&amp;#x7684;&amp;#x90A3;&amp;#x4E2A;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;clone_subset&amp;#x6765;&amp;#x62F7;&amp;#x8D1D;&amp;#x5230;head&amp;#x5BF9;&amp;#x8C61;&amp;#x5E94;&amp;#x8BE5;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x4E86;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5730;&amp;#x65B9;&amp;#x8FD8;&amp;#x6709;&amp;#x7591;&amp;#x95EE;&lt;/strong&gt;&amp;#x3002;&lt;br&gt;&lt;em&gt;&amp;#x53E6;&amp;#x5916;&amp;#xFF0C;&amp;#x5728;&amp;#x539F;&amp;#x6765;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x903B;&amp;#x8F91;&amp;#x91CC;&amp;#x662F;&amp;#x5148;&amp;#x628A;replica&amp;#x7684;head&amp;#x5BF9;&amp;#x8C61;&amp;#x5220;&amp;#x9664;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x518D;&amp;#x7ED3;&amp;#x5408;data_subsets&amp;#x4ECE;primary&amp;#x901A;&amp;#x8FC7;&amp;#x7F51;&amp;#x7EDC;&amp;#x4F20;&amp;#x8F93;&amp;#x8FC7;&amp;#x6765;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x52A0;&amp;#x4E0A;clone_subsets&amp;#x4ECE;&amp;#x672C;&amp;#x5730;snap&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;&amp;#x4E00;&amp;#x8D77;&amp;#x6765;&amp;#x91CD;&amp;#x65B0;&amp;#x6784;&amp;#x9020;&amp;#x51FA;head&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x4E4B;&amp;#x6240;&amp;#x4EE5;&amp;#x8FD9;&amp;#x6837;&amp;#x505A;&amp;#xFF0C;&amp;#x662F;&amp;#x56E0;&amp;#x4E3A;data_subsets&amp;#x5C31;&amp;#x662F;&amp;#x6839;&amp;#x636E;head&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x5404;&amp;#x4E2A;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;clone_overlap&amp;#x7B97;&amp;#x51FA;&amp;#x6765;&amp;#x7684;&amp;#xFF0C;&amp;#x800C;&amp;#x505A;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x70B9;&amp;#x4E0E;replica&amp;#x6302;&amp;#x6389;&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x70B9;&amp;#x4E0D;&amp;#x4E00;&amp;#x6837;&amp;#xFF0C;&amp;#x4E5F;&amp;#x65E0;&amp;#x59A8;&amp;#x533A;&amp;#x5206;&amp;#x662F;&amp;#x5426;&amp;#x662F;replica&amp;#x6302;&amp;#x6389;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x505A;&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x53EA;&amp;#x662F;&amp;#x7528;data_subsets&amp;#x90A3;&amp;#x90E8;&amp;#x5206;&amp;#x6570;&amp;#x636E;&amp;#x8986;&amp;#x76D6;&amp;#x5199;&amp;#x5230;replica&amp;#x7684;head&amp;#x5BF9;&amp;#x8C61;&amp;#x4E0A;&amp;#xFF08;&amp;#x6CA1;&amp;#x6709;&amp;#x5148;&amp;#x5220;&amp;#x9664;replica&amp;#x7684;head&amp;#x5BF9;&amp;#x8C61;&amp;#xFF09;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;replia&amp;#x6062;&amp;#x590D;&amp;#x7684;head&amp;#x5BF9;&amp;#x8C61;&amp;#x5C31;&amp;#x8DDF;primary&amp;#x4E0A;&amp;#x7684;head&amp;#x5BF9;&amp;#x8C61;&amp;#x53EF;&amp;#x80FD;&amp;#x4E0D;&amp;#x4E00;&amp;#x6837;&amp;#xFF0C;&amp;#x9020;&amp;#x6210;&amp;#x6570;&amp;#x636E;&amp;#x4E0D;&amp;#x4E00;&amp;#x81F4;&lt;/em&gt;&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;4-2&amp;#x6062;&amp;#x590D;primary&quot;&gt;&lt;a href=&quot;#4-2&amp;#x6062;&amp;#x590D;primary&quot; class=&quot;headerlink&quot; title=&quot;4.2&amp;#x6062;&amp;#x590D;primary&quot;&gt;&lt;/a&gt;4.2&amp;#x6062;&amp;#x590D;primary&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;/2016/02/28/ceph-rbd-snap/recover-primary.png&quot; alt=&quot;recover-primary&quot;&gt;&lt;br&gt;&amp;#x5F53;primary&amp;#x6302;&amp;#x6389;&amp;#x53C8;&amp;#x8D77;&amp;#x6765;&amp;#x540E;&amp;#x8FDB;&amp;#x884C;&amp;#x6062;&amp;#x590D;&amp;#xFF0C;&amp;#x5148;&amp;#x7ECF;&amp;#x8FC7;peering&amp;#x8FC7;&amp;#x7A0B;&amp;#x540E;&amp;#x6784;&amp;#x5EFA;&amp;#x51FA;missing&amp;#x5217;&amp;#x8868;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x7531;primary&amp;#x8FDB;&amp;#x884C;&amp;#x6062;&amp;#x590D;&amp;#x3002;&lt;br&gt;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x662F;&amp;#x5148;&amp;#x6062;&amp;#x590D;head&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x518D;&amp;#x6062;&amp;#x590D;&amp;#x5176;snap&amp;#x5BF9;&amp;#x8C61;&amp;#x3002; &lt;/p&gt;
&lt;h3 id=&quot;1&amp;#xFF09;&amp;#x5BF9;&amp;#x4E8E;head&amp;#x5BF9;&amp;#x8C61;&quot;&gt;&lt;a href=&quot;#1&amp;#xFF09;&amp;#x5BF9;&amp;#x4E8E;head&amp;#x5BF9;&amp;#x8C61;&quot; class=&quot;headerlink&quot; title=&quot;1&amp;#xFF09;&amp;#x5BF9;&amp;#x4E8E;head&amp;#x5BF9;&amp;#x8C61;&quot;&gt;&lt;/a&gt;1&amp;#xFF09;&amp;#x5BF9;&amp;#x4E8E;head&amp;#x5BF9;&amp;#x8C61;&lt;/h3&gt;&lt;p&gt;data_subsets=[0, size]&amp;#xFF0C;clone_subsets=[]&lt;br&gt;&amp;#x8FD9;&amp;#x91CC;size&amp;#x662F;head&amp;#x5BF9;&amp;#x8C61;&amp;#x5927;&amp;#x5C0F;&amp;#xFF0C;&amp;#x4E00;&amp;#x822C;&amp;#x5982;&amp;#x679C;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x90FD;&amp;#x5199;&amp;#x8FC7;&amp;#x4E00;&amp;#x904D;&amp;#x540E;&amp;#x5C31;&amp;#x662F;4MB&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x8BF4;head&amp;#x5BF9;&amp;#x8C61;&amp;#x662F;&amp;#x9700;&amp;#x8981;&amp;#x5C06;&amp;#x6574;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x901A;&amp;#x8FC7;&amp;#x7F51;&amp;#x7EDC;&amp;#x4ECE;replica pull&amp;#x8FC7;&amp;#x6765;&amp;#x7684;&amp;#x3002;clone_subsets&amp;#x4E3A;&amp;#x7A7A;&amp;#xFF0C;&amp;#x8868;&amp;#x793A;&amp;#x6CA1;&amp;#x6709;&amp;#x6570;&amp;#x636E;&amp;#x4ECE;&amp;#x8BE5;primary&amp;#x7684;&amp;#x672C;&amp;#x5730;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;&amp;#x62F7;&amp;#x8D1D;&amp;#x3002;&lt;br&gt;&amp;#x8FD9;&amp;#x91CC;&amp;#x6CA1;&amp;#x6709;&amp;#x50CF;&amp;#x6062;&amp;#x590D;replica&amp;#x90A3;&amp;#x6837;&amp;#x53BB;&amp;#x8BA1;&amp;#x7B97;data_subsets&amp;#x548C;clone_subsets&amp;#xFF0C;&amp;#x662F;&amp;#x56E0;&amp;#x4E3A;primay&amp;#x6302;&amp;#x6389;&amp;#x540E;&amp;#xFF0C;&amp;#x53EF;&amp;#x80FD;&amp;#x53C8;&amp;#x505A;&amp;#x4E86;&amp;#x5FEB;&amp;#x7167;&amp;#x5E76;&amp;#x5199;&amp;#x5165;&amp;#x4E86;&amp;#x65B0;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;&amp;#x65B0;&amp;#x4EA7;&amp;#x751F;&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;&amp;#x5728;primay&amp;#x4E0A;&amp;#x5C31;&amp;#x6CA1;&amp;#x6709;&amp;#xFF0C;&amp;#x800C;&amp;#x4E14;primary&amp;#x4E0A;&amp;#x6CA1;&amp;#x6709;&amp;#x6700;&amp;#x65B0;&amp;#x7684;snapset&amp;#xFF08;&amp;#x5373;&amp;#x91CC;&amp;#x9762;&amp;#x5305;&amp;#x542B;&amp;#x7684;clone_overlap&amp;#x4E0D;&amp;#x662F;&amp;#x6700;&amp;#x65B0;&amp;#x7684;&amp;#xFF09;&amp;#xFF0C;&amp;#x56E0;&amp;#x6B64;&amp;#x5C31;&amp;#x4E0D;&amp;#x80FD;&amp;#x62FF;&amp;#x6765;&amp;#x8BA1;&amp;#x7B97;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x76F4;&amp;#x63A5;&amp;#x6062;&amp;#x590D;&amp;#x6574;&amp;#x4E2A;head&amp;#x5BF9;&amp;#x8C61;&amp;#x3002;&lt;/p&gt;
&lt;h3 id=&quot;2&amp;#xFF09;&amp;#x5BF9;&amp;#x4E8E;snap&amp;#x5BF9;&amp;#x8C61;&quot;&gt;&lt;a href=&quot;#2&amp;#xFF09;&amp;#x5BF9;&amp;#x4E8E;snap&amp;#x5BF9;&amp;#x8C61;&quot; class=&quot;headerlink&quot; title=&quot;2&amp;#xFF09;&amp;#x5BF9;&amp;#x4E8E;snap&amp;#x5BF9;&amp;#x8C61;&quot;&gt;&lt;/a&gt;2&amp;#xFF09;&amp;#x5BF9;&amp;#x4E8E;snap&amp;#x5BF9;&amp;#x8C61;&lt;/h3&gt;&lt;p&gt;&amp;#x4E0E;&amp;#x6062;&amp;#x590D;replica&amp;#x4E00;&amp;#x6837;&amp;#xFF0C;&amp;#x6839;&amp;#x636E;pglog&amp;#x6784;&amp;#x5EFA;&amp;#x51FA;&amp;#x7684;missing&amp;#x5217;&amp;#x8868;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#xFF0C;&amp;#x6309;&amp;#x7167;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x65B0;&amp;#x65E7;&amp;#xFF0C;&amp;#x5148;&amp;#x6062;&amp;#x590D;&amp;#x8F83;&amp;#x8001;&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x6700;&amp;#x540E;&amp;#x662F;&amp;#x6700;&amp;#x65B0;&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x3002;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;a&amp;#xFF09;&amp;#x5982;&amp;#x679C;&amp;#x5F85;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;&amp;#x5C31;&amp;#x662F;&amp;#x7B2C;&amp;#x4E00;&amp;#x6B21;&amp;#x5FEB;&amp;#x7167;&amp;#x540E;&amp;#x4EA7;&amp;#x751F;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x8BF4;&amp;#x660E;&amp;#x5B83;&amp;#x662F;primary&amp;#x6302;&amp;#x6389;&amp;#x4E4B;&amp;#x540E;&amp;#x505A;&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x4EA7;&amp;#x751F;&amp;#x7684;&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;&amp;#x5C31;&amp;#x9700;&amp;#x8981;&amp;#x5168;&amp;#x91CF;&amp;#x6062;&amp;#x590D;&amp;#xFF0C;&amp;#x5373;{data_subsets=[0, size]&amp;#xFF0C;clone_subsets=[]}&amp;#xFF0C;&amp;#x5176;&amp;#x4E2D;&amp;#x8868;&amp;#x793A;&amp;#x5F53;&amp;#x65F6;&amp;#x505A;&amp;#x5FEB;&amp;#x7167;&amp;#x65F6;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E2A;head&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x5927;&amp;#x5C0F;&amp;#xFF0C;&amp;#x4E00;&amp;#x822C;head&amp;#x5BF9;&amp;#x8C61;&amp;#x90FD;&amp;#x5199;&amp;#x8FC7;&amp;#x4E00;&amp;#x904D;&amp;#x540E;&amp;#x5C31;&amp;#x662F;4MB&amp;#xFF1B;&lt;/li&gt;
&lt;li&gt;b&amp;#xFF09;&amp;#x5982;&amp;#x679C;&amp;#x5F85;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;&amp;#x662F;&amp;#x7B2C;n&amp;#x6B21;&amp;#xFF08;n&amp;gt;=2&amp;#xFF09;&amp;#x5FEB;&amp;#x7167;&amp;#x540E;&amp;#x4EA7;&amp;#x751F;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;clone_subsets&amp;#x5C31;&amp;#x662F;&amp;#x6839;&amp;#x636E;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;&amp;#x7236;&amp;#x8F88;&amp;#x548C;&amp;#x5B50;&amp;#x5B59;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;clone_overlap&amp;#x8BA1;&amp;#x7B97;&amp;#x7684;&amp;#x4E00;&amp;#x4E2A;&amp;#x4EA4;&amp;#x96C6;&amp;#xFF0C;&amp;#x800C;data_subsets&amp;#x5C31;&amp;#x662F;&amp;#x7528;[0~size]&amp;#x51CF;&amp;#x53BB;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5FEB;&amp;#x7167;&amp;#x7236;&amp;#x8F88;&amp;#x548C;&amp;#x5B50;&amp;#x5B59;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;clone_overlap&amp;#x7684;&amp;#x5E76;&amp;#x96C6;&amp;#x5F97;&amp;#x5230;&amp;#x7684;&amp;#x533A;&amp;#x95F4;&amp;#xFF08;&amp;#x5177;&amp;#x4F53;&amp;#x8BA1;&amp;#x7B97;&amp;#x8FC7;&amp;#x7A0B;&amp;#x53C2;&amp;#x8003;&amp;#x6E90;&amp;#x7801;&amp;#x7684;calc_clone_subsets&amp;#x51FD;&amp;#x6570;&amp;#xFF09;&amp;#xFF0C;&amp;#x6BD4;&amp;#x5982;&amp;#x56FE;&amp;#x793A;&amp;#x4E0A;&amp;#x5BF9;&amp;#x4E8E;snap2&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x8BA1;&amp;#x7B97;&amp;#x5F97;&amp;#x5230;&amp;#x7684;&amp;#x5C31;&amp;#x662F;{data_subsets=[256k~512k], clone_subsets[1]=[0~256k, 512k~4M]}&amp;#xFF1B;&lt;/li&gt;
&lt;li&gt;c&amp;#xFF09;&amp;#x7136;&amp;#x540E;&amp;#x5BF9;&amp;#x4E8E;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;data_subsets&amp;#x90E8;&amp;#x5206;&amp;#xFF0C;&amp;#x5C31;&amp;#x9700;&amp;#x8981;&amp;#x901A;&amp;#x8FC7;&amp;#x7F51;&amp;#x7EDC;&amp;#x4ECE;replica pull&amp;#x8FC7;&amp;#x6765;&amp;#x5199;&amp;#x5230;&amp;#x672C;&amp;#x5730;&amp;#xFF0C;&amp;#x5BF9;&amp;#x4E8E;clone_subsets&amp;#x5C31;&amp;#x4F1A;&amp;#x4ECE;&amp;#x672C;&amp;#x5730;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;snap&amp;#x5BF9;&amp;#x8C61;&amp;#x53BB;clone_range&amp;#xFF0C;&amp;#x5373;&amp;#x5728;&amp;#x672C;&amp;#x5730;&amp;#x5C06;snap1&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x90E8;&amp;#x5206;&amp;#x6570;&amp;#x636E;&amp;#x62F7;&amp;#x8D1D;&amp;#x7ED9;snap2&amp;#x5BF9;&amp;#x8C61;&amp;#xFF1B;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&amp;#x4ECE;&amp;#x4E0A;&amp;#x9762;&amp;#x5206;&amp;#x6790;&amp;#x5F97;&amp;#x51FA;&amp;#xFF0C;&amp;#x6062;&amp;#x590D;replica&amp;#x65F6;&amp;#x662F;&amp;#x5148;&amp;#x6062;&amp;#x590D;snap&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x518D;&amp;#x6062;&amp;#x590D;head&amp;#x5BF9;&amp;#x8C61;&amp;#xFF1B;&amp;#x800C;&amp;#x6062;&amp;#x590D;primary&amp;#x65F6;&amp;#xFF0C;&amp;#x5374;&amp;#x662F;&amp;#x5148;&amp;#x6062;&amp;#x590D;head&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x518D;&amp;#x6062;&amp;#x590D;snap&amp;#x5BF9;&amp;#x8C61;&amp;#x3002;&amp;#x8FD9;&amp;#x4E2A;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x6CA1;&amp;#x6709;&amp;#x91C7;&amp;#x7528;&amp;#x4E00;&amp;#x6837;&amp;#x7684;&amp;#x903B;&amp;#x8F91;&amp;#xFF0C;&amp;#x6BD4;&amp;#x5982;&amp;#x90FD;&amp;#x5148;&amp;#x6062;&amp;#x590D;snap&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x518D;&amp;#x6062;&amp;#x590D;head&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5730;&amp;#x65B9;&amp;#x6CA1;&amp;#x6709;&amp;#x60F3;&amp;#x660E;&amp;#x767D;&amp;#x3002;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;#x524D;&amp;#x6BB5;&amp;#x65F6;&amp;#x95F4;&amp;#x4E00;&amp;#x76F4;&amp;#x5728;&amp;#x7814;&amp;#x7A76;ceph&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x4EE5;&amp;#x53CA;&amp;#x5176;&amp;#x6240;&amp;#x6D89;&amp;#x53CA;&amp;#x7684;&amp;#x6545;&amp;#x969C;&amp;#x6062;&amp;#x590D;&amp;#x903B;&amp;#x8F91;&amp;#xFF0C;ceph&amp;#x5728;&amp;#x8FD9;&amp;#x90E8;&amp;#x5206;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;&amp;#x633A;&amp;#x7CBE;&amp;#x5999;&amp;#x7684;&amp;#xFF0C;&amp;#x867D;&amp;#x7136;&amp;#x4E5F;&amp;#x662F;&amp;#x57FA;&amp;#x4E8E;COW&amp;#x5B9E;&amp;#x73B0;&amp;#x7684;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x7EC6;&amp;#x7EC6;&amp;#x54C1;&amp;#x6765;&amp;#xFF0C;&amp;#x5176;&amp;#x5728;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;&amp;#x5143;&amp;#x6570;&amp;#x636E;&amp;#x7BA1;&amp;#x7406;&amp;#x4EE5;&amp;#x53CA;&amp;#x7236;&amp;#x5B50;&amp;#x5173;&amp;#x7CFB;&amp;#x7684;&amp;#x7EF4;&amp;#x62A4;&amp;#x4E0A;&amp;#x6709;&amp;#x72EC;&amp;#x5230;&amp;#x4E4B;&amp;#x5904;&amp;#xFF0C;&amp;#x672C;&amp;#x6587;&amp;#x5C06;&amp;#x8BE6;&amp;#x7EC6;&amp;#x9610;&amp;#x8FF0;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;&amp;#x539F;&amp;#x7406;&amp;#x4EE5;&amp;#x53CA;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;&amp;#x5728;&amp;#x6062;&amp;#x590D;&amp;#x65F6;&amp;#x5982;&amp;#x4F55;&amp;#x81F3;&amp;#x5173;&amp;#x91CD;&amp;#x8981;&amp;#x7684;&amp;#x4F5C;&amp;#x7528;&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;1-rbd&amp;#x5FEB;&amp;#x7167;&amp;#x7684;&amp;#x76F4;&amp;#x89C2;&amp;#x7406;&amp;#x89E3;&quot;&gt;&lt;a href=&quot;#1-rbd&amp;#x5FEB;&amp;#x7167;&amp;#x7684;&amp;#x76F4;&amp;#x89C2;&amp;#x7406;&amp;#x89E3;&quot; class=&quot;headerlink&quot; title=&quot;1.rbd&amp;#x5FEB;&amp;#x7167;&amp;#x7684;&amp;#x76F4;&amp;#x89C2;&amp;#x7406;&amp;#x89E3;&quot;&gt;&lt;/a&gt;1.rbd&amp;#x5FEB;&amp;#x7167;&amp;#x7684;&amp;#x76F4;&amp;#x89C2;&amp;#x7406;&amp;#x89E3;&lt;/h1&gt;&lt;p&gt;ceph&amp;#x7684;rbd&amp;#x5377;&amp;#x53EF;&amp;#x7528;&amp;#x505A;&amp;#x591A;&amp;#x6B21;&amp;#x5FEB;&amp;#x7167;&amp;#xFF0C;&amp;#x6BCF;&amp;#x6B21;&amp;#x505A;&amp;#x5B8C;&amp;#x5FEB;&amp;#x7167;&amp;#x540E;&amp;#x518D;&amp;#x5BF9;&amp;#x5377;&amp;#x8FDB;&amp;#x884C;&amp;#x5199;&amp;#x5165;&amp;#x65F6;&amp;#x5C31;&amp;#x4F1A;&amp;#x89E6;&amp;#x53D1;COW&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x5373;&amp;#x5148;&amp;#x62F7;&amp;#x8D1D;&amp;#x51FA;&amp;#x539F;&amp;#x6570;&amp;#x636E;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x51FA;&amp;#x6765;&amp;#x751F;&amp;#x6210;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5BF9;&amp;#x539F;&amp;#x6570;&amp;#x636E;&amp;#x5BF9;&amp;#x8C61;&amp;#x8FDB;&amp;#x884C;&amp;#x5199;&amp;#x5165;&amp;#x3002;&amp;#x76F4;&amp;#x89C2;&amp;#x56FE;&amp;#x89E3;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;br&gt;&lt;img src=&quot;/2016/02/28/ceph-rbd-snap/rbd-flow.png&quot; alt=&quot;rbd-flow&quot;&gt;&lt;br&gt;&amp;#x505A;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;&amp;#x64CD;&amp;#x4F5C;&amp;#x662F;&amp;#x5F88;&amp;#x5FEB;&amp;#x7684;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x53EA;&amp;#x66F4;&amp;#x65B0;&amp;#x4E86;&amp;#x5377;&amp;#x7684;&amp;#x5143;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x6DFB;&amp;#x52A0;&amp;#x4E86;&amp;#x4E00;&amp;#x4E9B;&amp;#x5FEB;&amp;#x7167;&amp;#x4FE1;&amp;#x606F;&amp;#xFF08;&amp;#x5305;&amp;#x62EC;&amp;#x8BE5;&amp;#x5377;&amp;#x6709;&amp;#x54EA;&amp;#x4E9B;&amp;#x5FEB;&amp;#x7167;&amp;#xFF0C;&amp;#x5FEB;&amp;#x7167;id&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5377;&amp;#x662F;&amp;#x514B;&amp;#x9686;&amp;#x51FA;&amp;#x6765;&amp;#x7684;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x8FD8;&amp;#x5305;&amp;#x62EC;parent&amp;#x4FE1;&amp;#x606F;&amp;#xFF09;&amp;#x3002;&amp;#x6BCF;&amp;#x4E2A;rbd&amp;#x5377;&amp;#x5728;rados&amp;#x91CC;&amp;#x90FD;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;&lt;strong&gt;rbd_header&lt;/strong&gt;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;rbd_header&amp;#x5BF9;&amp;#x8C61;&amp;#x91CC;&amp;#x9762;&amp;#x6CA1;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x5377;&amp;#x7684;&amp;#x5143;&amp;#x6570;&amp;#x636E;&amp;#x90FD;&amp;#x662F;&amp;#x4F5C;&amp;#x4E3A;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x5C5E;&amp;#x6027;&amp;#x4EE5;omap&amp;#x65B9;&amp;#x5F0F;&amp;#x8BB0;&amp;#x5F55;&amp;#x5230;leveldb&amp;#x91CC;&amp;#xFF08;&amp;#x53EF;&amp;#x4EE5;&amp;#x4F7F;&amp;#x7528;rados -p &lt;pool&gt; listomapvals rbd_header.&lt;id&gt;&amp;#x6765;&amp;#x83B7;&amp;#x5F97;&amp;#x5FEB;&amp;#x7167;&amp;#x76F8;&amp;#x5173;&amp;#x7684;&amp;#x5143;&amp;#x6570;&amp;#x636E;&amp;#x4FE1;&amp;#x606F;&amp;#xFF09;&amp;#x3002;&lt;/id&gt;&lt;/pool&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x5F53;&amp;#x505A;&amp;#x5B8C;&amp;#x5FEB;&amp;#x7167;&amp;#x540E;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x5BF9;&amp;#x539F;&amp;#x5377;&amp;#x8FDB;&amp;#x884C;&amp;#x5199;&amp;#x5165;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x5C31;&amp;#x4F1A;&amp;#x5148;&amp;#x62F7;&amp;#x8D1D;&amp;#x6570;&amp;#x636E;&amp;#x51FA;&amp;#x6765;&amp;#x751F;&amp;#x6210;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF08;&amp;#x5728;&amp;#x4EE3;&amp;#x7801;&amp;#x5B9E;&amp;#x73B0;&amp;#x91CC;&amp;#x5C31;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;clone&amp;#x64CD;&amp;#x4F5C;&amp;#xFF09;&amp;#xFF0C;&amp;#x62F7;&amp;#x8D1D;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x662F;&amp;#x6574;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#xFF08;&amp;#x6709;&amp;#x53EF;&amp;#x80FD;&amp;#x8FD9;&amp;#x4E2A;&amp;#x6570;&amp;#x636E;&amp;#x5BF9;&amp;#x8C61;&amp;#x4E0D;&amp;#x662F;&amp;#x9ED8;&amp;#x8BA4;&amp;#x7684;4MB&amp;#x5927;&amp;#x5C0F;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x6709;&amp;#x591A;&amp;#x5927;&amp;#x62F7;&amp;#x591A;&amp;#x5927;&amp;#xFF09;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x518D;&amp;#x5199;&amp;#x5165;&amp;#x65B0;&amp;#x6570;&amp;#x636E;&amp;#x3002;&amp;#x5728;ceph&amp;#x91CC;&amp;#xFF0C;&amp;#x5377;&amp;#x7684;&amp;#x539F;&amp;#x5BF9;&amp;#x8C61;&amp;#x53EB;&amp;#x505A;&lt;strong&gt;head&amp;#x5BF9;&amp;#x8C61;&lt;/strong&gt;&amp;#xFF0C;&amp;#x800C;&amp;#x5377;&amp;#x4F5C;&amp;#x4E3A;&amp;#x5FEB;&amp;#x7167;&amp;#x540E;&amp;#x901A;&amp;#x8FC7;cow&amp;#x62F7;&amp;#x8D1D;&amp;#x51FA;&amp;#x6765;&amp;#x7684;&amp;#x5FEB;&amp;#x7167;&amp;#x5BF9;&amp;#x8C61;&amp;#x79F0;&amp;#x4E3A;&lt;strong&gt;snap&amp;#x5BF9;&amp;#x8C61;&lt;/strong&gt;&amp;#x3002;&lt;br&gt;&amp;#x56E0;&amp;#x4E3A;ceph&amp;#x91CC;&amp;#x5BF9;&amp;#x8C61;&amp;#x662F;&amp;#x5199;&amp;#x65F6;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#xFF0C;&amp;#x4E00;&amp;#x4E2A;&amp;#x65B0;&amp;#x521B;&amp;#x5EFA;&amp;#x7684;&amp;#x5377;&amp;#x5982;&amp;#x679C;&amp;#x6BCF;&amp;#x4E00;&amp;#x5199;&amp;#x8FC7;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x5728;rados&amp;#x91CC;&amp;#x662F;&amp;#x6CA1;&amp;#x6709;&amp;#x751F;&amp;#x6210;&amp;#x6570;&amp;#x636E;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#xFF0C;&amp;#x53EA;&amp;#x6709;&amp;#x5F53;&amp;#x6570;&amp;#x636E;&amp;#x5199;&amp;#x5165;&amp;#x65F6;&amp;#xFF0C;&amp;#x624D;&amp;#x5206;&amp;#x914D;&amp;#x51FA;&amp;#x6570;&amp;#x636E;&amp;#x5BF9;&amp;#x8C61;&amp;#x6765;&amp;#x3002;&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ceph" scheme="http://yoursite.com/categories/ceph/"/>
    
    
      <category term="ceph" scheme="http://yoursite.com/tags/ceph/"/>
    
      <category term="rbd" scheme="http://yoursite.com/tags/rbd/"/>
    
      <category term="snap" scheme="http://yoursite.com/tags/snap/"/>
    
  </entry>
  
  <entry>
    <title>ceph基于pglog的一致性协议</title>
    <link href="http://yoursite.com/2016/02/15/ceph-consistency/"/>
    <id>http://yoursite.com/2016/02/15/ceph-consistency/</id>
    <published>2016-02-15T08:30:31.000Z</published>
    <updated>2016-05-13T08:59:05.675Z</updated>
    
    <content type="html">&lt;p&gt;&amp;#x5206;&amp;#x5E03;&amp;#x5F0F;&amp;#x5B58;&amp;#x50A8;&amp;#x7CFB;&amp;#x7EDF;&amp;#x901A;&amp;#x5E38;&amp;#x91C7;&amp;#x7528;&amp;#x591A;&amp;#x526F;&amp;#x672C;&amp;#x7684;&amp;#x65B9;&amp;#x5F0F;&amp;#x6765;&amp;#x4FDD;&amp;#x8BC1;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x53EF;&amp;#x9760;&amp;#x6027;&amp;#xFF0C;&amp;#x800C;&amp;#x591A;&amp;#x526F;&amp;#x672C;&amp;#x4E4B;&amp;#x95F4;&amp;#x5982;&amp;#x4F55;&amp;#x4FDD;&amp;#x8BC1;&amp;#x6570;&amp;#x636E;&amp;#x7684;&amp;#x4E00;&amp;#x81F4;&amp;#x6027;&amp;#x5C31;&amp;#x662F;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x6838;&amp;#x5FC3;&amp;#x3002;ceph&amp;#x53F7;&amp;#x79F0;&amp;#x7EDF;&amp;#x4E00;&amp;#x5B58;&amp;#x50A8;&amp;#xFF0C;&amp;#x5176;&amp;#x6838;&amp;#x5FC3;RADOS&amp;#x65E2;&amp;#x652F;&amp;#x6301;&amp;#x591A;&amp;#x526F;&amp;#x672C;&amp;#xFF0C;&amp;#x4E5F;&amp;#x652F;&amp;#x6301;&amp;#x7EA0;&amp;#x5220;&amp;#x7801;&amp;#x3002;&amp;#x672C;&amp;#x6587;&amp;#x4E3B;&amp;#x8981;&amp;#x5206;&amp;#x6790;ceph&amp;#x7684;&amp;#x591A;&amp;#x526F;&amp;#x672C;&amp;#x4E00;&amp;#x81F4;&amp;#x6027;&amp;#x534F;&amp;#x8BAE;&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;1-pglog&amp;#x53CA;&amp;#x8BFB;&amp;#x5199;&amp;#x6D41;&amp;#x7A0B;&quot;&gt;&lt;a href=&quot;#1-pglog&amp;#x53CA;&amp;#x8BFB;&amp;#x5199;&amp;#x6D41;&amp;#x7A0B;&quot; class=&quot;headerlink&quot; title=&quot;1.pglog&amp;#x53CA;&amp;#x8BFB;&amp;#x5199;&amp;#x6D41;&amp;#x7A0B;&quot;&gt;&lt;/a&gt;1.pglog&amp;#x53CA;&amp;#x8BFB;&amp;#x5199;&amp;#x6D41;&amp;#x7A0B;&lt;/h1&gt;&lt;p&gt;ceph&amp;#x4F7F;&amp;#x7528;pglog&amp;#x6765;&amp;#x4FDD;&amp;#x8BC1;&amp;#x591A;&amp;#x526F;&amp;#x672C;&amp;#x4E4B;&amp;#x95F4;&amp;#x7684;&amp;#x4E00;&amp;#x81F4;&amp;#x6027;&amp;#xFF0C;pglog&amp;#x7684;&amp;#x793A;&amp;#x610F;&amp;#x56FE;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;pglog&amp;#x4E3B;&amp;#x8981;&amp;#x662F;&amp;#x7528;&amp;#x6765;&amp;#x8BB0;&amp;#x5F55;&amp;#x505A;&amp;#x4E86;&amp;#x4EC0;&amp;#x4E48;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x6BD4;&amp;#x5982;&amp;#x4FEE;&amp;#x6539;&amp;#xFF0C;&amp;#x5220;&amp;#x9664;&amp;#x7B49;&amp;#xFF0C;&amp;#x800C;&amp;#x6BCF;&amp;#x4E00;&amp;#x6761;&amp;#x8BB0;&amp;#x5F55;&amp;#x91CC;&amp;#x5305;&amp;#x542B;&amp;#x4E86;&amp;#x5BF9;&amp;#x8C61;&amp;#x4FE1;&amp;#x606F;&amp;#xFF0C;&amp;#x8FD8;&amp;#x6709;&amp;#x7248;&amp;#x672C;&amp;#x3002;&lt;br&gt;ceph&amp;#x4F7F;&amp;#x7528;&amp;#x7248;&amp;#x672C;&amp;#x63A7;&amp;#x5236;&amp;#x7684;&amp;#x65B9;&amp;#x5F0F;&amp;#x6765;&amp;#x6807;&amp;#x8BB0;&amp;#x4E00;&amp;#x4E2A;PG&amp;#x5185;&amp;#x7684;&amp;#x6BCF;&amp;#x4E00;&amp;#x6B21;&amp;#x66F4;&amp;#x65B0;&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;&amp;#x7248;&amp;#x672C;&amp;#x5305;&amp;#x62EC;&amp;#x4E00;&amp;#x4E2A;(epoch&amp;#xFF0C;version)&amp;#x6765;&amp;#x7EC4;&amp;#x6210;&amp;#xFF1A;&amp;#x5176;&amp;#x4E2D;epoch&amp;#x662F;osdmap&amp;#x7684;&amp;#x7248;&amp;#x672C;&amp;#xFF0C;&amp;#x6BCF;&amp;#x5F53;&amp;#x6709;OSD&amp;#x72B6;&amp;#x6001;&amp;#x53D8;&amp;#x5316;&amp;#x5982;&amp;#x589E;&amp;#x52A0;&amp;#x5220;&amp;#x9664;&amp;#x7B49;&amp;#x65F6;&amp;#xFF0C;epoch&amp;#x5C31;&amp;#x9012;&amp;#x589E;&amp;#xFF1B;version&amp;#x662F;PG&amp;#x5185;&amp;#x6BCF;&amp;#x6B21;&amp;#x66F4;&amp;#x65B0;&amp;#x64CD;&amp;#x4F5C;&amp;#x7684;&amp;#x7248;&amp;#x672C;&amp;#x53F7;&amp;#xFF0C;&amp;#x9012;&amp;#x589E;&amp;#x7684;&amp;#xFF0C;&amp;#x7531;PG&amp;#x5185;&amp;#x7684;Primary OSD&amp;#x8FDB;&amp;#x884C;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2016/02/15/ceph-consistency/pglog-entry.png&quot; alt=&quot;pglog-entry&quot;&gt;&lt;br&gt;&amp;#x6BCF;&amp;#x4E2A;&amp;#x526F;&amp;#x672C;&amp;#x4E0A;&amp;#x90FD;&amp;#x7EF4;&amp;#x62A4;&amp;#x4E86;pglog&amp;#xFF0C;pglog&amp;#x91CC;&amp;#x6700;&amp;#x91CD;&amp;#x8981;&amp;#x7684;&amp;#x4E24;&amp;#x4E2A;&amp;#x6307;&amp;#x9488;&amp;#x5C31;&amp;#x662F;last_complete&amp;#x548C;last_update&amp;#xFF0C;&amp;#x6B63;&amp;#x5E38;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;&amp;#x526F;&amp;#x672C;&amp;#x4E0A;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;&amp;#x6307;&amp;#x9488;&amp;#x90FD;&amp;#x6307;&amp;#x5411;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;&amp;#x4F4D;&amp;#x7F6E;&amp;#xFF0C;&amp;#x5F53;&amp;#x51FA;&amp;#x73B0;&amp;#x673A;&amp;#x5668;&amp;#x91CD;&amp;#x542F;&amp;#x3001;&amp;#x7F51;&amp;#x7EDC;&amp;#x4E2D;&amp;#x65AD;&amp;#x7B49;&amp;#x6545;&amp;#x969C;&amp;#x65F6;&amp;#xFF0C;&amp;#x6545;&amp;#x969C;&amp;#x526F;&amp;#x672C;&amp;#x7684;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;&amp;#x6307;&amp;#x9488;&amp;#x5C31;&amp;#x4F1A;&amp;#x6709;&amp;#x6240;&amp;#x533A;&amp;#x522B;&amp;#xFF0C;&amp;#x4EE5;&amp;#x4FBF;&amp;#x4E8E;&amp;#x6765;&amp;#x8BB0;&amp;#x5F55;&amp;#x526F;&amp;#x672C;&amp;#x95F4;&amp;#x7684;&amp;#x5DEE;&amp;#x5F02;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x4E3A;&amp;#x4E86;&amp;#x4FBF;&amp;#x4E8E;&amp;#x8BF4;&amp;#x660E;ceph&amp;#x7684;&amp;#x4E00;&amp;#x81F4;&amp;#x6027;&amp;#x534F;&amp;#x8BAE;&amp;#xFF0C;&amp;#x5148;&amp;#x7B80;&amp;#x8981;&amp;#x63CF;&amp;#x8FF0;&amp;#x4E00;&amp;#x4E0B;ceph&amp;#x7684;&amp;#x8BFB;&amp;#x5199;&amp;#x5904;&amp;#x7406;&amp;#x6D41;&amp;#x7A0B;&amp;#x3002;&lt;br&gt;&amp;#x5199;&amp;#x5904;&amp;#x7406;&amp;#x6D41;&amp;#x7A0B;&amp;#xFF1A;&lt;br&gt;1&amp;#xFF09;client&amp;#x628A;&amp;#x5199;&amp;#x8BF7;&amp;#x6C42;&amp;#x53D1;&amp;#x5230;Primary OSD&amp;#x4E0A;&amp;#xFF0C;Primary OSD&amp;#x4E0A;&amp;#x5C06;&amp;#x5199;&amp;#x8BF7;&amp;#x6C42;&amp;#x5E8F;&amp;#x5217;&amp;#x5316;&amp;#x5230;&amp;#x4E00;&amp;#x4E2A;&amp;#x4E8B;&amp;#x52A1;&amp;#x4E2D;&amp;#xFF08;&amp;#x5728;&amp;#x5185;&amp;#x5B58;&amp;#x91CC;&amp;#xFF09;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x6784;&amp;#x9020;&amp;#x4E00;&amp;#x6761;pglog&amp;#x8BB0;&amp;#x5F55;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5E8F;&amp;#x5217;&amp;#x5316;&amp;#x5230;&amp;#x8FD9;&amp;#x4E2A;&amp;#x4E8B;&amp;#x52A1;&amp;#x4E2D;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5C06;&amp;#x8FD9;&amp;#x4E2A;&amp;#x4E8B;&amp;#x52A1;&amp;#x4EE5;directIO&amp;#x7684;&amp;#x65B9;&amp;#x5F0F;&amp;#x5F02;&amp;#x6B65;&amp;#x5199;&amp;#x5165;journal&amp;#xFF0C;&amp;#x540C;&amp;#x65F6;Primary OSD&amp;#x628A;&amp;#x5199;&amp;#x8BF7;&amp;#x6C42;&amp;#x548C;pglog(pglog_entry&amp;#x662F;&amp;#x7531;primary&amp;#x751F;&amp;#x6210;)&amp;#x53D1;&amp;#x9001;&amp;#x5230;Replicas&amp;#x4E0A;&amp;#xFF1B;&lt;br&gt;2&amp;#xFF09;&amp;#x5728;Primary OSD&amp;#x5C06;&amp;#x4E8B;&amp;#x52A1;&amp;#x5199;&amp;#x5230;journal&amp;#x4E0A;&amp;#x540E;&amp;#xFF0C;&amp;#x4F1A;&amp;#x901A;&amp;#x8FC7;&amp;#x4E00;&amp;#x7CFB;&amp;#x5217;&amp;#x7684;&amp;#x7EBF;&amp;#x7A0B;&amp;#x548C;&amp;#x56DE;&amp;#x8C03;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5C06;&amp;#x8FD9;&amp;#x4E2A;&amp;#x4E8B;&amp;#x52A1;&amp;#x91CC;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x5199;&amp;#x5165;filesystem&amp;#xFF08;&amp;#x53EA;&amp;#x662F;&amp;#x5199;&amp;#x5230;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x7F13;&amp;#x5B58;&amp;#x91CC;&amp;#xFF0C;&amp;#x4F1A;&amp;#x6709;&amp;#x7EBF;&amp;#x7A0B;&amp;#x5B9A;&amp;#x671F;&amp;#x5237;&amp;#x6570;&amp;#x636E;&amp;#xFF09;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x4E8B;&amp;#x52A1;&amp;#x91CC;&amp;#x7684;pglog&amp;#x8BB0;&amp;#x5F55;&amp;#xFF08;&amp;#x4E5F;&amp;#x5305;&amp;#x62EC;pginfo&amp;#x7684;last_complete&amp;#x548C;last_update&amp;#xFF09;&amp;#x4F1A;&amp;#x5199;&amp;#x5230;leveldb&amp;#xFF0C;&amp;#x8FD8;&amp;#x6709;&amp;#x4E00;&amp;#x4E9B;&amp;#x6269;&amp;#x5C55;&amp;#x5C5E;&amp;#x6027;&amp;#x76F8;&amp;#x5173;&amp;#x7684;&amp;#x4E5F;&amp;#x5728;&amp;#x8FD9;&amp;#x4E2A;&amp;#x4E8B;&amp;#x52A1;&amp;#x91CC;&amp;#xFF0C;&amp;#x5728;&amp;#x904D;&amp;#x5386;&amp;#x8FD9;&amp;#x4E2A;&amp;#x4E8B;&amp;#x52A1;&amp;#x65F6;&amp;#x4E5F;&amp;#x4F1A;&amp;#x5199;&amp;#x5230;leveldb&amp;#xFF1B;&lt;br&gt;3&amp;#xFF09;&amp;#x5728;Replicas&amp;#x4E0A;&amp;#xFF0C;&amp;#x4E5F;&amp;#x662F;&amp;#x8FDB;&amp;#x884C;&amp;#x7C7B;&amp;#x4F3C;&amp;#x4E8E;Primary&amp;#x7684;&amp;#x52A8;&amp;#x4F5C;&amp;#xFF0C;&amp;#x5148;&amp;#x5199;journal&amp;#xFF0C;&amp;#x5199;&amp;#x6210;&amp;#x529F;&amp;#x4F1A;&amp;#x7ED9;Primary&amp;#x53D1;&amp;#x9001;&amp;#x4E00;&amp;#x4E2A;committed ack&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5C06;&amp;#x8FD9;&amp;#x4E2A;&amp;#x4E8B;&amp;#x52A1;&amp;#x91CC;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x5199;&amp;#x5230;filesystem&amp;#xFF0C;pglog&amp;#x4E0E;pginfo&amp;#x5199;&amp;#x5230;leveldb&amp;#x91CC;&amp;#xFF0C;&amp;#x5199;&amp;#x5B8C;&amp;#x540E;&amp;#x4F1A;&amp;#x7ED9;Primary&amp;#x53D1;&amp;#x9001;&amp;#x53E6;&amp;#x5916;&amp;#x4E00;&amp;#x4E2A;applied ack&amp;#xFF1B;&lt;br&gt;4&amp;#xFF09;Primary&amp;#x5728;&amp;#x81EA;&amp;#x5DF1;&amp;#x5B8C;&amp;#x6210;journal&amp;#x7684;&amp;#x5199;&amp;#x5165;&amp;#x65F6;&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;&amp;#x5728;&amp;#x6536;&amp;#x5230;Replica&amp;#x7684;committed ack&amp;#x65F6;&amp;#x90FD;&amp;#x4F1A;&amp;#x68C0;&amp;#x67E5;&amp;#x662F;&amp;#x5426;&amp;#x591A;&amp;#x4E2A;&amp;#x526F;&amp;#x672C;&amp;#x90FD;&amp;#x5199;&amp;#x5165;journal&amp;#x6210;&amp;#x529F;&amp;#x4E86;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x662F;&amp;#x5219;&amp;#x5411;client&amp;#x7AEF;&amp;#x53D1;&amp;#x9001;ack&amp;#x901A;&amp;#x77E5;&amp;#x5199;&amp;#x5B8C;&amp;#x6210;&amp;#xFF1B;Primary&amp;#x5728;&amp;#x81EA;&amp;#x5DF1;&amp;#x5B8C;&amp;#x6210;&amp;#x4E8B;&amp;#x52A1;&amp;#x5199;&amp;#x5230;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x548C;leveldb&amp;#x540E;&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;&amp;#x5728;&amp;#x6536;&amp;#x5230;replica&amp;#x7684;applied ack&amp;#x65F6;&amp;#x90FD;&amp;#x4F1A;&amp;#x68C0;&amp;#x67E5;&amp;#x662F;&amp;#x5426;&amp;#x591A;&amp;#x4E2A;&amp;#x526F;&amp;#x672C;&amp;#x90FD;&amp;#x5199;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x6210;&amp;#x529F;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x662F;&amp;#x5219;&amp;#x5411;client&amp;#x7AEF;&amp;#x53D1;&amp;#x9001;ack&amp;#x901A;&amp;#x77E5;&amp;#x6570;&amp;#x636E;&amp;#x53EF;&amp;#x8BFB;&amp;#xFF1B;&lt;br&gt;&amp;#x5BF9;&amp;#x8BFB;&amp;#x6D41;&amp;#x7A0B;&amp;#x6765;&amp;#x8BF4;&amp;#xFF0C;&amp;#x5C31;&amp;#x6BD4;&amp;#x8F83;&amp;#x7B80;&amp;#x5355;&amp;#xFF0C;&amp;#x90FD;&amp;#x662F;&amp;#x7531;Primary&amp;#x6765;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x5C31;&amp;#x4E0D;&amp;#x591A;&amp;#x8BF4;&amp;#x4E86;&amp;#x3002;&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;2-&amp;#x6545;&amp;#x969C;&amp;#x6062;&amp;#x590D;&quot;&gt;&lt;a href=&quot;#2-&amp;#x6545;&amp;#x969C;&amp;#x6062;&amp;#x590D;&quot; class=&quot;headerlink&quot; title=&quot;2.&amp;#x6545;&amp;#x969C;&amp;#x6062;&amp;#x590D;&quot;&gt;&lt;/a&gt;2.&amp;#x6545;&amp;#x969C;&amp;#x6062;&amp;#x590D;&lt;/h1&gt;&lt;p&gt;ceph&amp;#x5728;&amp;#x8FDB;&amp;#x884C;&amp;#x6545;&amp;#x969C;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x4F1A;&amp;#x7ECF;&amp;#x8FC7;peering&amp;#x7684;&amp;#x8FC7;&amp;#x7A0B;&amp;#xFF0C;&amp;#x7B80;&amp;#x8981;&amp;#x6765;&amp;#x8BF4;&amp;#xFF0C;peering&amp;#x5C31;&amp;#x662F;&amp;#x5BF9;&amp;#x6BD4;&amp;#x5404;&amp;#x4E2A;&amp;#x526F;&amp;#x672C;&amp;#x4E0A;&amp;#x7684;pglog&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x6839;&amp;#x636E;&amp;#x526F;&amp;#x672C;&amp;#x4E0A;pglog&amp;#x7684;&amp;#x5DEE;&amp;#x5F02;&amp;#x6765;&amp;#x6784;&amp;#x9020;missing&amp;#x5217;&amp;#x8868;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5728;&amp;#x6062;&amp;#x590D;&amp;#x9636;&amp;#x6BB5;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x6839;&amp;#x636E;missing&amp;#x5217;&amp;#x8868;&amp;#x6765;&amp;#x8FDB;&amp;#x884C;&amp;#x6062;&amp;#x590D;&amp;#x4E86;&amp;#x3002;peering&amp;#x662F;&amp;#x6309;&amp;#x7167;pg&amp;#x4E3A;&amp;#x5355;&amp;#x4F4D;&amp;#x8FDB;&amp;#x884C;&amp;#x7684;&amp;#xFF0C;&amp;#x5728;&amp;#x8FDB;&amp;#x884C;peering&amp;#x7684;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#xFF0C;I/O&amp;#x8BF7;&amp;#x6C42;&amp;#x662F;&amp;#x4F1A;&amp;#x6302;&amp;#x8D77;&amp;#x7684;&amp;#xFF0C;&amp;#x5F53;&amp;#x8FDB;&amp;#x884C;&amp;#x5B8C;peering&amp;#x9636;&amp;#x6BB5;&amp;#x8FDB;&amp;#x5165;recovery&amp;#x9636;&amp;#x6BB5;&amp;#x65F6;&amp;#xFF0C;I/O&amp;#x53EF;&amp;#x4EE5;&amp;#x7EE7;&amp;#x7EED;&amp;#x8FDB;&amp;#x884C;&amp;#xFF0C;&amp;#x4E0D;&amp;#x8FC7;&amp;#x5F53;I/O&amp;#x8BF7;&amp;#x6C42;&amp;#x547D;&amp;#x4E2D;&amp;#x4E86;missing&amp;#x5217;&amp;#x8868;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5F85;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x4F1A;&amp;#x4F18;&amp;#x5148;&amp;#x8FDB;&amp;#x884C;&amp;#x6062;&amp;#x590D;&amp;#xFF0C;&amp;#x5F53;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x6062;&amp;#x590D;&amp;#x5B8C;&amp;#x6210;&amp;#x540E;&amp;#xFF0C;&amp;#x518D;&amp;#x8FDB;&amp;#x884C;I/O&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x3002;&lt;br&gt;&amp;#x56E0;&amp;#x4E3A;pglog&amp;#x8BB0;&amp;#x5F55;&amp;#x6570;&amp;#x6709;&amp;#x9650;&amp;#x5236;&amp;#xFF0C;&amp;#x5F53;&amp;#x5BF9;&amp;#x6BD4;&amp;#x5404;&amp;#x4E2A;&amp;#x526F;&amp;#x672C;&amp;#x4E0A;&amp;#x7684;pglog&amp;#x65F6;&amp;#xFF0C;&amp;#x53D1;&amp;#x73B0;&amp;#x6545;&amp;#x969C;&amp;#x7684;&amp;#x526F;&amp;#x672C;&amp;#x5DF2;&amp;#x7ECF;&amp;#x843D;&amp;#x540E;&amp;#x592A;&amp;#x591A;&amp;#x4E86;&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;&amp;#x5C31;&amp;#x65E0;&amp;#x6CD5;&amp;#x6839;&amp;#x636E;pglog&amp;#x6765;&amp;#x6062;&amp;#x590D;&amp;#x4E86;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x8FD9;&amp;#x79CD;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;&amp;#x5C31;&amp;#x53EA;&amp;#x80FD;&amp;#x5168;&amp;#x91CF;&amp;#x6062;&amp;#x590D;&amp;#xFF0C;&amp;#x79F0;&amp;#x4E3A;backfill&amp;#xFF0C;&amp;#x574F;&amp;#x76D8;&amp;#x574F;&amp;#x673A;&amp;#x5668;&amp;#x6216;&amp;#x8005;&amp;#x96C6;&amp;#x7FA4;&amp;#x6269;&amp;#x5BB9;&amp;#x65F6;&amp;#x4E5F;&amp;#x4F1A;&amp;#x89E6;&amp;#x53D1;backfill&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x4E0D;&amp;#x505A;&amp;#x4ECB;&amp;#x7ECD;&amp;#xFF0C;&amp;#x540E;&amp;#x7EED;&amp;#x5355;&amp;#x72EC;&amp;#x4E00;&amp;#x7BC7;&amp;#x6587;&amp;#x7AE0;&amp;#x6765;&amp;#x8FDB;&amp;#x884C;&amp;#x5206;&amp;#x6790;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x57FA;&amp;#x4E8E;pglog&amp;#x7684;&amp;#x4E00;&amp;#x81F4;&amp;#x6027;&amp;#x534F;&amp;#x8BAE;&amp;#x5305;&amp;#x542B;&amp;#x4E24;&amp;#x79CD;&amp;#x6062;&amp;#x590D;&amp;#x8FC7;&amp;#x7A0B;&amp;#xFF0C;&amp;#x4E00;&amp;#x4E2A;&amp;#x662F;Primary&amp;#x6302;&amp;#x6389;&amp;#x540E;&amp;#x53C8;&amp;#x8D77;&amp;#x6765;&amp;#x7684;&amp;#x6062;&amp;#x590D;&amp;#xFF0C;&amp;#x4E00;&amp;#x79CD;&amp;#x662F;Replica&amp;#x6302;&amp;#x6389;&amp;#x540E;&amp;#x53C8;&amp;#x8D77;&amp;#x6765;&amp;#x7684;&amp;#x6062;&amp;#x590D;&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;2-1Primary&amp;#x6545;&amp;#x969C;&amp;#x6062;&amp;#x590D;&quot;&gt;&lt;a href=&quot;#2-1Primary&amp;#x6545;&amp;#x969C;&amp;#x6062;&amp;#x590D;&quot; class=&quot;headerlink&quot; title=&quot;2.1Primary&amp;#x6545;&amp;#x969C;&amp;#x6062;&amp;#x590D;&quot;&gt;&lt;/a&gt;2.1Primary&amp;#x6545;&amp;#x969C;&amp;#x6062;&amp;#x590D;&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;/2016/02/15/ceph-consistency/recover-primary.png&quot; alt=&quot;recover-primary&quot;&gt;&lt;br&gt;&amp;#x7B80;&amp;#x5355;&amp;#x8D77;&amp;#x89C1;&amp;#xFF0C;&amp;#x56FE;&amp;#x4E2D;&amp;#x7684;&amp;#x6570;&amp;#x5B57;&amp;#x5C31;&amp;#x8868;&amp;#x793A;pglog&amp;#x91CC;&amp;#x4E0D;&amp;#x540C;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x7248;&amp;#x672C;&amp;#x3002;&lt;br&gt;1&amp;#xFF09;&amp;#x6B63;&amp;#x5E38;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;&amp;#xFF0C;&amp;#x90FD;&amp;#x662F;&amp;#x7531;Primary&amp;#x5904;&amp;#x7406;client&amp;#x7AEF;&amp;#x7684;I/O&amp;#x8BF7;&amp;#x6C42;&amp;#xFF0C;&amp;#x8FD9;&amp;#x65F6;&amp;#xFF0C;Primary&amp;#x548C;Replicas&amp;#x4E0A;&amp;#x7684;last_update&amp;#x548C;last_complete&amp;#x90FD;&amp;#x4F1A;&amp;#x6307;&amp;#x5411;pglog&amp;#x6700;&amp;#x65B0;&amp;#x8BB0;&amp;#x5F55;&amp;#xFF1B;&lt;br&gt;2&amp;#xFF09;&amp;#x5F53;Primary&amp;#x6302;&amp;#x6389;&amp;#x540E;&amp;#xFF0C;&amp;#x4F1A;&amp;#x9009;&amp;#x51FA;&amp;#x4E00;&amp;#x4E2A;Replica&amp;#x4F5C;&amp;#x4E3A;&amp;#x201C;&amp;#x4E34;&amp;#x65F6;&amp;#x4E3B;&amp;#x201D;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x201C;&amp;#x4E34;&amp;#x65F6;&amp;#x4E3B;&amp;#x201D;&amp;#x8D1F;&amp;#x8D23;&amp;#x5904;&amp;#x7406;&amp;#x65B0;&amp;#x7684;&amp;#x8BFB;&amp;#x5199;&amp;#x8BF7;&amp;#x6C42;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x8FD9;&amp;#x4E2A;&amp;#x65F6;&amp;#x5019;&amp;#x201C;&amp;#x4E34;&amp;#x65F6;&amp;#x4E3B;&amp;#x201D;&amp;#x548C;&amp;#x5269;&amp;#x4E0B;&amp;#x7684;Replicas&amp;#x4E0A;&amp;#x7684;last_complete&amp;#x548C;last_update&amp;#x90FD;&amp;#x66F4;&amp;#x65B0;&amp;#x5230;&amp;#x8BE5;&amp;#x526F;&amp;#x672C;&amp;#x4E0A;&amp;#x7684;pglog&amp;#x7684;&amp;#x6700;&amp;#x65B0;&amp;#x8BB0;&amp;#x5F55;&amp;#xFF1B;&lt;br&gt;3&amp;#xFF09;&amp;#x5F53;&amp;#x539F;&amp;#x6765;&amp;#x7684;Primary&amp;#x53C8;&amp;#x91CD;&amp;#x542F;&amp;#x65F6;&amp;#xFF0C;&amp;#x4F1A;&amp;#x4ECE;&amp;#x672C;&amp;#x5730;&amp;#x8BFB;&amp;#x51FA;pginfo&amp;#x548C;pglog&amp;#xFF0C;&amp;#x5F53;&amp;#x53D1;&amp;#x73B0;last_complete&amp;lt;last_update&amp;#x65F6;&amp;#xFF0C;last_complete&amp;#x548C;last_update&amp;#x4E4B;&amp;#x95F4;&amp;#x5C31;&amp;#x53EF;&amp;#x80FD;&amp;#x5B58;&amp;#x5728;&amp;#x4E22;&amp;#x5931;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x904D;&amp;#x5386;last_complete&amp;#x5230;last_update&amp;#x4E4B;&amp;#x95F4;&amp;#x7684;pglog&amp;#x8BB0;&amp;#x5F55;&amp;#xFF0C;&amp;#x5BF9;&amp;#x4E8E;&amp;#x6BCF;&amp;#x4E00;&amp;#x6761;&amp;#x8BB0;&amp;#x5F55;&amp;#xFF0C;&amp;#x4ECE;&amp;#x672C;&amp;#x5730;&amp;#x8BFB;&amp;#x51FA;&amp;#x8BE5;&amp;#x8BB0;&amp;#x5F55;&amp;#x91CC;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x5C5E;&amp;#x6027;&amp;#xFF08;&amp;#x5305;&amp;#x542B;&amp;#x672C;&amp;#x5730;&amp;#x6301;&amp;#x4E45;&amp;#x5316;&amp;#x8FC7;&amp;#x7684;&amp;#x7248;&amp;#x672C;&amp;#xFF09;&amp;#xFF0C;&amp;#x5BF9;&amp;#x6BD4;pglog&amp;#x8BB0;&amp;#x5F55;&amp;#x91CC;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x7248;&amp;#x672C;&amp;#x4E0E;&amp;#x8BFB;&amp;#x51FA;&amp;#x6765;&amp;#x7684;&amp;#x7248;&amp;#x672C;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x8BFB;&amp;#x51FA;&amp;#x6765;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x7248;&amp;#x672C;&amp;#x5C0F;&amp;#x4E8E;pglog&amp;#x8BB0;&amp;#x5F55;&amp;#x91CC;&amp;#x7684;&amp;#x7248;&amp;#x672C;&amp;#xFF0C;&amp;#x8BF4;&amp;#x660E;&amp;#x8BE5;&amp;#x5BF9;&amp;#x8C61;&amp;#x4E0D;&amp;#x662F;&amp;#x6700;&amp;#x65B0;&amp;#x7684;&amp;#xFF0C;&amp;#x9700;&amp;#x8981;&amp;#x8FDB;&amp;#x884C;&amp;#x6062;&amp;#x590D;&amp;#xFF0C;&amp;#x56E0;&amp;#x6B64;&lt;strong&gt;&amp;#x5C06;&amp;#x8BE5;&amp;#x5BF9;&amp;#x8C61;&amp;#x52A0;&amp;#x5230;missing&amp;#x5217;&amp;#x8868;&amp;#x91CC;&lt;/strong&gt;&amp;#xFF1B;&lt;br&gt;4&amp;#xFF09;Primary&amp;#x53D1;&amp;#x8D77;peering&amp;#x8FC7;&amp;#x7A0B;&amp;#xFF0C;&amp;#x5373;&amp;#x201C;&amp;#x62A2;&amp;#x56DE;&amp;#x539F;&amp;#x6765;&amp;#x7684;&amp;#x4E3B;&amp;#x201D;&amp;#xFF0C;&amp;#x9009;&amp;#x51FA;&amp;#x6743;&amp;#x5A01;&amp;#x65E5;&amp;#x5FD7;&amp;#xFF0C;&amp;#x4E00;&amp;#x822C;&amp;#x5C31;&amp;#x662F;&amp;#x201C;&amp;#x4E34;&amp;#x65F6;&amp;#x4E3B;&amp;#x201D;&amp;#x7684;pglog&amp;#xFF0C;&amp;#x5C06;&amp;#x8BE5;&amp;#x6743;&amp;#x5A01;&amp;#x65E5;&amp;#x5FD7;&amp;#x83B7;&amp;#x53D6;&amp;#x8FC7;&amp;#x6765;&amp;#xFF0C;&amp;#x4E0E;&amp;#x81EA;&amp;#x5DF1;&amp;#x7684;pglog&amp;#x8FDB;&amp;#x884C;merge_log&amp;#x7684;&amp;#x6B65;&amp;#x9AA4;&amp;#xFF0C;&amp;#x6784;&amp;#x5EFA;&amp;#x51FA;missing&amp;#x5217;&amp;#x8868;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x66F4;&amp;#x65B0;&amp;#x81EA;&amp;#x5DF1;&amp;#x7684;last_update&amp;#x4E3A;&amp;#x6700;&amp;#x65B0;&amp;#x7684;pglog&amp;#x8BB0;&amp;#x5F55;&amp;#xFF08;&amp;#x4E0E;&amp;#x5404;&amp;#x4E2A;&amp;#x526F;&amp;#x672C;&amp;#x4E00;&amp;#x81F4;&amp;#xFF09;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x65F6;&amp;#x5019;&lt;strong&gt;last_complete&amp;#x4E0E;last_update&amp;#x4E4B;&amp;#x95F4;&amp;#x7684;&amp;#x5C31;&amp;#x4F1A;&amp;#x52A0;&amp;#x5230;missing&amp;#x5217;&amp;#x8868;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;peering&amp;#x5B8C;&amp;#x6210;&amp;#x540E;&amp;#x4F1A;&amp;#x6301;&amp;#x4E45;&amp;#x5316;last_complete&amp;#x548C;last_update&lt;/strong&gt;&amp;#xFF1B;&lt;br&gt;5&amp;#xFF09;&amp;#x5F53;&amp;#x6709;&amp;#x65B0;&amp;#x7684;&amp;#x5199;&amp;#x5165;&amp;#x65F6;&amp;#xFF0C;&amp;#x4ECD;&amp;#x7136;&amp;#x662F;&amp;#x7531;Primary&amp;#x8D1F;&amp;#x8D23;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x4F1A;&amp;#x66F4;&amp;#x65B0;last_update&amp;#xFF0C;&amp;#x526F;&amp;#x672C;&amp;#x4E0A;&amp;#x4F1A;&amp;#x540C;&amp;#x65F6;&amp;#x66F4;&amp;#x65B0;last_complete&amp;#xFF0C;&amp;#x4E0E;&amp;#x6B64;&amp;#x540C;&amp;#x65F6;&amp;#xFF0C;Primary&amp;#x4F1A;&amp;#x8FDB;&amp;#x884C;&amp;#x6062;&amp;#x590D;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x4ECE;&amp;#x5176;&amp;#x4ED6;&amp;#x526F;&amp;#x672C;&amp;#x4E0A;&amp;#x62C9;&amp;#x53D6;&amp;#x5BF9;&amp;#x8C61;&amp;#x6570;&amp;#x636E;&amp;#x5230;&amp;#x81EA;&amp;#x5DF1;&amp;#x8FD9;&amp;#x91CC;&amp;#x8FDB;&amp;#x884C;&amp;#x6062;&amp;#x590D;&amp;#xFF0C;&amp;#x6BCF;&amp;#x5F53;&amp;#x6062;&amp;#x590D;&amp;#x5B8C;&amp;#x4E00;&amp;#x4E2A;&amp;#x65F6;&amp;#xFF0C;&amp;#x5C31;&amp;#x4F1A;&amp;#x66F4;&amp;#x65B0;&amp;#x81EA;&amp;#x5DF1;&amp;#x7684;last_complete&amp;#xFF08;&amp;#x4F1A;&amp;#x6301;&amp;#x4E45;&amp;#x5316;&amp;#x7684;&amp;#xFF09;&amp;#xFF0C;&amp;#x5F53;&amp;#x6240;&amp;#x6709;&amp;#x5BF9;&amp;#x8C61;&amp;#x90FD;&amp;#x6062;&amp;#x590D;&amp;#x5B8C;&amp;#x6210;&amp;#x540E;&amp;#xFF0C;last_complete&amp;#x5C31;&amp;#x4F1A;&amp;#x8FFD;&amp;#x4E0A;last_update&amp;#x4E86;&amp;#x3002;&lt;br&gt;6&amp;#xFF09;&amp;#x5F53;&amp;#x6062;&amp;#x590D;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#xFF0C;Primary&amp;#x53C8;&amp;#x6302;&amp;#x4E86;&amp;#x518D;&amp;#x8D77;&amp;#x6765;&amp;#x6062;&amp;#x590D;&amp;#x65F6;&amp;#xFF0C;&amp;#x5148;&amp;#x8BFB;&amp;#x51FA;&amp;#x672C;&amp;#x5730;pglog&amp;#x65F6;&amp;#x5C31;&amp;#x4F1A;&amp;#x6839;&amp;#x636E;&amp;#x81EA;&amp;#x5DF1;&amp;#x7684;last_complete&amp;#x548C;last_update&amp;#x6784;&amp;#x5EFA;&amp;#x51FA;missing&amp;#x5217;&amp;#x8868;&amp;#xFF0C;&amp;#x800C;&amp;#x5728;peering&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x5BF9;&amp;#x6BD4;&amp;#x6743;&amp;#x5A01;&amp;#x65E5;&amp;#x5FD7;&amp;#x548C;&amp;#x672C;&amp;#x5730;&amp;#x7684;pglog&amp;#x53D1;&amp;#x73B0;&amp;#x6743;&amp;#x5A01;&amp;#x4E0E;&amp;#x81EA;&amp;#x5DF1;&amp;#x7684;last_update&amp;#x90FD;&amp;#x4E00;&amp;#x6837;&amp;#xFF0C;peering&amp;#x7684;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#x5C31;&amp;#x6CA1;&amp;#x6709;&amp;#x65B0;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x52A0;&amp;#x5230;missing&amp;#x5217;&amp;#x8868;&amp;#x91CC;&amp;#xFF0C;&amp;#x603B;&amp;#x7684;&amp;#x6765;&amp;#x8BF4;&amp;#xFF0C;missing&amp;#x5217;&amp;#x8868;&amp;#x5C31;&amp;#x662F;&amp;#x7531;&amp;#x4E24;&amp;#x4E2A;&amp;#x5730;&amp;#x65B9;&amp;#x8FDB;&amp;#x884C;&amp;#x6784;&amp;#x5EFA;&amp;#x7684;&amp;#xFF1A;&amp;#x4E00;&amp;#x4E2A;&amp;#x662F;osd&amp;#x542F;&amp;#x52A8;&amp;#x7684;&amp;#x65F6;&amp;#x5019;read_log&amp;#x91CC;&amp;#x6784;&amp;#x5EFA;&amp;#x7684;&amp;#xFF0C;&amp;#x53E6;&amp;#x4E00;&amp;#x4E2A;&amp;#x662F;peering&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x5BF9;&amp;#x6BD4;&amp;#x6743;&amp;#x5A01;&amp;#x65E5;&amp;#x5FD7;&amp;#x6784;&amp;#x5EFA;&amp;#x7684;&amp;#xFF1B;&lt;/p&gt;
&lt;h2 id=&quot;2-2Replica&amp;#x6545;&amp;#x969C;&amp;#x6062;&amp;#x590D;&quot;&gt;&lt;a href=&quot;#2-2Replica&amp;#x6545;&amp;#x969C;&amp;#x6062;&amp;#x590D;&quot; class=&quot;headerlink&quot; title=&quot;2.2Replica&amp;#x6545;&amp;#x969C;&amp;#x6062;&amp;#x590D;&quot;&gt;&lt;/a&gt;2.2Replica&amp;#x6545;&amp;#x969C;&amp;#x6062;&amp;#x590D;&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;/2016/02/15/ceph-consistency/recover-replica.png&quot; alt=&quot;recover-replica&quot;&gt;&lt;br&gt;&amp;#x4E0E;Primary&amp;#x7684;&amp;#x6062;&amp;#x590D;&amp;#x7C7B;&amp;#x4F3C;&amp;#xFF0C;peering&amp;#x90FD;&amp;#x662F;&amp;#x7531;Primary&amp;#x53D1;&amp;#x8D77;&amp;#x7684;&amp;#xFF0C;Replica&amp;#x8D77;&amp;#x6765;&amp;#x540E;&amp;#x4E5F;&amp;#x4F1A;&amp;#x6839;&amp;#x636E;pglog&amp;#x7684;last_complete&amp;#x548C;last_update&amp;#x6784;&amp;#x5EFA;&amp;#x51FA;replica&amp;#x81EA;&amp;#x5DF1;&amp;#x7684;missing&amp;#xFF0C;&amp;#x7136;&amp;#x540E;Primary&amp;#x8FDB;&amp;#x884C;peering&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x5BF9;&amp;#x6BD4;&amp;#x6743;&amp;#x5A01;&amp;#x65E5;&amp;#x5FD7;&amp;#xFF08;&amp;#x5373;&amp;#x81EA;&amp;#x8EAB;&amp;#xFF09;&amp;#x4E0E;&amp;#x6545;&amp;#x969C;replica&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&amp;#xFF0C;&amp;#x7ED3;&amp;#x5408;replica&amp;#x7684;missing&amp;#xFF0C;&amp;#x6784;&amp;#x5EFA;&amp;#x51FA;peer_missing&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5C31;&amp;#x904D;&amp;#x5386;peer_missing&amp;#x6765;&amp;#x6062;&amp;#x590D;&amp;#x5BF9;&amp;#x8C61;&amp;#x3002;&amp;#x7136;&amp;#x540E;&amp;#x65B0;&amp;#x7684;&amp;#x5199;&amp;#x5165;&amp;#x65F6;&amp;#x4F1A;&amp;#x5728;&amp;#x5404;&amp;#x4E2A;&amp;#x526F;&amp;#x672C;&amp;#x4E0A;&amp;#x66F4;&amp;#x65B0;last_complete&amp;#x548C;last_update&amp;#xFF0C;&amp;#x5176;&amp;#x4E2D;&amp;#x6545;&amp;#x969C;replica&amp;#x4E0A;&amp;#x53EA;&amp;#x66F4;&amp;#x65B0;last_update&amp;#xFF0C;&amp;#x6062;&amp;#x590D;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#xFF0C;&amp;#x6BCF;&amp;#x6062;&amp;#x590D;&amp;#x5B8C;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x6545;&amp;#x969C;replica&amp;#x4F1A;&amp;#x66F4;&amp;#x65B0;last_complete&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;&amp;#x6240;&amp;#x6709;&amp;#x5BF9;&amp;#x8C61;&amp;#x90FD;&amp;#x6062;&amp;#x590D;&amp;#x5B8C;&amp;#x6210;&amp;#x540E;&amp;#xFF0C;replica&amp;#x7684;last_complete&amp;#x5C31;&amp;#x4F1A;&amp;#x8FFD;&amp;#x4E0A;last_update&amp;#x3002;&lt;br&gt;&amp;#x5982;&amp;#x679C;&amp;#x6062;&amp;#x590D;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#xFF0C;&amp;#x6545;&amp;#x969C;replica&amp;#x53C8;&amp;#x6302;&amp;#x6389;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x91CD;&amp;#x542F;&amp;#x540E;&amp;#x8FDB;&amp;#x884C;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x4E5F;&amp;#x662F;&amp;#x5148;&amp;#x8BFB;&amp;#x51FA;&amp;#x672C;&amp;#x5730;log&amp;#xFF0C;&amp;#x5BF9;&amp;#x6BD4;last_complete&amp;#x4E0E;last_update&amp;#x4E4B;&amp;#x95F4;&amp;#x7684;pglog&amp;#x8BB0;&amp;#x5F55;&amp;#x91CC;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x7248;&amp;#x672C;&amp;#x4E0E;&amp;#x672C;&amp;#x5730;&amp;#x8BFB;&amp;#x51FA;&amp;#x6765;&amp;#x7684;&amp;#x8BE5;&amp;#x5BF9;&amp;#x8C61;&amp;#x7248;&amp;#x672C;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x672C;&amp;#x5730;&amp;#x4E0D;&amp;#x662F;&amp;#x6700;&amp;#x65B0;&amp;#x7684;&amp;#xFF0C;&amp;#x5C31;&amp;#x4F1A;&amp;#x52A0;&amp;#x5230;missing&amp;#x5217;&amp;#x8868;&amp;#x91CC;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;Primary&amp;#x53D1;&amp;#x8D77;peering&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x53D1;&amp;#x73B0;replica&amp;#x7684;last_update&amp;#x662F;&amp;#x6700;&amp;#x65B0;&amp;#x7684;&amp;#xFF0C;peering&amp;#x8FC7;&amp;#x7A0B;&amp;#x5C31;&amp;#x6CA1;&amp;#x6709;&amp;#x65B0;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x52A0;&amp;#x5230;peer_missing&amp;#x5217;&amp;#x8868;&amp;#x91CC;&amp;#xFF0C;peer_missing&amp;#x91CC;&amp;#x5C31;&amp;#x662F;replica&amp;#x81EA;&amp;#x5DF1;&amp;#x7684;missing&amp;#x91CC;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x3002;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;#x5206;&amp;#x5E03;&amp;#x5F0F;&amp;#x5B58;&amp;#x50A8;&amp;#x7CFB;&amp;#x7EDF;&amp;#x901A;&amp;#x5E38;&amp;#x91C7;&amp;#x7528;&amp;#x591A;&amp;#x526F;&amp;#x672C;&amp;#x7684;&amp;#x65B9;&amp;#x5F0F;&amp;#x6765;&amp;#x4FDD;&amp;#x8BC1;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x53EF;&amp;#x9760;&amp;#x6027;&amp;#xFF0C;&amp;#x800C;&amp;#x591A;&amp;#x526F;&amp;#x672C;&amp;#x4E4B;&amp;#x95F4;&amp;#x5982;&amp;#x4F55;&amp;#x4FDD;&amp;#x8BC1;&amp;#x6570;&amp;#x636E;&amp;#x7684;&amp;#x4E00;&amp;#x81F4;&amp;#x6027;&amp;#x5C31;&amp;#x662F;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x6838;&amp;#x5FC3;&amp;#x3002;ceph&amp;#x53F7;&amp;#x79F0;&amp;#x7EDF;&amp;#x4E00;&amp;#x5B58;&amp;#x50A8;&amp;#xFF0C;&amp;#x5176;&amp;#x6838;&amp;#x5FC3;RADOS&amp;#x65E2;&amp;#x652F;&amp;#x6301;&amp;#x591A;&amp;#x526F;&amp;#x672C;&amp;#xFF0C;&amp;#x4E5F;&amp;#x652F;&amp;#x6301;&amp;#x7EA0;&amp;#x5220;&amp;#x7801;&amp;#x3002;&amp;#x672C;&amp;#x6587;&amp;#x4E3B;&amp;#x8981;&amp;#x5206;&amp;#x6790;ceph&amp;#x7684;&amp;#x591A;&amp;#x526F;&amp;#x672C;&amp;#x4E00;&amp;#x81F4;&amp;#x6027;&amp;#x534F;&amp;#x8BAE;&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;1-pglog&amp;#x53CA;&amp;#x8BFB;&amp;#x5199;&amp;#x6D41;&amp;#x7A0B;&quot;&gt;&lt;a href=&quot;#1-pglog&amp;#x53CA;&amp;#x8BFB;&amp;#x5199;&amp;#x6D41;&amp;#x7A0B;&quot; class=&quot;headerlink&quot; title=&quot;1.pglog&amp;#x53CA;&amp;#x8BFB;&amp;#x5199;&amp;#x6D41;&amp;#x7A0B;&quot;&gt;&lt;/a&gt;1.pglog&amp;#x53CA;&amp;#x8BFB;&amp;#x5199;&amp;#x6D41;&amp;#x7A0B;&lt;/h1&gt;&lt;p&gt;ceph&amp;#x4F7F;&amp;#x7528;pglog&amp;#x6765;&amp;#x4FDD;&amp;#x8BC1;&amp;#x591A;&amp;#x526F;&amp;#x672C;&amp;#x4E4B;&amp;#x95F4;&amp;#x7684;&amp;#x4E00;&amp;#x81F4;&amp;#x6027;&amp;#xFF0C;pglog&amp;#x7684;&amp;#x793A;&amp;#x610F;&amp;#x56FE;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;pglog&amp;#x4E3B;&amp;#x8981;&amp;#x662F;&amp;#x7528;&amp;#x6765;&amp;#x8BB0;&amp;#x5F55;&amp;#x505A;&amp;#x4E86;&amp;#x4EC0;&amp;#x4E48;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x6BD4;&amp;#x5982;&amp;#x4FEE;&amp;#x6539;&amp;#xFF0C;&amp;#x5220;&amp;#x9664;&amp;#x7B49;&amp;#xFF0C;&amp;#x800C;&amp;#x6BCF;&amp;#x4E00;&amp;#x6761;&amp;#x8BB0;&amp;#x5F55;&amp;#x91CC;&amp;#x5305;&amp;#x542B;&amp;#x4E86;&amp;#x5BF9;&amp;#x8C61;&amp;#x4FE1;&amp;#x606F;&amp;#xFF0C;&amp;#x8FD8;&amp;#x6709;&amp;#x7248;&amp;#x672C;&amp;#x3002;&lt;br&gt;ceph&amp;#x4F7F;&amp;#x7528;&amp;#x7248;&amp;#x672C;&amp;#x63A7;&amp;#x5236;&amp;#x7684;&amp;#x65B9;&amp;#x5F0F;&amp;#x6765;&amp;#x6807;&amp;#x8BB0;&amp;#x4E00;&amp;#x4E2A;PG&amp;#x5185;&amp;#x7684;&amp;#x6BCF;&amp;#x4E00;&amp;#x6B21;&amp;#x66F4;&amp;#x65B0;&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;&amp;#x7248;&amp;#x672C;&amp;#x5305;&amp;#x62EC;&amp;#x4E00;&amp;#x4E2A;(epoch&amp;#xFF0C;version)&amp;#x6765;&amp;#x7EC4;&amp;#x6210;&amp;#xFF1A;&amp;#x5176;&amp;#x4E2D;epoch&amp;#x662F;osdmap&amp;#x7684;&amp;#x7248;&amp;#x672C;&amp;#xFF0C;&amp;#x6BCF;&amp;#x5F53;&amp;#x6709;OSD&amp;#x72B6;&amp;#x6001;&amp;#x53D8;&amp;#x5316;&amp;#x5982;&amp;#x589E;&amp;#x52A0;&amp;#x5220;&amp;#x9664;&amp;#x7B49;&amp;#x65F6;&amp;#xFF0C;epoch&amp;#x5C31;&amp;#x9012;&amp;#x589E;&amp;#xFF1B;version&amp;#x662F;PG&amp;#x5185;&amp;#x6BCF;&amp;#x6B21;&amp;#x66F4;&amp;#x65B0;&amp;#x64CD;&amp;#x4F5C;&amp;#x7684;&amp;#x7248;&amp;#x672C;&amp;#x53F7;&amp;#xFF0C;&amp;#x9012;&amp;#x589E;&amp;#x7684;&amp;#xFF0C;&amp;#x7531;PG&amp;#x5185;&amp;#x7684;Primary OSD&amp;#x8FDB;&amp;#x884C;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2016/02/15/ceph-consistency/pglog-entry.png&quot; alt=&quot;pglog-entry&quot;&gt;&lt;br&gt;&amp;#x6BCF;&amp;#x4E2A;&amp;#x526F;&amp;#x672C;&amp;#x4E0A;&amp;#x90FD;&amp;#x7EF4;&amp;#x62A4;&amp;#x4E86;pglog&amp;#xFF0C;pglog&amp;#x91CC;&amp;#x6700;&amp;#x91CD;&amp;#x8981;&amp;#x7684;&amp;#x4E24;&amp;#x4E2A;&amp;#x6307;&amp;#x9488;&amp;#x5C31;&amp;#x662F;last_complete&amp;#x548C;last_update&amp;#xFF0C;&amp;#x6B63;&amp;#x5E38;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;&amp;#x526F;&amp;#x672C;&amp;#x4E0A;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;&amp;#x6307;&amp;#x9488;&amp;#x90FD;&amp;#x6307;&amp;#x5411;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;&amp;#x4F4D;&amp;#x7F6E;&amp;#xFF0C;&amp;#x5F53;&amp;#x51FA;&amp;#x73B0;&amp;#x673A;&amp;#x5668;&amp;#x91CD;&amp;#x542F;&amp;#x3001;&amp;#x7F51;&amp;#x7EDC;&amp;#x4E2D;&amp;#x65AD;&amp;#x7B49;&amp;#x6545;&amp;#x969C;&amp;#x65F6;&amp;#xFF0C;&amp;#x6545;&amp;#x969C;&amp;#x526F;&amp;#x672C;&amp;#x7684;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;&amp;#x6307;&amp;#x9488;&amp;#x5C31;&amp;#x4F1A;&amp;#x6709;&amp;#x6240;&amp;#x533A;&amp;#x522B;&amp;#xFF0C;&amp;#x4EE5;&amp;#x4FBF;&amp;#x4E8E;&amp;#x6765;&amp;#x8BB0;&amp;#x5F55;&amp;#x526F;&amp;#x672C;&amp;#x95F4;&amp;#x7684;&amp;#x5DEE;&amp;#x5F02;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x4E3A;&amp;#x4E86;&amp;#x4FBF;&amp;#x4E8E;&amp;#x8BF4;&amp;#x660E;ceph&amp;#x7684;&amp;#x4E00;&amp;#x81F4;&amp;#x6027;&amp;#x534F;&amp;#x8BAE;&amp;#xFF0C;&amp;#x5148;&amp;#x7B80;&amp;#x8981;&amp;#x63CF;&amp;#x8FF0;&amp;#x4E00;&amp;#x4E0B;ceph&amp;#x7684;&amp;#x8BFB;&amp;#x5199;&amp;#x5904;&amp;#x7406;&amp;#x6D41;&amp;#x7A0B;&amp;#x3002;&lt;br&gt;&amp;#x5199;&amp;#x5904;&amp;#x7406;&amp;#x6D41;&amp;#x7A0B;&amp;#xFF1A;&lt;br&gt;1&amp;#xFF09;client&amp;#x628A;&amp;#x5199;&amp;#x8BF7;&amp;#x6C42;&amp;#x53D1;&amp;#x5230;Primary OSD&amp;#x4E0A;&amp;#xFF0C;Primary OSD&amp;#x4E0A;&amp;#x5C06;&amp;#x5199;&amp;#x8BF7;&amp;#x6C42;&amp;#x5E8F;&amp;#x5217;&amp;#x5316;&amp;#x5230;&amp;#x4E00;&amp;#x4E2A;&amp;#x4E8B;&amp;#x52A1;&amp;#x4E2D;&amp;#xFF08;&amp;#x5728;&amp;#x5185;&amp;#x5B58;&amp;#x91CC;&amp;#xFF09;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x6784;&amp;#x9020;&amp;#x4E00;&amp;#x6761;pglog&amp;#x8BB0;&amp;#x5F55;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5E8F;&amp;#x5217;&amp;#x5316;&amp;#x5230;&amp;#x8FD9;&amp;#x4E2A;&amp;#x4E8B;&amp;#x52A1;&amp;#x4E2D;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5C06;&amp;#x8FD9;&amp;#x4E2A;&amp;#x4E8B;&amp;#x52A1;&amp;#x4EE5;directIO&amp;#x7684;&amp;#x65B9;&amp;#x5F0F;&amp;#x5F02;&amp;#x6B65;&amp;#x5199;&amp;#x5165;journal&amp;#xFF0C;&amp;#x540C;&amp;#x65F6;Primary OSD&amp;#x628A;&amp;#x5199;&amp;#x8BF7;&amp;#x6C42;&amp;#x548C;pglog(pglog_entry&amp;#x662F;&amp;#x7531;primary&amp;#x751F;&amp;#x6210;)&amp;#x53D1;&amp;#x9001;&amp;#x5230;Replicas&amp;#x4E0A;&amp;#xFF1B;&lt;br&gt;2&amp;#xFF09;&amp;#x5728;Primary OSD&amp;#x5C06;&amp;#x4E8B;&amp;#x52A1;&amp;#x5199;&amp;#x5230;journal&amp;#x4E0A;&amp;#x540E;&amp;#xFF0C;&amp;#x4F1A;&amp;#x901A;&amp;#x8FC7;&amp;#x4E00;&amp;#x7CFB;&amp;#x5217;&amp;#x7684;&amp;#x7EBF;&amp;#x7A0B;&amp;#x548C;&amp;#x56DE;&amp;#x8C03;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5C06;&amp;#x8FD9;&amp;#x4E2A;&amp;#x4E8B;&amp;#x52A1;&amp;#x91CC;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x5199;&amp;#x5165;filesystem&amp;#xFF08;&amp;#x53EA;&amp;#x662F;&amp;#x5199;&amp;#x5230;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x7F13;&amp;#x5B58;&amp;#x91CC;&amp;#xFF0C;&amp;#x4F1A;&amp;#x6709;&amp;#x7EBF;&amp;#x7A0B;&amp;#x5B9A;&amp;#x671F;&amp;#x5237;&amp;#x6570;&amp;#x636E;&amp;#xFF09;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x4E8B;&amp;#x52A1;&amp;#x91CC;&amp;#x7684;pglog&amp;#x8BB0;&amp;#x5F55;&amp;#xFF08;&amp;#x4E5F;&amp;#x5305;&amp;#x62EC;pginfo&amp;#x7684;last_complete&amp;#x548C;last_update&amp;#xFF09;&amp;#x4F1A;&amp;#x5199;&amp;#x5230;leveldb&amp;#xFF0C;&amp;#x8FD8;&amp;#x6709;&amp;#x4E00;&amp;#x4E9B;&amp;#x6269;&amp;#x5C55;&amp;#x5C5E;&amp;#x6027;&amp;#x76F8;&amp;#x5173;&amp;#x7684;&amp;#x4E5F;&amp;#x5728;&amp;#x8FD9;&amp;#x4E2A;&amp;#x4E8B;&amp;#x52A1;&amp;#x91CC;&amp;#xFF0C;&amp;#x5728;&amp;#x904D;&amp;#x5386;&amp;#x8FD9;&amp;#x4E2A;&amp;#x4E8B;&amp;#x52A1;&amp;#x65F6;&amp;#x4E5F;&amp;#x4F1A;&amp;#x5199;&amp;#x5230;leveldb&amp;#xFF1B;&lt;br&gt;3&amp;#xFF09;&amp;#x5728;Replicas&amp;#x4E0A;&amp;#xFF0C;&amp;#x4E5F;&amp;#x662F;&amp;#x8FDB;&amp;#x884C;&amp;#x7C7B;&amp;#x4F3C;&amp;#x4E8E;Primary&amp;#x7684;&amp;#x52A8;&amp;#x4F5C;&amp;#xFF0C;&amp;#x5148;&amp;#x5199;journal&amp;#xFF0C;&amp;#x5199;&amp;#x6210;&amp;#x529F;&amp;#x4F1A;&amp;#x7ED9;Primary&amp;#x53D1;&amp;#x9001;&amp;#x4E00;&amp;#x4E2A;committed ack&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5C06;&amp;#x8FD9;&amp;#x4E2A;&amp;#x4E8B;&amp;#x52A1;&amp;#x91CC;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x5199;&amp;#x5230;filesystem&amp;#xFF0C;pglog&amp;#x4E0E;pginfo&amp;#x5199;&amp;#x5230;leveldb&amp;#x91CC;&amp;#xFF0C;&amp;#x5199;&amp;#x5B8C;&amp;#x540E;&amp;#x4F1A;&amp;#x7ED9;Primary&amp;#x53D1;&amp;#x9001;&amp;#x53E6;&amp;#x5916;&amp;#x4E00;&amp;#x4E2A;applied ack&amp;#xFF1B;&lt;br&gt;4&amp;#xFF09;Primary&amp;#x5728;&amp;#x81EA;&amp;#x5DF1;&amp;#x5B8C;&amp;#x6210;journal&amp;#x7684;&amp;#x5199;&amp;#x5165;&amp;#x65F6;&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;&amp;#x5728;&amp;#x6536;&amp;#x5230;Replica&amp;#x7684;committed ack&amp;#x65F6;&amp;#x90FD;&amp;#x4F1A;&amp;#x68C0;&amp;#x67E5;&amp;#x662F;&amp;#x5426;&amp;#x591A;&amp;#x4E2A;&amp;#x526F;&amp;#x672C;&amp;#x90FD;&amp;#x5199;&amp;#x5165;journal&amp;#x6210;&amp;#x529F;&amp;#x4E86;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x662F;&amp;#x5219;&amp;#x5411;client&amp;#x7AEF;&amp;#x53D1;&amp;#x9001;ack&amp;#x901A;&amp;#x77E5;&amp;#x5199;&amp;#x5B8C;&amp;#x6210;&amp;#xFF1B;Primary&amp;#x5728;&amp;#x81EA;&amp;#x5DF1;&amp;#x5B8C;&amp;#x6210;&amp;#x4E8B;&amp;#x52A1;&amp;#x5199;&amp;#x5230;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x548C;leveldb&amp;#x540E;&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;&amp;#x5728;&amp;#x6536;&amp;#x5230;replica&amp;#x7684;applied ack&amp;#x65F6;&amp;#x90FD;&amp;#x4F1A;&amp;#x68C0;&amp;#x67E5;&amp;#x662F;&amp;#x5426;&amp;#x591A;&amp;#x4E2A;&amp;#x526F;&amp;#x672C;&amp;#x90FD;&amp;#x5199;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x6210;&amp;#x529F;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x662F;&amp;#x5219;&amp;#x5411;client&amp;#x7AEF;&amp;#x53D1;&amp;#x9001;ack&amp;#x901A;&amp;#x77E5;&amp;#x6570;&amp;#x636E;&amp;#x53EF;&amp;#x8BFB;&amp;#xFF1B;&lt;br&gt;&amp;#x5BF9;&amp;#x8BFB;&amp;#x6D41;&amp;#x7A0B;&amp;#x6765;&amp;#x8BF4;&amp;#xFF0C;&amp;#x5C31;&amp;#x6BD4;&amp;#x8F83;&amp;#x7B80;&amp;#x5355;&amp;#xFF0C;&amp;#x90FD;&amp;#x662F;&amp;#x7531;Primary&amp;#x6765;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x5C31;&amp;#x4E0D;&amp;#x591A;&amp;#x8BF4;&amp;#x4E86;&amp;#x3002;&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ceph" scheme="http://yoursite.com/categories/ceph/"/>
    
    
      <category term="ceph" scheme="http://yoursite.com/tags/ceph/"/>
    
      <category term="pglog" scheme="http://yoursite.com/tags/pglog/"/>
    
      <category term="consistency" scheme="http://yoursite.com/tags/consistency/"/>
    
  </entry>
  
  <entry>
    <title>ceph解读之PGLog</title>
    <link href="http://yoursite.com/2015/12/18/ceph-pglog/"/>
    <id>http://yoursite.com/2015/12/18/ceph-pglog/</id>
    <published>2015-12-18T08:15:51.000Z</published>
    <updated>2016-05-13T09:00:44.462Z</updated>
    
    <content type="html">&lt;p&gt;ceph&amp;#x7684;PGLog&amp;#x662F;&amp;#x7531;PG&amp;#x6765;&amp;#x7EF4;&amp;#x62A4;&amp;#xFF0C;&amp;#x8BB0;&amp;#x5F55;&amp;#x4E86;&amp;#x8BE5;PG&amp;#x7684;&amp;#x6240;&amp;#x6709;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x5176;&amp;#x4F5C;&amp;#x7528;&amp;#x7C7B;&amp;#x4F3C;&amp;#x4E8E;&amp;#x6570;&amp;#x636E;&amp;#x5E93;&amp;#x91CC;&amp;#x7684;undo log&amp;#x3002;PGLog&amp;#x901A;&amp;#x5E38;&amp;#x53EA;&amp;#x4FDD;&amp;#x5B58;&amp;#x8FD1;&amp;#x5343;&amp;#x6761;&amp;#x7684;&amp;#x64CD;&amp;#x4F5C;&amp;#x8BB0;&amp;#x5F55;&amp;#xFF08;&amp;#x9ED8;&amp;#x8BA4;&amp;#x662F;3000&amp;#x6761;&amp;#xFF09;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x5F53;PG&amp;#x5904;&amp;#x4E8E;&amp;#x964D;&amp;#x7EA7;&amp;#x72B6;&amp;#x6001;&amp;#x65F6;&amp;#xFF0C;&amp;#x5C31;&amp;#x4F1A;&amp;#x4FDD;&amp;#x5B58;&amp;#x66F4;&amp;#x591A;&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&amp;#xFF08;&amp;#x9ED8;&amp;#x8BA4;&amp;#x662F;10000&amp;#x6761;&amp;#xFF09;&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x5728;&amp;#x6545;&amp;#x969C;&amp;#x7684;PG&amp;#x91CD;&amp;#x73B0;&amp;#x4E0A;&amp;#x7EBF;&amp;#x540E;&amp;#x7528;&amp;#x6765;&amp;#x6062;&amp;#x590D;PG&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x3002;&amp;#x672C;&amp;#x6587;&amp;#x4E3B;&amp;#x8981;&amp;#x4ECE;PGLog&amp;#x7684;&amp;#x683C;&amp;#x5F0F;&amp;#x3001;&amp;#x5B58;&amp;#x50A8;&amp;#x65B9;&amp;#x5F0F;&amp;#x3001;&amp;#x5982;&amp;#x4F55;&amp;#x53C2;&amp;#x4E0E;&amp;#x6062;&amp;#x590D;&amp;#x6765;&amp;#x89E3;&amp;#x6790;PGLog&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;1-PGLog&amp;#x7684;&amp;#x683C;&amp;#x5F0F;&quot;&gt;&lt;a href=&quot;#1-PGLog&amp;#x7684;&amp;#x683C;&amp;#x5F0F;&quot; class=&quot;headerlink&quot; title=&quot;1.PGLog&amp;#x7684;&amp;#x683C;&amp;#x5F0F;&quot;&gt;&lt;/a&gt;1.PGLog&amp;#x7684;&amp;#x683C;&amp;#x5F0F;&lt;/h1&gt;&lt;p&gt;ceph&amp;#x4F7F;&amp;#x7528;&amp;#x7248;&amp;#x672C;&amp;#x63A7;&amp;#x5236;&amp;#x7684;&amp;#x65B9;&amp;#x5F0F;&amp;#x6765;&amp;#x6807;&amp;#x8BB0;&amp;#x4E00;&amp;#x4E2A;PG&amp;#x5185;&amp;#x7684;&amp;#x6BCF;&amp;#x4E00;&amp;#x6B21;&amp;#x66F4;&amp;#x65B0;&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;&amp;#x7248;&amp;#x672C;&amp;#x5305;&amp;#x62EC;&amp;#x4E00;&amp;#x4E2A;(epoch&amp;#xFF0C;version)&amp;#x6765;&amp;#x7EC4;&amp;#x6210;&amp;#xFF1A;&amp;#x5176;&amp;#x4E2D;epoch&amp;#x662F;osdmap&amp;#x7684;&amp;#x7248;&amp;#x672C;&amp;#xFF0C;&amp;#x6BCF;&amp;#x5F53;&amp;#x6709;OSD&amp;#x72B6;&amp;#x6001;&amp;#x53D8;&amp;#x5316;&amp;#x5982;&amp;#x589E;&amp;#x52A0;&amp;#x5220;&amp;#x9664;&amp;#x7B49;&amp;#x65F6;&amp;#xFF0C;epoch&amp;#x5C31;&amp;#x9012;&amp;#x589E;&amp;#xFF1B;version&amp;#x662F;PG&amp;#x5185;&amp;#x6BCF;&amp;#x6B21;&amp;#x66F4;&amp;#x65B0;&amp;#x64CD;&amp;#x4F5C;&amp;#x7684;&amp;#x7248;&amp;#x672C;&amp;#x53F7;&amp;#xFF0C;&amp;#x9012;&amp;#x589E;&amp;#x7684;&amp;#xFF0C;&amp;#x7531;PG&amp;#x5185;&amp;#x7684;Primary OSD&amp;#x8FDB;&amp;#x884C;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;PGLog&amp;#x5728;&amp;#x4EE3;&amp;#x7801;&amp;#x5B9E;&amp;#x73B0;&amp;#x4E2D;&amp;#x6709;3&amp;#x4E2A;&amp;#x4E3B;&amp;#x8981;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#x6765;&amp;#x7EF4;&amp;#x62A4;&amp;#xFF1A;pg_info_t&amp;#xFF0C;pg_log_t&amp;#xFF0C;pg_log_entry_t&amp;#x3002;&amp;#x4E09;&amp;#x8005;&amp;#x7684;&amp;#x5173;&amp;#x7CFB;&amp;#x793A;&amp;#x610F;&amp;#x56FE;&amp;#x5982;&amp;#x4E0B;&amp;#x3002;&amp;#x4ECE;&amp;#x7ED3;&amp;#x6784;&amp;#x4E0A;&amp;#x53EF;&amp;#x4EE5;&amp;#x5F97;&amp;#x77E5;&amp;#xFF0C;PGLog&amp;#x91CC;&amp;#x53EA;&amp;#x6709;&amp;#x5BF9;&amp;#x8C61;&amp;#x66F4;&amp;#x65B0;&amp;#x64CD;&amp;#x4F5C;&amp;#x76F8;&amp;#x5173;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#xFF0C;&amp;#x6CA1;&amp;#x6709;&amp;#x5177;&amp;#x4F53;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x4EE5;&amp;#x53CA;&amp;#x504F;&amp;#x79FB;&amp;#x5927;&amp;#x5C0F;&amp;#x7B49;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x540E;&amp;#x7EED;&amp;#x4EE5;PGLog&amp;#x6765;&amp;#x8FDB;&amp;#x884C;&amp;#x6062;&amp;#x590D;&amp;#x65F6;&amp;#x90FD;&amp;#x662F;&amp;#x6309;&amp;#x7167;&amp;#x6574;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x6765;&amp;#x8FDB;&amp;#x884C;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#xFF08;&amp;#x9ED8;&amp;#x8BA4;&amp;#x5BF9;&amp;#x8C61;&amp;#x5927;&amp;#x5C0F;&amp;#x662F;4MB&amp;#xFF09;&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2015/12/18/ceph-pglog/pglog.png&quot; alt=&quot;pglog&quot;&gt;&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;&amp;#x5176;&amp;#x4E2D;&amp;#xFF1A;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;last_complete&amp;#xFF1A;&amp;#x5728;&amp;#x8BE5;&amp;#x6307;&amp;#x9488;&amp;#x4E4B;&amp;#x524D;&amp;#x7684;&amp;#x7248;&amp;#x672C;&amp;#x90FD;&amp;#x5DF2;&amp;#x7ECF;&amp;#x5728;&amp;#x6240;&amp;#x6709;&amp;#x7684;OSD&amp;#x4E0A;&amp;#x5B8C;&amp;#x6210;&amp;#x66F4;&amp;#x65B0;&amp;#xFF08;&amp;#x53EA;&amp;#x8868;&amp;#x793A;&amp;#x5185;&amp;#x5B58;&amp;#x66F4;&amp;#x65B0;&amp;#x5B8C;&amp;#x6210;&amp;#xFF09;&amp;#xFF1B;&lt;/li&gt;
&lt;li&gt;last_update&amp;#xFF1A;PG&amp;#x5185;&amp;#x6700;&amp;#x8FD1;&amp;#x4E00;&amp;#x6B21;&amp;#x66F4;&amp;#x65B0;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x7248;&amp;#x672C;&amp;#xFF0C;&amp;#x8FD8;&amp;#x6CA1;&amp;#x6709;&amp;#x5728;&amp;#x6240;&amp;#x6709;OSD&amp;#x4E0A;&amp;#x5B8C;&amp;#x6210;&amp;#x66F4;&amp;#x65B0;&amp;#xFF0C;&amp;#x5728;last_update&amp;#x4E0E;last_complete&amp;#x4E4B;&amp;#x95F4;&amp;#x7684;&amp;#x64CD;&amp;#x4F5C;&amp;#x8868;&amp;#x793A;&amp;#x8BE5;&amp;#x64CD;&amp;#x4F5C;&amp;#x5DF2;&amp;#x5728;&amp;#x90E8;&amp;#x5206;OSD&amp;#x4E0A;&amp;#x5B8C;&amp;#x6210;&amp;#x4F46;&amp;#x662F;&amp;#x8FD8;&amp;#x6CA1;&amp;#x6709;&amp;#x5168;&amp;#x90E8;&amp;#x5B8C;&amp;#x6210;&amp;#xFF1B;&lt;/li&gt;
&lt;li&gt;log_tail&amp;#xFF1A;&amp;#x6307;&amp;#x5411;pg log&amp;#x6700;&amp;#x8001;&amp;#x7684;&amp;#x90A3;&amp;#x6761;&amp;#x8BB0;&amp;#x5F55;&amp;#xFF1B;&lt;/li&gt;
&lt;li&gt;head&amp;#xFF1A;&amp;#x6700;&amp;#x65B0;&amp;#x7684;pg log&amp;#x8BB0;&amp;#x5F55;&amp;#xFF1B;&lt;/li&gt;
&lt;li&gt;tail&amp;#xFF1A;&amp;#x6307;&amp;#x5411;&amp;#x6700;&amp;#x8001;&amp;#x7684;pg log&amp;#x8BB0;&amp;#x5F55;&amp;#x7684;&amp;#x524D;&amp;#x4E00;&amp;#x4E2A;&amp;#xFF1B;&lt;/li&gt;
&lt;li&gt;log&amp;#xFF1A;&amp;#x5B58;&amp;#x653E;&amp;#x5B9E;&amp;#x9645;&amp;#x7684;pglog&amp;#x8BB0;&amp;#x5F55;&amp;#x7684;list&amp;#xFF1B;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;2-PGLog&amp;#x7684;&amp;#x5B58;&amp;#x50A8;&amp;#x65B9;&amp;#x5F0F;&quot;&gt;&lt;a href=&quot;#2-PGLog&amp;#x7684;&amp;#x5B58;&amp;#x50A8;&amp;#x65B9;&amp;#x5F0F;&quot; class=&quot;headerlink&quot; title=&quot;2.PGLog&amp;#x7684;&amp;#x5B58;&amp;#x50A8;&amp;#x65B9;&amp;#x5F0F;&quot;&gt;&lt;/a&gt;2.PGLog&amp;#x7684;&amp;#x5B58;&amp;#x50A8;&amp;#x65B9;&amp;#x5F0F;&lt;/h1&gt;&lt;p&gt;&amp;#x4E86;&amp;#x89E3;&amp;#x4E86;PGLog&amp;#x7684;&amp;#x683C;&amp;#x5F0F;&amp;#x4E4B;&amp;#x540E;&amp;#xFF0C;&amp;#x6211;&amp;#x4EEC;&amp;#x5C31;&amp;#x6765;&amp;#x5206;&amp;#x6790;&amp;#x4E00;&amp;#x4E0B;PGLog&amp;#x7684;&amp;#x5B58;&amp;#x50A8;&amp;#x65B9;&amp;#x5F0F;&amp;#x3002;&amp;#x5728;ceph&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;&amp;#x91CC;&amp;#xFF0C;&amp;#x5BF9;&amp;#x4E8E;&amp;#x5199;I/O&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x90FD;&amp;#x662F;&amp;#x5148;&amp;#x5C01;&amp;#x88C5;&amp;#x6210;&amp;#x4E00;&amp;#x4E2A;transaction&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5C06;&amp;#x8FD9;&amp;#x4E2A;transaction&amp;#x5199;&amp;#x5230;journal&amp;#x91CC;&amp;#xFF0C;&amp;#x5728;journal&amp;#x5199;&amp;#x5B8C;&amp;#x6210;&amp;#x540E;&amp;#xFF0C;&amp;#x89E6;&amp;#x53D1;&amp;#x56DE;&amp;#x8C03;&amp;#x6D41;&amp;#x7A0B;&amp;#xFF0C;&amp;#x7ECF;&amp;#x8FC7;&amp;#x591A;&amp;#x4E2A;&amp;#x7EBF;&amp;#x7A0B;&amp;#x53CA;&amp;#x56DE;&amp;#x8C03;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x540E;&amp;#x518D;&amp;#x8FDB;&amp;#x884C;&amp;#x5199;&amp;#x6570;&amp;#x636E;&amp;#x5230;buffer cache&amp;#x7684;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;&amp;#x5B8C;&amp;#x6210;&amp;#x6574;&amp;#x4E2A;&amp;#x5199;journal&amp;#x548C;&amp;#x5199;&amp;#x672C;&amp;#x5730;&amp;#x7F13;&amp;#x5B58;&amp;#x7684;&amp;#x6D41;&amp;#x7A0B;&amp;#xFF08;&amp;#x5177;&amp;#x4F53;&amp;#x7684;&amp;#x6D41;&amp;#x7A0B;&amp;#x5728;&amp;#x300A;OSD&amp;#x8BFB;&amp;#x5199;&amp;#x5904;&amp;#x7406;&amp;#x6D41;&amp;#x7A0B;&amp;#x300B;&amp;#x4E00;&amp;#x6587;&amp;#x4E2D;&amp;#x6709;&amp;#x8BE6;&amp;#x7EC6;&amp;#x63CF;&amp;#x8FF0;&amp;#xFF09;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x603B;&amp;#x4F53;&amp;#x6765;&amp;#x8BF4;&amp;#xFF0C;PGLog&amp;#x4E5F;&amp;#x662F;&amp;#x5C01;&amp;#x88C5;&amp;#x5230;transaction&amp;#x4E2D;&amp;#xFF0C;&amp;#x5728;&amp;#x5199;journal&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x4E00;&amp;#x8D77;&amp;#x5199;&amp;#x5230;&amp;#x65E5;&amp;#x5FD7;&amp;#x76D8;&amp;#x4E0A;&amp;#xFF0C;&amp;#x6700;&amp;#x540E;&amp;#x5728;&amp;#x5199;&amp;#x672C;&amp;#x5730;&amp;#x7F13;&amp;#x5B58;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x904D;&amp;#x5386;transaction&amp;#x91CC;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#xFF0C;&amp;#x5C06;PGLog&amp;#x76F8;&amp;#x5173;&amp;#x7684;&amp;#x4E1C;&amp;#x897F;&amp;#x5199;&amp;#x5230;Leveldb&amp;#x91CC;&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;&amp;#x5B8C;&amp;#x6210;&amp;#x8BE5;OSD&amp;#x4E0A;PGLog&amp;#x7684;&amp;#x66F4;&amp;#x65B0;&amp;#x64CD;&amp;#x4F5C;&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;2-1-PGLog&amp;#x66F4;&amp;#x65B0;&amp;#x5230;journal&quot;&gt;&lt;a href=&quot;#2-1-PGLog&amp;#x66F4;&amp;#x65B0;&amp;#x5230;journal&quot; class=&quot;headerlink&quot; title=&quot;2.1 PGLog&amp;#x66F4;&amp;#x65B0;&amp;#x5230;journal&quot;&gt;&lt;/a&gt;2.1 PGLog&amp;#x66F4;&amp;#x65B0;&amp;#x5230;journal&lt;/h2&gt;&lt;h3 id=&quot;2-1-1-&amp;#x5199;I-O&amp;#x5E8F;&amp;#x5217;&amp;#x5316;&amp;#x5230;transaction&quot;&gt;&lt;a href=&quot;#2-1-1-&amp;#x5199;I-O&amp;#x5E8F;&amp;#x5217;&amp;#x5316;&amp;#x5230;transaction&quot; class=&quot;headerlink&quot; title=&quot;2.1.1 &amp;#x5199;I/O&amp;#x5E8F;&amp;#x5217;&amp;#x5316;&amp;#x5230;transaction&quot;&gt;&lt;/a&gt;2.1.1 &amp;#x5199;I/O&amp;#x5E8F;&amp;#x5217;&amp;#x5316;&amp;#x5230;transaction&lt;/h3&gt;&lt;p&gt;&amp;#x5728;&amp;#x300A;OSD&amp;#x8BFB;&amp;#x5199;&amp;#x6D41;&amp;#x7A0B;&amp;#x300B;&amp;#x91CC;&amp;#x63CF;&amp;#x8FF0;&amp;#x4E86;&amp;#x4E3B;OSD&amp;#x4E0A;&amp;#x7684;&amp;#x8BFB;&amp;#x5199;&amp;#x5904;&amp;#x7406;&amp;#x6D41;&amp;#x7A0B;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x5C31;&amp;#x4E0D;&amp;#x505A;&amp;#x8BF4;&amp;#x660E;&amp;#x3002;&amp;#x5728;ReplicatedPG::do_osd_ops&amp;#x51FD;&amp;#x6570;&amp;#x91CC;&amp;#x6839;&amp;#x636E;&amp;#x7C7B;&amp;#x578B;CEPH_OSD_OP_WRITE&amp;#x5C31;&amp;#x4F1A;&amp;#x8FDB;&amp;#x884C;&amp;#x5C01;&amp;#x88C5;&amp;#x5199;I/O&amp;#x5230;transaction&amp;#x7684;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF08;&amp;#x5373;&amp;#x5C06;&amp;#x8981;&amp;#x5199;&amp;#x7684;&amp;#x6570;&amp;#x636E;encode&amp;#x5230;ObjectStore::Transaction::tbl&amp;#x91CC;&amp;#xFF0C;&amp;#x8FD9;&amp;#x662F;&amp;#x4E2A;bufferlist&amp;#xFF0C;encode&amp;#x65F6;&amp;#x90FD;&amp;#x5148;&amp;#x5C06;op&amp;#x7F16;&amp;#x7801;&amp;#x8FDB;&amp;#x53BB;&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;&amp;#x540E;&amp;#x7EED;&amp;#x5728;&amp;#x5904;&amp;#x7406;&amp;#x65F6;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x6839;&amp;#x636E;op&amp;#x6765;&amp;#x64CD;&amp;#x4F5C;&amp;#x3002;&amp;#x6CE8;&amp;#x610F;&amp;#x8FD9;&amp;#x91CC;&amp;#x7684;encode&amp;#x5176;&amp;#x5B9E;&amp;#x5C31;&amp;#x662F;&amp;#x5E8F;&amp;#x5217;&amp;#x5316;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF09;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x8FD9;&amp;#x4E2A;transaction&amp;#x7ECF;&amp;#x8FC7;&amp;#x7684;&amp;#x8FC7;&amp;#x7A0B;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;br&gt;&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;ReplicatedPG::OpContext::&lt;span class=&quot;keyword&quot;&gt;op_t&lt;/span&gt;  &amp;#x2013;&amp;gt;  PGBackend::PGTransaction::write&amp;#xFF08;&amp;#x5373;t-&amp;gt;write&amp;#xFF09; &amp;#x2013;&amp;gt;  RPGTransaction::write  &amp;#x2013;&amp;gt; ObjectStore::Transaction::write&amp;#xFF08;encode&amp;#x5230;ObjectStore::Transaction::tbl&amp;#xFF09; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#x540E;&amp;#x9762;&amp;#x8C03;&amp;#x7528;ReplicatedBackend::submit_transaction&amp;#x65F6;&amp;#x4F20;&amp;#x5165;&amp;#x7684;PGTransaction *&lt;span class=&quot;keyword&quot;&gt;_t&lt;/span&gt;&amp;#x5C31;&amp;#x662F;&amp;#x4E0A;&amp;#x9762;&amp;#x8FD9;&amp;#x4E2A;&amp;#xFF0C;&amp;#x901A;&amp;#x8FC7;&amp;#x8F6C;&amp;#x6362;&amp;#x6210;RPGTransaction *t&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x91CC;&amp;#x7528;&amp;#x5230;&amp;#x7684;ObjectStore::Transaction *&lt;span class=&quot;keyword&quot;&gt;op_t&lt;/span&gt;&amp;#x5C31;&amp;#x662F;&amp;#x5BF9;&amp;#x5E94;&amp;#x5230;RPGTransaction&amp;#x91CC;&amp;#x7684;ObjectStore::Transaction *t&amp;#x3002;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&quot;2-1-2-PGLog&amp;#x5E8F;&amp;#x5217;&amp;#x5316;&amp;#x5230;transaction&quot;&gt;&lt;a href=&quot;#2-1-2-PGLog&amp;#x5E8F;&amp;#x5217;&amp;#x5316;&amp;#x5230;transaction&quot; class=&quot;headerlink&quot; title=&quot;2.1.2 PGLog&amp;#x5E8F;&amp;#x5217;&amp;#x5316;&amp;#x5230;transaction&quot;&gt;&lt;/a&gt;2.1.2 PGLog&amp;#x5E8F;&amp;#x5217;&amp;#x5316;&amp;#x5230;transaction&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&amp;#x5728;ReplicatedPG::prepare_transaction&amp;#x91CC;&amp;#x8C03;&amp;#x7528;ReplicatedPG::finish_ctx&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5728;finish_ctx&amp;#x51FD;&amp;#x6570;&amp;#x91CC;&amp;#x5C31;&amp;#x4F1A;&amp;#x8C03;&amp;#x7528;ctx-&amp;gt;log.push_back&amp;#x5C31;&amp;#x4F1A;&amp;#x6784;&amp;#x9020;pg_log_entry_t&amp;#x63D2;&amp;#x5165;&amp;#x5230;vector log&amp;#x91CC;&amp;#xFF1B;&lt;/li&gt;
&lt;li&gt;&amp;#x5728;ReplicatedBackend::submit_transaction&amp;#x91CC;&amp;#x8C03;&amp;#x7528;parent-&amp;gt;log_operation&amp;#x5C06;PGLog&amp;#x5E8F;&amp;#x5217;&amp;#x5316;&amp;#x5230;transaction&amp;#x91CC;&amp;#x3002;&amp;#x5728;PG::append_log&amp;#x91CC;&amp;#x5C06;PGLog&amp;#x76F8;&amp;#x5173;&amp;#x4FE1;&amp;#x606F;&amp;#x5E8F;&amp;#x5217;&amp;#x5316;&amp;#x5230;transaction&amp;#x91CC;&amp;#x3002;&lt;/li&gt;
&lt;li&gt;&amp;#x4E3B;&amp;#x8981;&amp;#x5E8F;&amp;#x5217;&amp;#x5316;&amp;#x5230;transaction&amp;#x91CC;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#x5305;&amp;#x62EC;&amp;#xFF1A;pg_info_t&amp;#xFF0C;pg_log_entry_t&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E24;&amp;#x79CD;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#x90FD;&amp;#x662F;&amp;#x4EE5;map&lt;string, bufferlist=&quot;&quot;&gt;&amp;#x7684;&amp;#x5F62;&amp;#x5F0F;encode&amp;#x5230;transaction&amp;#x7684;bufferlist&amp;#x91CC;&amp;#x3002;&amp;#x5176;&amp;#x4E2D;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;map&amp;#x7684;value&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x5C31;&amp;#x662F;pg_info&amp;#x548C;pg_log_entry&amp;#x7684;bufferlist&amp;#x3002;&amp;#x800C;map&amp;#x7684;key&amp;#x5C31;&amp;#x662F;epoch+version&amp;#x6784;&amp;#x6210;&amp;#x7684;&amp;#x5B57;&amp;#x7B26;&amp;#x4E32;&amp;#x201D;epoch.version&amp;#x201D;&amp;#x3002;&amp;#x53E6;&amp;#x5916;&amp;#x9700;&amp;#x8981;&amp;#x6CE8;&amp;#x610F;&amp;#x7684;&amp;#x662F;&amp;#x8FD9;&amp;#x4E9B;map&amp;#x662F;&amp;#x9644;&amp;#x5E26;&amp;#x4E0A;op&amp;#x548C;oid&amp;#x4F5C;&amp;#x4E3A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;omap&amp;#xFF08;Object&amp;#x7684;&amp;#x5C5E;&amp;#x6027;&amp;#x4F1A;&amp;#x5229;&amp;#x7528;&amp;#x6587;&amp;#x4EF6;&amp;#x7684;xattr&amp;#x5C5E;&amp;#x6027;&amp;#x5B58;&amp;#x53D6;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x6709;&amp;#x4E9B;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x5BF9;xattr&amp;#x7684;&amp;#x957F;&amp;#x5EA6;&amp;#x6709;&amp;#x9650;&amp;#x5236;&amp;#xFF0C;&amp;#x56E0;&amp;#x6B64;&amp;#x8D85;&amp;#x51FA;&amp;#x957F;&amp;#x5EA6;&amp;#x7684;Metadata&amp;#x4F1A;&amp;#x88AB;&amp;#x5B58;&amp;#x50A8;&amp;#x5728;DBObjectMap&amp;#x91CC;&amp;#x3002;&amp;#x800C;Object&amp;#x7684;omap&amp;#x5219;&amp;#x76F4;&amp;#x63A5;&amp;#x5229;&amp;#x7528;DBObjectMap&amp;#x5B9E;&amp;#x73B0;&amp;#x3002;&amp;#xFF09;&amp;#x6765;&amp;#x5E8F;&amp;#x5217;&amp;#x5316;&amp;#x5230;transaction&amp;#x91CC;&amp;#xFF1B;&lt;/string,&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;2-1-3-Transaction&amp;#x91CC;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&quot;&gt;&lt;a href=&quot;#2-1-3-Transaction&amp;#x91CC;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&quot; class=&quot;headerlink&quot; title=&quot;2.1.3 Transaction&amp;#x91CC;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&quot;&gt;&lt;/a&gt;2.1.3 Transaction&amp;#x91CC;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&lt;/h3&gt;&lt;p&gt;&amp;#x4ECE;&amp;#x4E0A;&amp;#x9762;&amp;#x7684;&amp;#x5206;&amp;#x6790;&amp;#x5F97;&amp;#x77E5;&amp;#xFF0C;&amp;#x5199;I/O&amp;#x548C;PGLog&amp;#x90FD;&amp;#x4F1A;&amp;#x5E8F;&amp;#x5217;&amp;#x5316;&amp;#x5230;transaction&amp;#x91CC;&amp;#x7684;bufferlist&amp;#x91CC;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x5C31;&amp;#x5BF9;&amp;#x8FD9;&amp;#x4E2A;bufferlist&amp;#x91CC;&amp;#x7684;&amp;#x4E3B;&amp;#x8981;&amp;#x5185;&amp;#x5BB9;&amp;#x4EE5;&amp;#x56FE;&amp;#x7684;&amp;#x5F62;&amp;#x5F0F;&amp;#x5C55;&amp;#x793A;&amp;#x51FA;&amp;#x6765;&amp;#x3002;transaction&amp;#x7684;bufflist&amp;#x91CC;&amp;#x5C31;&amp;#x662F;&amp;#x6309;&amp;#x7167;&amp;#x64CD;&amp;#x4F5C;&amp;#x7C7B;&amp;#x578B;op&amp;#x6765;&amp;#x5E8F;&amp;#x5217;&amp;#x5316;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#xFF0C;&amp;#x5982;OP_WRITE&amp;#x8868;&amp;#x793A;&amp;#x5199;I/O&amp;#xFF0C;&amp;#x800C;OP_OMAP&lt;em&gt;SETKEYS&amp;#x5C31;&amp;#x8868;&amp;#x793A;&amp;#x8BBE;&amp;#x7F6E;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;omap&amp;#xFF0C;&amp;#x5176;&amp;#x4E2D;&amp;#x7684;attrset&amp;#x5C31;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;kv&amp;#x7684;map&amp;#x3002; &amp;#x6CE8;&amp;#x610F;&amp;#x8FD9;&amp;#x91CC;&amp;#x9762;&amp;#x7684;oid&amp;#xFF0C;&amp;#x5BF9;&amp;#x4E8E;pglog&amp;#x6765;&amp;#x8BF4;&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;pg&amp;#x5728;&amp;#x521B;&amp;#x5EFA;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x5C31;&amp;#x4F1A;&amp;#x751F;&amp;#x6210;&amp;#x4E00;&amp;#x4E2A;logoid&amp;#xFF0C;&amp;#x4F1A;&amp;#x52A0;&amp;#x4E0A;pglog&lt;/em&gt;&lt;pgid&gt;&amp;#x6784;&amp;#x9020;&amp;#x7684;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x5BF9;&amp;#x4E8E;pginfo&amp;#x6765;&amp;#x8BF4;&amp;#xFF0C;&amp;#x662F;pginfo_&lt;pgid&gt;&amp;#x6784;&amp;#x9020;&amp;#x7684;&amp;#x4E00;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x800C;&amp;#x5BF9;&amp;#x4E8E;&amp;#x771F;&amp;#x6B63;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x5BF9;&amp;#x8C61;&amp;#x6765;&amp;#x8BF4;&amp;#xFF0C;attrset&amp;#x5C31;&amp;#x662F;&amp;#x5176;&amp;#x5C5E;&amp;#x6027;&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2015/12/18/ceph-pglog/trans.png&quot; alt=&quot;trans&quot;&gt;&lt;/pgid&gt;&lt;/pgid&gt;&lt;/p&gt;
&lt;h3 id=&quot;2-1-4-Trim-Log&quot;&gt;&lt;a href=&quot;#2-1-4-Trim-Log&quot; class=&quot;headerlink&quot; title=&quot;2.1.4 Trim Log&quot;&gt;&lt;/a&gt;2.1.4 Trim Log&lt;/h3&gt;&lt;p&gt;&amp;#x524D;&amp;#x9762;&amp;#x8BF4;&amp;#x5230;PGLog&amp;#x7684;&amp;#x8BB0;&amp;#x5F55;&amp;#x6570;&amp;#x662F;&amp;#x6709;&amp;#x9650;&amp;#x5236;&amp;#x7684;&amp;#xFF0C;&amp;#x6B63;&amp;#x5E38;&amp;#x60C5;&amp;#x51B5;&amp;#x662F;&amp;#x9ED8;&amp;#x8BA4;&amp;#x662F;3000&amp;#x6761;&amp;#xFF08;&amp;#x7531;&amp;#x53C2;&amp;#x6570;osd_min_pg_log_entries&amp;#x63A7;&amp;#x5236;&amp;#xFF09;&amp;#xFF0C;PG&amp;#x964D;&amp;#x7EA7;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;&amp;#x9ED8;&amp;#x8BA4;&amp;#x589E;&amp;#x52A0;&amp;#x5230;10000&amp;#x6761;&amp;#xFF08;&amp;#x7531;&amp;#x53C2;&amp;#x6570;osd_max_pg_log_entries&amp;#x63A7;&amp;#x5236;&amp;#xFF09;&amp;#x3002;&amp;#x5F53;&amp;#x8FBE;&amp;#x5230;&amp;#x9650;&amp;#x5236;&amp;#x65F6;&amp;#xFF0C;&amp;#x5C31;&amp;#x4F1A;trim log&amp;#x8FDB;&amp;#x884C;&amp;#x622A;&amp;#x65AD;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x5728;ReplicatedPG::execute_ctx&amp;#x91CC;&amp;#x8C03;&amp;#x7528;ReplicatedPG::calc_trim_to&amp;#x6765;&amp;#x8FDB;&amp;#x884C;&amp;#x8BA1;&amp;#x7B97;&amp;#x3002;&amp;#x8BA1;&amp;#x7B97;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x4ECE;log&amp;#x7684;tail&amp;#xFF08;tail&amp;#x6307;&amp;#x5411;&amp;#x6700;&amp;#x8001;&amp;#x7684;&amp;#x8BB0;&amp;#x5F55;&amp;#xFF09;&amp;#x5F00;&amp;#x59CB;&amp;#xFF0C;&amp;#x9700;&amp;#x8981;trim&amp;#x7684;&amp;#x6761;&amp;#x6570;=log.head-log.tail-max_entries&amp;#x3002;&amp;#x4F46;&amp;#x662F;trim&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x9700;&amp;#x8981;&amp;#x8003;&amp;#x8651;&amp;#x5230;min_last_complete_ondisk&amp;#xFF08;&amp;#x8FD9;&amp;#x4E2A;&amp;#x8868;&amp;#x793A;&amp;#x5404;&amp;#x4E2A;&amp;#x526F;&amp;#x672C;&amp;#x4E0A;last_complete&amp;#x7684;&amp;#x6700;&amp;#x5C0F;&amp;#x7248;&amp;#x672C;&amp;#xFF0C;&amp;#x662F;&amp;#x4E3B;osd&amp;#x5728;&amp;#x6536;&amp;#x5230;3&amp;#x526F;&amp;#x672C;&amp;#x90FD;&amp;#x5B8C;&amp;#x6210;&amp;#x65F6;&amp;#x518D;&amp;#x8FDB;&amp;#x884C;&amp;#x8BA1;&amp;#x7B97;&amp;#x7684;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x8BA1;&amp;#x7B97;last_complete_ondisk&amp;#x548C;&amp;#x5176;&amp;#x4ED6;&amp;#x526F;&amp;#x672C;osd&amp;#x4E0A;&amp;#x7684;last_complete_ondisk&amp;#x2013;&amp;#x5373;peer_last_complete_ondisk&amp;#x7684;&amp;#x6700;&amp;#x5C0F;&amp;#x503C;&amp;#x5F97;&amp;#x5230;min_last_complete_ondisk&amp;#xFF09;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x8BF4;trim&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x4E0D;&amp;#x80FD;&amp;#x8D85;&amp;#x8FC7;min_last_complete_ondisk&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x8D85;&amp;#x8FC7;&amp;#x4E86;&amp;#x7684;&amp;#x4E5F;trim&amp;#x6389;&amp;#x7684;&amp;#x8BDD;&amp;#x5C31;&amp;#x4F1A;&amp;#x5BFC;&amp;#x81F4;&amp;#x6CA1;&amp;#x6709;&amp;#x66F4;&amp;#x65B0;&amp;#x5230;&amp;#x78C1;&amp;#x76D8;&amp;#x4E0A;&amp;#x7684;pg log&amp;#x4E22;&amp;#x5931;&amp;#x3002;&amp;#x6240;&amp;#x4EE5;&amp;#x8BF4;&amp;#x53EF;&amp;#x80FD;&amp;#x5B58;&amp;#x5728;&amp;#x67D0;&amp;#x4E2A;&amp;#x65F6;&amp;#x5019;pglog&amp;#x7684;&amp;#x8BB0;&amp;#x5F55;&amp;#x6570;&amp;#x8D85;&amp;#x8FC7;max_entries&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2015/12/18/ceph-pglog/trim_log.png&quot; alt=&quot;trim_log&quot;&gt;&lt;br&gt;&amp;#x5728;ReplicatedPG::log_operation&amp;#x91CC;&amp;#x7684;trim_to&amp;#x5C31;&amp;#x662F;pg_trim_to&amp;#xFF0C;trim_rollback_to&amp;#x5C31;&amp;#x662F;min_last_complete_on_disk&amp;#x3002;log_operation&amp;#x91CC;&amp;#x8C03;&amp;#x7528;pg_log.trim(&amp;amp;handler, trim_to, info)&amp;#x8FDB;&amp;#x884C;trim&amp;#xFF0C;&amp;#x4F1A;&amp;#x5C06;&amp;#x9700;&amp;#x8981;trim&amp;#x7684;key&amp;#x52A0;&amp;#x5165;&amp;#x5230;PGLog::trimmed&amp;#x8FD9;&amp;#x4E2A;set&amp;#x91CC;&amp;#x3002;&amp;#x7136;&amp;#x540E;&amp;#x5728;_write_log&amp;#x91CC;&amp;#x5C06;trimmed&amp;#x91CC;&amp;#x63D2;&amp;#x5165;&amp;#x5230;to_remove&amp;#x91CC;&amp;#xFF0C;&amp;#x6700;&amp;#x540E;&amp;#x5728;&amp;#x8C03;&amp;#x7528;t.omap_rmkeys&amp;#x5E8F;&amp;#x5217;&amp;#x5316;&amp;#x5230;transaction&amp;#x7684;bufferlist&amp;#x91CC;&amp;#x3002;&lt;/p&gt;
&lt;h3 id=&quot;2-1-5-PGLog&amp;#x5199;&amp;#x5230;journal&amp;#x76D8;&quot;&gt;&lt;a href=&quot;#2-1-5-PGLog&amp;#x5199;&amp;#x5230;journal&amp;#x76D8;&quot; class=&quot;headerlink&quot; title=&quot;2.1.5 PGLog&amp;#x5199;&amp;#x5230;journal&amp;#x76D8;&quot;&gt;&lt;/a&gt;2.1.5 PGLog&amp;#x5199;&amp;#x5230;journal&amp;#x76D8;&lt;/h3&gt;&lt;p&gt;PGLog&amp;#x5199;&amp;#x5230;journal&amp;#x76D8;&amp;#x4E0A;&amp;#x5C31;&amp;#x662F;&amp;#x5199;journal&amp;#x4E00;&amp;#x6837;&amp;#x7684;&amp;#x6D41;&amp;#x7A0B;&amp;#xFF0C;&amp;#x5177;&amp;#x4F53;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&amp;#x5728;ReplicatedBackend::submit_transaction&amp;#x8C03;&amp;#x7528;log_operation&amp;#x5C06;PGLog&amp;#x5E8F;&amp;#x5217;&amp;#x5316;&amp;#x5230;transaction&amp;#x91CC;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x8C03;&amp;#x7528;queue_transaction&amp;#x5C06;&amp;#x8FD9;&amp;#x4E2A;transaction&amp;#x4F20;&amp;#x5230;&amp;#x540E;&amp;#x7EED;&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#xFF1B;&lt;/li&gt;
&lt;li&gt;&amp;#x8C03;&amp;#x7528;&amp;#x5230;&amp;#x4E86;FileStore::queue_transactions&amp;#x91CC;&amp;#xFF0C;&amp;#x5C31;&amp;#x5C06;list&lt;transaction*&gt;&amp;#x6784;&amp;#x9020;&amp;#x6210;&amp;#x4E00;&amp;#x4E2A;FileStore::Op&amp;#xFF0C;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;list&lt;transaction*&gt;&amp;#x653E;&amp;#x5230;FileStore::Op::tls&amp;#x91CC;&amp;#xFF1B;&lt;/transaction*&gt;&lt;/transaction*&gt;&lt;/li&gt;
&lt;li&gt;&amp;#x63A5;&amp;#x7740;&amp;#x5728;JournalingObjectStore::_op_journal_transactions&amp;#x51FD;&amp;#x6570;&amp;#x91CC;&amp;#x904D;&amp;#x5386;list&lt;objectstore::transaction*&gt;&amp;amp; tls&amp;#xFF0C;&amp;#x5C06;ObjectStore::Transaction encode&amp;#x5230;&amp;#x4E00;&amp;#x4E2A;bufferlist&amp;#x91CC;&amp;#xFF08;&amp;#x8BB0;&amp;#x4E3A;tbl&amp;#xFF09;&amp;#xFF1B;&lt;/objectstore::transaction*&gt;&lt;/li&gt;
&lt;li&gt;&amp;#x7136;&amp;#x540E;FileJournal::submit_entry&amp;#x91CC;&amp;#x5C06;bufferlist&amp;#x6784;&amp;#x9020;&amp;#x6210;write_item&amp;#x653E;&amp;#x5230;writeq&amp;#xFF1B;&lt;/li&gt;
&lt;li&gt;&amp;#x63A5;&amp;#x7740;&amp;#x5728;FileJournal::write_thread_entry&amp;#x4F1A;&amp;#x4ECE;writeq&amp;#x91CC;&amp;#x53D6;&amp;#x51FA;write_item&amp;#xFF0C;&amp;#x653E;&amp;#x5230;&amp;#x53E6;&amp;#x5916;&amp;#x4E00;&amp;#x4E2A;bufferlist&amp;#x91CC;&amp;#xFF1B;&lt;/li&gt;
&lt;li&gt;&amp;#x6700;&amp;#x540E;&amp;#x8C03;&amp;#x7528;do_aio_write&amp;#x5C06;bufferlist&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#x5F02;&amp;#x6B65;&amp;#x5199;&amp;#x5230;&amp;#x78C1;&amp;#x76D8;&amp;#x4E0A;&amp;#xFF08;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x5199;journal&amp;#xFF09;&amp;#xFF1B;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;2-2-PGLog&amp;#x5199;&amp;#x5165;leveldb&quot;&gt;&lt;a href=&quot;#2-2-PGLog&amp;#x5199;&amp;#x5165;leveldb&quot; class=&quot;headerlink&quot; title=&quot;2.2 PGLog&amp;#x5199;&amp;#x5165;leveldb&quot;&gt;&lt;/a&gt;2.2 PGLog&amp;#x5199;&amp;#x5165;leveldb&lt;/h2&gt;&lt;p&gt;&amp;#x5728;&amp;#x300A;OSD&amp;#x8BFB;&amp;#x5199;&amp;#x6D41;&amp;#x7A0B;&amp;#x300B;&amp;#x91CC;&amp;#x63CF;&amp;#x8FF0;&amp;#x5230;&amp;#x662F;&amp;#x5728;FileStore::_do_op&amp;#x91CC;&amp;#x8FDB;&amp;#x884C;&amp;#x5199;&amp;#x6570;&amp;#x636E;&amp;#x5230;&amp;#x672C;&amp;#x5730;&amp;#x7F13;&amp;#x5B58;&amp;#x7684;&amp;#x64CD;&amp;#x4F5C;&amp;#x3002;&amp;#x5C06;pglog&amp;#x5199;&amp;#x5165;&amp;#x5230;leveldb&amp;#x91CC;&amp;#x7684;&amp;#x64CD;&amp;#x4F5C;&amp;#x4E5F;&amp;#x662F;&amp;#x4ECE;&amp;#x8FD9;&amp;#x91CC;&amp;#x51FA;&amp;#x53D1;&amp;#x7684;&amp;#xFF0C;&amp;#x4F1A;&amp;#x6839;&amp;#x636E;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;op&amp;#x7C7B;&amp;#x578B;&amp;#x6765;&amp;#x8FDB;&amp;#x884C;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x64CD;&amp;#x4F5C;&amp;#x3002;&lt;br&gt;&amp;#x6BD4;&amp;#x5982;OP_OMAP_SETKEYS&amp;#xFF08;PGLog&amp;#x5199;&amp;#x5165;leveldb&amp;#x5C31;&amp;#x662F;&amp;#x6839;&amp;#x636E;&amp;#x8FD9;&amp;#x4E2A;key&amp;#xFF09;&amp;#xFF1A;&lt;br&gt;&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;FileStore::_do_op --&amp;gt; FileStore::_do_transactions --&amp;gt; FileStore::_do_transaction &amp;#x6839;&amp;#x636E;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;Transaction&amp;#x7C7B;&amp;#x578B;&amp;#x6765;&amp;#x8FDB;&amp;#x884C;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x64CD;&amp;#x4F5C; --&amp;gt; &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; Transaction::OP_OMAP_SETKEYS --&amp;gt; FileStore::_omap_setkeys --&amp;gt; object_map-&amp;gt;rm_keys&amp;#xFF0C;&amp;#x5373;DBObjectMap::set_keys --&amp;gt; KeyValueDB::TransactionImpl::&lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt;&amp;#xFF0C;&amp;#x904D;&amp;#x5386;&lt;span class=&quot;built_in&quot;&gt;map&lt;/span&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;string&lt;/span&gt;, bufferlist&amp;gt;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x8C03;&amp;#x7528;&lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt;(prefix, it-&amp;gt;first, it-&amp;gt;second)&amp;#xFF0C;&amp;#x5373;&amp;#x8C03;&amp;#x7528;&amp;#x5230;LevelDBStore::LevelDBTransactionImpl::&lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; --&amp;gt; &amp;#x6700;&amp;#x540E;&amp;#x8C03;&amp;#x7528;db-&amp;gt;submit_transaction&amp;#x63D0;&amp;#x4EA4;&amp;#x4E8B;&amp;#x52A1;&amp;#x5199;&amp;#x5230;&amp;#x76D8;&amp;#x4E0A;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x518D;&amp;#x6BD4;&amp;#x5982;&amp;#x4EE5;OP_OMAP_RMKEYS&amp;#xFF08;trim pglog&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x5C31;&amp;#x662F;&amp;#x7528;&amp;#x5230;&amp;#x4E86;&amp;#x8FD9;&amp;#x4E2A;key&amp;#xFF09;&amp;#x4E3A;&amp;#x4F8B;&amp;#xFF1A;&lt;br&gt;&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;FileStore::_do_op --&amp;gt; FileStore::_do_transactions --&amp;gt; FileStore::_do_transaction &amp;#x6839;&amp;#x636E;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;Transaction&amp;#x7C7B;&amp;#x578B;&amp;#x6765;&amp;#x8FDB;&amp;#x884C;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x64CD;&amp;#x4F5C; --&amp;gt; &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; Transaction::OP_OMAP_RMKEYS --&amp;gt; FileStore::_omap_rmkeys --&amp;gt; object_map-&amp;gt;rm_keys&amp;#xFF0C;&amp;#x540E;&amp;#x9762;&amp;#x5C31;&amp;#x662F;&amp;#x8C03;&amp;#x7528;&amp;#x5230;LevelDB&amp;#x91CC;&amp;#x7684;rm_keys&amp;#x53BB;&amp;#x5220;&amp;#x9664;keys&amp;#x3002;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;PGLog&amp;#x5C01;&amp;#x88C5;&amp;#x5230;transaction&amp;#x91CC;&amp;#x9762;&amp;#x548C;journal&amp;#x4E00;&amp;#x8D77;&amp;#x5199;&amp;#x5230;&amp;#x76D8;&amp;#x4E0A;&amp;#x7684;&amp;#x597D;&amp;#x5904;&amp;#xFF1A;&amp;#x5982;&amp;#x679C;osd&amp;#x5F02;&amp;#x5E38;&amp;#x5D29;&amp;#x6E83;&amp;#x65F6;&amp;#xFF0C;journal&amp;#x5199;&amp;#x5B8C;&amp;#x6210;&amp;#x4E86;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x6570;&amp;#x636E;&amp;#x6709;&amp;#x53EF;&amp;#x80FD;&amp;#x6CA1;&amp;#x6709;&amp;#x5199;&amp;#x5230;&amp;#x78C1;&amp;#x76D8;&amp;#x4E0A;&amp;#xFF0C;&amp;#x76F8;&amp;#x5E94;&amp;#x7684;pg log&amp;#x4E5F;&amp;#x6CA1;&amp;#x6709;&amp;#x5199;&amp;#x5230;leveldb&amp;#x91CC;&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;&amp;#x5728;osd&amp;#x518D;&amp;#x542F;&amp;#x52A8;&amp;#x8D77;&amp;#x6765;&amp;#x65F6;&amp;#xFF0C;&amp;#x5C31;&amp;#x4F1A;&amp;#x8FDB;&amp;#x884C;journal replay&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;&amp;#x4ECE;journal&amp;#x91CC;&amp;#x5C31;&amp;#x80FD;&amp;#x8BFB;&amp;#x51FA;&amp;#x5B8C;&amp;#x6574;&amp;#x7684;transaction&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x518D;&amp;#x8FDB;&amp;#x884C;&amp;#x4E8B;&amp;#x52A1;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x5C06;&amp;#x6570;&amp;#x636E;&amp;#x5199;&amp;#x5230;&amp;#x76D8;&amp;#x4E0A;&amp;#xFF0C;pglog&amp;#x5199;&amp;#x5230;leveldb&amp;#x91CC;&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;3-PGLog&amp;#x5982;&amp;#x4F55;&amp;#x53C2;&amp;#x4E0E;&amp;#x6062;&amp;#x590D;&quot;&gt;&lt;a href=&quot;#3-PGLog&amp;#x5982;&amp;#x4F55;&amp;#x53C2;&amp;#x4E0E;&amp;#x6062;&amp;#x590D;&quot; class=&quot;headerlink&quot; title=&quot;3. PGLog&amp;#x5982;&amp;#x4F55;&amp;#x53C2;&amp;#x4E0E;&amp;#x6062;&amp;#x590D;&quot;&gt;&lt;/a&gt;3. PGLog&amp;#x5982;&amp;#x4F55;&amp;#x53C2;&amp;#x4E0E;&amp;#x6062;&amp;#x590D;&lt;/h1&gt;&lt;p&gt;PGLog&amp;#x53C2;&amp;#x4E0E;&amp;#x6062;&amp;#x590D;&amp;#x4E3B;&amp;#x8981;&amp;#x4F53;&amp;#x73B0;&amp;#x5728;ceph&amp;#x8FDB;&amp;#x884C;peering&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x5EFA;&amp;#x7ACB;missing&amp;#x5217;&amp;#x8868;&amp;#x6765;&amp;#x6807;&amp;#x8BB0;&amp;#x8FC7;&amp;#x65F6;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x4EE5;&amp;#x4FBF;&amp;#x4E8E;&amp;#x8FDB;&amp;#x884C;&amp;#x5BF9;&amp;#x8FD9;&amp;#x4E9B;&amp;#x6570;&amp;#x636E;&amp;#x8FDB;&amp;#x884C;&amp;#x4FEE;&amp;#x590D;&amp;#x3002;&lt;br&gt;&amp;#x6545;&amp;#x969C;&amp;#x7684;OSD&amp;#x91CD;&amp;#x65B0;&amp;#x4E0A;&amp;#x7EBF;&amp;#x540E;&amp;#xFF0C;PG&amp;#x5C31;&amp;#x4F1A;&amp;#x6807;&amp;#x8BB0;&amp;#x4E3A;peering&amp;#x72B6;&amp;#x6001;&amp;#x5E76;&amp;#x6682;&amp;#x505C;&amp;#x5904;&amp;#x7406;&amp;#x8BF7;&amp;#x6C42;&amp;#x3002;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&amp;#x5BF9;&amp;#x4E8E;&amp;#x6545;&amp;#x969C;OSD&amp;#x6240;&amp;#x62E5;&amp;#x6709;&amp;#x7684;Primary PG &lt;ul&gt;
&lt;li&gt;&amp;#x5B83;&amp;#x4F5C;&amp;#x4E3A;&amp;#x8FD9;&amp;#x90E8;&amp;#x5206;&amp;#x6570;&amp;#x636E;&amp;#x201D;&amp;#x6743;&amp;#x8D23;&amp;#x201D;&amp;#x4E3B;&amp;#x4F53;&amp;#xFF0C;&amp;#x9700;&amp;#x8981;&amp;#x53D1;&amp;#x9001;&amp;#x67E5;&amp;#x8BE2; PG &amp;#x5143;&amp;#x6570;&amp;#x636E;&amp;#x8BF7;&amp;#x6C42;&amp;#x7ED9;&amp;#x6240;&amp;#x6709;&amp;#x5C5E;&amp;#x4E8E;&amp;#x8BE5; PG &amp;#x7684; Replicate &amp;#x89D2;&amp;#x8272;&amp;#x8282;&amp;#x70B9;&amp;#xFF1B;&lt;/li&gt;
&lt;li&gt;&amp;#x8BE5; PG &amp;#x7684; Replicate &amp;#x89D2;&amp;#x8272;&amp;#x8282;&amp;#x70B9;&amp;#x5B9E;&amp;#x9645;&amp;#x4E0A;&amp;#x5728;&amp;#x6545;&amp;#x969C; OSD &amp;#x4E0B;&amp;#x7EBF;&amp;#x65F6;&amp;#x671F;&amp;#x95F4;&amp;#x6210;&amp;#x4E3A;&amp;#x4E86; Primary &amp;#x89D2;&amp;#x8272;&amp;#x5E76;&amp;#x7EF4;&amp;#x62A4;&amp;#x4E86;&amp;#x201C;&amp;#x6743;&amp;#x5A01;&amp;#x201D;&amp;#x7684; PGLog&amp;#xFF0C;&amp;#x8BE5; PG &amp;#x5728;&amp;#x5F97;&amp;#x5230;&amp;#x6545;&amp;#x969C; OSD &amp;#x7684; Primary PG &amp;#x7684;&amp;#x67E5;&amp;#x8BE2;&amp;#x8BF7;&amp;#x6C42;&amp;#x540E;&amp;#x4F1A;&amp;#x53D1;&amp;#x9001;&amp;#x56DE;&amp;#x5E94;&amp;#xFF1B;&lt;/li&gt;
&lt;li&gt;Primary PG &amp;#x901A;&amp;#x8FC7;&amp;#x5BF9;&amp;#x6BD4; Replicate PG &amp;#x53D1;&amp;#x9001;&amp;#x7684;&amp;#x5143;&amp;#x6570;&amp;#x636E;&amp;#x548C; PG &amp;#x7248;&amp;#x672C;&amp;#x4FE1;&amp;#x606F;&amp;#x540E;&amp;#x53D1;&amp;#x73B0;&amp;#x5904;&amp;#x4E8E;&amp;#x843D;&amp;#x540E;&amp;#x72B6;&amp;#x6001;&amp;#xFF0C;&amp;#x56E0;&amp;#x6B64;&amp;#x5B83;&amp;#x4F1A;&amp;#x5408;&amp;#x5E76;&amp;#x5F97;&amp;#x5230;&amp;#x7684; PGLog&amp;#x5E76;&amp;#x5EFA;&amp;#x7ACB;&amp;#x201C;&amp;#x6743;&amp;#x5A01;&amp;#x201D; PGLog&amp;#xFF0C;&amp;#x540C;&amp;#x65F6;&amp;#x4F1A;&amp;#x5EFA;&amp;#x7ACB; missing &amp;#x5217;&amp;#x8868;&amp;#x6765;&amp;#x6807;&amp;#x8BB0;&amp;#x8FC7;&amp;#x65F6;&amp;#x6570;&amp;#x636E;&amp;#xFF1B;&lt;/li&gt;
&lt;li&gt;Primary PG &amp;#x5728;&amp;#x5B8C;&amp;#x6210;&amp;#x201C;&amp;#x6743;&amp;#x5A01;&amp;#x201D; PGLog &amp;#x7684;&amp;#x5EFA;&amp;#x7ACB;&amp;#x540E;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x6807;&amp;#x5FD7;&amp;#x81EA;&amp;#x5DF1;&amp;#x5904;&amp;#x4E8E; Active &amp;#x72B6;&amp;#x6001;&amp;#xFF1B;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&amp;#x5BF9;&amp;#x4E8E;&amp;#x6545;&amp;#x969C;OSD&amp;#x6240;&amp;#x62E5;&amp;#x6709;&amp;#x7684;Replicate PG &lt;ul&gt;
&lt;li&gt;&amp;#x8FD9;&amp;#x65F6;&amp;#x4E0A;&amp;#x7EBF;&amp;#x540E;&amp;#x6545;&amp;#x969C; OSD &amp;#x7684; Replicate PG &amp;#x4F1A;&amp;#x5F97;&amp;#x5230; Primary PG &amp;#x7684;&amp;#x67E5;&amp;#x8BE2;&amp;#x8BF7;&amp;#x6C42;&amp;#xFF0C;&amp;#x53D1;&amp;#x9001;&amp;#x81EA;&amp;#x5DF1;&amp;#x8FD9;&amp;#x4EFD;&amp;#x201C;&amp;#x8FC7;&amp;#x65F6;&amp;#x201D;&amp;#x7684;&amp;#x5143;&amp;#x6570;&amp;#x636E;&amp;#x548C; PGLog&amp;#xFF1B;&lt;/li&gt;
&lt;li&gt;Primary PG &amp;#x5BF9;&amp;#x6BD4;&amp;#x6570;&amp;#x636E;&amp;#x540E;&amp;#x53D1;&amp;#x73B0;&amp;#x8BE5; PG &amp;#x843D;&amp;#x540E;&amp;#x5E76;&amp;#x4E14;&amp;#x8FC7;&amp;#x65F6;&amp;#xFF0C;&amp;#x6BD4;&amp;#x901A;&amp;#x8FC7; PGLog &amp;#x5EFA;&amp;#x7ACB;&amp;#x4E86; missing &amp;#x5217;&amp;#x8868;&amp;#xFF1B;&lt;/li&gt;
&lt;li&gt;Primary PG &amp;#x6807;&amp;#x8BB0;&amp;#x81EA;&amp;#x5DF1;&amp;#x5904;&amp;#x4E8E; Active &amp;#x72B6;&amp;#x6001;&amp;#xFF1B;&lt;br&gt;Peering&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#x6D89;&amp;#x53CA;&amp;#x5230;PGLog&amp;#xFF08;pg_info&amp;#x548C;pg_log&amp;#xFF09;&amp;#x7684;&amp;#x6B65;&amp;#x9AA4;&amp;#x4E3B;&amp;#x8981;&amp;#x5305;&amp;#x62EC;&amp;#xFF1A;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;GetInfo : PG&amp;#x7684;Primary OSD&amp;#x901A;&amp;#x8FC7;&amp;#x53D1;&amp;#x9001;&amp;#x6D88;&amp;#x606F;&amp;#x83B7;&amp;#x53D6;&amp;#x5404;&amp;#x4E2A;Replicate OSD&amp;#x7684;pg_info&amp;#x4FE1;&amp;#x606F;&amp;#x3002;&amp;#x5728;&amp;#x6536;&amp;#x5230;&amp;#x5404;&amp;#x4E2A;Replicate OSD&amp;#x7684;pg_info&amp;#x540E;&amp;#xFF0C;&amp;#x4F1A;&amp;#x8C03;&amp;#x7528;PG::proc_replica_info&amp;#x5904;&amp;#x7406;&amp;#x526F;&amp;#x672C;OSD&amp;#x7684;pg_info&amp;#xFF0C;&amp;#x5728;&amp;#x8FD9;&amp;#x91CC;&amp;#x9762;&amp;#x4F1A;&amp;#x8C03;&amp;#x7528;info.history.merge&amp;#x5408;&amp;#x5E76;Replicate OSD&amp;#x53D1;&amp;#x8FC7;&amp;#x6765;&amp;#x7684;pg_info&amp;#x4FE1;&amp;#x606F;&amp;#xFF0C;&amp;#x5408;&amp;#x5E76;&amp;#x7684;&amp;#x539F;&amp;#x5219;&amp;#x5C31;&amp;#x662F;&amp;#x66F4;&amp;#x65B0;&amp;#x4E3A;&amp;#x6700;&amp;#x65B0;&amp;#x7684;&amp;#x5B57;&amp;#x6BB5;&amp;#xFF08;&amp;#x6BD4;&amp;#x5982;last_epoch_started&amp;#x548C;last_epoch_clean&amp;#x90FD;&amp;#x53D8;&amp;#x6210;&amp;#x6700;&amp;#x65B0;&amp;#x7684;&amp;#xFF09;&amp;#xFF1B;&lt;/li&gt;
&lt;li&gt;GetLog&amp;#xFF1A;&amp;#x6839;&amp;#x636E;pg_info&amp;#x7684;&amp;#x6BD4;&amp;#x8F83;&amp;#xFF0C;&amp;#x9009;&amp;#x62E9;&amp;#x4E00;&amp;#x4E2A;&amp;#x62E5;&amp;#x6709;&amp;#x6743;&amp;#x5A01;&amp;#x65E5;&amp;#x5FD7;&amp;#x7684;OSD&amp;#xFF08;auth_log_shard&amp;#xFF09; , &amp;#x5982;&amp;#x679C;Primary OSD&amp;#x4E0D;&amp;#x662F;&amp;#x62E5;&amp;#x6709;&amp;#x6743;&amp;#x5A01;&amp;#x65E5;&amp;#x5FD7;&amp;#x7684;OSD&amp;#xFF0C;&amp;#x5C31;&amp;#x53BB;&amp;#x8BE5;OSD&amp;#x4E0A;&amp;#x83B7;&amp;#x53D6;&amp;#x6743;&amp;#x5A01;&amp;#x65E5;&amp;#x5FD7;&amp;#xFF1B;&lt;ul&gt;
&lt;li&gt;&amp;#x9009;&amp;#x53D6;&amp;#x62E5;&amp;#x6709;&amp;#x6743;&amp;#x5A01;&amp;#x65E5;&amp;#x5FD7;&amp;#x7684;OSD&amp;#x65F6;&amp;#xFF0C;&amp;#x9075;&amp;#x5FAA;3&amp;#x4E2A;&amp;#x539F;&amp;#x5219;&amp;#xFF08;&amp;#x5728;find_best_info&amp;#x91CC;&amp;#xFF09;&amp;#xFF1A;&lt;ul&gt;
&lt;li&gt;Prefer newer last_update&lt;/li&gt;
&lt;li&gt;Prefer longer tail if it brings another info into contiguity&lt;/li&gt;
&lt;li&gt;Prefer current primary&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x8BF4;&amp;#x5BF9;&amp;#x6BD4;&amp;#x5404;&amp;#x4E2A;OSD&amp;#x7684;pg_info_t&amp;#xFF0C;&amp;#x8C01;&amp;#x7684;last_update&amp;#x5927;&amp;#xFF0C;&amp;#x5C31;&amp;#x9009;&amp;#x8C01;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;last_update&amp;#x90FD;&amp;#x4E00;&amp;#x6837;&amp;#xFF0C;&amp;#x5219;&amp;#x8C01;&amp;#x7684;log_tail&amp;#x5C0F;&amp;#xFF0C;&amp;#x5C31;&amp;#x9009;&amp;#x8C01;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;log_tail&amp;#x4E5F;&amp;#x4E00;&amp;#x6837;&amp;#xFF0C;&amp;#x5C31;&amp;#x9009;&amp;#x5F53;&amp;#x524D;&amp;#x7684;Primary OSD&amp;#xFF1B;&lt;/li&gt;
&lt;li&gt;&amp;#x5982;&amp;#x679C;Primary OSD&amp;#x4E0D;&amp;#x662F;&amp;#x62E5;&amp;#x6709;&amp;#x6743;&amp;#x5A01;&amp;#x65E5;&amp;#x5FD7;&amp;#x7684;OSD&amp;#xFF0C;&amp;#x5219;&amp;#x9700;&amp;#x8981;&amp;#x53BB;&amp;#x62E5;&amp;#x6709;&amp;#x6743;&amp;#x5A01;&amp;#x65E5;&amp;#x5FD7;&amp;#x7684;osd&amp;#x4E0A;&amp;#x53BB;&amp;#x62C9;&amp;#x53D6;&amp;#x6743;&amp;#x5A01;&amp;#x65E5;&amp;#x5FD7;&amp;#xFF0C;&amp;#x6536;&amp;#x5230;&amp;#x6743;&amp;#x5A01;&amp;#x65E5;&amp;#x5FD7;&amp;#x540E;&amp;#xFF0C;&amp;#x4F1A;&amp;#x8C03;&amp;#x7528;proc_master_log&amp;#x5C06;&amp;#x6743;&amp;#x5A01;&amp;#x65E5;&amp;#x5FD7;&amp;#x5408;&amp;#x5E76;&amp;#x5230;&amp;#x672C;&amp;#x5730;pg log&amp;#xFF1B;&lt;/li&gt;
&lt;li&gt;&amp;#x5728;merge &amp;#x6743;&amp;#x5A01;log&amp;#x5230;&amp;#x672C;&amp;#x5730;pg log&amp;#x7684;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#xFF0C;&amp;#x4F1A;&amp;#x5C06;merge&amp;#x7684;pg_log_entry_t&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;oid&amp;#x548C;eversion&amp;#x653E;&amp;#x5230;missing&amp;#x5217;&amp;#x8868;&amp;#x91CC;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;missing&amp;#x5217;&amp;#x8868;&amp;#x91CC;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x5C31;&amp;#x662F;Primary OSD&amp;#x6240;&amp;#x7F3A;&amp;#x5931;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x540E;&amp;#x7EED;&amp;#x5728;recovery&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x9700;&amp;#x8981;&amp;#x4ECE;&amp;#x5176;&amp;#x4ED6;osd pull&amp;#x7684;&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2015/12/18/ceph-pglog/merge.png&quot; alt=&quot;merge&quot;&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;GetMissing&amp;#xFF1A;&amp;#x62C9;&amp;#x53D6;&amp;#x5176;&amp;#x5B83;Replicate OSD &amp;#x7684;pg log&amp;#xFF08;&amp;#x6216;&amp;#x8005;&amp;#x90E8;&amp;#x5206;&amp;#x83B7;&amp;#x53D6;&amp;#xFF0C;&amp;#x6216;&amp;#x8005;&amp;#x5168;&amp;#x90E8;&amp;#x83B7;&amp;#x53D6;FULL_LOG) , &amp;#x901A;&amp;#x8FC7;&amp;#x672C;&amp;#x5730;&amp;#x7684;auth log&amp;#x5BF9;&amp;#x6BD4;&amp;#xFF0C;&amp;#x8C03;&amp;#x7528;proc_replica_log&amp;#x5904;&amp;#x7406;&amp;#x65E5;&amp;#x5FD7;&amp;#xFF0C;&amp;#x4F1A;&amp;#x5C06;Replicate OSD&amp;#x91CC;&amp;#x7F3A;&amp;#x5931;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x653E;&amp;#x5230;peer_missing&amp;#x5217;&amp;#x8868;&amp;#x91CC;&amp;#xFF0C;&amp;#x4EE5;&amp;#x7528;&amp;#x4E8E;&amp;#x540E;&amp;#x7EED;recovery&amp;#x8FC7;&amp;#x7A0B;&amp;#x7684;&amp;#x4F9D;&amp;#x636E;&amp;#xFF1B;&lt;strong&gt;&amp;#x6CE8;&amp;#x610F;&amp;#xFF1A;&amp;#x5B9E;&amp;#x9645;&amp;#x4E0A;&amp;#x662F;&amp;#x5728;PG:activate&amp;#x91CC;&amp;#x66F4;&amp;#x65B0;peer_missing&amp;#x5217;&amp;#x8868;&amp;#x7684;&amp;#xFF0C;&amp;#x5728;proc_replica_log&amp;#x5904;&amp;#x7406;&amp;#x7684;&amp;#x53EA;&amp;#x662F;&amp;#x4ECE;replica&amp;#x4F20;&amp;#x8FC7;&amp;#x6765;&amp;#x5B83;&amp;#x672C;&amp;#x5730;&amp;#x7684;missing&amp;#xFF08;&amp;#x5C31;&amp;#x662F;replica&amp;#x91CD;&amp;#x542F;&amp;#x540E;&amp;#x6839;&amp;#x636E;&amp;#x81EA;&amp;#x8EAB;&amp;#x7684;last_update&amp;#x548C;last_complete&amp;#x6784;&amp;#x9020;&amp;#x7684;missing&amp;#x5217;&amp;#x8868;&amp;#xFF09;&amp;#xFF0C;&amp;#x4E00;&amp;#x822C;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;&amp;#x8FD9;&amp;#x4E2A;missing&amp;#x5217;&amp;#x8868;&amp;#x662F;&amp;#x7A7A;&lt;/strong&gt;&amp;#xFF1B;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;4.&amp;#x53C2;&amp;#x8003;&amp;#x8D44;&amp;#x6599;&lt;br&gt;ceph&amp;#x6E90;&amp;#x7801;v0.80.11&amp;#x7248;&amp;#x672C;&lt;br&gt;&amp;#x300A;OSD&amp;#x8BFB;&amp;#x5199;&amp;#x6D41;&amp;#x7A0B;&amp;#x300B;&lt;a href=&quot;http://www.sysnote.org/?p=262&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.sysnote.org/?p=262&lt;/a&gt;&lt;br&gt;&amp;#x300A;peering&amp;#x8FC7;&amp;#x7A0B;&amp;#x300B;&lt;a href=&quot;http://blog.csdn.net/changtao381/article/details/49125817&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://blog.csdn.net/changtao381/article/details/49125817&lt;/a&gt;&lt;br&gt;&amp;#x300A;&amp;#x89E3;&amp;#x6790;ceph&amp;#xFF1A;&amp;#x6062;&amp;#x590D;&amp;#x4E0E;&amp;#x6570;&amp;#x636E;&amp;#x4E00;&amp;#x81F4;&amp;#x6027;&amp;#x300B;&lt;a href=&quot;http://www.wzxue.com/ceph-recovery/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.wzxue.com/ceph-recovery/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;ceph&amp;#x7684;PGLog&amp;#x662F;&amp;#x7531;PG&amp;#x6765;&amp;#x7EF4;&amp;#x62A4;&amp;#xFF0C;&amp;#x8BB0;&amp;#x5F55;&amp;#x4E86;&amp;#x8BE5;PG&amp;#x7684;&amp;#x6240;&amp;#x6709;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x5176;&amp;#x4F5C;&amp;#x7528;&amp;#x7C7B;&amp;#x4F3C;&amp;#x4E8E;&amp;#x6570;&amp;#x636E;&amp;#x5E93;&amp;#x91CC;&amp;#x7684;undo log&amp;#x3002;PGLog&amp;#x901A;&amp;#x5E38;&amp;#x53EA;&amp;#x4FDD;&amp;#x5B58;&amp;#x8FD1;&amp;#x5343;&amp;#x6761;&amp;#x7684;&amp;#x64CD;&amp;#x4F5C;&amp;#x8BB0;&amp;#x5F55;&amp;#xFF08;&amp;#x9ED8;&amp;#x8BA4;&amp;#x662F;3000&amp;#x6761;&amp;#xFF09;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x5F53;PG&amp;#x5904;&amp;#x4E8E;&amp;#x964D;&amp;#x7EA7;&amp;#x72B6;&amp;#x6001;&amp;#x65F6;&amp;#xFF0C;&amp;#x5C31;&amp;#x4F1A;&amp;#x4FDD;&amp;#x5B58;&amp;#x66F4;&amp;#x591A;&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&amp;#xFF08;&amp;#x9ED8;&amp;#x8BA4;&amp;#x662F;10000&amp;#x6761;&amp;#xFF09;&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x5728;&amp;#x6545;&amp;#x969C;&amp;#x7684;PG&amp;#x91CD;&amp;#x73B0;&amp;#x4E0A;&amp;#x7EBF;&amp;#x540E;&amp;#x7528;&amp;#x6765;&amp;#x6062;&amp;#x590D;PG&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x3002;&amp;#x672C;&amp;#x6587;&amp;#x4E3B;&amp;#x8981;&amp;#x4ECE;PGLog&amp;#x7684;&amp;#x683C;&amp;#x5F0F;&amp;#x3001;&amp;#x5B58;&amp;#x50A8;&amp;#x65B9;&amp;#x5F0F;&amp;#x3001;&amp;#x5982;&amp;#x4F55;&amp;#x53C2;&amp;#x4E0E;&amp;#x6062;&amp;#x590D;&amp;#x6765;&amp;#x89E3;&amp;#x6790;PGLog&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;1-PGLog&amp;#x7684;&amp;#x683C;&amp;#x5F0F;&quot;&gt;&lt;a href=&quot;#1-PGLog&amp;#x7684;&amp;#x683C;&amp;#x5F0F;&quot; class=&quot;headerlink&quot; title=&quot;1.PGLog&amp;#x7684;&amp;#x683C;&amp;#x5F0F;&quot;&gt;&lt;/a&gt;1.PGLog&amp;#x7684;&amp;#x683C;&amp;#x5F0F;&lt;/h1&gt;&lt;p&gt;ceph&amp;#x4F7F;&amp;#x7528;&amp;#x7248;&amp;#x672C;&amp;#x63A7;&amp;#x5236;&amp;#x7684;&amp;#x65B9;&amp;#x5F0F;&amp;#x6765;&amp;#x6807;&amp;#x8BB0;&amp;#x4E00;&amp;#x4E2A;PG&amp;#x5185;&amp;#x7684;&amp;#x6BCF;&amp;#x4E00;&amp;#x6B21;&amp;#x66F4;&amp;#x65B0;&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;&amp;#x7248;&amp;#x672C;&amp;#x5305;&amp;#x62EC;&amp;#x4E00;&amp;#x4E2A;(epoch&amp;#xFF0C;version)&amp;#x6765;&amp;#x7EC4;&amp;#x6210;&amp;#xFF1A;&amp;#x5176;&amp;#x4E2D;epoch&amp;#x662F;osdmap&amp;#x7684;&amp;#x7248;&amp;#x672C;&amp;#xFF0C;&amp;#x6BCF;&amp;#x5F53;&amp;#x6709;OSD&amp;#x72B6;&amp;#x6001;&amp;#x53D8;&amp;#x5316;&amp;#x5982;&amp;#x589E;&amp;#x52A0;&amp;#x5220;&amp;#x9664;&amp;#x7B49;&amp;#x65F6;&amp;#xFF0C;epoch&amp;#x5C31;&amp;#x9012;&amp;#x589E;&amp;#xFF1B;version&amp;#x662F;PG&amp;#x5185;&amp;#x6BCF;&amp;#x6B21;&amp;#x66F4;&amp;#x65B0;&amp;#x64CD;&amp;#x4F5C;&amp;#x7684;&amp;#x7248;&amp;#x672C;&amp;#x53F7;&amp;#xFF0C;&amp;#x9012;&amp;#x589E;&amp;#x7684;&amp;#xFF0C;&amp;#x7531;PG&amp;#x5185;&amp;#x7684;Primary OSD&amp;#x8FDB;&amp;#x884C;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;PGLog&amp;#x5728;&amp;#x4EE3;&amp;#x7801;&amp;#x5B9E;&amp;#x73B0;&amp;#x4E2D;&amp;#x6709;3&amp;#x4E2A;&amp;#x4E3B;&amp;#x8981;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#x6765;&amp;#x7EF4;&amp;#x62A4;&amp;#xFF1A;pg_info_t&amp;#xFF0C;pg_log_t&amp;#xFF0C;pg_log_entry_t&amp;#x3002;&amp;#x4E09;&amp;#x8005;&amp;#x7684;&amp;#x5173;&amp;#x7CFB;&amp;#x793A;&amp;#x610F;&amp;#x56FE;&amp;#x5982;&amp;#x4E0B;&amp;#x3002;&amp;#x4ECE;&amp;#x7ED3;&amp;#x6784;&amp;#x4E0A;&amp;#x53EF;&amp;#x4EE5;&amp;#x5F97;&amp;#x77E5;&amp;#xFF0C;PGLog&amp;#x91CC;&amp;#x53EA;&amp;#x6709;&amp;#x5BF9;&amp;#x8C61;&amp;#x66F4;&amp;#x65B0;&amp;#x64CD;&amp;#x4F5C;&amp;#x76F8;&amp;#x5173;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#xFF0C;&amp;#x6CA1;&amp;#x6709;&amp;#x5177;&amp;#x4F53;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x4EE5;&amp;#x53CA;&amp;#x504F;&amp;#x79FB;&amp;#x5927;&amp;#x5C0F;&amp;#x7B49;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x540E;&amp;#x7EED;&amp;#x4EE5;PGLog&amp;#x6765;&amp;#x8FDB;&amp;#x884C;&amp;#x6062;&amp;#x590D;&amp;#x65F6;&amp;#x90FD;&amp;#x662F;&amp;#x6309;&amp;#x7167;&amp;#x6574;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x6765;&amp;#x8FDB;&amp;#x884C;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#xFF08;&amp;#x9ED8;&amp;#x8BA4;&amp;#x5BF9;&amp;#x8C61;&amp;#x5927;&amp;#x5C0F;&amp;#x662F;4MB&amp;#xFF09;&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2015/12/18/ceph-pglog/pglog.png&quot; alt=&quot;pglog&quot;&gt;&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ceph" scheme="http://yoursite.com/categories/ceph/"/>
    
    
      <category term="ceph" scheme="http://yoursite.com/tags/ceph/"/>
    
      <category term="pglog" scheme="http://yoursite.com/tags/pglog/"/>
    
  </entry>
  
  <entry>
    <title>重启osd对ceph性能影响的分析</title>
    <link href="http://yoursite.com/2015/12/05/restart-osd-affects/"/>
    <id>http://yoursite.com/2015/12/05/restart-osd-affects/</id>
    <published>2015-12-05T08:03:16.000Z</published>
    <updated>2016-05-13T09:00:37.841Z</updated>
    
    <content type="html">&lt;p&gt;&amp;#x6700;&amp;#x8FD1;&amp;#x6D4B;&amp;#x8BD5;ceph&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x5BF9;&amp;#x4E1A;&amp;#x52A1;io&amp;#x7684;&amp;#x5F71;&amp;#x54CD;&amp;#xFF0C;&amp;#x53D1;&amp;#x73B0;&amp;#x4FEE;&amp;#x590D;&amp;#x65F6;ceph&amp;#x96C6;&amp;#x7FA4;&amp;#x7684;&amp;#x6027;&amp;#x80FD;&amp;#x9AA4;&amp;#x964D;&amp;#xFF0C;&amp;#x6BD4;&amp;#x5982;&amp;#x6B63;&amp;#x5E38;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;&amp;#x4E00;&amp;#x4E2A;&amp;#x5377;&amp;#x7684;&amp;#x968F;&amp;#x673A;4k&amp;#x5199;&amp;#x7684;iops&amp;#x7EA6;10k&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x9AA4;&amp;#x964D;&amp;#x5230;1k&amp;#x5DE6;&amp;#x53F3;&amp;#x3002;&amp;#x4ECE;ceph&amp;#x8BBE;&amp;#x8BA1;&amp;#x6765;&amp;#x8BF4;&amp;#xFF0C;&amp;#x6062;&amp;#x590D;&amp;#x6D89;&amp;#x53CA;&amp;#x5230;peering&amp;#xFF0C;backfill&amp;#xFF0C;remap&amp;#x7B49;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x5BF9;&amp;#x6027;&amp;#x80FD;&amp;#x5FC5;&amp;#x7136;&amp;#x4F1A;&amp;#x5B58;&amp;#x5728;&amp;#x5F71;&amp;#x54CD;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x5148;&amp;#x4E0D;&amp;#x6DF1;&amp;#x7A76;ceph&amp;#x7684;&amp;#x6062;&amp;#x590D;&amp;#x673A;&amp;#x5236;&amp;#xFF0C;&amp;#x540E;&amp;#x7EED;&amp;#x7814;&amp;#x7A76;&amp;#x6E05;&amp;#x695A;&amp;#x4E86;&amp;#x518D;&amp;#x8FDB;&amp;#x884C;&amp;#x5206;&amp;#x6790;&amp;#xFF0C;&amp;#x672C;&amp;#x6587;&amp;#x4EE5;&amp;#x91CD;&amp;#x542F;osd&amp;#x4E3A;&amp;#x4F8B;&amp;#xFF0C;&amp;#x4ECE;&amp;#x73B0;&amp;#x8C61;&amp;#x5165;&amp;#x624B;&amp;#x6765;&amp;#x7B80;&amp;#x8981;&amp;#x5206;&amp;#x6790;&amp;#x91CD;&amp;#x542F;osd&amp;#x5BF9;ceph&amp;#x6027;&amp;#x80FD;&amp;#x7684;&amp;#x5F71;&amp;#x54CD;&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;1-&amp;#x73AF;&amp;#x5883;&amp;#x914D;&amp;#x7F6E;&quot;&gt;&lt;a href=&quot;#1-&amp;#x73AF;&amp;#x5883;&amp;#x914D;&amp;#x7F6E;&quot; class=&quot;headerlink&quot; title=&quot;1.&amp;#x73AF;&amp;#x5883;&amp;#x914D;&amp;#x7F6E;&quot;&gt;&lt;/a&gt;1.&amp;#x73AF;&amp;#x5883;&amp;#x914D;&amp;#x7F6E;&lt;/h1&gt;&lt;p&gt;1&amp;#xFF09;&amp;#x786C;&amp;#x4EF6;&amp;#x914D;&amp;#x7F6E;&amp;#xFF1A;&amp;#x4F7F;&amp;#x7528;openstack + ceph&amp;#x540E;&amp;#x7AEF;&amp;#xFF0C;&amp;#x8BA1;&amp;#x7B97;&amp;#x548C;&amp;#x5B58;&amp;#x50A8;&amp;#x5206;&amp;#x79BB;&amp;#xFF0C;6&amp;#x53F0;&amp;#x7269;&amp;#x7406;&amp;#x673A;&amp;#x4F5C;&amp;#x4E3A;ceph&amp;#x5B58;&amp;#x50A8;&amp;#x8282;&amp;#x70B9;&amp;#xFF0C;&amp;#x6BCF;&amp;#x53F0;&amp;#x673A;&amp;#x5668;6&amp;#x5757;ssd&amp;#xFF0C;&amp;#x6BCF;&amp;#x5757;ssd&amp;#x4E0A;&amp;#x8FD0;&amp;#x884C;&amp;#x4E00;&amp;#x4E2A;osd&amp;#xFF08;&amp;#x5176;&amp;#x4E2D;journal&amp;#x548C;data&amp;#x5404;&amp;#x5360;&amp;#x4E00;&amp;#x4E2A;&amp;#x5206;&amp;#x533A;&amp;#xFF09;&amp;#xFF0C;&amp;#x6574;&amp;#x4E2A;&amp;#x96C6;&amp;#x7FA4;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x6D41;&amp;#x4F7F;&amp;#x7528;&amp;#x4E07;&amp;#x5146;&amp;#x7F51;&amp;#x7EDC;&amp;#xFF1B;&lt;br&gt;2&amp;#xFF09;&amp;#x6D4B;&amp;#x8BD5;&amp;#x65F6;&amp;#x5728;6&amp;#x53F0;kvm&amp;#x865A;&amp;#x62DF;&amp;#x673A;&amp;#x91CC;&amp;#x5206;&amp;#x522B;&amp;#x6302;&amp;#x8F7D;&amp;#x4E00;&amp;#x5757;20GB&amp;#x7684;ceph&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x4F7F;&amp;#x7528;fio&amp;#x5206;&amp;#x522B;&amp;#x8DD1;6&amp;#x79CD;I/O&amp;#x6A21;&amp;#x578B;&amp;#xFF1A;4KB&amp;#x5757;&amp;#x5927;&amp;#x5C0F;&amp;#x7684;&amp;#x968F;&amp;#x673A;&amp;#x5199;&amp;#xFF0C;4KB&amp;#x5757;&amp;#x5927;&amp;#x5C0F;&amp;#x7684;&amp;#x968F;&amp;#x673A;&amp;#x8BFB;&amp;#xFF0C;4KB&amp;#x5757;&amp;#x5927;&amp;#x5C0F;&amp;#x7684;&amp;#x968F;&amp;#x673A;&amp;#x6DF7;&amp;#x5408;&amp;#x8BFB;&amp;#x5199;&amp;#xFF08;1:1&amp;#x6BD4;&amp;#x4F8B;&amp;#xFF09;&amp;#xFF0C;64KB&amp;#x5757;&amp;#x5927;&amp;#x5C0F;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x5199;&amp;#xFF0C;64KB&amp;#x5757;&amp;#x5927;&amp;#x5C0F;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x8BFB;&amp;#xFF0C;64KB&amp;#x5757;&amp;#x5927;&amp;#x5C0F;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x6DF7;&amp;#x5408;&amp;#x8BFB;&amp;#x5199;&amp;#xFF08;1:1&amp;#x6BD4;&amp;#x4F8B;&amp;#xFF09;&amp;#x3002;&amp;#x4F7F;&amp;#x7528;&amp;#x8FD9;&amp;#x6837;&amp;#x7684;&amp;#x6A21;&amp;#x578B;&amp;#x6765;&amp;#x6A21;&amp;#x62DF;&amp;#x96C6;&amp;#x7FA4;&amp;#x8D1F;&amp;#x8F7D;&amp;#xFF1B;&lt;/p&gt;
&lt;h1 id=&quot;2-&amp;#x91CD;&amp;#x542F;osd&amp;#x8FDB;&amp;#x884C;&amp;#x6D4B;&amp;#x8BD5;&quot;&gt;&lt;a href=&quot;#2-&amp;#x91CD;&amp;#x542F;osd&amp;#x8FDB;&amp;#x884C;&amp;#x6D4B;&amp;#x8BD5;&quot; class=&quot;headerlink&quot; title=&quot;2.&amp;#x91CD;&amp;#x542F;osd&amp;#x8FDB;&amp;#x884C;&amp;#x6D4B;&amp;#x8BD5;&quot;&gt;&lt;/a&gt;2.&amp;#x91CD;&amp;#x542F;osd&amp;#x8FDB;&amp;#x884C;&amp;#x6D4B;&amp;#x8BD5;&lt;/h1&gt;&lt;p&gt;1&amp;#xFF09;&amp;#x5148;&amp;#x5C06;6&amp;#x4E2A;&amp;#x5377;&amp;#x7684;I/O&amp;#x8DD1;&amp;#x8D77;&amp;#x6765;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x91CD;&amp;#x542F;&amp;#x4E00;&amp;#x4E2A;osd&amp;#xFF1B;&lt;br&gt;2&amp;#xFF09;&amp;#x89C2;&amp;#x5BDF;&amp;#x5230;&amp;#x968F;&amp;#x673A;&amp;#x5199;&amp;#x7684;iops&amp;#x4ECE;10k&amp;#x964D;&amp;#x5230;&amp;#x4F4E;&amp;#x4E8E;1k&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x6CE2;&amp;#x52A8;&amp;#x8FD8;&amp;#x6BD4;&amp;#x8F83;&amp;#x5927;&amp;#xFF0C;&amp;#x968F;&amp;#x673A;&amp;#x8BFB;&amp;#x7684;iops&amp;#x4ECE;10k&amp;#x964D;&amp;#x5230;&amp;#x51E0;&amp;#x767E;&amp;#xFF1B;&lt;br&gt;3&amp;#xFF09;&amp;#x6027;&amp;#x80FD;&amp;#x4E0B;&amp;#x964D;&amp;#x6301;&amp;#x7EED;&amp;#x4E86;10&amp;#x51E0;&amp;#x79D2;&amp;#x540E;&amp;#x53C8;&amp;#x6B63;&amp;#x5E38;&amp;#xFF0C;&amp;#x662F;&amp;#x56E0;&amp;#x4E3A;&amp;#x6062;&amp;#x590D;&amp;#x5B8C;&amp;#x4E86;&amp;#xFF1B;&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;3-&amp;#x6027;&amp;#x80FD;&amp;#x6392;&amp;#x67E5;&amp;#x5206;&amp;#x6790;&quot;&gt;&lt;a href=&quot;#3-&amp;#x6027;&amp;#x80FD;&amp;#x6392;&amp;#x67E5;&amp;#x5206;&amp;#x6790;&quot; class=&quot;headerlink&quot; title=&quot;3.&amp;#x6027;&amp;#x80FD;&amp;#x6392;&amp;#x67E5;&amp;#x5206;&amp;#x6790;&quot;&gt;&lt;/a&gt;3.&amp;#x6027;&amp;#x80FD;&amp;#x6392;&amp;#x67E5;&amp;#x5206;&amp;#x6790;&lt;/h1&gt;&lt;h2 id=&quot;3-1&amp;#x4F7F;&amp;#x7528;ceph-osd-perf&amp;#x67E5;&amp;#x770B;&amp;#x91CD;&amp;#x542F;osd&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#x7684;osd&amp;#x7684;&amp;#x6027;&amp;#x80FD;&amp;#x6570;&amp;#x636E;&quot;&gt;&lt;a href=&quot;#3-1&amp;#x4F7F;&amp;#x7528;ceph-osd-perf&amp;#x67E5;&amp;#x770B;&amp;#x91CD;&amp;#x542F;osd&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#x7684;osd&amp;#x7684;&amp;#x6027;&amp;#x80FD;&amp;#x6570;&amp;#x636E;&quot; class=&quot;headerlink&quot; title=&quot;3.1&amp;#x4F7F;&amp;#x7528;ceph osd perf&amp;#x67E5;&amp;#x770B;&amp;#x91CD;&amp;#x542F;osd&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#x7684;osd&amp;#x7684;&amp;#x6027;&amp;#x80FD;&amp;#x6570;&amp;#x636E;&quot;&gt;&lt;/a&gt;3.1&amp;#x4F7F;&amp;#x7528;ceph osd perf&amp;#x67E5;&amp;#x770B;&amp;#x91CD;&amp;#x542F;osd&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#x7684;osd&amp;#x7684;&amp;#x6027;&amp;#x80FD;&amp;#x6570;&amp;#x636E;&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#ceph osd perf&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;osdid fs_commit_latency(ms) fs_apply_latency(ms)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   .......&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   45                     1                    4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   46                     2                    6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   47                     0                    2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   48                     1                    4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   49                     0                    2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   50                     0                    2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   52                     0                    2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   53                     0                    2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   54                     0                    2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   56                   236                 267&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   57                     1                    6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   58                     1                    2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   59                     1                    5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   60                     0                    2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   61                     1                    4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   62                     1                    3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; .........&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x5230;&amp;#x8FD9;&amp;#x4E2A;osd&amp;#x7684;commit_latency&amp;#x548C;apply_latency&amp;#x90FD;&amp;#x589E;&amp;#x52A0;&amp;#x4E86;&amp;#x5F88;&amp;#x591A;&amp;#xFF08;&amp;#x4ECE;&amp;#x6B63;&amp;#x5E38;&amp;#x7684;&amp;#x51E0;ms&amp;#x5347;&amp;#x9AD8;&amp;#x5230;&amp;#x51E0;&amp;#x767E;ms&amp;#xFF09;&amp;#xFF0C;&amp;#x5176;&amp;#x4E2D;commit_latency&amp;#x662F;&amp;#x503C;&amp;#x5199;journal&amp;#x5B8C;&amp;#x6210;&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#xFF0C;apply_latency&amp;#x662F;&amp;#x5199;&amp;#x5230;osd&amp;#x7684;buffer cache&amp;#x91CC;&amp;#x5B8C;&amp;#x6210;&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x3002;&lt;br&gt;&amp;#x8FD9;&amp;#x4E2A;osd&amp;#x5728;&amp;#x91CD;&amp;#x542F;&amp;#x540E;&amp;#x8FDB;&amp;#x884C;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x5199;journal&amp;#x5EF6;&amp;#x8FDF;&amp;#x5347;&amp;#x9AD8;&amp;#xFF0C;&amp;#x5BFC;&amp;#x81F4;&amp;#x4E86;&amp;#x4E0A;&amp;#x5C42;&amp;#x5199;&amp;#x6027;&amp;#x80FD;&amp;#x7684;&amp;#x4E0B;&amp;#x964D;&amp;#xFF0C;&amp;#x90A3;&amp;#x5C31;&amp;#x4ECE;&amp;#x8FD9;&amp;#x4E2A;&amp;#x70B9;&amp;#x5165;&amp;#x624B;&amp;#x53BB;&amp;#x8FDB;&amp;#x884C;&amp;#x6392;&amp;#x67E5;&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;3-2-fs-commit-latency&amp;#x7684;&amp;#x8BA1;&amp;#x7B97;&quot;&gt;&lt;a href=&quot;#3-2-fs-commit-latency&amp;#x7684;&amp;#x8BA1;&amp;#x7B97;&quot; class=&quot;headerlink&quot; title=&quot;3.2 fs_commit_latency&amp;#x7684;&amp;#x8BA1;&amp;#x7B97;&quot;&gt;&lt;/a&gt;3.2 fs_commit_latency&amp;#x7684;&amp;#x8BA1;&amp;#x7B97;&lt;/h2&gt;&lt;p&gt;&amp;#x65E2;&amp;#x7136;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x65F6;&amp;#x5019;fs_commit_latency&amp;#x589E;&amp;#x52A0;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x5C31;&amp;#x5148;&amp;#x770B;&amp;#x4E0B;&amp;#x8FD9;&amp;#x4E2A;&amp;#x65F6;&amp;#x95F4;&amp;#x662F;&amp;#x600E;&amp;#x4E48;&amp;#x8BA1;&amp;#x7B97;&amp;#x51FA;&amp;#x6765;&amp;#x7684;&amp;#x3002;&lt;br&gt;&amp;#x5728;&amp;#x4EE3;&amp;#x7801;&amp;#x91CC;&amp;#x641C;&amp;#x7D22;fs_commit_latency&amp;#x627E;&amp;#x5230;&amp;#x5982;&amp;#x4E0B;&lt;br&gt;&lt;img src=&quot;/2015/12/05/restart-osd-affects/fs_commit_lat.png&quot; alt=&quot;fs_commit_lat&quot;&gt;&lt;br&gt;&amp;#x56E0;&amp;#x6B64;&amp;#x53EA;&amp;#x8981;&amp;#x627E;&amp;#x51FA;l_os_j_lat&amp;#x662F;&amp;#x600E;&amp;#x4E48;&amp;#x8BA1;&amp;#x7B97;&amp;#x7684;&amp;#x3002;&amp;#x5728;queue_completions_thru&amp;#x91CC;&amp;#x8BA1;&amp;#x7B97;&amp;#x7684;&amp;#x8FD9;&amp;#x4E2A;&amp;#x503C;&amp;#xFF0C;&amp;#x800C;&amp;#x5F00;&amp;#x59CB;&amp;#x65F6;&amp;#x95F4;&amp;#x662F;&amp;#x4ECE;completion_item&amp;#x91CC;&amp;#x5F97;&amp;#x5230;&amp;#x7684;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x5728;submit_entry&amp;#x91CC;&amp;#x8BB0;&amp;#x7684;&amp;#x5F00;&amp;#x59CB;&amp;#x65F6;&amp;#x95F4;&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2015/12/05/restart-osd-affects/queue_completions_thru.png&quot; alt=&quot;queue_completions_thru&quot;&gt;&lt;br&gt;&lt;img src=&quot;/2015/12/05/restart-osd-affects/submit_entry.png&quot; alt=&quot;submit_entry&quot;&gt;&lt;br&gt;&amp;#x4ECE;&amp;#x6211;&amp;#x4E4B;&amp;#x524D;&amp;#x7684;&amp;#x535A;&amp;#x5BA2;&amp;#x91CC;&amp;#x300A;OSD&amp;#x8BFB;&amp;#x5199;&amp;#x6D41;&amp;#x7A0B;&amp;#xFF08;2&amp;#xFF09;&amp;#x2013;&amp;#x4E3B;OSD&amp;#x5199;&amp;#x64CD;&amp;#x4F5C;&amp;#x4E8B;&amp;#x52A1;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x300B;&amp;#x91CC;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x5230;&amp;#xFF0C;l_os_j_lat&amp;#x5C31;&amp;#x662F;&amp;#x7EDF;&amp;#x8BA1;&amp;#x7684;&amp;#x653E;&amp;#x5165;writeq&amp;#x5230;&amp;#x5199;journal&amp;#x5B8C;&amp;#x6210;&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x3002;&amp;#x8FD9;&amp;#x4E2A;&amp;#x65F6;&amp;#x95F4;&amp;#x65E2;&amp;#x662F;ceph osd perf&amp;#x91CC;&amp;#x770B;&amp;#x5230;&amp;#x7684;fs_commit_latency&amp;#xFF0C;&amp;#x4E5F;&amp;#x662F;ceph daemon osd.x perf dump&amp;#x91CC;&amp;#x770B;&amp;#x5230;&amp;#x7684;journal_latency&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2015/12/05/restart-osd-affects/journal.png&quot; alt=&quot;journal&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;3-3-&amp;#x7ED3;&amp;#x5408;&amp;#x65E5;&amp;#x5FD7;&amp;#x5206;&amp;#x6790;&quot;&gt;&lt;a href=&quot;#3-3-&amp;#x7ED3;&amp;#x5408;&amp;#x65E5;&amp;#x5FD7;&amp;#x5206;&amp;#x6790;&quot; class=&quot;headerlink&quot; title=&quot;3.3 &amp;#x7ED3;&amp;#x5408;&amp;#x65E5;&amp;#x5FD7;&amp;#x5206;&amp;#x6790;&quot;&gt;&lt;/a&gt;3.3 &amp;#x7ED3;&amp;#x5408;&amp;#x65E5;&amp;#x5FD7;&amp;#x5206;&amp;#x6790;&lt;/h2&gt;&lt;p&gt;&amp;#x4ECE;&amp;#x4EE3;&amp;#x7801;&amp;#x903B;&amp;#x8F91;&amp;#x4E0A;&amp;#x770B;&amp;#x5C31;&amp;#x662F;&amp;#x653E;&amp;#x5230;writeq&amp;#x540E;&amp;#x7136;&amp;#x540E;&amp;#x5524;&amp;#x9192;journal&amp;#x7EBF;&amp;#x7A0B;&amp;#x53BB;&amp;#x5199;journal&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x9762;&amp;#x53EF;&amp;#x80FD;&amp;#x5728;&amp;#x4EC0;&amp;#x4E48;&amp;#x5730;&amp;#x65B9;&amp;#x8017;&amp;#x65F6;&amp;#x6BD4;&amp;#x8F83;&amp;#x591A;&amp;#x5462;&amp;#xFF1F;&amp;#x4E3A;&amp;#x6B64;&amp;#xFF0C;&amp;#x5C06;&amp;#x8FD9;&amp;#x4E2A;journal&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&amp;#x6253;&amp;#x5F00;&amp;#xFF0C;&amp;#x4ECE;&amp;#x65E5;&amp;#x5FD7;&amp;#x91CC;&amp;#x770B;&amp;#x770B;&amp;#x6709;&amp;#x6CA1;&amp;#x6709;&amp;#x7EBF;&amp;#x7D22;&amp;#x3002;&lt;br&gt;1&amp;#xFF09;&amp;#x4FEE;&amp;#x6539;ceph.conf&amp;#xFF0C;&amp;#x52A0;&amp;#x5165;debug_journal=20&amp;#xFF0C;&amp;#x6765;&amp;#x5F00;&amp;#x542F;journal&amp;#x7684;debug&amp;#x65E5;&amp;#x5FD7;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x91CD;&amp;#x542F;osd&amp;#x518D;&amp;#x8FDB;&amp;#x884C;&amp;#x6D4B;&amp;#x8BD5;&amp;#xFF0C;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x5728;/var/log/ceph/ceph-osd.56.log&amp;#x91CC;&amp;#x770B;&amp;#x5230;journal&amp;#x76F8;&amp;#x5173;&amp;#x7684;debug&amp;#x65E5;&amp;#x5FD7;&amp;#x4E86;&amp;#x3002;&lt;br&gt;2&amp;#xFF09;&amp;#x4F7F;&amp;#x7528;ceph -w&amp;#x89C2;&amp;#x5BDF;&amp;#x91CD;&amp;#x542F;osd&amp;#x95F4;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x60C5;&amp;#x51B5;&amp;#xFF0C;&amp;#x5C06;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x533A;&amp;#x95F4;&amp;#x627E;&amp;#x51FA;&amp;#x6765;&amp;#xFF0C;&amp;#x6BD4;&amp;#x5982;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x65F6;&amp;#x95F4;2015-12-02 09:47:33~2015-12-02 09:47:33&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x5C31;&amp;#x6839;&amp;#x636E;&amp;#x65F6;&amp;#x95F4;&amp;#x6233;&amp;#x4ECE;ceph-osd.56.log&amp;#x91CC;&amp;#x5C06;&amp;#x8FD9;&amp;#x4E2A;&amp;#x65F6;&amp;#x95F4;&amp;#x6BB5;&amp;#x7684;journal&amp;#x65E5;&amp;#x5FD7;grep&amp;#x51FA;&amp;#x6765;&amp;#x3002;&lt;br&gt;3&amp;#xFF09;&amp;#x6839;&amp;#x636E;&amp;#x4E4B;&amp;#x524D;&amp;#x7684;&amp;#x4EE3;&amp;#x7801;&amp;#x770B;&amp;#x5230;queue_completions_thru&amp;#x91CC;&amp;#x4F1A;&amp;#x6253;&amp;#x5370;&amp;#x51FA;l_os_j_lat&amp;#xFF0C;&amp;#x90A3;&amp;#x5C31;&amp;#x6839;&amp;#x636E;&amp;#x5173;&amp;#x952E;&amp;#x5B57;&amp;#x201D;queue_completions_thru&amp;#x201D;&amp;#x5230;&amp;#x521A;&amp;#x624D;&amp;#x622A;&amp;#x53D6;&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&amp;#x91CC;&amp;#x641C;&amp;#x7D22;&amp;#xFF0C;grep&amp;#x51FA;&amp;#x6765;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x67E5;&amp;#x770B;&amp;#x8FD9;&amp;#x4E2A;lat&amp;#x7684;&amp;#x53D8;&amp;#x5316;&amp;#x8D8B;&amp;#x52BF;&amp;#xFF0C;&amp;#x770B;&amp;#x770B;&amp;#x662F;&amp;#x5426;&amp;#x6709;&amp;#x660E;&amp;#x663E;&amp;#x5347;&amp;#x9AD8;&amp;#x7684;&amp;#x60C5;&amp;#x51B5;&amp;#xFF0C;&lt;br&gt;&amp;#x7ED3;&amp;#x679C;&amp;#x786E;&amp;#x5B9E;&amp;#x53D1;&amp;#x73B0;&amp;#x6709;&amp;#x660E;&amp;#x663E;&amp;#x589E;&amp;#x52A0;&amp;#x7684;&amp;#x60C5;&amp;#x51B5;&amp;#xFF1A;&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:34.097848 7f87bfdf3700 10 journal queue_completions_thru seq 143576679 queueing seq 143576679 0x3f14420 lat 0.000690&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:34.099863 7f87bfdf3700 10 journal queue_completions_thru seq 143576680 queueing seq 143576680 0x1a69edb0 lat 0.000875&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:34.100190 7f87bfdf3700 10 journal queue_completions_thru seq 143576681 queueing seq 143576681 0x8ad0000 lat 0.000227&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:34.101104 7f87bfdf3700 10 journal queue_completions_thru seq 143576682 queueing seq 143576682 0x8ad1860 lat 0.000543&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...............................&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:34.221383 7f87bfdf3700 10 journal queue_completions_thru seq 143576896 queueing seq 143576872 0x1c18f560 lat 0.012914&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:34.221390 7f87bfdf3700 10 journal queue_completions_thru seq 143576896 queueing seq 143576873 0x1c18f710 lat 0.012867&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:34.221392 7f87bfdf3700 10 journal queue_completions_thru seq 143576896 queueing seq 143576874 0x1bb212f0 lat 0.012765&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:34.221395 7f87bfdf3700 10 journal queue_completions_thru seq 143576896 queueing seq 143576875 0x1c18ecf0 lat 0.012647&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:34.221397 7f87bfdf3700 10 journal queue_completions_thru seq 143576896 queueing seq 143576876 0x1bb21290 lat 0.012532&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...............................&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:34.689892 7f87bfdf3700 10 journal queue_completions_thru seq 143577160 queueing seq 143577159 0x189a4270 lat 0.089205&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:34.689896 7f87bfdf3700 10 journal queue_completions_thru seq 143577160 queueing seq 143577160 0x2a1ddd0 lat 0.088614&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:34.730755 7f87bfdf3700 10 journal queue_completions_thru seq 143577163 queueing seq 143577161 0x1aff0b40 lat 0.129044&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:34.730765 7f87bfdf3700 10 journal queue_completions_thru seq 143577163 queueing seq 143577162 0x2a37170 lat 0.129024&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:34.730769 7f87bfdf3700 10 journal queue_completions_thru seq 143577163 queueing seq 143577163 0x1a3ca930 lat 0.128522&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:34.746175 7f87bfdf3700 10 journal queue_completions_thru seq 143577166 queueing seq 143577164 0x1a59cdb0 lat 0.142385&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...............................&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:34.808426 7f87bfdf3700 10 journal queue_completions_thru seq 143577236 queueing seq 143577221 0x1a6696b0 lat 0.013378&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:34.808429 7f87bfdf3700 10 journal queue_completions_thru seq 143577236 queueing seq 143577222 0x1a669830 lat 0.013349&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:34.808431 7f87bfdf3700 10 journal queue_completions_thru seq 143577236 queueing seq 143577223 0x1bb21500 lat 0.013290&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:34.808434 7f87bfdf3700 10 journal queue_completions_thru seq 143577236 queueing seq 143577224 0x1a669770 lat 0.013255&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:34.808436 7f87bfdf3700 10 journal queue_completions_thru seq 143577236 queueing seq 143577225 0x1a685c80 lat 0.013229&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:34.808438 7f87bfdf3700 10 journal queue_completions_thru seq 143577236 queueing seq 143577226 0x1cf00450 lat 0.008882&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:34.808445 7f87bfdf3700 10 journal queue_completions_thru seq 143577236 queueing seq 143577227 0x1a59c720 lat 0.006527&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...............................&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.367197 7f87bfdf3700 10 journal queue_completions_thru seq 143577901 queueing seq 143577901 0x1cdcb560 lat 0.402130&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.405384 7f87bfdf3700 10 journal queue_completions_thru seq 143577921 queueing seq 143577902 0x1a4cf890 lat 0.440091&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.405392 7f87bfdf3700 10 journal queue_completions_thru seq 143577921 queueing seq 143577903 0x2b230090 lat 0.439959&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.405395 7f87bfdf3700 10 journal queue_completions_thru seq 143577921 queueing seq 143577904 0x1cf01d70 lat 0.439845&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.405398 7f87bfdf3700 10 journal queue_completions_thru seq 143577921 queueing seq 143577905 0x1cc5ff20 lat 0.439770&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;.................................&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:48:05.289463 7f87bfdf3700 10 journal queue_completions_thru seq 143597534 queueing seq 143597533 0x1880c630 lat 0.001408&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:48:05.289479 7f87bfdf3700 10 journal queue_completions_thru seq 143597534 queueing seq 143597534 0x18981440 lat 0.000517&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:48:05.290794 7f87bfdf3700 10 journal queue_completions_thru seq 143597535 queueing seq 143597535 0x1523a330 lat 0.000571&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:48:05.291299 7f87bfdf3700 10 journal queue_completions_thru seq 143597536 queueing seq 143597536 0x16aabc50 lat 0.000384&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;latency&amp;#x5728;&amp;#x53D8;&amp;#x5316;&amp;#xFF0C;&amp;#x9010;&amp;#x6E10;&amp;#x589E;&amp;#x52A0;&amp;#x5230;&amp;#x51E0;&amp;#x767E;ms&amp;#xFF0C;&amp;#x800C;&amp;#x4E14;&amp;#x8FD8;&amp;#x662F;&amp;#x6CE2;&amp;#x52A8;&amp;#x7684;&amp;#xFF0C;&amp;#x76F4;&amp;#x5230;&amp;#x4FEE;&amp;#x590D;&amp;#x7ED3;&amp;#x675F;&amp;#x540E;&amp;#xFF0C;&amp;#x53C8;&amp;#x964D;&amp;#x4F4E;&amp;#x5230;&amp;#x6B63;&amp;#x5E38;&amp;#x7684;0.&amp;#x51E0;ms&amp;#x3002;&lt;/p&gt;
&lt;p&gt;4&amp;#xFF09;&amp;#x6839;&amp;#x636E;&amp;#x65E5;&amp;#x5FD7;&amp;#x53CA;&amp;#x4EE3;&amp;#x7801;&amp;#x90FD;&amp;#x53EF;&amp;#x4EE5;&amp;#x77E5;&amp;#x9053;&amp;#x5199;journal&amp;#x7684;&amp;#x6BCF;&amp;#x4E00;&amp;#x4E2A;&amp;#x5199;io&amp;#x90FD;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;seq&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x662F;&amp;#x4E25;&amp;#x683C;&amp;#x9012;&amp;#x589E;&amp;#x7684;&amp;#xFF0C;&amp;#x5199;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x4E5F;&amp;#x662F;&amp;#x6309;&amp;#x7167;&amp;#x5148;&amp;#x5199;seq&amp;#x5E8F;&amp;#x53F7;&amp;#x5C0F;&amp;#x7684;&amp;#xFF0C;&amp;#x518D;&amp;#x5199;seq&amp;#x5E8F;&amp;#x53F7;&amp;#x5927;&amp;#x7684;&amp;#x3002;&amp;#x65E2;&amp;#x7136;&amp;#x5982;&amp;#x6B64;&amp;#xFF0C;&amp;#x90A3;&amp;#x5C31;&amp;#x6839;&amp;#x636E;seq&amp;#x5E8F;&amp;#x53F7;&amp;#x53BB;&amp;#x65E5;&amp;#x5FD7;&amp;#x91CC;&amp;#x770B;&amp;#x770B;&amp;#x5EF6;&amp;#x8FDF;&amp;#x9AD8;&amp;#x7684;&amp;#x90A3;&amp;#x4E2A;io&amp;#x7684;log&amp;#x4FE1;&amp;#x606F;&amp;#xFF0C;&amp;#x4EE5;&amp;#x201C;seq 143577921&amp;#x201D;&amp;#x4E3A;&amp;#x4F8B;&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.076975 7f87c05f4700 15 journal prepare_single_write 1 will write 5234556928 : seq 143577880 len 4196270 -&amp;gt; 4202496 (head 40 pre_pad 3434 ebl 4196270 post_pad 2712 tail 40) (ebl alignment 3474)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.077003 7f87bb5ea700 10 journal op_apply_finish 143577875 open_ops 5 -&amp;gt; 4, max_applied_seq 143577874 -&amp;gt; 143577875&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.077024 7f87a6743700 10 journal op_submit_start 143577921&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.077032 7f87a6743700 10 journal op_journal_transactions 143577921 0x1b9e7440&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.077040 7f87a6743700  5 journal submit_entry seq 143577921 len 4196270 (0x1a4e1e00)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.077047 7f87a6743700 10 journal op_submit_finish 143577921&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;..................&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.368799 7f87c05f4700 15 journal prepare_single_write 20 will write 5319761920 : seq 143577921 len 4196270 -&amp;gt; 4202496 (head 40 pre_pad 3434 ebl 4196270 post_pad 2712 tail 40) (ebl alignment 3474)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;..................&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.373188 7f87c05f4700 20 journal write_aio_bl 5311217664~12746752 seq 143577921&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;..................&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.405376 7f87bfdf3700 20 journal check_aio_completion completed seq 143577921 5311217664~12746752&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.405381 7f87bfdf3700 20 journal check_aio_completion queueing finishers through seq 143577921&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.405384 7f87bfdf3700 10 journal queue_completions_thru seq 143577921 queueing seq 143577902 0x1a4cf890 lat 0.440091&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.405392 7f87bfdf3700 10 journal queue_completions_thru seq 143577921 queueing seq 143577903 0x2b230090 lat 0.439959&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.405395 7f87bfdf3700 10 journal queue_completions_thru seq 143577921 queueing seq 143577904 0x1cf01d70 lat 0.439845&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.405398 7f87bfdf3700 10 journal queue_completions_thru seq 143577921 queueing seq 143577905 0x1cc5ff20 lat 0.439770&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.405401 7f87bfdf3700 10 journal queue_completions_thru seq 143577921 queueing seq 143577906 0x1c0c9530 lat 0.373900&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.405403 7f87bfdf3700 10 journal queue_completions_thru seq 143577921 queueing seq 143577907 0x1983f8c0 lat 0.373753&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.405405 7f87bfdf3700 10 journal queue_completions_thru seq 143577921 queueing seq 143577908 0x1c0c9500 lat 0.373637&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.405408 7f87bfdf3700 10 journal queue_completions_thru seq 143577921 queueing seq 143577909 0x50cfb890 lat 0.373515&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.405426 7f87bfdf3700 10 journal queue_completions_thru seq 143577921 queueing seq 143577910 0x1c177950 lat 0.373398&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.405430 7f87bfdf3700 10 journal queue_completions_thru seq 143577921 queueing seq 143577911 0x1c36aba0 lat 0.373152&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.405434 7f87bfdf3700 10 journal queue_completions_thru seq 143577921 queueing seq 143577912 0x8ad0360 lat 0.373025&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.405437 7f87bfdf3700 10 journal queue_completions_thru seq 143577921 queueing seq 143577913 0x1cb3&lt;span class=&quot;built_in&quot;&gt;cd&lt;/span&gt;50 lat 0.372915&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.405438 7f87b8383700 10 journal op_apply_start 143577902 open_ops 0 -&amp;gt; 1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.405441 7f87bfdf3700 10 journal queue_completions_thru seq 143577921 queueing seq 143577914 0x4707e630 lat 0.372819&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.405445 7f87bfdf3700 10 journal queue_completions_thru seq 143577921 queueing seq 143577915 0x1a4e07b0 lat 0.372727&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.405448 7f87bfdf3700 10 journal queue_completions_thru seq 143577921 queueing seq 143577916 0x1c0d0a50 lat 0.372623&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.405452 7f87bfdf3700 10 journal queue_completions_thru seq 143577921 queueing seq 143577917 0x1bafe8a0 lat 0.372516&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.405455 7f87b637f700 10 journal op_apply_start 143577906 open_ops 1 -&amp;gt; 2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.405459 7f87bfdf3700 10 journal queue_completions_thru seq 143577921 queueing seq 143577918 0x1b3528d0 lat 0.372410&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.405464 7f87bfdf3700 10 journal queue_completions_thru seq 143577921 queueing seq 143577919 0x1c0c8cc0 lat 0.372320&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.405468 7f87bfdf3700 10 journal queue_completions_thru seq 143577921 queueing seq 143577920 0x1a1e59e0 lat 0.370506&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.405471 7f87bfdf3700 10 journal queue_completions_thru seq 143577921 queueing seq 143577921 0x1a4e1e00 lat 0.328340&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;....................&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x4ECE;&amp;#x4E0A;&amp;#x9762;&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&amp;#x6765;&amp;#x770B;seq 143577921&amp;#x8FD9;&amp;#x4E2A;io&amp;#x5728;submit_entry&amp;#x5F00;&amp;#x59CB;&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x662F;09:47:36.077040&amp;#xFF0C;&amp;#x800C;&amp;#x4E00;&amp;#x76F4;&amp;#x5230;09:47:36.405471&amp;#x624D;&amp;#x6700;&amp;#x540E;&amp;#x5B8C;&amp;#x6210;&amp;#xFF0C;&lt;br&gt;&amp;#x800C;&amp;#x4E14;&amp;#x6BD4;&amp;#x8F83;&amp;#x660E;&amp;#x663E;&amp;#x7684;&amp;#x662F;&amp;#x8FD9;&amp;#x4E2A;io&amp;#x63D0;&amp;#x4EA4;&amp;#x5230;writeq&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x70B9;&amp;#x662F;2015-12-02 09:47:36.077040&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.077040 7f87a6743700  5 journal submit_entry seq 143577921 len 4196270 (0x1a4e1e00)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x800C;&amp;#x771F;&amp;#x6B63;&amp;#x8F6E;&amp;#x5230;&amp;#x8FD9;&amp;#x4E2A;io&amp;#x5904;&amp;#x7406;&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x70B9;&amp;#x662F;2015-12-02 09:47:36.368799&amp;#xFF0C;&amp;#x4ECE;&amp;#x653E;&amp;#x5230;writeq&amp;#x5230;&amp;#x5F00;&amp;#x59CB;prepare&amp;#x8FD9;&amp;#x4E2A;io&amp;#x5C31;&amp;#x5DF2;&amp;#x7ECF;&amp;#x8FC7;&amp;#x4E86;&amp;#x7EA6;300ms&amp;#x4E86;&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.368799 7f87c05f4700 15 journal prepare_single_write 20 will write 5319761920 : seq 143577921 len 4196270 -&amp;gt; 4202496 (head 40 pre_pad 3434 ebl 4196270 post_pad 2712 tail 40) (ebl alignment 3474)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x800C;&amp;#x4E14;&amp;#x4ECE;&amp;#x4E0A;&amp;#x9762;&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&amp;#x4E2D;&amp;#x8FD8;&amp;#x770B;&amp;#x5230;journal&amp;#x7EBF;&amp;#x7A0B;&amp;#x5E76;&amp;#x4E0D;&amp;#x662F;&amp;#x7A7A;&amp;#x95F2;&amp;#x7684;&amp;#xFF0C;&amp;#x5B83;&amp;#x8FD8;&amp;#x5728;&amp;#x5904;&amp;#x7406;&amp;#x961F;&amp;#x5217;&amp;#x91CC;&amp;#x524D;&amp;#x9762;&amp;#x7684;io&amp;#xFF0C;&amp;#x5927;&amp;#x81F4;&amp;#x53EF;&amp;#x4EE5;&amp;#x7B97;&amp;#x51FA;writeq&amp;#x91CC;&amp;#x8FD8;&amp;#x6709;143577921-143577880=41&amp;#x4E2A;io&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.076975 7f87c05f4700 15 journal prepare_single_write 1 will write 5234556928 : seq 143577880 len 4196270 -&amp;gt; 4202496 (head 40 pre_pad 3434 ebl 4196270 post_pad 2712 tail 40) (ebl alignment 3474)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&quot;3-4&amp;#x4ECE;&amp;#x8FD9;&amp;#x4E9B;&amp;#x73B0;&amp;#x8C61;&amp;#x6765;&amp;#x770B;&amp;#xFF0C;&amp;#x6709;2&amp;#x5904;&amp;#x6000;&amp;#x7591;&amp;#x70B9;&amp;#xFF1A;&quot;&gt;&lt;a href=&quot;#3-4&amp;#x4ECE;&amp;#x8FD9;&amp;#x4E9B;&amp;#x73B0;&amp;#x8C61;&amp;#x6765;&amp;#x770B;&amp;#xFF0C;&amp;#x6709;2&amp;#x5904;&amp;#x6000;&amp;#x7591;&amp;#x70B9;&amp;#xFF1A;&quot; class=&quot;headerlink&quot; title=&quot;3.4&amp;#x4ECE;&amp;#x8FD9;&amp;#x4E9B;&amp;#x73B0;&amp;#x8C61;&amp;#x6765;&amp;#x770B;&amp;#xFF0C;&amp;#x6709;2&amp;#x5904;&amp;#x6000;&amp;#x7591;&amp;#x70B9;&amp;#xFF1A;&quot;&gt;&lt;/a&gt;3.4&amp;#x4ECE;&amp;#x8FD9;&amp;#x4E9B;&amp;#x73B0;&amp;#x8C61;&amp;#x6765;&amp;#x770B;&amp;#xFF0C;&amp;#x6709;2&amp;#x5904;&amp;#x6000;&amp;#x7591;&amp;#x70B9;&amp;#xFF1A;&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;a&amp;#xFF09;&amp;#x4E00;&amp;#x4E2A;&amp;#x662F;journal&amp;#x7EBF;&amp;#x7A0B;&amp;#x91CC;&amp;#x6709;&amp;#x63D0;&amp;#x4EA4;&amp;#x6570;&amp;#x636E;&amp;#x91CF;&amp;#x6216;&amp;#x8005;io&amp;#x6570;&amp;#x7684;&amp;#x9650;&amp;#x5236;&amp;#xFF1B;
b&amp;#xFF09;&amp;#x540E;&amp;#x7AEF;&amp;#x78C1;&amp;#x76D8;&amp;#x6162;&amp;#x4E86;&amp;#xFF0C;io&amp;#x5904;&amp;#x7406;&amp;#x4E0D;&amp;#x8FC7;&amp;#x6765;&amp;#x5BFC;&amp;#x81F4;io&amp;#x5806;&amp;#x79EF;&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;&amp;#x5F71;&amp;#x54CD;&amp;#x4E0A;&amp;#x5C42;io&amp;#xFF1B;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;1&amp;#xFF09;&amp;#x5BF9;&amp;#x4E8E;&amp;#x7B2C;&amp;#x4E00;&amp;#x4E2A;&amp;#x6000;&amp;#x7591;&amp;#x70B9;&amp;#xFF0C;&amp;#x4ECE;&amp;#x4EE3;&amp;#x7801;&amp;#x4E0A;&amp;#x770B;&amp;#xFF0C;&amp;#x5728;write_thread_entry&amp;#x662F;prepare_multi_write&amp;#xFF0C;&amp;#x5728;prepare_multi_write&amp;#x91CC;&amp;#x5FAA;&amp;#x73AF;&amp;#x8C03;&amp;#x7528;prepare_single_write&amp;#xFF0C;&amp;#x5927;&amp;#x81F4;&amp;#x7684;&amp;#x610F;&amp;#x601D;&amp;#x5C31;&amp;#x662F;&amp;#x5199;journal&amp;#x65F6;&amp;#x4F1A;&amp;#x5C06;&amp;#x4ECE;&amp;#x961F;&amp;#x5217;&amp;#x91CC;&amp;#x53D6;&amp;#x591A;&amp;#x4E2A;io&amp;#x62FC;&amp;#x5728;&amp;#x4E00;&amp;#x8D77;&amp;#xFF0C;&amp;#x653E;&amp;#x5230;bufferlist&amp;#x91CC;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x518D;&amp;#x4E0B;&amp;#x53D1;&amp;#x5230;&amp;#x540E;&amp;#x7AEF;&amp;#x8BBE;&amp;#x5907;&amp;#x3002;&amp;#x5728;&amp;#x62FC;io&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x5E76;&amp;#x4E0D;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x52B2;&amp;#x5730;&amp;#x5F80;bufferlist&amp;#x91CC;&amp;#x653E;&amp;#xFF0C;&amp;#x800C;&amp;#x662F;&amp;#x6709;&amp;#x9650;&amp;#x5236;&amp;#x7684;&amp;#xFF0C;&amp;#x53D6;&amp;#x51B3;&amp;#x4E8E;&amp;#x4E24;&amp;#x4E2A;&amp;#x53C2;&amp;#x6570;&amp;#xFF1A;&lt;br&gt;journal_max_write_bytes&amp;#xFF1A;journal&amp;#x4E00;&amp;#x6B21;&amp;#x6027;&amp;#x5199;&amp;#x5165;&amp;#x7684;&amp;#x6700;&amp;#x5927;&amp;#x5B57;&amp;#x8282;&amp;#x6570;&amp;#xFF0C;&amp;#x9ED8;&amp;#x8BA4;&amp;#x503C;&amp;#x662F;10MB&lt;br&gt;journal_max_write_entries&amp;#xFF1A;journal&amp;#x4E00;&amp;#x6B21;&amp;#x6027;&amp;#x5199;&amp;#x5165;&amp;#x7684;&amp;#x6700;&amp;#x5927;&amp;#x8BB0;&amp;#x5F55;&amp;#x6570;&amp;#xFF08;&amp;#x5373;&amp;#x5F80;bufferlist&amp;#x653E;&amp;#x7684;&amp;#x6700;&amp;#x5927;io&amp;#x6570;&amp;#xFF09;&amp;#xFF0C;&amp;#x9ED8;&amp;#x8BA4;&amp;#x503C;&amp;#x662F;100&lt;/p&gt;
&lt;p&gt;&amp;#x5E76;&amp;#x4E14;&amp;#x4ECE;&amp;#x65E5;&amp;#x5FD7;&amp;#x91CC;&amp;#x4E5F;&amp;#x770B;&amp;#x5230;&amp;#x6709;&amp;#x8D85;&amp;#x8FC7;journal_max_write_bytes&amp;#x7684;&amp;#x6253;&amp;#x5370;&amp;#x65E5;&amp;#x5FD7;&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.079302 7f87c05f4700 20 journal prepare_multi_write hit max write size 10485760&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x56E0;&amp;#x6B64;&amp;#x5C1D;&amp;#x8BD5;&amp;#x5C06;&amp;#x8FD9;&amp;#x4E2A;&amp;#x503C;&amp;#x6539;&amp;#x5927;&amp;#x6210;100MB&amp;#x518D;&amp;#x8BD5;&amp;#x8BD5;&amp;#xFF08;&amp;#x8C03;&amp;#x6574;&amp;#x8FD9;&amp;#x4E2A;&amp;#x53C2;&amp;#x6570;&amp;#x9700;&amp;#x8981;&amp;#x8C28;&amp;#x614E;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x8C03;&amp;#x5927;&amp;#x4E86;&amp;#x5BF9;&amp;#x78C1;&amp;#x76D8;&amp;#x7684;io&amp;#x538B;&amp;#x529B;&amp;#x4E5F;&amp;#x589E;&amp;#x5927;&amp;#x4E86;&amp;#xFF09;&amp;#xFF0C;&amp;#x4ECE;fio&amp;#x7684;&amp;#x7ED3;&amp;#x679C;&amp;#x6765;&amp;#x770B;&amp;#xFF0C;&amp;#x8FD8;&amp;#x662F;&amp;#x6027;&amp;#x80FD;&amp;#x9AA4;&amp;#x964D;&amp;#xFF0C;&amp;#x5F71;&amp;#x54CD;&amp;#x8FD8;&amp;#x662F;&amp;#x8DDF;&amp;#x4E4B;&amp;#x524D;&amp;#x4E00;&amp;#x6837;&amp;#xFF0C;&amp;#x4E0D;&amp;#x8FC7;&amp;#x4ECE;osd&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&amp;#x91CC;&amp;#x770B;&amp;#x5230;&amp;#x5199;journal&amp;#x7684;latency&amp;#x6700;&amp;#x5927;&amp;#x7684;&amp;#x662F;100&amp;#x591A;ms&amp;#xFF0C;&amp;#x6BD4;&amp;#x4E4B;&amp;#x524D;&amp;#x7684;300&amp;#x591A;ms&amp;#x964D;&amp;#x4F4E;&amp;#x4E86;&amp;#x4E00;&amp;#x4E9B;&amp;#xFF0C;&amp;#x8BF4;&amp;#x660E;&amp;#x6539;&amp;#x4E86;&amp;#x8FD9;&amp;#x4E2A;&amp;#x53C2;&amp;#x6570;&amp;#x6709;&amp;#x4E00;&amp;#x70B9;&amp;#x6548;&amp;#x679C;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x6548;&amp;#x679C;&amp;#x4E0D;&amp;#x660E;&amp;#x663E;&amp;#xFF0C;&amp;#x7136;&amp;#x5E76;&amp;#x5375;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x8FD9;&amp;#x6837;&amp;#x770B;&amp;#x6765;&amp;#xFF0C;&amp;#x5C31;&amp;#x5F88;&amp;#x6709;&amp;#x53EF;&amp;#x80FD;&amp;#x662F;&amp;#x7B2C;&amp;#x4E8C;&amp;#x4E2A;&amp;#x6000;&amp;#x7591;&amp;#x70B9;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x540E;&amp;#x7AEF;&amp;#x78C1;&amp;#x76D8;&amp;#x6162;&amp;#x4E86;&amp;#x5BFC;&amp;#x81F4;&amp;#x7684;&amp;#x3002;&amp;#x4F7F;&amp;#x7528;iostat&amp;#x89C2;&amp;#x5BDF;&amp;#x91CD;&amp;#x542F;osd&amp;#x671F;&amp;#x95F4;&amp;#x8FD9;&amp;#x4E2A;osd&amp;#x6240;&amp;#x5728;&amp;#x78C1;&amp;#x76D8;&amp;#x7684;io&amp;#x60C5;&amp;#x51B5;&amp;#x3002;&amp;#x5176;&amp;#x4E2D;sdu1&amp;#x662F;osd&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x76D8;&amp;#xFF0C;sdu2&amp;#x662F;osd&amp;#x7684;journal&amp;#x76D8;&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Device:         rrqm/s   wrqm/s     r/s     w/s    rMB/s    wMB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sdu               0.00     0.00    0.00  666.00     0.00   157.04   482.90   145.09  210.28    0.00  210.28   1.50 100.00&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sdu1              0.00     0.00    0.00  638.00     0.00   156.08   501.02   143.48  216.92    0.00  216.92   1.57 100.00&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sdu2              0.00     0.00    0.00    7.00     0.00     0.96   280.00     1.41  208.00    0.00  208.00 114.29  80.00&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;avg-cpu:  %user   %nice %system %iowait  %steal   %idle&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           4.96    0.00    4.87    4.03    0.00   86.14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Device:         rrqm/s   wrqm/s     r/s     w/s    rMB/s    wMB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sdu               0.00     0.00    0.00  636.00     0.00   156.46   503.81   177.52  259.62    0.00  259.62   1.57 100.00&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sdu1              0.00     0.00    0.00  528.00     0.00   137.25   532.38   145.96  272.19    0.00  272.19   1.89 100.00&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sdu2              0.00     0.00    0.00   72.00     0.00    19.20   546.22    31.45  295.78    0.00  295.78  12.17  87.60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;avg-cpu:  %user   %nice %system %iowait  %steal   %idle&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           7.03    0.00    4.77    3.58    0.00   84.63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Device:         rrqm/s   wrqm/s     r/s     w/s    rMB/s    wMB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sdu               0.00     0.00    0.00  842.00     0.00   154.83   376.58   117.44  174.29    0.00  174.29   1.18  99.60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sdu1              0.00     0.00    0.00  419.00     0.00    81.99   400.73    92.50  269.19    0.00  269.19   2.35  98.40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sdu2              0.00     0.00    0.00  269.00     0.00    72.84   554.56    24.59  124.94    0.00  124.94   3.06  82.40&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x6B63;&amp;#x5E38;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x76D8;&amp;#x548C;&amp;#x65E5;&amp;#x5FD7;&amp;#x76D8;&amp;#x4E0A;&amp;#x7684;io&amp;#x90FD;&amp;#x4E0D;&amp;#x7B97;&amp;#x5927;&amp;#xFF0C;&amp;#x81F3;&amp;#x5C11;&amp;#x5E26;&amp;#x5BBD;&amp;#x4E0D;&amp;#x5E26;&amp;#xFF0C;&amp;#x800C;&amp;#x4E14;&amp;#x90FD;&amp;#x662F;&amp;#x5C0F;io&amp;#xFF0C;&amp;#x5F53;&amp;#x8FDB;&amp;#x884C;&amp;#x6062;&amp;#x590D;&amp;#x65F6;&amp;#xFF0C;&amp;#x6570;&amp;#x636E;&amp;#x76D8;&amp;#x4E0A;&amp;#x7684;io&amp;#x4E00;&amp;#x4E0B;&amp;#x5B50;&amp;#x4E0A;&amp;#x53BB;&amp;#x4E86;&amp;#xFF0C;&amp;#x90FD;&amp;#x662F;&amp;#x5927;&amp;#x5757;io&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5F71;&amp;#x54CD;&amp;#x4E86;&amp;#x65E5;&amp;#x5FD7;&amp;#x76D8;&amp;#x7684;io&amp;#xFF08;&amp;#x56E0;&amp;#x4E3A;&amp;#x6570;&amp;#x636E;&amp;#x76D8;&amp;#x548C;&amp;#x65E5;&amp;#x5FD7;&amp;#x76D8;&amp;#x5404;&amp;#x5360;&amp;#x4E00;&amp;#x4E2A;&amp;#x5206;&amp;#x533A;&amp;#xFF09;&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;&amp;#x5199;journal&amp;#x6162;&amp;#x4E86;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x5C31;&amp;#x4F1A;&amp;#x6162;&amp;#x6162;&amp;#x5806;&amp;#x79EF;&amp;#xFF0C;&amp;#x4E00;&amp;#x6B21;&amp;#x63D0;&amp;#x4EA4;&amp;#x591A;&amp;#x4E2A;&amp;#xFF08;&amp;#x6B63;&amp;#x5E38;&amp;#x7684;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;&amp;#x5199;journal&amp;#x4E00;&amp;#x822C;&amp;#x5C31;&amp;#x4E00;&amp;#x6B21;&amp;#x4E00;&amp;#x4E2A;&amp;#xFF09;&amp;#xFF0C;&amp;#x4E00;&amp;#x4E0B;&amp;#x5B50;&amp;#x65E5;&amp;#x5FD7;&amp;#x76D8;&amp;#x4E0A;&amp;#x4E5F;&amp;#x53D8;&amp;#x6210;&amp;#x4E86;&amp;#x5927;&amp;#x5757;&amp;#x987A;&amp;#x5E8F;io&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;&amp;#x6570;&amp;#x636E;&amp;#x76D8;&amp;#x548C;&amp;#x65E5;&amp;#x5FD7;&amp;#x76D8;&amp;#x7684;&amp;#x76F8;&amp;#x4E92;&amp;#x5F71;&amp;#x54CD;&amp;#x4E0B;&amp;#xFF0C;&amp;#x5EF6;&amp;#x8FDF;&amp;#x5F88;&amp;#x9AD8;&amp;#xFF0C;&amp;#x5199;journal&amp;#x8FD9;&amp;#x4E48;&amp;#x9AD8;&amp;#x7684;&amp;#x5EF6;&amp;#x8FDF;&amp;#x5BFC;&amp;#x81F4;&amp;#x5199;io&amp;#x5806;&amp;#x79EF;&amp;#x53D8;&amp;#x6162;&amp;#xFF0C;&amp;#x4E0A;&amp;#x5C42;iops&amp;#x81EA;&amp;#x7136;&amp;#x5C31;&amp;#x964D;&amp;#x4F4E;&amp;#x4E86;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;2&amp;#xFF09;&amp;#x4E3A;&amp;#x4E86;&amp;#x8BC1;&amp;#x5B9E;&amp;#x4E0A;&amp;#x9762;&amp;#x7684;&amp;#x731C;&amp;#x6D4B;&amp;#xFF0C;&amp;#x5C06;&amp;#x8FD9;&amp;#x4E2A;osd&amp;#x7684;data&amp;#x76D8;&amp;#x548C;journal&amp;#x76D8;&amp;#x5206;&amp;#x5F00;&amp;#xFF0C;&amp;#x5404;&amp;#x5355;&amp;#x72EC;&amp;#x5360;&amp;#x4E00;&amp;#x5757;ssd&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x518D;&amp;#x8FDB;&amp;#x884C;&amp;#x91CD;&amp;#x542F;osd&amp;#x7684;&amp;#x6D4B;&amp;#x8BD5;&amp;#xFF0C;&amp;#x53D1;&amp;#x73B0;&amp;#x5BF9;&amp;#x5199;&amp;#x7684;&amp;#x5F71;&amp;#x54CD;&amp;#x5F88;&amp;#x5C0F;&amp;#x4E86;&amp;#xFF0C;&lt;br&gt;ceph osd perf&amp;#x6CA1;&amp;#x6709;&amp;#x53D1;&amp;#x73B0;osd&amp;#x7684;commit_latency&amp;#x6CA1;&amp;#x6709;&amp;#x660E;&amp;#x663E;&amp;#x7684;&amp;#x5347;&amp;#x9AD8;&amp;#xFF0C;iostat&amp;#x67E5;&amp;#x770B;&amp;#x7684;&amp;#x7ED3;&amp;#x679C;&amp;#x4E5F;&amp;#x8868;&amp;#x660E;journal&amp;#x76D8;&amp;#x4E0A;&amp;#x6CA1;&amp;#x6709;&amp;#x74F6;&amp;#x9888;&amp;#x4E86;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x8BC1;&amp;#x5B9E;&amp;#x4E86;&amp;#x4E0A;&amp;#x9762;&amp;#x7684;&amp;#x731C;&amp;#x6D4B;&amp;#xFF0C;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x5199;data&amp;#x76D8;&amp;#x5F71;&amp;#x54CD;&amp;#x4E86;&amp;#x5199;journal&amp;#x7684;io&amp;#x3002;&amp;#xFF08;ps&amp;#xFF1A;&amp;#x4E0D;&amp;#x8FC7;&amp;#x6211;&amp;#x4EEC;&amp;#x7528;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x4E0D;&amp;#x4F1A;&amp;#x5C06;osd&amp;#x7684;data&amp;#x76D8;&amp;#x548C;journal&amp;#x76D8;&amp;#x5206;&amp;#x522B;&amp;#x653E;&amp;#x5230;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;ssd&amp;#x4E0A;&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;&amp;#x6210;&amp;#x672C;&amp;#x592A;&amp;#x9AD8;&amp;#x4E86;&amp;#x3002;&amp;#xFF09;&lt;/p&gt;
&lt;p&gt;3&amp;#xFF09;&amp;#x53E6;&amp;#x5916;&amp;#xFF0C;&amp;#x9488;&amp;#x5BF9;ssd&amp;#x672C;&amp;#x8EAB;&amp;#x7684;&amp;#x6027;&amp;#x80FD;&amp;#x8FDB;&amp;#x884C;&amp;#x6D4B;&amp;#x8BD5;&amp;#xFF0C;&amp;#x4E5F;&amp;#x662F;&amp;#x5206;&amp;#x4E24;&amp;#x4E2A;&amp;#x5206;&amp;#x533A;&amp;#xFF0C;&amp;#x6A21;&amp;#x62DF;&amp;#x6062;&amp;#x590D;&amp;#x65F6;&amp;#x7684;io&amp;#x60C5;&amp;#x51B5;&amp;#xFF0C;&amp;#x5BF9;&amp;#x4E00;&amp;#x4E2A;&amp;#x5206;&amp;#x533A;&amp;#x8FDB;&amp;#x884C;&amp;#x968F;&amp;#x673A;&amp;#x5927;&amp;#x5757;&amp;#x5199;&amp;#xFF0C;&amp;#x5BF9;&amp;#x53E6;&amp;#x5916;&amp;#x4E00;&amp;#x4E2A;&amp;#x5206;&amp;#x533A;&amp;#x8FDB;&amp;#x884C;&amp;#x987A;&amp;#x5E8F;&amp;#x5927;&amp;#x5757;&amp;#x5199;&amp;#xFF0C;&amp;#x5F97;&amp;#x5230;&amp;#x7684;&amp;#x7ED3;&amp;#x679C;&amp;#x5982;&amp;#x4E0B;&amp;#xFF0C;&amp;#x8BF4;&amp;#x660E;&amp;#x8FD9;&amp;#x5757;ssd&amp;#x672C;&amp;#x8EAB;&amp;#x5728;&amp;#x8FD9;&amp;#x79CD;io&amp;#x6A21;&amp;#x5F0F;&amp;#x4E0B;&amp;#x5EF6;&amp;#x8FDF;&amp;#x5C31;&amp;#x5F88;&amp;#x9AD8;&amp;#x4E86;&amp;#xFF0C;&amp;#x800C;&amp;#x4E14;&amp;#x961F;&amp;#x5217;&amp;#x6DF1;&amp;#x5EA6;&amp;#x5F88;&amp;#x5927;&amp;#xFF0C;&amp;#x8BF4;&amp;#x660E;&amp;#x538B;&amp;#x529B;&amp;#x786E;&amp;#x5B9E;&amp;#x5F88;&amp;#x9AD8;&amp;#xFF0C;ssd&amp;#x4E5F;&amp;#x6491;&amp;#x4E0D;&amp;#x4F4F;&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Device:         rrqm/s   wrqm/s     r/s     w/s    rMB/s    wMB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sdu1              0.00     0.00    0.00  422.00     0.00   105.50   512.00    48.58  117.91    0.00  117.91   2.37 100.00&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sdu2              0.00     0.00    0.00  256.00     0.00    46.88   375.00    31.96  116.92    0.00  116.92   3.91 100.00&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;avg-cpu:  %user   %nice %system %iowait  %steal   %idle&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           1.93    0.00    3.04    6.28    0.00   88.75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Device:         rrqm/s   wrqm/s     r/s     w/s    rMB/s    wMB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sdu1              0.00     0.00    0.00  395.00     0.00    98.75   512.00    48.34  119.68    0.00  119.68   2.53 100.00&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sdu3              0.00     0.00    0.00  280.00     0.00    52.25   382.17    31.98  120.26    0.00  120.26   3.57 100.00&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;avg-cpu:  %user   %nice %system %iowait  %steal   %idle&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           3.39    0.00    3.99    5.63    0.00   86.99&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Device:         rrqm/s   wrqm/s     r/s     w/s    rMB/s    wMB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sdu1              0.00     0.00    0.00  407.00     0.00   101.77   512.12    46.86  118.06    0.00  118.06   2.46 100.00&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sdu2             28.00     0.00    4.00  166.00     0.02    31.87   384.19    22.00  137.15   72.00  138.72   5.86  99.60&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;4&amp;#xFF09;&amp;#x800C;&amp;#x5BF9;&amp;#x4E8E;&amp;#x65B0;&amp;#x7684;ssd&amp;#x4E5F;&amp;#x8FDB;&amp;#x884C;&amp;#x4E86;&amp;#x7C7B;&amp;#x4F3C;&amp;#x7684;&amp;#x6D4B;&amp;#x8BD5;&amp;#xFF0C;&amp;#x7ED3;&amp;#x679C;&amp;#x8981;&amp;#x597D;&amp;#x4E00;&amp;#x4E9B;&amp;#xFF0C;&amp;#x5EF6;&amp;#x8FDF;&amp;#x624D;&amp;#x51E0;&amp;#x5341;ms.&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Device:         rrqm/s   wrqm/s     r/s     w/s    rMB/s    wMB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sdc               0.00     0.00    0.00 2445.00     0.00   553.62   463.73    79.92   32.40    0.00   32.40   0.41 100.00&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sdc1              0.00     0.00    0.00 1481.00     0.00   370.25   512.00    47.95   32.40    0.00   32.40   0.68 100.00&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sdc2              0.00     0.00    0.00  964.00     0.00   183.38   389.58    31.97   32.39    0.00   32.39   1.04 100.00&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;avg-cpu:  %user   %nice %system %iowait  %steal   %idle&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           0.04    0.00    0.04   10.33    0.00   89.59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Device:         rrqm/s   wrqm/s     r/s     w/s    rMB/s    wMB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sdc               0.00     0.00    0.00 2524.00     0.00   570.25   462.71    79.95   31.86    0.00   31.86   0.40 100.00&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sdc1              0.00     0.00    0.00 1504.00     0.00   376.00   512.00    47.98   31.86    0.00   31.86   0.66 100.00&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sdc2              0.00     0.00    0.00 1020.00     0.00   194.25   390.02    31.97   31.85    0.00   31.85   0.98 100.00&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;avg-cpu:  %user   %nice %system %iowait  %steal   %idle&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           0.04    0.00    0.17   11.13    0.00   88.66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Device:         rrqm/s   wrqm/s     r/s     w/s    rMB/s    wMB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sdc               0.00     0.00    0.00 2505.00     0.00   563.00   460.29    79.94   31.71    0.00   31.71   0.40 100.00&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sdc1              0.00     0.00    0.00 1513.00     0.00   378.25   512.00    47.95   31.71    0.00   31.71   0.66 100.00&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sdc2              0.00     0.00    0.00  992.00     0.00   184.75   381.42    31.98   31.73    0.00   31.73   1.01 100.00&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;5&amp;#xFF09;&amp;#x4E8B;&amp;#x5B9E;&amp;#x4E0A;&amp;#xFF0C;&amp;#x4ECE;&amp;#x4EE3;&amp;#x7801;&amp;#x4E0A;&amp;#x6765;&amp;#x770B;&amp;#xFF0C;&amp;#x5728;journal&amp;#x7684;write thread&amp;#x91CC;&amp;#x6709;&amp;#x9650;&amp;#x5236;aio&amp;#x7684;&amp;#x673A;&amp;#x5236;&amp;#x6765;&amp;#x907F;&amp;#x514D;&amp;#x5BF9;&amp;#x78C1;&amp;#x76D8;&amp;#x5E26;&amp;#x6765;&amp;#x8FC7;&amp;#x5927;&amp;#x7684;&amp;#x538B;&amp;#x529B;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x4E00;&amp;#x4E2A;&amp;#x52B2;&amp;#x5730;&amp;#x5F80;&amp;#x78C1;&amp;#x76D8;&amp;#x4E0B;&amp;#x53D1;io&amp;#xFF0C;&amp;#x78C1;&amp;#x76D8;&amp;#x4E5F;&amp;#x6709;&amp;#x5904;&amp;#x7406;&amp;#x6781;&amp;#x9650;&amp;#xFF0C;&amp;#x8D85;&amp;#x8FC7;&amp;#x5904;&amp;#x7406;&amp;#x80FD;&amp;#x529B;&amp;#x53EA;&amp;#x4F1A;&amp;#x8BA9;&amp;#x540E;&amp;#x7EED;&amp;#x7684;io&amp;#x66F4;&amp;#x6162;&amp;#xFF0C;&amp;#x8FD8;&amp;#x4E0D;&amp;#x5982;&amp;#x5728;&amp;#x961F;&amp;#x5217;&amp;#x91CC;&amp;#x7B49;&amp;#x7740;&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2015/12/05/restart-osd-affects/write-thread.png&quot; alt=&quot;write-thread&quot;&gt;&lt;br&gt;&amp;#x4ECE;&amp;#x65E5;&amp;#x5FD7;&amp;#x91CC;&amp;#x4E5F;&amp;#x80FD;&amp;#x770B;&amp;#x5230;&amp;#x9650;&amp;#x5236;aio&amp;#x65F6;&amp;#x7684;log&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.084964 7f87c05f4700 20 journal write_thread_entry aio throttle: aio num 1 bytes 12607488 ... exp 2 min_new 4 ... pending 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2015-12-02 09:47:36.084967 7f87c05f4700 20 journal write_thread_entry deferring until more aios complete: 1 aios with 12607488 bytes needs 4 bytes to start a new aio (currently 0 pending)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&quot;3-5-&amp;#x8C03;&amp;#x6574;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x53C2;&amp;#x6570;&quot;&gt;&lt;a href=&quot;#3-5-&amp;#x8C03;&amp;#x6574;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x53C2;&amp;#x6570;&quot; class=&quot;headerlink&quot; title=&quot;3.5 &amp;#x8C03;&amp;#x6574;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x53C2;&amp;#x6570;&quot;&gt;&lt;/a&gt;3.5 &amp;#x8C03;&amp;#x6574;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x53C2;&amp;#x6570;&lt;/h2&gt;&lt;p&gt;&amp;#x4ECE;&amp;#x4E0A;&amp;#x9762;&amp;#x7684;&amp;#x5206;&amp;#x6790;&amp;#x770B;&amp;#x6765;&amp;#xFF0C;&amp;#x672C;&amp;#x8D28;&amp;#x4E0A;&amp;#x7684;&amp;#x5F71;&amp;#x54CD;&amp;#x8FD8;&amp;#x662F;&amp;#x7531;&amp;#x4E8E;&amp;#x6062;&amp;#x590D;&amp;#x5BFC;&amp;#x81F4;&amp;#x7684;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x5C31;&amp;#x63A7;&amp;#x5236;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x901F;&amp;#x5EA6;&amp;#x6765;&amp;#x51CF;&amp;#x5C0F;&amp;#x5BF9;&amp;#x6B63;&amp;#x5E38;io&amp;#x7684;&amp;#x5F71;&amp;#x54CD;&amp;#x3002;&amp;#x4FEE;&amp;#x6539;&amp;#x4E0B;&amp;#x9762;&amp;#x51E0;&amp;#x4E2A;&amp;#x53C2;&amp;#x6570;&amp;#xFF1A;&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#ceph tell osd.* injectargs &amp;apos;--osd_recovery_threads 1&amp;apos;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#ceph tell osd.* injectargs &amp;apos;--osd_max_backfills 1&amp;apos;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#ceph tell osd.* injectargs &amp;apos;--osd_recovery_max_active 1&amp;apos;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#ceph tell osd.* injectargs &amp;apos;--osd_recovery_max_chunk  16777216&amp;apos;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x7136;&amp;#x540E;&amp;#x518D;&amp;#x8FDB;&amp;#x884C;&amp;#x91CD;&amp;#x542F;osd&amp;#x7684;&amp;#x6062;&amp;#x590D;&amp;#x6D4B;&amp;#x8BD5;&amp;#xFF0C;&amp;#x53D1;&amp;#x73B0;&amp;#x6548;&amp;#x679C;&amp;#x4E0D;&amp;#x660E;&amp;#x663E;&amp;#xFF0C;&amp;#x5BF9;&amp;#x6B63;&amp;#x5E38;io&amp;#x7684;&amp;#x5F71;&amp;#x54CD;&amp;#x4ECD;&amp;#x7136;&amp;#x5F88;&amp;#x5927;&amp;#x3002;&amp;#x800C;&amp;#x4E14;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5F71;&amp;#x54CD;&amp;#x8FD8;&amp;#x662F;&amp;#x5168;&amp;#x5C40;&amp;#x7684;&amp;#xFF0C;&amp;#x57FA;&amp;#x672C;&amp;#x4E0A;&amp;#x4F1A;&amp;#x5F71;&amp;#x54CD;&amp;#x5230;&amp;#x6240;&amp;#x6709;&amp;#x7684;ceph&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#xFF0C;&amp;#x5F71;&amp;#x54CD;&amp;#x5927;&amp;#x5C0F;&amp;#x53CA;&amp;#x65F6;&amp;#x95F4;&amp;#x53D6;&amp;#x51B3;&amp;#x4E8E;io&amp;#x7684;&amp;#x538B;&amp;#x529B;&amp;#x53CA;&amp;#x4FEE;&amp;#x590D;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x91CF;&amp;#x3002;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;#x6700;&amp;#x8FD1;&amp;#x6D4B;&amp;#x8BD5;ceph&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x5BF9;&amp;#x4E1A;&amp;#x52A1;io&amp;#x7684;&amp;#x5F71;&amp;#x54CD;&amp;#xFF0C;&amp;#x53D1;&amp;#x73B0;&amp;#x4FEE;&amp;#x590D;&amp;#x65F6;ceph&amp;#x96C6;&amp;#x7FA4;&amp;#x7684;&amp;#x6027;&amp;#x80FD;&amp;#x9AA4;&amp;#x964D;&amp;#xFF0C;&amp;#x6BD4;&amp;#x5982;&amp;#x6B63;&amp;#x5E38;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;&amp;#x4E00;&amp;#x4E2A;&amp;#x5377;&amp;#x7684;&amp;#x968F;&amp;#x673A;4k&amp;#x5199;&amp;#x7684;iops&amp;#x7EA6;10k&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x9AA4;&amp;#x964D;&amp;#x5230;1k&amp;#x5DE6;&amp;#x53F3;&amp;#x3002;&amp;#x4ECE;ceph&amp;#x8BBE;&amp;#x8BA1;&amp;#x6765;&amp;#x8BF4;&amp;#xFF0C;&amp;#x6062;&amp;#x590D;&amp;#x6D89;&amp;#x53CA;&amp;#x5230;peering&amp;#xFF0C;backfill&amp;#xFF0C;remap&amp;#x7B49;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x5BF9;&amp;#x6027;&amp;#x80FD;&amp;#x5FC5;&amp;#x7136;&amp;#x4F1A;&amp;#x5B58;&amp;#x5728;&amp;#x5F71;&amp;#x54CD;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x5148;&amp;#x4E0D;&amp;#x6DF1;&amp;#x7A76;ceph&amp;#x7684;&amp;#x6062;&amp;#x590D;&amp;#x673A;&amp;#x5236;&amp;#xFF0C;&amp;#x540E;&amp;#x7EED;&amp;#x7814;&amp;#x7A76;&amp;#x6E05;&amp;#x695A;&amp;#x4E86;&amp;#x518D;&amp;#x8FDB;&amp;#x884C;&amp;#x5206;&amp;#x6790;&amp;#xFF0C;&amp;#x672C;&amp;#x6587;&amp;#x4EE5;&amp;#x91CD;&amp;#x542F;osd&amp;#x4E3A;&amp;#x4F8B;&amp;#xFF0C;&amp;#x4ECE;&amp;#x73B0;&amp;#x8C61;&amp;#x5165;&amp;#x624B;&amp;#x6765;&amp;#x7B80;&amp;#x8981;&amp;#x5206;&amp;#x6790;&amp;#x91CD;&amp;#x542F;osd&amp;#x5BF9;ceph&amp;#x6027;&amp;#x80FD;&amp;#x7684;&amp;#x5F71;&amp;#x54CD;&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;1-&amp;#x73AF;&amp;#x5883;&amp;#x914D;&amp;#x7F6E;&quot;&gt;&lt;a href=&quot;#1-&amp;#x73AF;&amp;#x5883;&amp;#x914D;&amp;#x7F6E;&quot; class=&quot;headerlink&quot; title=&quot;1.&amp;#x73AF;&amp;#x5883;&amp;#x914D;&amp;#x7F6E;&quot;&gt;&lt;/a&gt;1.&amp;#x73AF;&amp;#x5883;&amp;#x914D;&amp;#x7F6E;&lt;/h1&gt;&lt;p&gt;1&amp;#xFF09;&amp;#x786C;&amp;#x4EF6;&amp;#x914D;&amp;#x7F6E;&amp;#xFF1A;&amp;#x4F7F;&amp;#x7528;openstack + ceph&amp;#x540E;&amp;#x7AEF;&amp;#xFF0C;&amp;#x8BA1;&amp;#x7B97;&amp;#x548C;&amp;#x5B58;&amp;#x50A8;&amp;#x5206;&amp;#x79BB;&amp;#xFF0C;6&amp;#x53F0;&amp;#x7269;&amp;#x7406;&amp;#x673A;&amp;#x4F5C;&amp;#x4E3A;ceph&amp;#x5B58;&amp;#x50A8;&amp;#x8282;&amp;#x70B9;&amp;#xFF0C;&amp;#x6BCF;&amp;#x53F0;&amp;#x673A;&amp;#x5668;6&amp;#x5757;ssd&amp;#xFF0C;&amp;#x6BCF;&amp;#x5757;ssd&amp;#x4E0A;&amp;#x8FD0;&amp;#x884C;&amp;#x4E00;&amp;#x4E2A;osd&amp;#xFF08;&amp;#x5176;&amp;#x4E2D;journal&amp;#x548C;data&amp;#x5404;&amp;#x5360;&amp;#x4E00;&amp;#x4E2A;&amp;#x5206;&amp;#x533A;&amp;#xFF09;&amp;#xFF0C;&amp;#x6574;&amp;#x4E2A;&amp;#x96C6;&amp;#x7FA4;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x6D41;&amp;#x4F7F;&amp;#x7528;&amp;#x4E07;&amp;#x5146;&amp;#x7F51;&amp;#x7EDC;&amp;#xFF1B;&lt;br&gt;2&amp;#xFF09;&amp;#x6D4B;&amp;#x8BD5;&amp;#x65F6;&amp;#x5728;6&amp;#x53F0;kvm&amp;#x865A;&amp;#x62DF;&amp;#x673A;&amp;#x91CC;&amp;#x5206;&amp;#x522B;&amp;#x6302;&amp;#x8F7D;&amp;#x4E00;&amp;#x5757;20GB&amp;#x7684;ceph&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x4F7F;&amp;#x7528;fio&amp;#x5206;&amp;#x522B;&amp;#x8DD1;6&amp;#x79CD;I/O&amp;#x6A21;&amp;#x578B;&amp;#xFF1A;4KB&amp;#x5757;&amp;#x5927;&amp;#x5C0F;&amp;#x7684;&amp;#x968F;&amp;#x673A;&amp;#x5199;&amp;#xFF0C;4KB&amp;#x5757;&amp;#x5927;&amp;#x5C0F;&amp;#x7684;&amp;#x968F;&amp;#x673A;&amp;#x8BFB;&amp;#xFF0C;4KB&amp;#x5757;&amp;#x5927;&amp;#x5C0F;&amp;#x7684;&amp;#x968F;&amp;#x673A;&amp;#x6DF7;&amp;#x5408;&amp;#x8BFB;&amp;#x5199;&amp;#xFF08;1:1&amp;#x6BD4;&amp;#x4F8B;&amp;#xFF09;&amp;#xFF0C;64KB&amp;#x5757;&amp;#x5927;&amp;#x5C0F;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x5199;&amp;#xFF0C;64KB&amp;#x5757;&amp;#x5927;&amp;#x5C0F;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x8BFB;&amp;#xFF0C;64KB&amp;#x5757;&amp;#x5927;&amp;#x5C0F;&amp;#x7684;&amp;#x987A;&amp;#x5E8F;&amp;#x6DF7;&amp;#x5408;&amp;#x8BFB;&amp;#x5199;&amp;#xFF08;1:1&amp;#x6BD4;&amp;#x4F8B;&amp;#xFF09;&amp;#x3002;&amp;#x4F7F;&amp;#x7528;&amp;#x8FD9;&amp;#x6837;&amp;#x7684;&amp;#x6A21;&amp;#x578B;&amp;#x6765;&amp;#x6A21;&amp;#x62DF;&amp;#x96C6;&amp;#x7FA4;&amp;#x8D1F;&amp;#x8F7D;&amp;#xFF1B;&lt;/p&gt;
&lt;h1 id=&quot;2-&amp;#x91CD;&amp;#x542F;osd&amp;#x8FDB;&amp;#x884C;&amp;#x6D4B;&amp;#x8BD5;&quot;&gt;&lt;a href=&quot;#2-&amp;#x91CD;&amp;#x542F;osd&amp;#x8FDB;&amp;#x884C;&amp;#x6D4B;&amp;#x8BD5;&quot; class=&quot;headerlink&quot; title=&quot;2.&amp;#x91CD;&amp;#x542F;osd&amp;#x8FDB;&amp;#x884C;&amp;#x6D4B;&amp;#x8BD5;&quot;&gt;&lt;/a&gt;2.&amp;#x91CD;&amp;#x542F;osd&amp;#x8FDB;&amp;#x884C;&amp;#x6D4B;&amp;#x8BD5;&lt;/h1&gt;&lt;p&gt;1&amp;#xFF09;&amp;#x5148;&amp;#x5C06;6&amp;#x4E2A;&amp;#x5377;&amp;#x7684;I/O&amp;#x8DD1;&amp;#x8D77;&amp;#x6765;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x91CD;&amp;#x542F;&amp;#x4E00;&amp;#x4E2A;osd&amp;#xFF1B;&lt;br&gt;2&amp;#xFF09;&amp;#x89C2;&amp;#x5BDF;&amp;#x5230;&amp;#x968F;&amp;#x673A;&amp;#x5199;&amp;#x7684;iops&amp;#x4ECE;10k&amp;#x964D;&amp;#x5230;&amp;#x4F4E;&amp;#x4E8E;1k&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x6CE2;&amp;#x52A8;&amp;#x8FD8;&amp;#x6BD4;&amp;#x8F83;&amp;#x5927;&amp;#xFF0C;&amp;#x968F;&amp;#x673A;&amp;#x8BFB;&amp;#x7684;iops&amp;#x4ECE;10k&amp;#x964D;&amp;#x5230;&amp;#x51E0;&amp;#x767E;&amp;#xFF1B;&lt;br&gt;3&amp;#xFF09;&amp;#x6027;&amp;#x80FD;&amp;#x4E0B;&amp;#x964D;&amp;#x6301;&amp;#x7EED;&amp;#x4E86;10&amp;#x51E0;&amp;#x79D2;&amp;#x540E;&amp;#x53C8;&amp;#x6B63;&amp;#x5E38;&amp;#xFF0C;&amp;#x662F;&amp;#x56E0;&amp;#x4E3A;&amp;#x6062;&amp;#x590D;&amp;#x5B8C;&amp;#x4E86;&amp;#xFF1B;&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ceph" scheme="http://yoursite.com/categories/ceph/"/>
    
    
      <category term="ceph" scheme="http://yoursite.com/tags/ceph/"/>
    
      <category term="osd" scheme="http://yoursite.com/tags/osd/"/>
    
      <category term="performance" scheme="http://yoursite.com/tags/performance/"/>
    
  </entry>
  
  <entry>
    <title>ceph OSD读写流程（3）–副本OSD的消息处理及主OSD的响应处理</title>
    <link href="http://yoursite.com/2015/11/25/ceph-osd-rw3/"/>
    <id>http://yoursite.com/2015/11/25/ceph-osd-rw3/</id>
    <published>2015-11-25T07:57:12.000Z</published>
    <updated>2016-05-13T09:01:07.620Z</updated>
    
    <content type="html">&lt;p&gt;&lt;img src=&quot;/2015/11/25/ceph-osd-rw3/replica.png&quot; alt=&quot;replica&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&amp;#x526F;&amp;#x672C;OSD&amp;#x6536;&amp;#x5230;&amp;#x4E3B;OSD&amp;#x7684;&amp;#x5199;&amp;#x8BF7;&amp;#x6C42;&amp;#x65F6;&amp;#xFF0C;&amp;#x4E5F;&amp;#x662F;&amp;#x6309;&amp;#x7167;&amp;#x6D88;&amp;#x606F;&amp;#x5904;&amp;#x7406;&amp;#x7684;&amp;#x6D41;&amp;#x7A0B;&amp;#x4ECE;&amp;#x961F;&amp;#x5217;&amp;#x91CC;&amp;#x53D6;&amp;#x51FA;&amp;#x6765;&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x5148;&amp;#x5199;PGLog&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x6CE8;&amp;#x518C;&amp;#x4E24;&amp;#x4E2A;&amp;#x56DE;&amp;#x8C03;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x8FDB;&amp;#x884C;&amp;#x5199;journal&amp;#x548C;&amp;#x5199;&amp;#x672C;&amp;#x5730;&amp;#x7F13;&amp;#x5B58;&amp;#x7684;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x5728;&amp;#x5904;&amp;#x7406;&amp;#x5B8C;&amp;#x6210;&amp;#x540E;&amp;#x53D1;&amp;#x9001;&amp;#x54CD;&amp;#x5E94;&amp;#x7ED9;&amp;#x4E3B;OSD&amp;#xFF08;op_modify_commit&amp;#x548C;op_modify_applied&amp;#xFF09;&amp;#xFF0C;&amp;#x5177;&amp;#x4F53;&amp;#x6D41;&amp;#x7A0B;&amp;#x53C2;&amp;#x8003;&amp;#x4E0A;&amp;#x4E00;&amp;#x7BC7;&amp;#x6587;&amp;#x7AE0;&amp;#xFF1B;&lt;/li&gt;
&lt;li&gt;&amp;#x4E3B;OSD&amp;#x6536;&amp;#x5230;&amp;#x526F;&amp;#x672C;OSD&amp;#x7684;&amp;#x54CD;&amp;#x5E94;&amp;#x540E;&amp;#xFF0C;&amp;#x4ECE;in_progress_ops&amp;#x4E2D;&amp;#x627E;&amp;#x5230;op&amp;#xFF0C;op&amp;#x91CC;&amp;#x5C31;&amp;#x6709;&amp;#x6CE8;&amp;#x518C;&amp;#x7684;&amp;#x56DE;&amp;#x8C03;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x5224;&amp;#x65AD;flag&amp;#x5982;&amp;#x679C;&amp;#x662F;CEPH_OSD_FLG_ONDISK&amp;#xFF0C;&amp;#x5219;&amp;#x4ECE;waiting_for_commit&amp;#x4E2D;&amp;#x5220;&amp;#x9664;&amp;#xFF0C;&amp;#x5426;&amp;#x5219;&amp;#x4ECE;waiting_for_applied&amp;#x4E2D;&amp;#x5220;&amp;#x9664;&amp;#xFF1B;&amp;#x7136;&amp;#x540E;&amp;#x6839;&amp;#x636E;waiting_for_commit/waiting_for_applied&amp;#x662F;&amp;#x5426;&amp;#x4E3A;&amp;#x7A7A;&amp;#xFF0C;&amp;#x6765;&amp;#x8C03;&amp;#x7528;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x56DE;&amp;#x8C03;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x5728;&amp;#x5B8C;&amp;#x6210;&amp;#x7684;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;&amp;#x53D1;&amp;#x9001;&amp;#x6D88;&amp;#x606F;&amp;#x7ED9;&amp;#x5BA2;&amp;#x6237;&amp;#x7AEF;&amp;#xFF1B;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&amp;#x5BF9;&amp;#x4E8E;0.80.10&amp;#x7248;&amp;#x672C;&amp;#xFF0C;&amp;#x6CA1;&amp;#x6709;MSG_OSD_REPOP&amp;#xFF0C;&amp;#x53EA;&amp;#x6709;MSG_OSD_SUBOP&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/2015/11/25/ceph-osd-rw3/replica.png&quot; alt=&quot;replica&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&amp;#x526F;&amp;#x672C;OSD&amp;#x6536;&amp;#x5230;&amp;#x4E3B;OSD&amp;#x7684;&amp;#x5199
    
    </summary>
    
      <category term="ceph" scheme="http://yoursite.com/categories/ceph/"/>
    
    
      <category term="ceph" scheme="http://yoursite.com/tags/ceph/"/>
    
      <category term="osd" scheme="http://yoursite.com/tags/osd/"/>
    
      <category term="replica" scheme="http://yoursite.com/tags/replica/"/>
    
  </entry>
  
  <entry>
    <title>ceph OSD读写流程（2）–主OSD的写操作事务的处理</title>
    <link href="http://yoursite.com/2015/11/25/ceph-osd-rw2/"/>
    <id>http://yoursite.com/2015/11/25/ceph-osd-rw2/</id>
    <published>2015-11-25T07:51:59.000Z</published>
    <updated>2016-05-13T09:01:22.141Z</updated>
    
    <content type="html">&lt;p&gt;&lt;img src=&quot;/2015/11/25/ceph-osd-rw2/journal-trans.png&quot; alt=&quot;journal-trans&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;OSD&amp;#x4E2D;&amp;#x5199;&amp;#x64CD;&amp;#x4F5C;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x4E2D;&amp;#x6D89;&amp;#x53CA;&amp;#x5230;&amp;#x5F88;&amp;#x591A;&amp;#x56DE;&amp;#x8C03;&amp;#x51FD;&amp;#x6570;&amp;#xFF08;&amp;#x8FD9;&amp;#x4E5F;&amp;#x662F;ceph&amp;#x672C;&amp;#x8EAB;&amp;#x7684;&amp;#x4E00;&amp;#x4E2A;&amp;#x7279;&amp;#x70B9;&amp;#xFF09;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E9B;&amp;#x56DE;&amp;#x8C03;&amp;#x51FD;&amp;#x6570;&amp;#x8FFD;&amp;#x6EAF;&amp;#x5230;Context&amp;#x7C7B;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x7C7B;&amp;#x662F;&amp;#x56DE;&amp;#x8C03;&amp;#x51FD;&amp;#x6570;&amp;#x7C7B;&amp;#x7684;&amp;#x62BD;&amp;#x8C61;&amp;#x57FA;&amp;#x7C7B;&amp;#xFF0C;&amp;#x7EE7;&amp;#x627F;&amp;#x5B83;&amp;#x7684;&amp;#x7C7B;&amp;#x53EA;&amp;#x9700;&amp;#x8981;&amp;#x5728;&amp;#x5B50;&amp;#x7C7B;&amp;#x4E2D;&amp;#x5B9E;&amp;#x73B0;&amp;#x5B83;&amp;#x7684;finish&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x518D;finish&amp;#x51FD;&amp;#x6570;&amp;#x4E2D;&amp;#x8C03;&amp;#x7528;&amp;#x81EA;&amp;#x5DF1;&amp;#x6CE8;&amp;#x518C;&amp;#x7684;&amp;#x56DE;&amp;#x8C03;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x5C31;&amp;#x80FD;&amp;#x5B8C;&amp;#x6210;&amp;#x56DE;&amp;#x8C03;&amp;#xFF1B;&lt;/li&gt;
&lt;li&gt;&amp;#x4E0A;&amp;#x9762;&amp;#x8BF4;&amp;#x5230;&amp;#x7684;&amp;#x8C03;&amp;#x7528;Context&amp;#x7C7B;&amp;#x7684;finish&amp;#x51FD;&amp;#x6570;&amp;#x5C31;&amp;#x80FD;&amp;#x8FDB;&amp;#x884C;&amp;#x56DE;&amp;#x8C03;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x5177;&amp;#x4F53;&amp;#x8C03;&amp;#x7528;&amp;#x5B83;&amp;#x7684;&amp;#x5730;&amp;#x65B9;&amp;#x5C31;&amp;#x5728;Finisher&amp;#x7C7B;&amp;#x7684;finisher_thread_entry&amp;#x91CC;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x662F;finisher&amp;#x7684;&amp;#x7EBF;&amp;#x7A0B;&amp;#x5904;&amp;#x7406;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;finisher&amp;#x8FD8;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;finisher_queue&amp;#xFF0C;&amp;#x5B9E;&amp;#x73B0;&amp;#x751F;&amp;#x4EA7;&amp;#x8005;&amp;#x6D88;&amp;#x8D39;&amp;#x8005;&amp;#x6A21;&amp;#x578B;&amp;#xFF0C;&amp;#x751F;&amp;#x4EA7;&amp;#x8005;&amp;#x5F80;finisher_queue&amp;#x91CC;&amp;#x653E;&amp;#x4E1C;&amp;#x897F;&amp;#xFF0C;&amp;#x5E76;&amp;#x901A;&amp;#x8FC7;&amp;#x6761;&amp;#x4EF6;&amp;#x53D8;&amp;#x91CF;&amp;#x901A;&amp;#x77E5;finisher&amp;#x7684;&amp;#x7EBF;&amp;#x7A0B;&amp;#x5904;&amp;#x7406;&amp;#x51FD;&amp;#x6570;&amp;#x6765;&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x5728;&amp;#x8FD9;&amp;#x4E2A;&amp;#x7EBF;&amp;#x7A0B;&amp;#x5904;&amp;#x7406;&amp;#x51FD;&amp;#x6570;&amp;#x91CC;&amp;#x5C31;&amp;#x80FD;&amp;#x901A;&amp;#x8FC7;&amp;#x8C03;&amp;#x7528;Context&amp;#x7C7B;&amp;#x7684;complete&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x8C03;&amp;#x7528;&amp;#x6389;&amp;#x5176;&amp;#x5B50;&amp;#x7C7B;&amp;#x5B9E;&amp;#x73B0;&amp;#x7684;finish&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;&amp;#x5B8C;&amp;#x6210;&amp;#x56DE;&amp;#x8C03;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#xFF1B;&lt;/li&gt;
&lt;li&gt;OSD&amp;#x7684;&amp;#x5199;&amp;#x64CD;&amp;#x4F5C;&amp;#x5148;&amp;#x653E;&amp;#x5230;writeq&amp;#x91CC;&amp;#xFF0C;&amp;#x901A;&amp;#x77E5;FileJournal&amp;#x7684;&amp;#x7EBF;&amp;#x7A0B;&amp;#x5904;&amp;#x7406;&amp;#x51FD;&amp;#x6570;&amp;#x8FDB;&amp;#x884C;&amp;#x5199;journal&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x518D;&amp;#x653E;&amp;#x5165;&amp;#x5230;journal&amp;#x7684;finisher_queue&amp;#x91CC;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;finisher&amp;#x7EBF;&amp;#x7A0B;&amp;#x5904;&amp;#x7406;&amp;#x51FD;&amp;#x6570;&amp;#x8C03;&amp;#x7528;&amp;#x4E4B;&amp;#x524D;&amp;#x6CE8;&amp;#x518C;&amp;#x7684;&amp;#x56DE;&amp;#x8C03;&amp;#x51FD;&amp;#x6570;&amp;#xFF08;&lt;strong&gt;C_JournaledAhead&lt;/strong&gt;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x51FD;&amp;#x8C03;&amp;#x51FD;&amp;#x6570;&amp;#x662F;FileStore::_journaled_ahead&amp;#xFF09;&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x5C31;&amp;#x5206;&amp;#x6210;&amp;#x4E24;&amp;#x6761;&amp;#x7EBF;&amp;#x8DEF;&amp;#x8FDB;&amp;#x884C;&amp;#x4E0B;&amp;#x53BB;&amp;#xFF1A;&lt;ul&gt;
&lt;li&gt;&amp;#x653E;&amp;#x5165;ondisk_finisher&amp;#xFF0C;&amp;#x8FDB;&amp;#x800C;&amp;#x89E6;&amp;#x53D1;ondisk_finisher&amp;#x7684;&amp;#x7EBF;&amp;#x7A0B;&amp;#x5904;&amp;#x7406;&amp;#x51FD;&amp;#x6570;&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x5C31;&amp;#x4F1A;&amp;#x8C03;&amp;#x7528;&amp;#x5230;&lt;strong&gt;C_OSD_OnOpCommit&lt;/strong&gt;&amp;#x7684;&amp;#x51FD;&amp;#x8C03;&amp;#x51FD;&amp;#x6570;ReplicatedBackend::op_commit&amp;#xFF0C;&amp;#x5728;&amp;#x8FD9;&amp;#x91CC;&amp;#x9762;&amp;#x4F1A;&amp;#x68C0;&amp;#x67E5;waiting_for_commit&amp;#x662F;&amp;#x5426;&amp;#x4E3A;&amp;#x7A7A;&amp;#xFF08;&amp;#x5982;&amp;#x679C;&amp;#x662F;3&amp;#x526F;&amp;#x672C;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x9762;&amp;#x5C31;&amp;#x6709;3&amp;#x9879;&amp;#xFF0C;&amp;#x6BCF;&amp;#x5B8C;&amp;#x6210;&amp;#x4E00;&amp;#x4E2A;&amp;#x526F;&amp;#x672C;&amp;#x7684;&amp;#x5199;journal&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x5C31;&amp;#x4F1A;&amp;#x4ECE;waiting_for_commit&amp;#x91CC;&amp;#x5220;&amp;#x9664;&amp;#x4E00;&amp;#x4E2A;&amp;#xFF09;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x4E3A;&amp;#x7A7A;&amp;#xFF0C;&amp;#x624D;&amp;#x8C03;&amp;#x7528;&lt;strong&gt;C_OSD_RepopCommit&lt;/strong&gt;&amp;#x7684;&amp;#x56DE;&amp;#x8C03;&amp;#x51FD;&amp;#x6570;repop_all_committed&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;&amp;#x8C03;&amp;#x7528;ReplicatePG::eval_repop&amp;#x53D1;&amp;#x7ED9;&amp;#x5BA2;&amp;#x6237;&amp;#x7AEF;&amp;#x5199;&amp;#x64CD;&amp;#x4F5C;&amp;#x5B8C;&amp;#x6210;&amp;#xFF1B;&lt;/li&gt;
&lt;li&gt;&amp;#x653E;&amp;#x5165;op_wq&amp;#x91CC;&amp;#xFF0C;FileStore::op_tp&amp;#x7EBF;&amp;#x7A0B;&amp;#x6C60;&amp;#x5C31;&amp;#x4F1A;&amp;#x4ECE;op_wq&amp;#x4E2D;&amp;#x53D6;&amp;#x51FA;&amp;#x8FDB;&amp;#x884C;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x5728;FileStore::OpWQ::_process&amp;#x53BB;&amp;#x8FDB;&amp;#x884C;&amp;#x5199;&amp;#x5230;&amp;#x672C;&amp;#x5730;&amp;#x7F13;&amp;#x5B58;&amp;#x7684;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF08;FileStore::_write&amp;#xFF09;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x5728;&amp;#x5B8C;&amp;#x6210;&amp;#x540E;FileStore::OpWQ::_process_finish&amp;#x4E2D;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x7C7B;&amp;#x4F3C;&amp;#x7684;&amp;#x4E5F;&amp;#x662F;&amp;#x653E;&amp;#x5230;&amp;#x4E00;&amp;#x4E2A;finisher_queue&amp;#x91CC;&amp;#xFF08;op_finisher&amp;#xFF09;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;finisher&amp;#x7684;&amp;#x7EBF;&amp;#x7A0B;&amp;#x8C03;&amp;#x7528;&lt;strong&gt;C_OSD_OnOpApplied&lt;/strong&gt;&amp;#x7684;&amp;#x56DE;&amp;#x8C03;&amp;#x51FD;&amp;#x6570;&amp;#xFF08;ReplicatedBackend::op_applied&amp;#xFF09;&amp;#x6765;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;waiting_for_applied&amp;#x4E3A;&amp;#x7A7A;&amp;#xFF08;&amp;#x5982;&amp;#x679C;&amp;#x662F;3&amp;#x526F;&amp;#x672C;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x9762;&amp;#x5C31;&amp;#x6709;3&amp;#x9879;&amp;#xFF0C;&amp;#x6BCF;&amp;#x5B8C;&amp;#x6210;&amp;#x4E00;&amp;#x4E2A;&amp;#x526F;&amp;#x672C;&amp;#x7684;&amp;#x5199;&amp;#x672C;&amp;#x5730;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x5C31;&amp;#x4F1A;&amp;#x4ECE;waiting_for_applied&amp;#x91CC;&amp;#x5220;&amp;#x9664;&amp;#x4E00;&amp;#x4E2A;&amp;#xFF09;&amp;#xFF0C;&amp;#x624D;&amp;#x8C03;&amp;#x7528;&lt;strong&gt;C_OSD_RepOpApplied&lt;/strong&gt;&amp;#x7684;&amp;#x56DE;&amp;#x8C03;&amp;#x51FD;&amp;#x6570;repop_all_applied&amp;#xFF0C;&amp;#x8FDB;&amp;#x800C;&amp;#x8C03;&amp;#x7528;ReplicatePG::eval_repop&amp;#x53D1;&amp;#x7ED9;&amp;#x5BA2;&amp;#x6237;&amp;#x7AEF;&amp;#x6570;&amp;#x636E;&amp;#x53EF;&amp;#x8BFB;&amp;#xFF1B;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/2015/11/25/ceph-osd-rw2/journal-trans.png&quot; alt=&quot;journal-trans&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;OSD&amp;#x4E2D;&amp;#x5199;&amp;#x64CD;&amp;#x4F5C;&amp;#x7684;&amp;#x590
    
    </summary>
    
      <category term="ceph" scheme="http://yoursite.com/categories/ceph/"/>
    
    
      <category term="ceph" scheme="http://yoursite.com/tags/ceph/"/>
    
      <category term="osd" scheme="http://yoursite.com/tags/osd/"/>
    
      <category term="journal transaction" scheme="http://yoursite.com/tags/journal-transaction/"/>
    
  </entry>
  
  <entry>
    <title>ceph OSD读写流程（1）–主OSD的处理流程</title>
    <link href="http://yoursite.com/2015/11/25/ceph-osd-rw1/"/>
    <id>http://yoursite.com/2015/11/25/ceph-osd-rw1/</id>
    <published>2015-11-25T07:48:55.000Z</published>
    <updated>2016-05-13T09:01:31.351Z</updated>
    
    <content type="html">&lt;p&gt;&amp;#x672C;&amp;#x6587;&amp;#x57FA;&amp;#x4E8E;hammer&amp;#x7248;&amp;#x672C;&amp;#x5BF9;OSD&amp;#x7684;&amp;#x8BFB;&amp;#x5199;&amp;#x6D41;&amp;#x7A0B;&amp;#x8FDB;&amp;#x884C;&amp;#x5206;&amp;#x6790;&amp;#xFF0C;&amp;#x5BF9;&amp;#x4E8E;&amp;#x6D88;&amp;#x606F;&amp;#x7684;&amp;#x63A5;&amp;#x6536;&amp;#x5904;&amp;#x7406;&amp;#x540E;&amp;#x7EED;&amp;#x4F1A;&amp;#x5355;&amp;#x72EC;&amp;#x8FDB;&amp;#x884C;&amp;#x5206;&amp;#x6790;&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2015/11/25/ceph-osd-rw1/primary-path.png&quot; alt=&quot;primary-path&quot;&gt;&lt;br&gt;&amp;#x5177;&amp;#x4F53;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x6D41;&amp;#x7A0B;&amp;#x4ECE;&amp;#x56FE;&amp;#x4E2D;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x4F53;&amp;#x73B0;&amp;#x51FA;&amp;#x6765;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x5C31;&amp;#x4E0D;&amp;#x4F5C;&amp;#x8FC7;&amp;#x591A;&amp;#x7684;&amp;#x63CF;&amp;#x8FF0;&amp;#xFF0C;&amp;#x9700;&amp;#x8981;&amp;#x63D0;&amp;#x7684;&amp;#x51E0;&amp;#x70B9;&amp;#xFF1A;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1&amp;#xFF09;&amp;#x8BFB;&amp;#x8BF7;&amp;#x6C42;&amp;#x7531;Primary OSD&amp;#x6765;&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#xFF1B;&lt;/li&gt;
&lt;li&gt;2&amp;#xFF09;&amp;#x5BF9;&amp;#x4E8E;&amp;#x5199;&amp;#x8BF7;&amp;#x6C42;&amp;#xFF0C;Primary OSD&amp;#x5148;&amp;#x53D1;&amp;#x6D88;&amp;#x606F;&amp;#x5230;&amp;#x526F;&amp;#x672C;OSD&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x8BB0;&amp;#x5F55;PGLog&amp;#xFF08;&amp;#x5728;log_operation&amp;#x91CC;&amp;#x53EA;&amp;#x662F;&amp;#x6784;&amp;#x9020;transaction&amp;#xFF0C;&amp;#x771F;&amp;#x6B63;&amp;#x5199;&amp;#x5230;&amp;#x76D8;&amp;#x662F;&amp;#x548C;journal&amp;#x4E00;&amp;#x8D77;&amp;#x5199;&amp;#x7684;&amp;#xFF09;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x518D;&amp;#x751F;&amp;#x6210;&amp;#x672C;&amp;#x5730;&amp;#x4E8B;&amp;#x52A1;&amp;#x8FDB;&amp;#x884C;&amp;#x672C;&amp;#x5730;&amp;#x5199;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#xFF1B;&lt;/li&gt;
&lt;li&gt;3&amp;#xFF09;&amp;#x5199;&amp;#x8BF7;&amp;#x6C42;&amp;#x6D89;&amp;#x53CA;&amp;#x5230;&amp;#x4E24;&amp;#x6B65;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x4E00;&amp;#x4E2A;&amp;#x662F;&amp;#x5199;journal&amp;#xFF0C;&amp;#x4E00;&amp;#x4E2A;&amp;#x662F;&amp;#x5199;&amp;#x5230;&amp;#x672C;&amp;#x5730;&amp;#x7F13;&amp;#x5B58;&amp;#xFF08;page cache&amp;#xFF09;&amp;#xFF0C;&amp;#x5BF9;&amp;#x4E8E;&amp;#x6BCF;&amp;#x4E00;&amp;#x4E2A;&amp;#x526F;&amp;#x672C;&amp;#x90FD;&amp;#x6709;&amp;#x8FD9;&amp;#x4E24;&amp;#x6B65;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;&amp;#x526F;&amp;#x672C;&amp;#x90FD;&amp;#x662F;&amp;#x5148;&amp;#x5199;journal&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x518D;&amp;#x5199;&amp;#x5230;&amp;#x672C;&amp;#x5730;&amp;#x7F13;&amp;#x5B58;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x662F;3&amp;#x526F;&amp;#x672C;&amp;#xFF0C;&amp;#x5C31;&amp;#x6D89;&amp;#x53CA;&amp;#x5230;6&amp;#x6B21;&amp;#x5199;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF1B;&lt;/li&gt;
&lt;li&gt;4&amp;#xFF09;Primary OSD&amp;#x521B;&amp;#x5EFA;&amp;#x4E86;2&amp;#x4E2A;&amp;#x56DE;&amp;#x8C03;&amp;#x51FD;&amp;#x6570;&amp;#x6765;&amp;#x5904;&amp;#x7406;&amp;#x5199;journal&amp;#x548C;&amp;#x5199;&amp;#x5230;&amp;#x7F13;&amp;#x5B58;&amp;#xFF08;&amp;#x5206;&amp;#x522B;&amp;#x662F;&lt;strong&gt;C_OSD_RepopCommit&lt;/strong&gt;&amp;#x548C;&lt;strong&gt;C_OSD_RepOpApplied&lt;/strong&gt;&amp;#xFF09;&amp;#xFF0C;&amp;#x4E3B;&amp;#x526F;&amp;#x672C;&amp;#x7684;&amp;#x5199;&amp;#x548C;&amp;#x4ECE;&amp;#x526F;&amp;#x672C;&amp;#x7684;&amp;#x5199;&amp;#x6CA1;&amp;#x6709;&amp;#x5148;&amp;#x540E;&amp;#x987A;&amp;#x5E8F;&amp;#xFF0C;&amp;#x6709;&amp;#x53EF;&amp;#x80FD;&amp;#x4E3B;&amp;#x7684;journal&amp;#x5148;&amp;#x5199;&amp;#x5B8C;&amp;#xFF0C;&amp;#x4E5F;&amp;#x6709;&amp;#x53EF;&amp;#x80FD;&amp;#x4ECE;&amp;#x7684;journal&amp;#x5148;&amp;#x5199;&amp;#x5B8C;&amp;#xFF0C;ceph&amp;#x4E0D;&amp;#x7BA1;&amp;#x8FD9;&amp;#x4E2A;&amp;#x987A;&amp;#x5E8F;&amp;#xFF0C;&amp;#x53EA;&amp;#x8981;&amp;#x4FDD;&amp;#x8BC1;3&amp;#x526F;&amp;#x672C;&amp;#x90FD;&amp;#x5199;&amp;#x5B8C;&amp;#x4E86;&amp;#x4E4B;&amp;#x540E;&amp;#x624D;&amp;#x8FD4;&amp;#x56DE;&amp;#x5BA2;&amp;#x6237;&amp;#x7AEF;&amp;#x54CD;&amp;#x5E94;&amp;#xFF08;degrade&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;&amp;#x4F8B;&amp;#x5916;&amp;#xFF09;&amp;#xFF0C;3&amp;#x4E2A;&amp;#x526F;&amp;#x672C;&amp;#x7684;journal&amp;#x5199;&amp;#x5B8C;&amp;#x6210;&amp;#xFF08;all_commit&amp;#xFF09;&amp;#xFF0C;&amp;#x4F1A;&amp;#x8FD4;&amp;#x56DE;&amp;#x5BA2;&amp;#x6237;&amp;#x7AEF;&amp;#x201C;&amp;#x5199;&amp;#x64CD;&amp;#x4F5C;&amp;#x5B8C;&amp;#x6210;&amp;#x201D;&amp;#xFF0C;&amp;#x800C;3&amp;#x4E2A;&amp;#x526F;&amp;#x672C;&amp;#x90FD;&amp;#x5199;&amp;#x672C;&amp;#x5730;&amp;#x7F13;&amp;#x5B58;&amp;#x5B8C;&amp;#x6210;&amp;#x540E;&amp;#xFF08;all_applied&amp;#xFF09;&amp;#xFF0C;&amp;#x624D;&amp;#x8FD4;&amp;#x56DE;&amp;#x5BA2;&amp;#x6237;&amp;#x7AEF;&amp;#x201C;&amp;#x6570;&amp;#x636E;&amp;#x53EF;&amp;#x8BFB;&amp;#x201D;&amp;#xFF1B;&lt;/li&gt;
&lt;/ul&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;#x672C;&amp;#x6587;&amp;#x57FA;&amp;#x4E8E;hammer&amp;#x7248;&amp;#x672C;&amp;#x5BF9;OSD&amp;#x7684;&amp;#x8BFB;&amp;#x5199;&amp;#x6D41;&amp;#x7A0B;&amp;#x8FDB;&amp;#x884C;&amp;#x5206;&amp;#x6790;
    
    </summary>
    
      <category term="ceph" scheme="http://yoursite.com/categories/ceph/"/>
    
    
      <category term="ceph" scheme="http://yoursite.com/tags/ceph/"/>
    
      <category term="osd" scheme="http://yoursite.com/tags/osd/"/>
    
  </entry>
  
  <entry>
    <title>ceph rbd中的对象解析</title>
    <link href="http://yoursite.com/2015/10/20/ceph-rbd-obj/"/>
    <id>http://yoursite.com/2015/10/20/ceph-rbd-obj/</id>
    <published>2015-10-20T07:27:13.000Z</published>
    <updated>2016-05-13T09:02:00.849Z</updated>
    
    <content type="html">&lt;p&gt;&amp;#x5728;&amp;#x4F7F;&amp;#x7528;ceph rbd&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x65F6;&amp;#xFF0C;&amp;#x521B;&amp;#x5EFA;&amp;#x4E00;&amp;#x4E2A;rbd image&amp;#x53EF;&amp;#x4EE5;&amp;#x6307;&amp;#x5B9A;&amp;#x683C;&amp;#x5F0F;&amp;#xFF1A;&amp;#x2013;image-format=1&amp;#x6216;&amp;#x8005;&amp;#x2013;image-format=2&amp;#xFF0C;&amp;#x5B98;&amp;#x65B9;&amp;#x6587;&amp;#x6863;&amp;#x7ED9;&amp;#x51FA;&amp;#x4E86;&amp;#x5982;&amp;#x4E0B;&amp;#x89E3;&amp;#x91CA;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;format 1 - Use the original format for a new rbd image. This format is understood by all versions of librbd and the kernel rbd module, but does not support newer features like cloning.&lt;/li&gt;
&lt;li&gt;format 2 - Use the second rbd format, which is supported by librbd (but not the kernel rbd module) at this time. This adds support for cloning and is more easily extensible to allow more features in the future.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&amp;#x9ED8;&amp;#x8BA4;&amp;#x7684;image&amp;#x683C;&amp;#x5F0F;&amp;#x662F;format 1&amp;#xFF0C;&amp;#x8FD9;&amp;#x79CD;&amp;#x683C;&amp;#x5F0F;&amp;#x652F;&amp;#x6301;&amp;#x6240;&amp;#x6709;&amp;#x7248;&amp;#x672C;&amp;#x7684;librbd&amp;#x548C;&amp;#x5185;&amp;#x6838;rbd&amp;#x6A21;&amp;#x5757;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x4E0D;&amp;#x652F;&amp;#x6301;&amp;#x65B0;&amp;#x7684;&amp;#x529F;&amp;#x80FD;&amp;#x5982;&amp;#x514B;&amp;#x9686;&amp;#xFF1B;&amp;#x800C;format 2&amp;#x7531;librbd&amp;#x652F;&amp;#x6301;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x4E0D;&amp;#x652F;&amp;#x6301;&amp;#x5185;&amp;#x6838;rbd&amp;#x6A21;&amp;#x5757;&amp;#xFF0C;&amp;#x8FD9;&amp;#x79CD;&amp;#x683C;&amp;#x5F0F;&amp;#x652F;&amp;#x6301;&amp;#x514B;&amp;#x9686;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x4FBF;&amp;#x4E8E;&amp;#x6269;&amp;#x5C55;&amp;#x540E;&amp;#x7EED;&amp;#x5176;&amp;#x4ED6;&amp;#x529F;&amp;#x80FD;&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;1-format-1&amp;#x683C;&amp;#x5F0F;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x89E3;&amp;#x6790;&quot;&gt;&lt;a href=&quot;#1-format-1&amp;#x683C;&amp;#x5F0F;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x89E3;&amp;#x6790;&quot; class=&quot;headerlink&quot; title=&quot;1. format 1&amp;#x683C;&amp;#x5F0F;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x89E3;&amp;#x6790;&quot;&gt;&lt;/a&gt;1. format 1&amp;#x683C;&amp;#x5F0F;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x89E3;&amp;#x6790;&lt;/h1&gt;&lt;p&gt;&amp;#x9996;&amp;#x5148;&amp;#x521B;&amp;#x5EFA;&amp;#x4E00;&amp;#x4E2A;format 1&amp;#x683C;&amp;#x5F0F;&amp;#x7684;image&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root@ceph1:~&lt;span class=&quot;comment&quot;&gt;# rbd create test_vol --size=10&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;root@ceph1:~&lt;span class=&quot;comment&quot;&gt;# rbd -p rbd ls                                                       &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;test&lt;/span&gt;_vol&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x7136;&amp;#x540E;&amp;#x4F7F;&amp;#x7528;rados&amp;#x547D;&amp;#x4EE4;&amp;#x770B;&amp;#x5230;&amp;#x5BF9;&amp;#x5E94;&amp;#x4EA7;&amp;#x751F;&amp;#x4E00;&amp;#x4E2A;test_vol.rbd&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root@ceph1:~&lt;span class=&quot;comment&quot;&gt;# rados -p rbd ls&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;test&lt;/span&gt;_vol.rbd&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rbd_directory&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x5176;&amp;#x4E2D;rbd_directory&amp;#x662F;&amp;#x4FDD;&amp;#x5B58;&amp;#x8BE5;&amp;#x5B58;&amp;#x50A8;&amp;#x6C60;&amp;#x91CC;&amp;#x7684;image&amp;#x5217;&amp;#x8868;&lt;br&gt;&amp;#x4ECE;&amp;#x4E0B;&amp;#x9762;&amp;#x7684;&amp;#x547D;&amp;#x4EE4;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x5230;&amp;#x5BF9;&amp;#x4E8E;format 1&amp;#x683C;&amp;#x5F0F;&amp;#x7684;image&amp;#xFF0C;&amp;#x6CA1;&amp;#x6709;&amp;#x5C06;image name&amp;#x548C;id&amp;#x7684;&amp;#x6620;&amp;#x5C04;&amp;#x4FDD;&amp;#x5B58;&amp;#x5230;rbd_directory&amp;#x91CC;&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root@ceph1:~&lt;span class=&quot;comment&quot;&gt;#rados -p rbd listomapvals rbd_directory&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;root@ceph1:~&lt;span class=&quot;comment&quot;&gt;#&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;&amp;#x4F7F;&amp;#x7528;rbd info&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x5230;&amp;#x5BF9;&amp;#x5E94;image&amp;#x7684;&amp;#x4E00;&amp;#x4E9B;&amp;#x5143;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x5305;&amp;#x62EC;size&amp;#xFF0C;order&amp;#x5C31;&amp;#x662F;&amp;#x5757;&amp;#x5927;&amp;#x5C0F;&amp;#xFF08;1&amp;lt;&amp;lt;order&amp;#xFF09;&amp;#xFF0C;block_name_prefix&amp;#x662F;&amp;#x6570;&amp;#x636E;&amp;#x5BF9;&amp;#x8C61;&amp;#x540D;&amp;#x79F0;&amp;#x7684;&amp;#x524D;&amp;#x7F00;&amp;#xFF0C;format&amp;#x8868;&amp;#x793A;&amp;#x662F;&amp;#x54EA;&amp;#x79CD;image&amp;#x683C;&amp;#x5F0F;&amp;#x3002;&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root@ceph1:/var/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/osd/current&lt;span class=&quot;comment&quot;&gt;# rbd info rbd/test_vol&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rbd image &lt;span class=&quot;string&quot;&gt;&amp;apos;test_vol&amp;apos;&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        size 10240 kB &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; 3 objects&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        order 22 (4096 kB objects)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        block_name_prefix: rb.0.12ae.74b0dc51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        format: 1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&amp;#x53E6;&amp;#x5916;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x901A;&amp;#x8FC7;&amp;#x5982;&amp;#x4E0B;&amp;#x65B9;&amp;#x5F0F;&amp;#x770B;&amp;#x5230;test_vol.rbd&amp;#x91CC;&amp;#x5305;&amp;#x542B;&amp;#x7684;&amp;#x5143;&amp;#x6570;&amp;#x636E;&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root@ceph1:~&lt;span class=&quot;comment&quot;&gt;# rados -p rbd stat test_vol.rbd&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rbd/&lt;span class=&quot;built_in&quot;&gt;test&lt;/span&gt;_vol.rbd mtime 1445237108, size 141&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;root@ceph1:~&lt;span class=&quot;comment&quot;&gt;# rados -p rbd get test_vol.rbd 1.txt&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;root@ceph1:~&lt;span class=&quot;comment&quot;&gt;# xxd 1.txt&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000000: 3c3c 3c20 5261 646f 7320 426c 6f63 6b20  &amp;lt;&amp;lt;&amp;lt; Rados Block&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000010: 4465 7669 6365 2049 6d61 6765 203e 3e3e  Device Image &amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000020: 0a00 0000 0000 0000 7262 2e30 2e31 3261  ........rb.0.12a&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000030: 652e 3734 6230 6463 3531 0000 0000 0000  e.74b0dc51......&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000040: 5242 4400 3030 312e 3030 3500 1600 0000  RBD.001.005.....&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000050: 0000 a000 0000 0000 0400 0000 0000 0000  ................&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000060: 0100 0000 0000 0000 0d00 0000 0000 0000  ................&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000070: 0400 0000 0000 0000 0000 a000 0000 0000  ................&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000080: 7465 7374 766f 6c5f 736e 6170 00         testvol_snap.&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x5F80;&amp;#x8FD9;&amp;#x4E2A;image&amp;#x91CC;&amp;#x5199;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5728;&amp;#x4F7F;&amp;#x7528;rados -p rbd ls&amp;#x67E5;&amp;#x770B;&amp;#x53D1;&amp;#x73B0;&amp;#x591A;&amp;#x4E86;&amp;#x4E00;&amp;#x4E2A;&amp;#x8BE5;image&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x5BF9;&amp;#x8C61;&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root@ceph1:~&lt;span class=&quot;comment&quot;&gt;# rbd map test_vol&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;root@ceph1:~&lt;span class=&quot;comment&quot;&gt;# rbd showmapped &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;id pool    image     snap device    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2  volumes &lt;span class=&quot;built_in&quot;&gt;test&lt;/span&gt;_vol1 -    /dev/rbd2 &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3  rbd     myrbd     -    /dev/rbd3 &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4  rbd     &lt;span class=&quot;built_in&quot;&gt;test&lt;/span&gt;_vol  -    /dev/rbd4 &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;root@ceph1:~&lt;span class=&quot;comment&quot;&gt;# dd if=/dev/urandom of=/dev/rbd/rbd/test_vol bs=4M count=1 oflag=direct&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;1+0 records &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;1+0 records out&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4194304 bytes (4.2 MB) copied, 1.03652 s, 4.0 MB/s&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;root@ceph1:~&lt;span class=&quot;comment&quot;&gt;# &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;root@ceph1:~&lt;span class=&quot;comment&quot;&gt;# rados -p rbd ls&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rbd_directory&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;test&lt;/span&gt;_vol.rbd&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rb.0.12ae.74b0dc51.000000000000&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x5E76;&amp;#x4E14;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x5230;&amp;#x5177;&amp;#x4F53;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x5BF9;&amp;#x8C61;&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root@ceph1:/var/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/osd/current&lt;span class=&quot;comment&quot;&gt;# ls -la *head |grep 74b0dc51&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-rw-r--r--   1 root root 4194304 Oct 19 14:26 rb.0.12ae.74b0dc51.000000000000__head_331FC0BA__2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x547D;&amp;#x540D;&amp;#x89C4;&amp;#x5219;&amp;#x4E3A;&amp;#xFF1A;&lt;br&gt;block_name_prefix.fragment.&lt;strong&gt;head(snap_num)_hash&lt;/strong&gt;poolid&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;block_name_prefix&amp;#xFF1A;&amp;#x5BF9;&amp;#x8C61;&amp;#x540D;&amp;#x524D;&amp;#x7F00;&lt;/li&gt;
&lt;li&gt;fragment&amp;#xFF1A;&amp;#x6309;&amp;#x7167;&amp;#x5757;&amp;#x5927;&amp;#x5C0F;&amp;#x6765;&amp;#x5212;&amp;#x5206;&amp;#x7684;&amp;#x504F;&amp;#x79FB;&amp;#xFF0C;&amp;#x6BD4;&amp;#x5982;4MB&amp;#x7684;&amp;#x5757;&amp;#x5927;&amp;#x5C0F;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;000000000000&amp;#x5C31;&amp;#x8868;&amp;#x793A;&amp;#x7B2C;&amp;#x4E00;&amp;#x4E2A;4MB&amp;#x7684;&amp;#x5757;&lt;/li&gt;
&lt;li&gt;head(snap_num)&amp;#xFF1A;snapshot&amp;#x7248;&amp;#x672C;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x662F;head&amp;#xFF0C;&amp;#x8868;&amp;#x793A;&amp;#x662F;image&amp;#x7684;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x662F;&amp;#x6570;&amp;#x5B57;&amp;#xFF0C;&amp;#x8868;&amp;#x793A;&amp;#x662F;snapshot&amp;#x7684;&amp;#x5E8F;&amp;#x53F7;&lt;/li&gt;
&lt;li&gt;hash&amp;#xFF1A;&amp;#x7531;block_nama_prefix&amp;#x8BA1;&amp;#x7B97;&amp;#x5F97;&amp;#x5230;&amp;#x7684;&lt;/li&gt;
&lt;li&gt;poolid&amp;#xFF1A;image&amp;#x6240;&amp;#x5C5E;&amp;#x7684;pool id&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;2-format-2&amp;#x683C;&amp;#x5F0F;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x89E3;&amp;#x6790;&quot;&gt;&lt;a href=&quot;#2-format-2&amp;#x683C;&amp;#x5F0F;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x89E3;&amp;#x6790;&quot; class=&quot;headerlink&quot; title=&quot;2. format 2&amp;#x683C;&amp;#x5F0F;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x89E3;&amp;#x6790;&quot;&gt;&lt;/a&gt;2. format 2&amp;#x683C;&amp;#x5F0F;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x89E3;&amp;#x6790;&lt;/h1&gt;&lt;p&gt;&amp;#x521B;&amp;#x5EFA;format 2&amp;#x683C;&amp;#x5F0F;&amp;#x7684;image&amp;#x65F6;&amp;#x52A0;&amp;#x4E0A;&amp;#x2013;image-format=2&amp;#x5373;&amp;#x53EF;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x5C31;&amp;#x4E0D;&amp;#x7F57;&amp;#x5217;&amp;#x5177;&amp;#x4F53;&amp;#x7684;&amp;#x521B;&amp;#x5EFA;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E86;&amp;#xFF0C;&amp;#x4E0B;&amp;#x9762;&amp;#x76F4;&amp;#x63A5;&amp;#x6765;&amp;#x770B;&amp;#x4E00;&amp;#x4E0B;rbd format 2&amp;#x4E0B;&amp;#x6709;&amp;#x54EA;&amp;#x4E9B;&amp;#x5BF9;&amp;#x8C61;&amp;#x3002;&lt;br&gt;rbd&amp;#x4E3B;&amp;#x8981;&amp;#x7684;&amp;#x51E0;&amp;#x4E2A;osd&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root@ceph1:~&lt;span class=&quot;comment&quot;&gt;# rados -p rbd ls&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rbd_id.myrbdsnapclone1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rbd_header.11ee2ae8944a&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rbd_children&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rbd_directory&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rbd_data.11ee2ae8944a.0000000000000000&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rbd_id.myrbd&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rbd_data.11ee2ae8944a.0000000000000002&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rbd_header.123f238e1f29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rbd_data.11ee2ae8944a.0000000000000001&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&quot;2-1-rbd-id-image-name&quot;&gt;&lt;a href=&quot;#2-1-rbd-id-image-name&quot; class=&quot;headerlink&quot; title=&quot;2.1 rbd_id.{image name}&quot;&gt;&lt;/a&gt;2.1 rbd_id.{image name}&lt;/h2&gt;&lt;p&gt;rbd_id&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x683C;&amp;#x5F0F;&amp;#x4E3A;&amp;#xFF1A;rbd\uid.{image name}&lt;strong&gt;head_hash&lt;/strong&gt;poolid&lt;br&gt;&amp;#x6BD4;&amp;#x5982;&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root@ceph1:var/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/osd/current&lt;span class=&quot;comment&quot;&gt;# ls *head -la |grep id&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-rw-r--r--   1 root root   16 Oct 19 10:25 rbd\uid.myrbd__head_422A8C36__2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x5BF9;&amp;#x8C61;&amp;#x91CC;&amp;#x5B58;&amp;#x7684;&amp;#x5C31;&amp;#x662F;image&amp;#x7684;id&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x901A;&amp;#x8FC7;&amp;#x4EE5;&amp;#x4E0B;&amp;#x65B9;&amp;#x5F0F;&amp;#x67E5;&amp;#x770B;&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root@ceph1:/var/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/osd/current&lt;span class=&quot;comment&quot;&gt;# rados -p rbd get rbd_id.myrbd 1.txt&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;root@ceph1:/var/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/osd/current&lt;span class=&quot;comment&quot;&gt;# xxd 1.txt&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000000: 0c00 0000 3131 6565 3261 6538 3934 3461  ....11ee2ae8944a&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x6216;&amp;#x8005;&amp;#x76F4;&amp;#x63A5;&amp;#x627E;&amp;#x5BF9;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x8FDB;&amp;#x884C;&amp;#x67E5;&amp;#x770B;&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root@ceph1:/var/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/osd/current&lt;span class=&quot;comment&quot;&gt;# xxd 2.36_head/rbd\\uid.myrbd__head_422A8C36__2 &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000000: 0c00 0000 3131 6565 3261 6538 3934 3461  ....11ee2ae8944a&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&quot;2-2-rbd-header-image-id&quot;&gt;&lt;a href=&quot;#2-2-rbd-header-image-id&quot; class=&quot;headerlink&quot; title=&quot;2.2 rbd_header.{image id}&quot;&gt;&lt;/a&gt;2.2 rbd_header.{image id}&lt;/h2&gt;&lt;p&gt;rbd_header&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x683C;&amp;#x5F0F;&amp;#x4E3A;&amp;#xFF1A;rbd\uheader.{image id}&lt;strong&gt;head_hash&lt;/strong&gt;poolid&lt;br&gt;&amp;#x6BD4;&amp;#x5982;&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root@ceph1:/var/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/osd/current&lt;span class=&quot;comment&quot;&gt;#ls *head -la |grep header&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-rw-r--r--   1 root root    0 Oct 19 10:25 rbd\uheader.11ee2ae8944a__head_3FB535C5__2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x8BB0;&amp;#x5F55;rbd image&amp;#x7684;&amp;#x5143;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x5176;&amp;#x5185;&amp;#x5BB9;&amp;#x5305;&amp;#x62EC;size&amp;#xFF0C;order&amp;#xFF0C;object_prefix, snap&lt;em&gt;seq, parent&amp;#xFF08;&amp;#x514B;&amp;#x9686;&amp;#x7684;image&amp;#x624D;&amp;#x6709;&amp;#xFF09;, snapshot&lt;/em&gt;{snap id}&amp;#xFF08;&amp;#x5404;&amp;#x4E2A;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;&amp;#x4FE1;&amp;#x606F;&amp;#xFF09;&amp;#x3002;&lt;br&gt;&amp;#x4E0B;&amp;#x9762;&amp;#x5206;&amp;#x522B;&amp;#x5BF9;&amp;#x4E0D;&amp;#x540C;&amp;#x7C7B;&amp;#x578B;&amp;#x7684;image&amp;#x7684;rbd_header&amp;#x91CC;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x8FDB;&amp;#x884C;&amp;#x8BF4;&amp;#x660E;&lt;/p&gt;
&lt;h3 id=&quot;1&amp;#xFF09;&amp;#x6CA1;&amp;#x6709;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;image&quot;&gt;&lt;a href=&quot;#1&amp;#xFF09;&amp;#x6CA1;&amp;#x6709;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;image&quot; class=&quot;headerlink&quot; title=&quot;1&amp;#xFF09;&amp;#x6CA1;&amp;#x6709;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;image&quot;&gt;&lt;/a&gt;1&amp;#xFF09;&amp;#x6CA1;&amp;#x6709;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;image&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;object_prefix&amp;#xFF1A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x540D;&amp;#x5B57;&amp;#x524D;&amp;#x7F00;&lt;/li&gt;
&lt;li&gt;order&amp;#xFF1A;&amp;#x7528;&amp;#x6765;&amp;#x8BA1;&amp;#x7B97;block size&amp;#x7684;&amp;#xFF0C;&amp;#x6BD4;&amp;#x5982;22&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x5757;&amp;#x5927;&amp;#x5C0F;&amp;#x5C31;&amp;#x662F;1&amp;lt;&amp;lt;22=4MB&lt;/li&gt;
&lt;li&gt;size&amp;#xFF1A;&amp;#x5BF9;&amp;#x8C61;&amp;#x5927;&amp;#x5C0F;&lt;/li&gt;
&lt;li&gt;snap_seq&amp;#xFF1A;&amp;#x5FEB;&amp;#x7167;&amp;#x7F16;&amp;#x53F7;&amp;#xFF0C;&amp;#x6CA1;&amp;#x6709;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x662F;0&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root@ceph1:/var/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/osd/current&lt;span class=&quot;comment&quot;&gt;# rados -p rbd listomapvals rbd_header.12812ae8944a&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;features&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;value: (8 bytes) :&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000 : 01 00 00 00 00 00 00 00                         : ........&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;object_prefix&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;value: (25 bytes) :&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000 : 15 00 00 00 72 62 64 5f 64 61 74 61 2e 31 32 38 : ....rbd_data.128&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0010 : 31 32 61 65 38 39 34 34 61                      : 12ae8944a&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;order&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;value: (1 bytes) :&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000 : 16                                              : .&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;size&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;value: (8 bytes) :&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000 : 00 00 a0 00 00 00 00 00                         : ........&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;snap_seq&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;value: (8 bytes) :&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000 : 00 00 00 00 00 00 00 00                         : ........&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;2&amp;#xFF09;&amp;#x505A;&amp;#x8FC7;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;image&quot;&gt;&lt;a href=&quot;#2&amp;#xFF09;&amp;#x505A;&amp;#x8FC7;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;image&quot; class=&quot;headerlink&quot; title=&quot;2&amp;#xFF09;&amp;#x505A;&amp;#x8FC7;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;image&quot;&gt;&lt;/a&gt;2&amp;#xFF09;&amp;#x505A;&amp;#x8FC7;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;image&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;object_prefix&amp;#xFF1A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x540D;&amp;#x5B57;&amp;#x524D;&amp;#x7F00;&lt;/li&gt;
&lt;li&gt;order&amp;#xFF1A;&amp;#x7528;&amp;#x6765;&amp;#x8BA1;&amp;#x7B97;block size&amp;#x7684;&amp;#xFF0C;&amp;#x6BD4;&amp;#x5982;22&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x5757;&amp;#x5927;&amp;#x5C0F;&amp;#x5C31;&amp;#x662F;1&amp;lt;&amp;lt;22=4MB&lt;/li&gt;
&lt;li&gt;size&amp;#xFF1A;&amp;#x5BF9;&amp;#x8C61;&amp;#x5927;&amp;#x5C0F;&lt;/li&gt;
&lt;li&gt;snap_seq&amp;#xFF1A;&amp;#x5FEB;&amp;#x7167;&amp;#x7F16;&amp;#x53F7;&lt;/li&gt;
&lt;li&gt;snapshot_id&amp;#xFF1A;&amp;#x8BB0;&amp;#x5F55;&amp;#x5BF9;&amp;#x5E94;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;&amp;#x4FE1;&amp;#x606F;&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root@ceph1:/var/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/osd/current&lt;span class=&quot;comment&quot;&gt;# rados -p rbd listomapvals rbd_header.11ee2ae8944a&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;features&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;value: (8 bytes) :&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000 : 01 00 00 00 00 00 00 00                         : ........&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;object_prefix&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;value: (25 bytes) :&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000 : 15 00 00 00 72 62 64 5f 64 61 74 61 2e 31 31 65 : ....rbd_data.11e&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0010 : 65 32 61 65 38 39 34 34 61                      : e2ae8944a&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;order&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;value: (1 bytes) :&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000 : 16                                                                            : .&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;size&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;value: (8 bytes) :&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000 : 00 00 a0 00 00 00 00 00                         : ........&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;snap_seq&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;value: (8 bytes) :&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000 : 03 00 00 00 00 00 00 00                         : ........&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;snapshot_0000000000000002&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;value: (78 bytes) :&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000 : 03 01 48 00 00 00 02 00 00 00 00 00 00 00 09 00 : ..H.............&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0010 : 00 00 6d 79 72 62 64 73 6e 61 70 00 00 a0 00 00 : ..myrbdsnap.....&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0020 : 00 00 00 01 00 00 00 00 00 00 00 01 01 1c 00 00 : ................&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0030 : 00 ff ff ff ff ff ff ff ff 00 00 00 00 fe ff ff : ................&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0040 : ff ff ff ff ff 00 00 00 00 00 00 00 00 02       : ..............&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;snapshot_0000000000000003&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;value: (79 bytes) :&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000 : 03 01 49 00 00 00 03 00 00 00 00 00 00 00 0a 00 : ..I.............&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0010 : 00 00 6d 79 72 62 64 73 6e 61 70 32 00 00 a0 00 : ..myrbdsnap2....&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0020 : 00 00 00 00 01 00 00 00 00 00 00 00 01 01 1c 00 : ................&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0030 : 00 00 ff ff ff ff ff ff ff ff 00 00 00 00 fe ff : ................&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0040 : ff ff ff ff ff ff 00 00 00 00 00 00 00 00 00    : ...............&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;3&amp;#xFF09;&amp;#x4ECE;&amp;#x5FEB;&amp;#x7167;&amp;#x514B;&amp;#x9686;&amp;#x7684;image&quot;&gt;&lt;a href=&quot;#3&amp;#xFF09;&amp;#x4ECE;&amp;#x5FEB;&amp;#x7167;&amp;#x514B;&amp;#x9686;&amp;#x7684;image&quot; class=&quot;headerlink&quot; title=&quot;3&amp;#xFF09;&amp;#x4ECE;&amp;#x5FEB;&amp;#x7167;&amp;#x514B;&amp;#x9686;&amp;#x7684;image&quot;&gt;&lt;/a&gt;3&amp;#xFF09;&amp;#x4ECE;&amp;#x5FEB;&amp;#x7167;&amp;#x514B;&amp;#x9686;&amp;#x7684;image&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;object_prefix&amp;#xFF1A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x540D;&amp;#x5B57;&amp;#x524D;&amp;#x7F00;&lt;/li&gt;
&lt;li&gt;order&amp;#xFF1A;&amp;#x7528;&amp;#x6765;&amp;#x8BA1;&amp;#x7B97;block size&amp;#x7684;&amp;#xFF0C;&amp;#x6BD4;&amp;#x5982;22&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x5757;&amp;#x5927;&amp;#x5C0F;&amp;#x5C31;&amp;#x662F;1&amp;lt;&amp;lt;22=4MB&lt;/li&gt;
&lt;li&gt;size&amp;#xFF1A;&amp;#x5BF9;&amp;#x8C61;&amp;#x5927;&amp;#x5C0F;&lt;/li&gt;
&lt;li&gt;snap_seq&amp;#xFF1A;&amp;#x5FEB;&amp;#x7167;&amp;#x7F16;&amp;#x53F7;&amp;#xFF0C;&amp;#x6CA1;&amp;#x6709;&amp;#x5FEB;&amp;#x7167;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x662F;0&lt;/li&gt;
&lt;li&gt;parent&amp;#xFF1A;&amp;#x8BB0;&amp;#x5F55;&amp;#x8BE5;image&amp;#x7684;&amp;#x7236;image&amp;#x7684;id&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root@ceph1:/var/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/osd/current&lt;span class=&quot;comment&quot;&gt;# rados -p rbd listomapvals rbd_header.123f238e1f29&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;features&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;value: (8 bytes) :&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000 : 01 00 00 00 00 00 00 00                         : ........&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;object_prefix&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;value: (25 bytes) :&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000 : 15 00 00 00 72 62 64 5f 64 61 74 61 2e 31 32 33 : ....rbd_data.123&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0010 : 66 32 33 38 65 31 66 32 39                      : f238e1f29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;order&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;value: (1 bytes) :&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000 : 16                                                                           : .&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;parent&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;value: (46 bytes) :&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000 : 01 01 28 00 00 00 02 00 00 00 00 00 00 00 0c 00 : ..(.............&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0010 : 00 00 31 31 65 65 32 61 65 38 39 34 34 61 02 00 : ..11ee2ae8944a..&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0020 : 00 00 00 00 00 00 00 00 a0 00 00 00 00 00       : ..............&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;size&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;value: (8 bytes) :&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000 : 00 00 a0 00 00 00 00 00                         : ........&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;snap_seq&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;value: (8 bytes) :&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000 : 00 00 00 00 00 00 00 00                         : ........&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;2-3-rbd-data-image-id-offset&quot;&gt;&lt;a href=&quot;#2-3-rbd-data-image-id-offset&quot; class=&quot;headerlink&quot; title=&quot;2.3 rbd_data.{image id}.{offset}&quot;&gt;&lt;/a&gt;2.3 rbd_data.{image id}.{offset}&lt;/h2&gt;&lt;p&gt;rbd_data&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x547D;&amp;#x540D;&amp;#x683C;&amp;#x5F0F;&amp;#x4E3A;&amp;#xFF1A;rbd\udata.{image id}.fragement&lt;strong&gt;head(snap)_hash&lt;/strong&gt;poolid&lt;br&gt;rbd image&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x5B58;&amp;#x653E;&amp;#x5177;&amp;#x4F53;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x5185;&amp;#x5BB9;&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root@ceph2:/var/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/osd/current&lt;span class=&quot;comment&quot;&gt;# ls *head -la|grep data&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-rw-r--r--   1 root root 1048576 Oct 19 10:47 rbd\udata.11ee2ae8944a.0000000000000000__2_88F8F929__2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-rw-r--r--   1 root root 4194304 Oct 19 11:37 rbd\udata.11ee2ae8944a.0000000000000000__3_88F8F929__2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-rw-r--r--   1 root root 4194304 Oct 19 11:37 rbd\udata.11ee2ae8944a.0000000000000000__head_88F8F929__2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-rw-r--r--   1 root root 4194304 Oct 19 11:37 rbd\udata.11ee2ae8944a.0000000000000001__3_0F1C4EFE__2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-rw-r--r--   1 root root 4194304 Oct 19 11:37 rbd\udata.11ee2ae8944a.0000000000000001__head_0F1C4EFE__2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&quot;2-4-rbd-directory&quot;&gt;&lt;a href=&quot;#2-4-rbd-directory&quot; class=&quot;headerlink&quot; title=&quot;2.4 rbd_directory&quot;&gt;&lt;/a&gt;2.4 rbd_directory&lt;/h2&gt;&lt;p&gt;rbd_directory&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x547D;&amp;#x540D;&amp;#x683C;&amp;#x5F0F;&amp;#x4E3A;&amp;#xFF1A;rbd\udirectory&lt;strong&gt;head_hash&lt;/strong&gt;poolid&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root@ceph1:/var/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/osd/current&lt;span class=&quot;comment&quot;&gt;# ls *head -la|grep directory&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-rw-r--r--   1 root root    8 Oct 19 10:22 rbd\udirectory__head_30A98C1C__2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x91CC;&amp;#x9762;&amp;#x5305;&amp;#x542B;&amp;#x5BF9;&amp;#x5E94;&amp;#x5B58;&amp;#x50A8;&amp;#x6C60;&amp;#x91CC;&amp;#x6240;&amp;#x6709;&amp;#x7684;image&amp;#x7684;name&amp;#x548C;id&amp;#x7684;&amp;#x53CC;&amp;#x5411;&amp;#x6620;&amp;#x5C04;&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root@ceph1:/var/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/osd/current&lt;span class=&quot;comment&quot;&gt;# rados -p rbd listomapvals rbd_directory&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;id_11ee2ae8944a&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;value: (9 bytes) :&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000 : 05 00 00 00 6d 79 72 62 64                      : ....myrbd&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;id_123f238e1f29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;value: (19 bytes) :&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000 : 0f 00 00 00 6d 79 72 62 64 73 6e 61 70 63 6c 6f : ....myrbdsnapclo&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0010 : 6e 65 31                                        : ne1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;id_12812ae8944a&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;value: (10 bytes) :&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000 : 06 00 00 00 6d 79 72 62 64 32                   : ....myrbd2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;name_myrbd&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;value: (16 bytes) :&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000 : 0c 00 00 00 31 31 65 65 32 61 65 38 39 34 34 61 : ....11ee2ae8944a&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;name_myrbd2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;value: (16 bytes) :&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000 : 0c 00 00 00 31 32 38 31 32 61 65 38 39 34 34 61 : ....12812ae8944a&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;name_myrbdsnapclone1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;value: (16 bytes) :&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000 : 0c 00 00 00 31 32 33 66 32 33 38 65 31 66 32 39 : ....123f238e1f29&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&quot;2-5-rbd-children&quot;&gt;&lt;a href=&quot;#2-5-rbd-children&quot; class=&quot;headerlink&quot; title=&quot;2.5 rbd_children&quot;&gt;&lt;/a&gt;2.5 rbd_children&lt;/h2&gt;&lt;p&gt;rbd_children&amp;#x5BF9;&amp;#x8C61;&amp;#x547D;&amp;#x540D;&amp;#x683C;&amp;#x5F0F;&amp;#x4E3A;&amp;#xFF1A;rbd\uchildren&lt;strong&gt;head_hash&lt;/strong&gt;poolid&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root@ceph3:/var/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/osd/current&lt;span class=&quot;comment&quot;&gt;# ls *head -la|grep children &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-rw-r--r--   1 root root    0 Oct 19 11:19 rbd\uchildren__head_0FA1CACA__2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x8BB0;&amp;#x5F55;&amp;#x7236;&amp;#x5B50;&amp;#x5173;&amp;#x7CFB;&amp;#xFF0C;key&amp;#x662F;parent image&amp;#x7684;id&amp;#xFF0C;value&amp;#x662F;&amp;#x514B;&amp;#x9686;&amp;#x7684;image&amp;#x7684;id&amp;#xFF0C;&amp;#x7528;&amp;#x6765;&amp;#x5FEB;&amp;#x901F;&amp;#x67E5;&amp;#x627E;&amp;#x786E;&amp;#x8BA4;&amp;#x7236;&amp;#x5B50;&amp;#x5173;&amp;#x7CFB;&amp;#x7684;&amp;#x3002;&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root@ceph1:/var/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/osd/current&lt;span class=&quot;comment&quot;&gt;# rados -p rbd listomapvals rbd_children &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;key: (32 bytes):&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000 : 02 00 00 00 00 00 00 00 0c 00 00 00 31 31 65 65 : ............11ee&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0010 : 32 61 65 38 39 34 34 61 02 00 00 00 00 00 00 00 : 2ae8944a........&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;value: (20 bytes) :&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0000 : 01 00 00 00 0c 00 00 00 31 32 33 66 32 33 38 65 : ........123f238e&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0010 : 31 66 32 39                                     : 1f29&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;#x5728;&amp;#x4F7F;&amp;#x7528;ceph rbd&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x65F6;&amp;#xFF0C;&amp;#x521B;&amp;#x5EFA;&amp;#x4E00;&amp;#x4E2A;rbd image&amp;#x53EF;&amp;#x4EE5;&amp;#x6307;&amp;#x5B9A;&amp;#x683C;&amp;#x5F0F;&amp;#xFF1A;&amp;#x2013;image-format=1&amp;#x6216;&amp;#x8005;&amp;#x2013;image-format=2&amp;#xFF0C;&amp;#x5B98;&amp;#x65B9;&amp;#x6587;&amp;#x6863;&amp;#x7ED9;&amp;#x51FA;&amp;#x4E86;&amp;#x5982;&amp;#x4E0B;&amp;#x89E3;&amp;#x91CA;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;format 1 - Use the original format for a new rbd image. This format is understood by all versions of librbd and the kernel rbd module, but does not support newer features like cloning.&lt;/li&gt;
&lt;li&gt;format 2 - Use the second rbd format, which is supported by librbd (but not the kernel rbd module) at this time. This adds support for cloning and is more easily extensible to allow more features in the future.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&amp;#x9ED8;&amp;#x8BA4;&amp;#x7684;image&amp;#x683C;&amp;#x5F0F;&amp;#x662F;format 1&amp;#xFF0C;&amp;#x8FD9;&amp;#x79CD;&amp;#x683C;&amp;#x5F0F;&amp;#x652F;&amp;#x6301;&amp;#x6240;&amp;#x6709;&amp;#x7248;&amp;#x672C;&amp;#x7684;librbd&amp;#x548C;&amp;#x5185;&amp;#x6838;rbd&amp;#x6A21;&amp;#x5757;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x4E0D;&amp;#x652F;&amp;#x6301;&amp;#x65B0;&amp;#x7684;&amp;#x529F;&amp;#x80FD;&amp;#x5982;&amp;#x514B;&amp;#x9686;&amp;#xFF1B;&amp;#x800C;format 2&amp;#x7531;librbd&amp;#x652F;&amp;#x6301;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x4E0D;&amp;#x652F;&amp;#x6301;&amp;#x5185;&amp;#x6838;rbd&amp;#x6A21;&amp;#x5757;&amp;#xFF0C;&amp;#x8FD9;&amp;#x79CD;&amp;#x683C;&amp;#x5F0F;&amp;#x652F;&amp;#x6301;&amp;#x514B;&amp;#x9686;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x4FBF;&amp;#x4E8E;&amp;#x6269;&amp;#x5C55;&amp;#x540E;&amp;#x7EED;&amp;#x5176;&amp;#x4ED6;&amp;#x529F;&amp;#x80FD;&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;1-format-1&amp;#x683C;&amp;#x5F0F;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x89E3;&amp;#x6790;&quot;&gt;&lt;a href=&quot;#1-format-1&amp;#x683C;&amp;#x5F0F;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x89E3;&amp;#x6790;&quot; class=&quot;headerlink&quot; title=&quot;1. format 1&amp;#x683C;&amp;#x5F0F;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x89E3;&amp;#x6790;&quot;&gt;&lt;/a&gt;1. format 1&amp;#x683C;&amp;#x5F0F;&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&amp;#x89E3;&amp;#x6790;&lt;/h1&gt;&lt;p&gt;&amp;#x9996;&amp;#x5148;&amp;#x521B;&amp;#x5EFA;&amp;#x4E00;&amp;#x4E2A;format 1&amp;#x683C;&amp;#x5F0F;&amp;#x7684;image&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root@ceph1:~&lt;span class=&quot;comment&quot;&gt;# rbd create test_vol --size=10&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;root@ceph1:~&lt;span class=&quot;comment&quot;&gt;# rbd -p rbd ls                                                       &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;test&lt;/span&gt;_vol&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x7136;&amp;#x540E;&amp;#x4F7F;&amp;#x7528;rados&amp;#x547D;&amp;#x4EE4;&amp;#x770B;&amp;#x5230;&amp;#x5BF9;&amp;#x5E94;&amp;#x4EA7;&amp;#x751F;&amp;#x4E00;&amp;#x4E2A;test_vol.rbd&amp;#x7684;&amp;#x5BF9;&amp;#x8C61;&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root@ceph1:~&lt;span class=&quot;comment&quot;&gt;# rados -p rbd ls&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;test&lt;/span&gt;_vol.rbd&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rbd_directory&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x5176;&amp;#x4E2D;rbd_directory&amp;#x662F;&amp;#x4FDD;&amp;#x5B58;&amp;#x8BE5;&amp;#x5B58;&amp;#x50A8;&amp;#x6C60;&amp;#x91CC;&amp;#x7684;image&amp;#x5217;&amp;#x8868;&lt;br&gt;&amp;#x4ECE;&amp;#x4E0B;&amp;#x9762;&amp;#x7684;&amp;#x547D;&amp;#x4EE4;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x5230;&amp;#x5BF9;&amp;#x4E8E;format 1&amp;#x683C;&amp;#x5F0F;&amp;#x7684;image&amp;#xFF0C;&amp;#x6CA1;&amp;#x6709;&amp;#x5C06;image name&amp;#x548C;id&amp;#x7684;&amp;#x6620;&amp;#x5C04;&amp;#x4FDD;&amp;#x5B58;&amp;#x5230;rbd_directory&amp;#x91CC;&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root@ceph1:~&lt;span class=&quot;comment&quot;&gt;#rados -p rbd listomapvals rbd_directory&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;root@ceph1:~&lt;span class=&quot;comment&quot;&gt;#&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ceph" scheme="http://yoursite.com/categories/ceph/"/>
    
    
      <category term="ceph" scheme="http://yoursite.com/tags/ceph/"/>
    
      <category term="rbd" scheme="http://yoursite.com/tags/rbd/"/>
    
  </entry>
  
  <entry>
    <title>如何使用新的glibc来编译自己的程序</title>
    <link href="http://yoursite.com/2015/08/25/use-new-glibc/"/>
    <id>http://yoursite.com/2015/08/25/use-new-glibc/</id>
    <published>2015-08-25T07:20:58.000Z</published>
    <updated>2016-05-13T09:02:26.085Z</updated>
    
    <content type="html">&lt;p&gt;&amp;#x901A;&amp;#x5E38;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;&amp;#x6211;&amp;#x4EEC;&amp;#x90FD;&amp;#x662F;&amp;#x76F4;&amp;#x63A5;&amp;#x4F7F;&amp;#x7528;glibc&amp;#x63D0;&amp;#x4F9B;&amp;#x7684;&amp;#x4E00;&amp;#x4E9B;&amp;#x5E93;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x67D0;&amp;#x4E9B;&amp;#x7279;&amp;#x6B8A;&amp;#x7684;&amp;#x60C5;&amp;#x51B5;&amp;#xFF0C;&amp;#x6BD4;&amp;#x5982;&amp;#x8981;&amp;#x4FEE;&amp;#x6539;glibc&amp;#x7684;&amp;#x4E00;&amp;#x4E9B;&amp;#x4EE3;&amp;#x7801;&amp;#x6216;&amp;#x8005;&amp;#x52A0;&amp;#x5165;glibc&amp;#x7684;&amp;#x4E00;&amp;#x4E9B;&amp;#x7F16;&amp;#x8BD1;&amp;#x9009;&amp;#x9879;&amp;#x6216;&amp;#x8005;&amp;#x8981;&amp;#x4F7F;&amp;#x7528;&amp;#x5176;&amp;#x4ED6;&amp;#x7248;&amp;#x672C;&amp;#x7684;glibc&amp;#xFF0C;&amp;#x6211;&amp;#x4EEC;&amp;#x5C31;&amp;#x9700;&amp;#x8981;&amp;#x91CD;&amp;#x65B0;&amp;#x7F16;&amp;#x8BD1;glibc&amp;#x3002;&lt;br&gt;&amp;#x7F16;&amp;#x8BD1;glibc&amp;#x65F6;&amp;#x7279;&amp;#x522B;&amp;#x8981;&amp;#x6CE8;&amp;#x610F;&amp;#xFF0C;&amp;#x4E0D;&amp;#x80FD;&amp;#x53BB;&amp;#x66FF;&amp;#x6362;&amp;#x7CFB;&amp;#x7EDF;&amp;#x81EA;&amp;#x5E26;&amp;#x7684;glibc&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;glibc&amp;#x4F5C;&amp;#x4E3A;linux&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x6838;&amp;#x5FC3;&amp;#x5E93;&amp;#xFF0C;&amp;#x5F88;&amp;#x591A;&amp;#x5E95;&amp;#x5C42;&amp;#x6A21;&amp;#x5757;&amp;#x90FD;&amp;#x4F9D;&amp;#x8D56;&amp;#x5B83;&amp;#xFF0C;&amp;#x7A0D;&amp;#x6709;&amp;#x4E0D;&amp;#x614E;&amp;#x5C31;&amp;#x4F1A;&amp;#x628A;&amp;#x7CFB;&amp;#x7EDF;&amp;#x641E;&amp;#x6302;&amp;#x6389;&amp;#x3002;&amp;#x56E0;&amp;#x6B64;&amp;#x6211;&amp;#x4EEC;&amp;#x7F16;&amp;#x8BD1;glibc&amp;#x65F6;&amp;#x6700;&amp;#x597D;&amp;#x8981;&amp;#x6307;&amp;#x5B9A;prefix=/new/path&amp;#xFF0C;&lt;br&gt;&amp;#x8FD9;&amp;#x6837;&amp;#x7F16;&amp;#x8BD1;&amp;#x5B8C;&amp;#x4E86;&amp;#x4E4B;&amp;#x540E;make install&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x5C31;&amp;#x4E0D;&amp;#x4F1A;&amp;#x53BB;&amp;#x8986;&amp;#x76D6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x81EA;&amp;#x5E26;&amp;#x7684;&amp;#x7248;&amp;#x672C;&amp;#x3002;&amp;#x90A3;&amp;#x4E48;&amp;#x95EE;&amp;#x9898;&amp;#x6765;&amp;#x4E86;&amp;#xFF0C;&amp;#x7F16;&amp;#x8BD1;&amp;#x597D;glibc&amp;#x540E;&amp;#xFF0C;&amp;#x5982;&amp;#x4F55;&amp;#x8BA9;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;&amp;#x7A0B;&amp;#x5E8F;&amp;#x4F7F;&amp;#x7528;&amp;#x8FD9;&amp;#x4E2A;&amp;#x65B0;&amp;#x7F16;&amp;#x8BD1;&amp;#x7684;glibc&amp;#x5462;&amp;#xFF1F;&amp;#x4E0B;&amp;#x9762;&amp;#x5C31;&amp;#x4EE5;&amp;#x6211;&amp;#x4EEC;&amp;#x5B9E;&amp;#x9645;&amp;#x7F16;&amp;#x8BD1;glibc&amp;#x7684;&amp;#x6B65;&amp;#x9AA4;&amp;#x6765;&amp;#x8BF4;&amp;#x660E;&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;1-&amp;#x4E0B;&amp;#x8F7D;glibc&amp;#x6E90;&amp;#x4EE3;&amp;#x7801;&quot;&gt;&lt;a href=&quot;#1-&amp;#x4E0B;&amp;#x8F7D;glibc&amp;#x6E90;&amp;#x4EE3;&amp;#x7801;&quot; class=&quot;headerlink&quot; title=&quot;1.&amp;#x4E0B;&amp;#x8F7D;glibc&amp;#x6E90;&amp;#x4EE3;&amp;#x7801;&quot;&gt;&lt;/a&gt;1.&amp;#x4E0B;&amp;#x8F7D;glibc&amp;#x6E90;&amp;#x4EE3;&amp;#x7801;&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;http://www.gnu.org/software/libc/&amp;#xFF0C;&amp;#x5728;&amp;#x5B98;&amp;#x7F51;&amp;#x4E0A;&amp;#x6709;&amp;#x5404;&amp;#x4E2A;glibc&amp;#x7684;&amp;#x53D1;&amp;#x884C;&amp;#x7248;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x6211;&amp;#x9009;&amp;#x7528;&amp;#x7684;&amp;#x662F;glibc-2.17&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.gnu.org/software/libc/&amp;#xFF0C;&amp;#x5728;&amp;#x5B98;&amp;#x7F51;&amp;#x4E0A;&amp;#x6709;&amp;#x5404;&amp;#x4E2A;glibc&amp;#x7684;&amp;#x53D1;&amp;#x884C;&amp;#x7248;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x6211;&amp;#x9009;&amp;#x7528;&amp;#x7684;&amp;#x662F;glibc-2.17&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;2-&amp;#x89E3;&amp;#x538B;glibc&amp;#x5230;&amp;#x5F53;&amp;#x524D;&amp;#x76EE;&amp;#x5F55;&quot;&gt;&lt;a href=&quot;#2-&amp;#x89E3;&amp;#x538B;glibc&amp;#x5230;&amp;#x5F53;&amp;#x524D;&amp;#x76EE;&amp;#x5F55;&quot; class=&quot;headerlink&quot; title=&quot;2.&amp;#x89E3;&amp;#x538B;glibc&amp;#x5230;&amp;#x5F53;&amp;#x524D;&amp;#x76EE;&amp;#x5F55;&quot;&gt;&lt;/a&gt;2.&amp;#x89E3;&amp;#x538B;glibc&amp;#x5230;&amp;#x5F53;&amp;#x524D;&amp;#x76EE;&amp;#x5F55;&lt;/h1&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root@xxx:~&lt;span class=&quot;comment&quot;&gt;# tar zxvf glibc-2.17.tar.gz&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h1 id=&quot;3-&amp;#x521B;&amp;#x5EFA;glibc&amp;#x7684;build&amp;#x76EE;&amp;#x5F55;&quot;&gt;&lt;a href=&quot;#3-&amp;#x521B;&amp;#x5EFA;glibc&amp;#x7684;build&amp;#x76EE;&amp;#x5F55;&quot; class=&quot;headerlink&quot; title=&quot;3.&amp;#x521B;&amp;#x5EFA;glibc&amp;#x7684;build&amp;#x76EE;&amp;#x5F55;&quot;&gt;&lt;/a&gt;3.&amp;#x521B;&amp;#x5EFA;glibc&amp;#x7684;build&amp;#x76EE;&amp;#x5F55;&lt;/h1&gt;&lt;p&gt;&amp;#x4E0D;&amp;#x80FD;&amp;#x5728;glibc-2.17&amp;#x6E90;&amp;#x7801;&amp;#x76EE;&amp;#x5F55;&amp;#x4E0B;./configure&amp;#xFF0C;&amp;#x4F1A;&amp;#x62A5;&amp;#x9519;&amp;#x201C;configure: error: you must configure in a separate build directory&amp;#x201D;&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root@xxx:~&lt;span class=&quot;comment&quot;&gt;# mkdir -p build/glibc-build&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h1 id=&quot;4-configure-glibc&quot;&gt;&lt;a href=&quot;#4-configure-glibc&quot; class=&quot;headerlink&quot; title=&quot;4.configure glibc&quot;&gt;&lt;/a&gt;4.configure glibc&lt;/h1&gt;&lt;p&gt;&amp;#x8FD9;&amp;#x91CC;&amp;#x6211;&amp;#x6307;&amp;#x5B9A;&amp;#x4E86;&amp;#x81EA;&amp;#x5DF1;&amp;#x9700;&amp;#x8981;&amp;#x7684;&amp;#x4E00;&amp;#x4E9B;&amp;#x7F16;&amp;#x8BD1;&amp;#x9009;&amp;#x9879;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x6307;&amp;#x5B9A;prefix&amp;#x76EE;&amp;#x5F55;&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root@xxx:~/build/glibc-build&lt;span class=&quot;comment&quot;&gt;# /root/glibc-2.17/configure CFLAGS=&amp;quot;-fno-builtin-strlen -ggdb -O2&amp;quot; FEATURES=&amp;quot;preserve-libs nostrip splitdebug&amp;quot; --prefix=/root/build/glibc-build&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h1 id=&quot;5-&amp;#x7F16;&amp;#x8BD1;&amp;#x5B89;&amp;#x88C5;&quot;&gt;&lt;a href=&quot;#5-&amp;#x7F16;&amp;#x8BD1;&amp;#x5B89;&amp;#x88C5;&quot; class=&quot;headerlink&quot; title=&quot;5.&amp;#x7F16;&amp;#x8BD1;&amp;#x5B89;&amp;#x88C5;&quot;&gt;&lt;/a&gt;5.&amp;#x7F16;&amp;#x8BD1;&amp;#x5B89;&amp;#x88C5;&lt;/h1&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root@xxx:~/build/glibc-build&lt;span class=&quot;comment&quot;&gt;# make -j10&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;root@xxx:~/build/glibc-build&lt;span class=&quot;comment&quot;&gt;# make install&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x5230;glibc&amp;#x76F8;&amp;#x5173;&amp;#x7684;&amp;#x5E93;&amp;#x90FD;&amp;#x5728;glibc-build&amp;#x76EE;&amp;#x5F55;&amp;#x4E0B;&amp;#x4E86;&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root@xxx:~/build/glibc-build&lt;span class=&quot;comment&quot;&gt;# ls lib&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;audit              libanl.so               libcidn.so     libdl.a     libm.so.6        libnss_db.so.2           libnss_nis-2.17.so      libpthread.so      librt.so.1           Scrt1.o&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;crt1.o              libanl.so.1           libcidn.so.1     libdl.so     libnsl-2.17.so        libnss_dns-2.17.so     libnss_nisplus-2.17.so  libpthread.so.0      libSegFault.so&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;crti.o              libBrokenLocale-2.17.so  libc_nonshared.a  libdl.so.2     libnsl.a        libnss_dns.so           libnss_nisplus.so       libresolv-2.17.so  libthread_db-1.0.so&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;crtn.o              libBrokenLocale.a        libcrypt-2.17.so  libg.a         libnsl.so        libnss_dns.so.2        libnss_nisplus.so.2     libresolv.a      libthread_db.so&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;gconv              libBrokenLocale.so       libcrypt.a     libieee.a     libnsl.so.1        libnss_files-2.17.so   libnss_nis.so           libresolv.so      libthread_db.so.1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;gcrt1.o              libBrokenLocale.so.1     libcrypt.so     libm-2.17.so     libnss_compat-2.17.so    libnss_files.so        libnss_nis.so.2           libresolv.so.2      libutil-2.17.so&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ld-2.17.so          libbsd-compat.a           libcrypt.so.1     libm.a         libnss_compat.so    libnss_files.so.2      libpcprofile.so           librpcsvc.a      libutil.a&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ld-linux-x86-64.so.2  libc-2.17.so           libc.so         libmcheck.a     libnss_compat.so.2    libnss_hesiod-2.17.so  libpthread-2.17.so      librt-2.17.so      libutil.so&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;libanl-2.17.so          libc.a               libc.so.6     libmemusage.so  libnss_db-2.17.so    libnss_hesiod.so       libpthread.a           librt.a          libutil.so.1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;libanl.a          libcidn-2.17.so           libdl-2.17.so     libm.so     libnss_db.so        libnss_hesiod.so.2     libpthread_nonshared.a  librt.so          Mcrt1.o&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h1 id=&quot;6-&amp;#x4F7F;&amp;#x7528;&amp;#x65B0;&amp;#x7684;glibc&amp;#x6765;&amp;#x7F16;&amp;#x8BD1;&amp;#x7A0B;&amp;#x5E8F;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x6211;&amp;#x7F16;&amp;#x8BD1;&amp;#x7684;&amp;#x662F;valgrind&quot;&gt;&lt;a href=&quot;#6-&amp;#x4F7F;&amp;#x7528;&amp;#x65B0;&amp;#x7684;glibc&amp;#x6765;&amp;#x7F16;&amp;#x8BD1;&amp;#x7A0B;&amp;#x5E8F;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x6211;&amp;#x7F16;&amp;#x8BD1;&amp;#x7684;&amp;#x662F;valgrind&quot; class=&quot;headerlink&quot; title=&quot;6.&amp;#x4F7F;&amp;#x7528;&amp;#x65B0;&amp;#x7684;glibc&amp;#x6765;&amp;#x7F16;&amp;#x8BD1;&amp;#x7A0B;&amp;#x5E8F;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x6211;&amp;#x7F16;&amp;#x8BD1;&amp;#x7684;&amp;#x662F;valgrind&quot;&gt;&lt;/a&gt;6.&amp;#x4F7F;&amp;#x7528;&amp;#x65B0;&amp;#x7684;glibc&amp;#x6765;&amp;#x7F16;&amp;#x8BD1;&amp;#x7A0B;&amp;#x5E8F;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x6211;&amp;#x7F16;&amp;#x8BD1;&amp;#x7684;&amp;#x662F;valgrind&lt;/h1&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root@xxx:~&lt;span class=&quot;comment&quot;&gt;# tar jxvf valgrind-3.10.1.tar.bz2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;root@xxx:~&lt;span class=&quot;comment&quot;&gt;# mkdir -p build/valgrind-build&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;root@xxx:~&lt;span class=&quot;comment&quot;&gt;# cd valgrind-3.10.1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;root@xxx:~/valgrind-3.10.1&lt;span class=&quot;comment&quot;&gt;# ./configure CFLAGS=&amp;quot;-I/root/build/glibc-build/include&amp;quot; LDFLAGS=&amp;quot;-L/home/nbs/glibc/lib -Wl,--rpath=/root/build/glibc-build/lib -Wl,--dynamic-linker=/root/build/glibc-build/lib/ld-linux-x86-64.so.2&amp;quot; --prefix=/root/build/valgrind-build&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&amp;#x4E0B;&amp;#x9762;&amp;#x5BF9;configure&amp;#x7684;&amp;#x9009;&amp;#x9879;&amp;#x8FDB;&amp;#x884C;&amp;#x8BF4;&amp;#x660E;&amp;#xFF1A;&lt;br&gt;&lt;em&gt;CFLAGS=&amp;#x201D;-I/root/build/glibc-build/include&amp;#x201D;&lt;/em&gt;        &amp;#x8FD9;&amp;#x4E2A;&amp;#x662F;&amp;#x6307;&amp;#x5B9A;&amp;#x5934;&amp;#x6587;&amp;#x4EF6;&amp;#x7684;&amp;#x67E5;&amp;#x627E;&amp;#x8DEF;&amp;#x5F84;&amp;#xFF0C;&amp;#x53BB;&amp;#x65B0;&amp;#x7F16;&amp;#x8BD1;&amp;#x7684;glibc&amp;#x91CC;&amp;#x67E5;&amp;#x627E;&lt;br&gt;&lt;em&gt;LDFLAGS&lt;/em&gt;: Makefile&amp;#x7684;&amp;#x94FE;&amp;#x63A5;&amp;#x9009;&amp;#x9879;&amp;#xFF0C;&amp;#x5176;&amp;#x4E2D;&lt;br&gt;&lt;strong&gt;-L&lt;/strong&gt;: &amp;#x544A;&amp;#x8BC9;&amp;#x94FE;&amp;#x63A5;&amp;#x5668;&amp;#x5148;&amp;#x4ECE;&amp;#x6307;&amp;#x5B9A;&amp;#x7684;&amp;#x8DEF;&amp;#x5F84;&amp;#x67E5;&amp;#x627E;&amp;#x5E93;&amp;#x6765;&amp;#x94FE;&amp;#x63A5;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x6CA1;&amp;#x627E;&amp;#x5230;&amp;#xFF0C;&amp;#x518D;&amp;#x4ECE;&amp;#x9ED8;&amp;#x8BA4;&amp;#x7684;&amp;#x5730;&amp;#x65B9;&amp;#x627E;&amp;#x3002;&amp;#x7F16;&amp;#x8BD1;&amp;#x65F6;&amp;#x7684;-L&amp;#x9009;&amp;#x9879;&amp;#x5E76;&amp;#x4E0D;&amp;#x5F71;&amp;#x54CD;&amp;#x73AF;&amp;#x5883;&amp;#x53D8;&amp;#x91CF;LD_LIBRARY_PATH&amp;#xFF0C;-L&amp;#x53EA;&amp;#x662F;&amp;#x6307;&amp;#x5B9A;&amp;#x4E86;&amp;#x7A0B;&amp;#x5E8F;&amp;#x7F16;&amp;#x8BD1;&amp;#x8FDE;&amp;#x63A5;&amp;#x65F6;&amp;#x5E93;&amp;#x7684;&amp;#x8DEF;&amp;#x5F84;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E0D;&amp;#x5F71;&amp;#x54CD;&amp;#x7A0B;&amp;#x5E8F;&amp;#x6267;&amp;#x884C;&amp;#x65F6;&amp;#x5E93;&amp;#x7684;&amp;#x8DEF;&amp;#x5F84;&amp;#xFF0C;&amp;#x7CFB;&amp;#x7EDF;&amp;#x8FD8;&amp;#x662F;&amp;#x4F1A;&amp;#x5230;&amp;#x9ED8;&amp;#x8BA4;&amp;#x8DEF;&amp;#x5F84;&amp;#x4E0B;&amp;#x67E5;&amp;#x627E;&amp;#x8BE5;&amp;#x7A0B;&amp;#x5E8F;&amp;#x6240;&amp;#x9700;&amp;#x8981;&amp;#x7684;&amp;#x5E93;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x627E;&amp;#x4E0D;&amp;#x5230;&amp;#xFF0C;&amp;#x8FD8;&amp;#x662F;&amp;#x4F1A;&amp;#x62A5;&amp;#x9519;&amp;#xFF0C;&amp;#x7C7B;&amp;#x4F3C;cannot open shared object file&amp;#x3002;&lt;br&gt;&amp;#x53EF;&amp;#x4EE5;&amp;#x8BBE;&amp;#x5B9A;LD_LIBRARY_PATH&amp;#x6765;&amp;#x8BA9;&amp;#x7A0B;&amp;#x5E8F;&amp;#x5728;&amp;#x8FD0;&amp;#x884C;&amp;#x65F6;&amp;#x67E5;&amp;#x627E;&amp;#x9664;&amp;#x9ED8;&amp;#x8BA4;&amp;#x8DEF;&amp;#x5F84;&amp;#xFF08;&amp;#x9ED8;&amp;#x8BA4;&amp;#x662F;&amp;#x5148;&amp;#x641C;&amp;#x7D22;/lib&amp;#x548C;/usr/lib&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;&amp;#x76EE;&amp;#x5F55;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x6309;&amp;#x7167;/etc/ld.so.conf&amp;#x91CC;&amp;#x9762;&amp;#x7684;&amp;#x914D;&amp;#x7F6E;&amp;#x641C;&amp;#x7D22;&amp;#x7EDD;&amp;#x5BF9;&amp;#x8DEF;&amp;#x5F84;&amp;#xFF09;&amp;#x4E4B;&amp;#x5916;&amp;#x7684;&amp;#x5176;&amp;#x4ED6;&amp;#x8DEF;&amp;#x5F84;&amp;#xFF0C;&amp;#x4E0D;&amp;#x8FC7;LD_LIBRARY_PATH&amp;#x7684;&amp;#x8BBE;&amp;#x5B9A;&amp;#x4F5C;&amp;#x7528;&amp;#x662F;&amp;#x5168;&amp;#x5C40;&amp;#x7684;&amp;#xFF0C;&amp;#x5EFA;&amp;#x8BAE;&amp;#x4F7F;&amp;#x7528;gcc&amp;#x7684;&amp;#x7684;-R&amp;#x6216;-rpath&amp;#x9009;&amp;#x9879;&amp;#x6765;&amp;#x5728;&amp;#x7F16;&amp;#x8BD1;&amp;#x65F6;&amp;#x5C31;&amp;#x6307;&amp;#x5B9A;&amp;#x5E93;&amp;#x7684;&amp;#x67E5;&amp;#x627E;&amp;#x8DEF;&amp;#x5F84;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x8BE5;&amp;#x5E93;&amp;#x7684;&amp;#x8DEF;&amp;#x5F84;&amp;#x4FE1;&amp;#x606F;&amp;#x4FDD;&amp;#x5B58;&amp;#x5728;&amp;#x53EF;&amp;#x6267;&amp;#x884C;&amp;#x6587;&amp;#x4EF6;&amp;#x4E2D;&amp;#xFF0C;&amp;#x8FD0;&amp;#x884C;&amp;#x65F6;&amp;#x5B83;&amp;#x4F1A;&amp;#x76F4;&amp;#x63A5;&amp;#x5230;&amp;#x8BE5;&amp;#x8DEF;&amp;#x5F84;&amp;#x67E5;&amp;#x627E;&amp;#x5E93;&amp;#xFF0C;&amp;#x907F;&amp;#x514D;&amp;#x4E86;&amp;#x4F7F;&amp;#x7528;LD_LIBRARY_PATH&amp;#x73AF;&amp;#x5883;&amp;#x53D8;&amp;#x91CF;&amp;#x67E5;&amp;#x627E;&amp;#x3002;&lt;br&gt;&amp;#x56E0;&amp;#x6B64;&amp;#x6211;&amp;#x5728;&amp;#x4E0A;&amp;#x9762;&amp;#x6307;&amp;#x5B9A;&amp;#x4E86;-Wl,&amp;#x2013;rpath=/root/build/glibc-build/lib&amp;#xFF0C;&amp;#x8BF4;&amp;#x660E;&amp;#x4E00;&amp;#x4E0B;&amp;#xFF0C;-Wl,option&amp;#x662F;&amp;#x5C06;&amp;#x9009;&amp;#x9879;&amp;#x4F20;&amp;#x7ED9;&amp;#x94FE;&amp;#x63A5;&amp;#x5668;&lt;/p&gt;
&lt;p&gt;&amp;#x53E6;&amp;#x5916;&amp;#xFF0C;&amp;#x4E5F;&amp;#x9700;&amp;#x8981;&amp;#x4F7F;&amp;#x7528;&amp;#x65B0;&amp;#x7F16;&amp;#x8BD1;&amp;#x7684;&amp;#x94FE;&amp;#x63A5;&amp;#x5668;&amp;#xFF0C;&amp;#x4F7F;&amp;#x7528;&lt;em&gt;&amp;#x2013;dynamic-linker&lt;/em&gt;&amp;#x6307;&amp;#x5B9A;&amp;#x94FE;&amp;#x63A5;&amp;#x5668;&lt;br&gt;&amp;#x7136;&amp;#x540E;&amp;#x518D;&amp;#x4F7F;&amp;#x7528;make &amp;amp;&amp;amp; make install&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x7F16;&amp;#x8BD1;&amp;#x5B8C;&amp;#x6210;&amp;#xFF0C;&amp;#x5B8C;&amp;#x6210;&amp;#x540E;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x5230;&amp;#x5B89;&amp;#x88C5;&amp;#x7684;&amp;#x4E1C;&amp;#x897F;&amp;#x90FD;&amp;#x5728;/root/build/valgrind-build/&amp;#x4E0B;&amp;#x3002;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;#x901A;&amp;#x5E38;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;&amp;#x6211;&amp;#x4EEC;&amp;#x90FD;&amp;#x662F;&amp;#x76F4;&amp;#x63A5;&amp;#x4F7F;&amp;#x7528;glibc&amp;#x63D0;&amp;#x4F9B;&amp;#x7684;&amp;#x4E00;&amp;#x4E9B;&amp;#x5E93;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x67D0;&amp;#x4E9B;&amp;#x7279;&amp;#x6B8A;&amp;#x7684;&amp;#x60C5;&amp;#x51B5;&amp;#xFF0C;&amp;#x6BD4;&amp;#x5982;&amp;#x8981;&amp;#x4FEE;&amp;#x6539;glibc&amp;#x7684;&amp;#x4E00;&amp;#x4E9B;&amp;#x4EE3;&amp;#x7801;&amp;#x6216;&amp;#x8005;&amp;#x52A0;&amp;#x5165;glibc&amp;#x7684;&amp;#x4E00;&amp;#x4E9B;&amp;#x7F16;&amp;#x8BD1;&amp;#x9009;&amp;#x9879;&amp;#x6216;&amp;#x8005;&amp;#x8981;&amp;#x4F7F;&amp;#x7528;&amp;#x5176;&amp;#x4ED6;&amp;#x7248;&amp;#x672C;&amp;#x7684;glibc&amp;#xFF0C;&amp;#x6211;&amp;#x4EEC;&amp;#x5C31;&amp;#x9700;&amp;#x8981;&amp;#x91CD;&amp;#x65B0;&amp;#x7F16;&amp;#x8BD1;glibc&amp;#x3002;&lt;br&gt;&amp;#x7F16;&amp;#x8BD1;glibc&amp;#x65F6;&amp;#x7279;&amp;#x522B;&amp;#x8981;&amp;#x6CE8;&amp;#x610F;&amp;#xFF0C;&amp;#x4E0D;&amp;#x80FD;&amp;#x53BB;&amp;#x66FF;&amp;#x6362;&amp;#x7CFB;&amp;#x7EDF;&amp;#x81EA;&amp;#x5E26;&amp;#x7684;glibc&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;glibc&amp;#x4F5C;&amp;#x4E3A;linux&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x6838;&amp;#x5FC3;&amp;#x5E93;&amp;#xFF0C;&amp;#x5F88;&amp;#x591A;&amp;#x5E95;&amp;#x5C42;&amp;#x6A21;&amp;#x5757;&amp;#x90FD;&amp;#x4F9D;&amp;#x8D56;&amp;#x5B83;&amp;#xFF0C;&amp;#x7A0D;&amp;#x6709;&amp;#x4E0D;&amp;#x614E;&amp;#x5C31;&amp;#x4F1A;&amp;#x628A;&amp;#x7CFB;&amp;#x7EDF;&amp;#x641E;&amp;#x6302;&amp;#x6389;&amp;#x3002;&amp;#x56E0;&amp;#x6B64;&amp;#x6211;&amp;#x4EEC;&amp;#x7F16;&amp;#x8BD1;glibc&amp;#x65F6;&amp;#x6700;&amp;#x597D;&amp;#x8981;&amp;#x6307;&amp;#x5B9A;prefix=/new/path&amp;#xFF0C;&lt;br&gt;&amp;#x8FD9;&amp;#x6837;&amp;#x7F16;&amp;#x8BD1;&amp;#x5B8C;&amp;#x4E86;&amp;#x4E4B;&amp;#x540E;make install&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x5C31;&amp;#x4E0D;&amp;#x4F1A;&amp;#x53BB;&amp;#x8986;&amp;#x76D6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x81EA;&amp;#x5E26;&amp;#x7684;&amp;#x7248;&amp;#x672C;&amp;#x3002;&amp;#x90A3;&amp;#x4E48;&amp;#x95EE;&amp;#x9898;&amp;#x6765;&amp;#x4E86;&amp;#xFF0C;&amp;#x7F16;&amp;#x8BD1;&amp;#x597D;glibc&amp;#x540E;&amp;#xFF0C;&amp;#x5982;&amp;#x4F55;&amp;#x8BA9;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;&amp;#x7A0B;&amp;#x5E8F;&amp;#x4F7F;&amp;#x7528;&amp;#x8FD9;&amp;#x4E2A;&amp;#x65B0;&amp;#x7F16;&amp;#x8BD1;&amp;#x7684;glibc&amp;#x5462;&amp;#xFF1F;&amp;#x4E0B;&amp;#x9762;&amp;#x5C31;&amp;#x4EE5;&amp;#x6211;&amp;#x4EEC;&amp;#x5B9E;&amp;#x9645;&amp;#x7F16;&amp;#x8BD1;glibc&amp;#x7684;&amp;#x6B65;&amp;#x9AA4;&amp;#x6765;&amp;#x8BF4;&amp;#x660E;&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;1-&amp;#x4E0B;&amp;#x8F7D;glibc&amp;#x6E90;&amp;#x4EE3;&amp;#x7801;&quot;&gt;&lt;a href=&quot;#1-&amp;#x4E0B;&amp;#x8F7D;glibc&amp;#x6E90;&amp;#x4EE3;&amp;#x7801;&quot; class=&quot;headerlink&quot; title=&quot;1.&amp;#x4E0B;&amp;#x8F7D;glibc&amp;#x6E90;&amp;#x4EE3;&amp;#x7801;&quot;&gt;&lt;/a&gt;1.&amp;#x4E0B;&amp;#x8F7D;glibc&amp;#x6E90;&amp;#x4EE3;&amp;#x7801;&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;http://www.gnu.org/software/libc/&amp;#xFF0C;&amp;#x5728;&amp;#x5B98;&amp;#x7F51;&amp;#x4E0A;&amp;#x6709;&amp;#x5404;&amp;#x4E2A;glibc&amp;#x7684;&amp;#x53D1;&amp;#x884C;&amp;#x7248;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x6211;&amp;#x9009;&amp;#x7528;&amp;#x7684;&amp;#x662F;glibc-2.17&quot;&gt;http://www.gnu.org/software/libc/&amp;#xFF0C;&amp;#x5728;&amp;#x5B98;&amp;#x7F51;&amp;#x4E0A;&amp;#x6709;&amp;#x5404;&amp;#x4E2A;glibc&amp;#x7684;&amp;#x53D1;&amp;#x884C;&amp;#x7248;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x6211;&amp;#x9009;&amp;#x7528;&amp;#x7684;&amp;#x662F;glibc-2.17&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;2-&amp;#x89E3;&amp;#x538B;glibc&amp;#x5230;&amp;#x5F53;&amp;#x524D;&amp;#x76EE;&amp;#x5F55;&quot;&gt;&lt;a href=&quot;#2-&amp;#x89E3;&amp;#x538B;glibc&amp;#x5230;&amp;#x5F53;&amp;#x524D;&amp;#x76EE;&amp;#x5F55;&quot; class=&quot;headerlink&quot; title=&quot;2.&amp;#x89E3;&amp;#x538B;glibc&amp;#x5230;&amp;#x5F53;&amp;#x524D;&amp;#x76EE;&amp;#x5F55;&quot;&gt;&lt;/a&gt;2.&amp;#x89E3;&amp;#x538B;glibc&amp;#x5230;&amp;#x5F53;&amp;#x524D;&amp;#x76EE;&amp;#x5F55;&lt;/h1&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root@xxx:~&lt;span class=&quot;comment&quot;&gt;# tar zxvf glibc-2.17.tar.gz&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h1 id=&quot;3-&amp;#x521B;&amp;#x5EFA;glibc&amp;#x7684;build&amp;#x76EE;&amp;#x5F55;&quot;&gt;&lt;a href=&quot;#3-&amp;#x521B;&amp;#x5EFA;glibc&amp;#x7684;build&amp;#x76EE;&amp;#x5F55;&quot; class=&quot;headerlink&quot; title=&quot;3.&amp;#x521B;&amp;#x5EFA;glibc&amp;#x7684;build&amp;#x76EE;&amp;#x5F55;&quot;&gt;&lt;/a&gt;3.&amp;#x521B;&amp;#x5EFA;glibc&amp;#x7684;build&amp;#x76EE;&amp;#x5F55;&lt;/h1&gt;&lt;p&gt;&amp;#x4E0D;&amp;#x80FD;&amp;#x5728;glibc-2.17&amp;#x6E90;&amp;#x7801;&amp;#x76EE;&amp;#x5F55;&amp;#x4E0B;./configure&amp;#xFF0C;&amp;#x4F1A;&amp;#x62A5;&amp;#x9519;&amp;#x201C;configure: error: you must configure in a separate build directory&amp;#x201D;&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root@xxx:~&lt;span class=&quot;comment&quot;&gt;# mkdir -p build/glibc-build&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="tools" scheme="http://yoursite.com/categories/tools/"/>
    
    
      <category term="glibc" scheme="http://yoursite.com/tags/glibc/"/>
    
      <category term="link" scheme="http://yoursite.com/tags/link/"/>
    
  </entry>
  
  <entry>
    <title>IET架构解析</title>
    <link href="http://yoursite.com/2015/08/20/IET/"/>
    <id>http://yoursite.com/2015/08/20/IET/</id>
    <published>2015-08-20T07:15:29.000Z</published>
    <updated>2016-05-13T09:02:40.532Z</updated>
    
    <content type="html">&lt;p&gt;IET&amp;#xFF08;iSCSI Enterprise Target&amp;#xFF09;&amp;#x662F;&amp;#x5185;&amp;#x6838;&amp;#x6001;&amp;#x5B9E;&amp;#x73B0;&amp;#x7684;iscsi target&amp;#xFF0C;&amp;#x76F8;&amp;#x6BD4;&amp;#x4E8E;&amp;#x7528;&amp;#x6237;&amp;#x6001;&amp;#x5B9E;&amp;#x73B0;&amp;#x7684;target&amp;#xFF08;&amp;#x6BD4;&amp;#x5982;tgt&amp;#xFF09;&amp;#xFF0C;iet&amp;#x6BD4;&amp;#x8F83;&amp;#x7A33;&amp;#x5B9A;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x4E5F;&amp;#x7B97;&amp;#x662F;&amp;#x5386;&amp;#x53F2;&amp;#x60A0;&amp;#x4E45;&amp;#xFF0C;io&amp;#x90FD;&amp;#x76F4;&amp;#x63A5;&amp;#x7ECF;&amp;#x8FC7;&amp;#x5185;&amp;#x6838;&amp;#x6001;&amp;#xFF0C;&amp;#x6027;&amp;#x80FD;&amp;#x6BD4;&amp;#x8F83;&amp;#x597D;&amp;#x3002;&amp;#x672C;&amp;#x6587;&amp;#x4E3B;&amp;#x8981;&amp;#x9488;&amp;#x5BF9;IET&amp;#x7684;&amp;#x7A0B;&amp;#x5E8F;&amp;#x67B6;&amp;#x6784;&amp;#xFF0C;&amp;#x4ECE;&amp;#x7A0B;&amp;#x5E8F;&amp;#x6A21;&amp;#x5757;&amp;#xFF0C;&amp;#x547D;&amp;#x4EE4;&amp;#x64CD;&amp;#x4F5C;&amp;#x5904;&amp;#x7406;&amp;#x6D41;&amp;#x7A0B;&amp;#xFF0C;initiator&amp;#x4E0E;target&amp;#x7684;&amp;#x4EA4;&amp;#x4E92;&amp;#xFF0C;I/O&amp;#x5904;&amp;#x7406;&amp;#x6D41;&amp;#x7A0B;&amp;#x8FDB;&amp;#x884C;&amp;#x5206;&amp;#x6790;&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;1-&amp;#x7A0B;&amp;#x5E8F;&amp;#x6A21;&amp;#x5757;&quot;&gt;&lt;a href=&quot;#1-&amp;#x7A0B;&amp;#x5E8F;&amp;#x6A21;&amp;#x5757;&quot; class=&quot;headerlink&quot; title=&quot;1.&amp;#x7A0B;&amp;#x5E8F;&amp;#x6A21;&amp;#x5757;&quot;&gt;&lt;/a&gt;1.&amp;#x7A0B;&amp;#x5E8F;&amp;#x6A21;&amp;#x5757;&lt;/h1&gt;&lt;p&gt;IET&amp;#x5305;&amp;#x542B;3&amp;#x90E8;&amp;#x5206;&amp;#xFF1A;ietadm&amp;#xFF0C;ietd&amp;#xFF0C;iscsi_trgt&amp;#xFF0C;&amp;#x5176;&amp;#x4E2D;ietadm&amp;#x662F;&amp;#x547D;&amp;#x4EE4;&amp;#x884C;&amp;#x5DE5;&amp;#x5177;&amp;#xFF0C;&amp;#x63D0;&amp;#x4F9B;target&amp;#xFF0C;lun&amp;#x7684;&amp;#x521B;&amp;#x5EFA;&amp;#x3001;&amp;#x5220;&amp;#x9664;&amp;#x3001;&amp;#x53C2;&amp;#x6570;&amp;#x8BBE;&amp;#x7F6E;&amp;#x7B49;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF1B;&amp;#x800C;ietd&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x7528;&amp;#x6237;&amp;#x6001;&amp;#x7A0B;&amp;#x5E8F;&amp;#xFF0C;&amp;#x7528;&amp;#x4E8E;&amp;#x548C;ietadm&amp;#x4EE5;&amp;#x53CA;initiator&amp;#x7684;&amp;#x4EA4;&amp;#x4E92;&amp;#xFF0C;&amp;#x5E76;&amp;#x8FDB;&amp;#x884C;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;iscsi&amp;#x76F8;&amp;#x5173;&amp;#x7684;&amp;#x53D1;&amp;#x73B0;&amp;#x3001;&amp;#x767B;&amp;#x5F55;&amp;#x3001;&amp;#x8BA4;&amp;#x8BC1;&amp;#x3001;&amp;#x767B;&amp;#x51FA;&amp;#x7B49;&amp;#x64CD;&amp;#x4F5C;&amp;#x90FD;&amp;#x5728;&amp;#x7528;&amp;#x6237;&amp;#x6001;&amp;#x5B9E;&amp;#x73B0;&amp;#xFF1B;iscsi_trgt&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x5185;&amp;#x6838;&amp;#x6A21;&amp;#x5757;&amp;#xFF0C;iscsi&amp;#x534F;&amp;#x8BAE;&amp;#x7684;&amp;#x89E3;&amp;#x6790;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;I/O&amp;#x5904;&amp;#x7406;&amp;#x90FD;&amp;#x5728;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5185;&amp;#x6838;&amp;#x6001;&amp;#x6A21;&amp;#x5757;&amp;#x5185;&amp;#x5B8C;&amp;#x6210;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;1&amp;#xFF09;ietdadm&amp;#x4E0E;ietd&amp;#x901A;&amp;#x8FC7;IPC&amp;#x8FDB;&amp;#x884C;&amp;#x4EA4;&amp;#x4E92;&amp;#xFF0C;IPC&amp;#x5728;ietd&amp;#x7A0B;&amp;#x5E8F;&amp;#x542F;&amp;#x52A8;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x8FDB;&amp;#x884C;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#xFF1B;&lt;br&gt;2&amp;#xFF09;ietd&amp;#x542F;&amp;#x52A8;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x8FD8;&amp;#x4F1A;&amp;#x521B;&amp;#x5EFA;&amp;#x76D1;&amp;#x542C;socket&amp;#xFF08;&amp;#x9ED8;&amp;#x8BA4;&amp;#x7684;&amp;#x7AEF;&amp;#x53E3;&amp;#x662F;3260&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x4F1A;&amp;#x4E3A;&amp;#x8BE5;&amp;#x673A;&amp;#x5668;&amp;#x4E0A;&amp;#x7684;&amp;#x6BCF;&amp;#x4E2A;ip&amp;#x90FD;&amp;#x751F;&amp;#x6210;&amp;#x4E00;&amp;#x4E2A;&amp;#x76D1;&amp;#x542C;socket&amp;#xFF0C;initiator&amp;#x5728;&amp;#x53D1;&amp;#x73B0;target&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x4F1A;&amp;#x6307;&amp;#x5B9A;ip&amp;#x548C;port&amp;#xFF09;&amp;#xFF0C;initiator&amp;#x5C31;&amp;#x901A;&amp;#x8FC7;socket&amp;#x4E0E;ietd&amp;#x8FDB;&amp;#x884C;&amp;#x4EA4;&amp;#x4E92;&amp;#xFF0C;&amp;#x4E00;&amp;#x4E2A;initiator&amp;#x548C;&amp;#x4E00;&amp;#x4E2A;target&amp;#x5EFA;&amp;#x7ACB;&amp;#x8D77;&amp;#x4E00;&amp;#x4E2A;&amp;#x957F;&amp;#x8FDE;&amp;#x63A5;&amp;#xFF08;iscsi&amp;#x534F;&amp;#x8BAE;&amp;#x6807;&amp;#x51C6;&amp;#x8BF4;&amp;#x7684;&amp;#x662F;&amp;#x81F3;&amp;#x5C11;1&amp;#x4E2A;&amp;#x8FDE;&amp;#x63A5;&amp;#xFF09;&amp;#xFF0C;&amp;#x540E;&amp;#x7EED;&amp;#x7684;I/O&amp;#x90FD;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;&amp;#x8FD9;&amp;#x4E2A;&amp;#x8FDE;&amp;#x63A5;&amp;#x8FDB;&amp;#x884C;&amp;#x4EA4;&amp;#x4E92;&amp;#xFF1B;&lt;br&gt;3&amp;#xFF09;ietd&amp;#x4E0E;iscsi_trgt&amp;#x4F7F;&amp;#x7528;ioctl&amp;#x8FDB;&amp;#x884C;&amp;#x4EA4;&amp;#x4E92;&amp;#xFF0C;&amp;#x4E00;&amp;#x4E9B;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF08;&amp;#x6BD4;&amp;#x5982;&amp;#x521B;&amp;#x5EFA;&amp;#x5220;&amp;#x9664;target&amp;#xFF0C;&amp;#x521B;&amp;#x5EFA;&amp;#x5220;&amp;#x9664;lun&amp;#x7B49;&amp;#xFF09;&amp;#x90FD;&amp;#x7531;ietd&amp;#x5728;&amp;#x7528;&amp;#x6237;&amp;#x6001;&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#x540E;&amp;#xFF0C;&amp;#x5C06;&amp;#x547D;&amp;#x4EE4;&amp;#x901A;&amp;#x8FC7;ioctl&amp;#x53D1;&amp;#x5230;iscsi_trgt&amp;#xFF0C;&amp;#x7136;&amp;#x540E;iscsi_trgt&amp;#x5728;&amp;#x5185;&amp;#x6838;&amp;#x6001;&amp;#x4E0B;&amp;#x8FDB;&amp;#x884C;&amp;#x76F8;&amp;#x5173;&amp;#x5904;&amp;#x7406;&amp;#xFF1B;&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;&lt;img src=&quot;/2015/08/20/IET/ietadm.png&quot; alt=&quot;ietadm&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;2-initiator&amp;#x4E0E;iet&amp;#x7684;&amp;#x4EA4;&amp;#x4E92;&quot;&gt;&lt;a href=&quot;#2-initiator&amp;#x4E0E;iet&amp;#x7684;&amp;#x4EA4;&amp;#x4E92;&quot; class=&quot;headerlink&quot; title=&quot;2.initiator&amp;#x4E0E;iet&amp;#x7684;&amp;#x4EA4;&amp;#x4E92;&quot;&gt;&lt;/a&gt;2.initiator&amp;#x4E0E;iet&amp;#x7684;&amp;#x4EA4;&amp;#x4E92;&lt;/h1&gt;&lt;p&gt;initiator&amp;#x5411;ietd&amp;#x53D1;&amp;#x8D77;&amp;#x8BF7;&amp;#x6C42;&amp;#xFF0C;ietd&amp;#x6839;&amp;#x636E;&amp;#x8BF7;&amp;#x6C42;&amp;#x7684;&amp;#x7C7B;&amp;#x578B;&amp;#x8FDB;&amp;#x884C;&amp;#x76F8;&amp;#x5173;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x5728;ietd&amp;#x8FDB;&amp;#x7A0B;&amp;#x4E3B;&amp;#x8981;&amp;#x8FDB;&amp;#x884C;&amp;#x7684;&amp;#x662F;discovery&amp;#x3001;login&amp;#x3001;auth&amp;#x3001;logout&amp;#x7B49;&amp;#x767B;&amp;#x5F55;&amp;#x8BA4;&amp;#x8BC1;&amp;#x7684;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x6709;&amp;#x9700;&amp;#x8981;&amp;#x7684;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;ietd&amp;#x4F1A;&amp;#x5C06;&amp;#x547D;&amp;#x4EE4;&amp;#x53D1;&amp;#x5230;iscsi_trgt&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#x3002;&amp;#x8FD9;&amp;#x91CC;&amp;#x4EE5;iscsi login&amp;#x4E3A;&amp;#x4F8B;&amp;#x6765;&amp;#x7B80;&amp;#x5355;&amp;#x5206;&amp;#x6790;&amp;#x5904;&amp;#x7406;&amp;#x6D41;&amp;#x7A0B;&amp;#x3002;&lt;br&gt;&amp;#x5982;&amp;#x56FE;&amp;#x6240;&amp;#x793A;&amp;#xFF0C;initiator&amp;#x53D1;&amp;#x8D77;login&amp;#x8BF7;&amp;#x6C42;&amp;#x5230;ietd&amp;#xFF0C;ietd&amp;#x6536;&amp;#x5230;login&amp;#x8BF7;&amp;#x6C42;&amp;#xFF0C;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x8FDE;&amp;#x63A5;&amp;#x4FE1;&amp;#x606F;&amp;#xFF08;conn&amp;#xFF09;&amp;#xFF0C;&amp;#x5E76;&amp;#x8FDB;&amp;#x884C;login&amp;#x7684;&amp;#x5BF9;&amp;#x5E94;&amp;#x5904;&amp;#x7406;&amp;#xFF08;&amp;#x5728;login_start&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x5C06;conn-&amp;gt;tid=target-&amp;gt;tid&amp;#xFF0C;&amp;#x5176;&amp;#x4E2D;target&amp;#x662F;&amp;#x6839;&amp;#x636E;&amp;#x8BF7;&amp;#x6C42;&amp;#x4FE1;&amp;#x606F;&amp;#x91CC;&amp;#x7684;targetname&amp;#x627E;&amp;#x5230;&amp;#x7684;&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;&amp;#x5C31;&amp;#x5C06;conn&amp;#x4E0E;target&amp;#x5173;&amp;#x8054;&amp;#x8D77;&amp;#x6765;&amp;#x4E86;&amp;#xFF09;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x521D;&amp;#x59CB;&amp;#x5316;session&amp;#xFF0C;&amp;#x5B8C;&amp;#x6210;&amp;#x540E;&amp;#xFF0C;ietd&amp;#x4F7F;&amp;#x7528;ioctl&amp;#x901A;&amp;#x8FC7;iscsi_trgt&amp;#x5728;&amp;#x5185;&amp;#x6838;&amp;#x6001;&amp;#x53BB;&amp;#x521B;&amp;#x5EFA;session&amp;#xFF0C;&amp;#x5B8C;&amp;#x6210;&amp;#x540E;&amp;#x8FD4;&amp;#x56DE;&amp;#x7ED9;ietd&amp;#xFF0C;&amp;#x7136;&amp;#x540E;ietd&amp;#x8FD4;&amp;#x56DE;&amp;#x7ED9;initiator&amp;#x54CD;&amp;#x5E94;&amp;#x4FE1;&amp;#x606F;&amp;#xFF1B;&amp;#x4E4B;&amp;#x540E;ietd&amp;#x901A;&amp;#x77E5;iscsi_trgt&amp;#x63A5;&amp;#x7BA1;fd&amp;#xFF0C;iscsi_trgt&amp;#x5C31;&amp;#x4F1A;&amp;#x5728;&amp;#x5185;&amp;#x6838;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#x8FDE;&amp;#x63A5;&amp;#xFF08;conn&amp;#xFF09;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x8FDE;&amp;#x63A5;&amp;#x76F4;&amp;#x63A5;&amp;#x4E0E;&amp;#x7528;&amp;#x6237;&amp;#x6001;ietd&amp;#x4F7F;&amp;#x7528;&amp;#x7684;&amp;#x90A3;&amp;#x4E2A;fd&amp;#x5173;&amp;#x8054;&amp;#xFF0C;&amp;#x76F4;&amp;#x63A5;&amp;#x4F7F;&amp;#x7528;&amp;#x4E86;&amp;#x8FD9;&amp;#x4E2A;fd&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x5185;&amp;#x6838;sock&amp;#xFF0C;&amp;#x540E;&amp;#x7EED;initiator&amp;#x7AEF;&amp;#x7684;I/O&amp;#x5C31;&amp;#x76F4;&amp;#x63A5;&amp;#x901A;&amp;#x8FC7;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5185;&amp;#x6838;sock&amp;#x4E0E;iscsi_trgt&amp;#x8FDB;&amp;#x884C;&amp;#x4EA4;&amp;#x4E92;&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2015/08/20/IET/initiator.png&quot; alt=&quot;initiator&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;3-I-O&amp;#x5904;&amp;#x7406;&quot;&gt;&lt;a href=&quot;#3-I-O&amp;#x5904;&amp;#x7406;&quot; class=&quot;headerlink&quot; title=&quot;3.I/O&amp;#x5904;&amp;#x7406;&quot;&gt;&lt;/a&gt;3.I/O&amp;#x5904;&amp;#x7406;&lt;/h1&gt;&lt;p&gt;&amp;#x5728;&amp;#x4ECB;&amp;#x7ECD;I/O&amp;#x5904;&amp;#x7406;&amp;#x6D41;&amp;#x7A0B;&amp;#x4E4B;&amp;#x524D;&amp;#xFF0C;&amp;#x5148;&amp;#x8981;&amp;#x4E86;&amp;#x89E3;&amp;#x4E00;&amp;#x4E0B;&amp;#x6BCF;&amp;#x4E2A;target&amp;#x6240;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x5185;&amp;#x6838;&amp;#x7EBF;&amp;#x7A0B;&amp;#x3002;&lt;br&gt;&amp;#x5728;&amp;#x521B;&amp;#x5EFA;target&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;iscsi_trgt&amp;#x5185;&amp;#x6838;&amp;#x6A21;&amp;#x5757;&amp;#x5C31;&amp;#x4F1A;&amp;#x4E3A;&amp;#x8FD9;&amp;#x4E2A;target&amp;#x5206;&amp;#x914D;&amp;#x4E00;&amp;#x4E2A;&amp;#x7F51;&amp;#x7EDC;&amp;#x7EBF;&amp;#x7A0B;nthread&amp;#xFF08;&amp;#x540D;&amp;#x5B57;&amp;#x53EB;istd&lt;tid&gt;&amp;#xFF0C;&amp;#x6BD4;&amp;#x5982;target id&amp;#x662F;1000&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;ps&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x5230;&amp;#x201C;istd1000&amp;#x201D;&amp;#x8FD9;&amp;#x6837;&amp;#x7684;&amp;#x8FDB;&amp;#x7A0B;&amp;#xFF09;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x4F1A;&amp;#x5206;&amp;#x914D;&amp;#x82E5;&amp;#x5E72;&amp;#x4E2A;&amp;#x5DE5;&amp;#x4F5C;&amp;#x7EBF;&amp;#x7A0B;wthread&amp;#xFF08;&amp;#x540D;&amp;#x5B57;&amp;#x53EB;istiod&lt;tid&gt;&amp;#xFF09;&amp;#xFF0C;&amp;#x9ED8;&amp;#x8BA4;&amp;#x662F;8&amp;#x4E2A;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x901A;&amp;#x8FC7;&amp;#x53C2;&amp;#x6570;&amp;#x914D;&amp;#x7F6E;&amp;#x7684;&amp;#x3002;&amp;#x7F51;&amp;#x7EDC;&amp;#x7EBF;&amp;#x7A0B;&amp;#x4F1A;&amp;#x8FDB;&amp;#x884C;iscsi&amp;#x534F;&amp;#x8BAE;&amp;#x7684;&amp;#x89E3;&amp;#x6790;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x5904;&amp;#x7406;&amp;#x5B8C;&amp;#x6210;&amp;#x540E;&amp;#x653E;&amp;#x5165;&amp;#x5DE5;&amp;#x4F5C;&amp;#x961F;&amp;#x5217;&amp;#xFF08;work_queue&amp;#xFF09;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x5524;&amp;#x9192;&amp;#x5DE5;&amp;#x4F5C;&amp;#x7EBF;&amp;#x7A0B;&amp;#xFF0C;&amp;#x591A;&amp;#x4E2A;&amp;#x5DE5;&amp;#x4F5C;&amp;#x7EBF;&amp;#x7A0B;&amp;#x5171;&amp;#x7528;&amp;#x8FD9;&amp;#x4E2A;work_queue&amp;#xFF0C;&amp;#x4ECE;work_queue&amp;#x91CC;&amp;#x53D6;cmnd&amp;#x6765;&amp;#x8FDB;&amp;#x884C;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x3002;&lt;/tid&gt;&lt;/tid&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x5982;&amp;#x56FE;&amp;#x6240;&amp;#x793A;&amp;#xFF0C;&amp;#x5728;initiator&amp;#x7AEF;&amp;#x5BF9;iscsi&amp;#x8BBE;&amp;#x5907;&amp;#x8FDB;&amp;#x884C;io&amp;#x8BFB;&amp;#x5199;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x7ECF;&amp;#x8FC7;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x3001;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x5230;SCSI&amp;#x5B50;&amp;#x7CFB;&amp;#x7EDF;&amp;#xFF0C;&amp;#x6700;&amp;#x540E;&amp;#x7531;SCSI low layer&amp;#x91CC;&amp;#x7684;iscsi_tcp&amp;#x6A21;&amp;#x5757;&amp;#x901A;&amp;#x8FC7;&amp;#x7F51;&amp;#x7EDC;&amp;#x53D1;&amp;#x9001;I/O&amp;#x8BF7;&amp;#x6C42;&amp;#x5230;iscsi_trgt&amp;#xFF0C;iscsi_trgt&amp;#x91CC;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;target&amp;#x7684;&amp;#x8FDE;&amp;#x63A5;&amp;#x7684;sock&amp;#x6536;&amp;#x5230;&amp;#x8BF7;&amp;#x6C42;&amp;#xFF0C;&amp;#x56DE;&amp;#x5524;&amp;#x9192;&amp;#x5BF9;&amp;#x5E94;target&amp;#x7684;nthread&amp;#xFF0C;&amp;#x7136;&amp;#x540E;nthread&amp;#x8FDB;&amp;#x884C;&amp;#x534F;&amp;#x8BAE;&amp;#x7684;&amp;#x89E3;&amp;#x6790;&amp;#xFF0C;&amp;#x5904;&amp;#x7406;&amp;#x5B8C;&amp;#x540E;&amp;#x5C06;cmnd&amp;#x653E;&amp;#x5230;&amp;#x5DE5;&amp;#x4F5C;&amp;#x961F;&amp;#x5217;work_queue&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x5524;&amp;#x9192;wthread&amp;#xFF0C;wthread&amp;#x4ECE;&amp;#x961F;&amp;#x5217;&amp;#x91CC;&amp;#x53D6;cmnd&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x6839;&amp;#x636E;&amp;#x8BF7;&amp;#x6C42;&amp;#x7C7B;&amp;#x578B;&amp;#x8FDB;&amp;#x884C;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#xFF08;&amp;#x5177;&amp;#x4F53;&amp;#x662F;&amp;#x5728;target_disk.c&amp;#x91CC;&amp;#x7684;disk_execute_cmnd&amp;#xFF0C;&amp;#x5305;&amp;#x62EC;INQUIRY&amp;#x3001;REPORT_LUNS&amp;#x3001;READ_CAPACITY&amp;#x3001;MODE_SENSE&amp;#x3001;READ_6/READ_10/READ_16&amp;#x3001;WRITE_6/WRITE_10/WRITE_16&amp;#x3001;SYNCHRONIZE_CACHE&amp;#x7B49;&amp;#x5BF9;&amp;#x5E94;&amp;#x8BF7;&amp;#x6C42;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#xFF09;&amp;#xFF0C;&amp;#x6BD4;&amp;#x5982;&amp;#x8BFB;&amp;#x5199;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x4F1A;&amp;#x8D70;&amp;#x5230;&amp;#x540E;&amp;#x7AEF;&amp;#x5B58;&amp;#x50A8;&amp;#x7C7B;&amp;#x578B;&amp;#xFF08;nullio&amp;#xFF0C;blockio&amp;#xFF0C;fileio&amp;#xFF09;&amp;#x7684;&amp;#x5177;&amp;#x4F53;&amp;#x5904;&amp;#x7406;&amp;#x6D41;&amp;#x7A0B;&amp;#xFF1A;&amp;#x5C31;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;make_request&amp;#x6307;&amp;#x5411;&amp;#x5230;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;request&amp;#x5904;&amp;#x7406;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x6BD4;&amp;#x5982;blockio&amp;#x91CC;&amp;#x7684;blockio_make_request&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x6784;&amp;#x9020;bio&amp;#xFF0C;&amp;#x8C03;&amp;#x7528;submit_bio&amp;#x4E0B;&amp;#x53D1;&amp;#x5230;&amp;#x5E95;&amp;#x5C42;&amp;#x78C1;&amp;#x76D8;&amp;#x8BBE;&amp;#x5907;&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#xFF1B;&amp;#x5982;&amp;#x679C;&amp;#x662F;fileio&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x8C03;&amp;#x7528;vfs_read/vfs_write&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;I/O&amp;#x5B8C;&amp;#x6210;&amp;#x540E;&amp;#xFF0C;&amp;#x6784;&amp;#x9020;iscsi response&amp;#x653E;&amp;#x5230;&amp;#x5230;write_list&amp;#xFF08;&amp;#x4E5F;&amp;#x662F;&amp;#x6BCF;&amp;#x4E2A;&amp;#x8FDE;&amp;#x63A5;&amp;#x4E00;&amp;#x4E2A;write_list&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;&amp;#x8BF4;&amp;#x4E0D;&amp;#x540C;target&amp;#x4E0D;&amp;#x4E00;&amp;#x6837;&amp;#xFF09;&amp;#xFF0C;&amp;#x5524;&amp;#x9192;nthread&amp;#x6765;&amp;#x8FDB;&amp;#x884C;iscsi response&amp;#x7684;&amp;#x76F8;&amp;#x5173;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x6700;&amp;#x540E;&amp;#x901A;&amp;#x8FC7;sock&amp;#x5C06;&amp;#x76F8;&amp;#x5E94;&amp;#x53D1;&amp;#x5230;initiator&amp;#x7AEF;&amp;#x7684;&amp;#x8BBE;&amp;#x5907;&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2015/08/20/IET/iet-arch.png&quot; alt=&quot;iet-arch&quot;&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;IET&amp;#xFF08;iSCSI Enterprise Target&amp;#xFF09;&amp;#x662F;&amp;#x5185;&amp;#x6838;&amp;#x6001;&amp;#x5B9E;&amp;#x73B0;&amp;#x7684;iscsi target&amp;#xFF0C;&amp;#x76F8;&amp;#x6BD4;&amp;#x4E8E;&amp;#x7528;&amp;#x6237;&amp;#x6001;&amp;#x5B9E;&amp;#x73B0;&amp;#x7684;target&amp;#xFF08;&amp;#x6BD4;&amp;#x5982;tgt&amp;#xFF09;&amp;#xFF0C;iet&amp;#x6BD4;&amp;#x8F83;&amp;#x7A33;&amp;#x5B9A;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x4E5F;&amp;#x7B97;&amp;#x662F;&amp;#x5386;&amp;#x53F2;&amp;#x60A0;&amp;#x4E45;&amp;#xFF0C;io&amp;#x90FD;&amp;#x76F4;&amp;#x63A5;&amp;#x7ECF;&amp;#x8FC7;&amp;#x5185;&amp;#x6838;&amp;#x6001;&amp;#xFF0C;&amp;#x6027;&amp;#x80FD;&amp;#x6BD4;&amp;#x8F83;&amp;#x597D;&amp;#x3002;&amp;#x672C;&amp;#x6587;&amp;#x4E3B;&amp;#x8981;&amp;#x9488;&amp;#x5BF9;IET&amp;#x7684;&amp;#x7A0B;&amp;#x5E8F;&amp;#x67B6;&amp;#x6784;&amp;#xFF0C;&amp;#x4ECE;&amp;#x7A0B;&amp;#x5E8F;&amp;#x6A21;&amp;#x5757;&amp;#xFF0C;&amp;#x547D;&amp;#x4EE4;&amp;#x64CD;&amp;#x4F5C;&amp;#x5904;&amp;#x7406;&amp;#x6D41;&amp;#x7A0B;&amp;#xFF0C;initiator&amp;#x4E0E;target&amp;#x7684;&amp;#x4EA4;&amp;#x4E92;&amp;#xFF0C;I/O&amp;#x5904;&amp;#x7406;&amp;#x6D41;&amp;#x7A0B;&amp;#x8FDB;&amp;#x884C;&amp;#x5206;&amp;#x6790;&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;1-&amp;#x7A0B;&amp;#x5E8F;&amp;#x6A21;&amp;#x5757;&quot;&gt;&lt;a href=&quot;#1-&amp;#x7A0B;&amp;#x5E8F;&amp;#x6A21;&amp;#x5757;&quot; class=&quot;headerlink&quot; title=&quot;1.&amp;#x7A0B;&amp;#x5E8F;&amp;#x6A21;&amp;#x5757;&quot;&gt;&lt;/a&gt;1.&amp;#x7A0B;&amp;#x5E8F;&amp;#x6A21;&amp;#x5757;&lt;/h1&gt;&lt;p&gt;IET&amp;#x5305;&amp;#x542B;3&amp;#x90E8;&amp;#x5206;&amp;#xFF1A;ietadm&amp;#xFF0C;ietd&amp;#xFF0C;iscsi_trgt&amp;#xFF0C;&amp;#x5176;&amp;#x4E2D;ietadm&amp;#x662F;&amp;#x547D;&amp;#x4EE4;&amp;#x884C;&amp;#x5DE5;&amp;#x5177;&amp;#xFF0C;&amp;#x63D0;&amp;#x4F9B;target&amp;#xFF0C;lun&amp;#x7684;&amp;#x521B;&amp;#x5EFA;&amp;#x3001;&amp;#x5220;&amp;#x9664;&amp;#x3001;&amp;#x53C2;&amp;#x6570;&amp;#x8BBE;&amp;#x7F6E;&amp;#x7B49;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF1B;&amp;#x800C;ietd&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x7528;&amp;#x6237;&amp;#x6001;&amp;#x7A0B;&amp;#x5E8F;&amp;#xFF0C;&amp;#x7528;&amp;#x4E8E;&amp;#x548C;ietadm&amp;#x4EE5;&amp;#x53CA;initiator&amp;#x7684;&amp;#x4EA4;&amp;#x4E92;&amp;#xFF0C;&amp;#x5E76;&amp;#x8FDB;&amp;#x884C;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;iscsi&amp;#x76F8;&amp;#x5173;&amp;#x7684;&amp;#x53D1;&amp;#x73B0;&amp;#x3001;&amp;#x767B;&amp;#x5F55;&amp;#x3001;&amp;#x8BA4;&amp;#x8BC1;&amp;#x3001;&amp;#x767B;&amp;#x51FA;&amp;#x7B49;&amp;#x64CD;&amp;#x4F5C;&amp;#x90FD;&amp;#x5728;&amp;#x7528;&amp;#x6237;&amp;#x6001;&amp;#x5B9E;&amp;#x73B0;&amp;#xFF1B;iscsi_trgt&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x5185;&amp;#x6838;&amp;#x6A21;&amp;#x5757;&amp;#xFF0C;iscsi&amp;#x534F;&amp;#x8BAE;&amp;#x7684;&amp;#x89E3;&amp;#x6790;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;I/O&amp;#x5904;&amp;#x7406;&amp;#x90FD;&amp;#x5728;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5185;&amp;#x6838;&amp;#x6001;&amp;#x6A21;&amp;#x5757;&amp;#x5185;&amp;#x5B8C;&amp;#x6210;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;1&amp;#xFF09;ietdadm&amp;#x4E0E;ietd&amp;#x901A;&amp;#x8FC7;IPC&amp;#x8FDB;&amp;#x884C;&amp;#x4EA4;&amp;#x4E92;&amp;#xFF0C;IPC&amp;#x5728;ietd&amp;#x7A0B;&amp;#x5E8F;&amp;#x542F;&amp;#x52A8;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x8FDB;&amp;#x884C;&amp;#x521D;&amp;#x59CB;&amp;#x5316;&amp;#xFF1B;&lt;br&gt;2&amp;#xFF09;ietd&amp;#x542F;&amp;#x52A8;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x8FD8;&amp;#x4F1A;&amp;#x521B;&amp;#x5EFA;&amp;#x76D1;&amp;#x542C;socket&amp;#xFF08;&amp;#x9ED8;&amp;#x8BA4;&amp;#x7684;&amp;#x7AEF;&amp;#x53E3;&amp;#x662F;3260&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x4F1A;&amp;#x4E3A;&amp;#x8BE5;&amp;#x673A;&amp;#x5668;&amp;#x4E0A;&amp;#x7684;&amp;#x6BCF;&amp;#x4E2A;ip&amp;#x90FD;&amp;#x751F;&amp;#x6210;&amp;#x4E00;&amp;#x4E2A;&amp;#x76D1;&amp;#x542C;socket&amp;#xFF0C;initiator&amp;#x5728;&amp;#x53D1;&amp;#x73B0;target&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x4F1A;&amp;#x6307;&amp;#x5B9A;ip&amp;#x548C;port&amp;#xFF09;&amp;#xFF0C;initiator&amp;#x5C31;&amp;#x901A;&amp;#x8FC7;socket&amp;#x4E0E;ietd&amp;#x8FDB;&amp;#x884C;&amp;#x4EA4;&amp;#x4E92;&amp;#xFF0C;&amp;#x4E00;&amp;#x4E2A;initiator&amp;#x548C;&amp;#x4E00;&amp;#x4E2A;target&amp;#x5EFA;&amp;#x7ACB;&amp;#x8D77;&amp;#x4E00;&amp;#x4E2A;&amp;#x957F;&amp;#x8FDE;&amp;#x63A5;&amp;#xFF08;iscsi&amp;#x534F;&amp;#x8BAE;&amp;#x6807;&amp;#x51C6;&amp;#x8BF4;&amp;#x7684;&amp;#x662F;&amp;#x81F3;&amp;#x5C11;1&amp;#x4E2A;&amp;#x8FDE;&amp;#x63A5;&amp;#xFF09;&amp;#xFF0C;&amp;#x540E;&amp;#x7EED;&amp;#x7684;I/O&amp;#x90FD;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;&amp;#x8FD9;&amp;#x4E2A;&amp;#x8FDE;&amp;#x63A5;&amp;#x8FDB;&amp;#x884C;&amp;#x4EA4;&amp;#x4E92;&amp;#xFF1B;&lt;br&gt;3&amp;#xFF09;ietd&amp;#x4E0E;iscsi_trgt&amp;#x4F7F;&amp;#x7528;ioctl&amp;#x8FDB;&amp;#x884C;&amp;#x4EA4;&amp;#x4E92;&amp;#xFF0C;&amp;#x4E00;&amp;#x4E9B;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF08;&amp;#x6BD4;&amp;#x5982;&amp;#x521B;&amp;#x5EFA;&amp;#x5220;&amp;#x9664;target&amp;#xFF0C;&amp;#x521B;&amp;#x5EFA;&amp;#x5220;&amp;#x9664;lun&amp;#x7B49;&amp;#xFF09;&amp;#x90FD;&amp;#x7531;ietd&amp;#x5728;&amp;#x7528;&amp;#x6237;&amp;#x6001;&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#x540E;&amp;#xFF0C;&amp;#x5C06;&amp;#x547D;&amp;#x4EE4;&amp;#x901A;&amp;#x8FC7;ioctl&amp;#x53D1;&amp;#x5230;iscsi_trgt&amp;#xFF0C;&amp;#x7136;&amp;#x540E;iscsi_trgt&amp;#x5728;&amp;#x5185;&amp;#x6838;&amp;#x6001;&amp;#x4E0B;&amp;#x8FDB;&amp;#x884C;&amp;#x76F8;&amp;#x5173;&amp;#x5904;&amp;#x7406;&amp;#xFF1B;&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="storage" scheme="http://yoursite.com/categories/storage/"/>
    
      <category term="iscsi" scheme="http://yoursite.com/categories/storage/iscsi/"/>
    
    
      <category term="storage" scheme="http://yoursite.com/tags/storage/"/>
    
      <category term="iscsi" scheme="http://yoursite.com/tags/iscsi/"/>
    
      <category term="iet" scheme="http://yoursite.com/tags/iet/"/>
    
  </entry>
  
  <entry>
    <title>Journal-guided Resynchronization for Software RAID</title>
    <link href="http://yoursite.com/2015/08/06/journal-guided-resync-for-sraid/"/>
    <id>http://yoursite.com/2015/08/06/journal-guided-resync-for-sraid/</id>
    <published>2015-08-06T14:24:38.000Z</published>
    <updated>2016-05-13T09:03:44.937Z</updated>
    
    <content type="html">&lt;p&gt;&amp;#x8BE5;&amp;#x6587;&amp;#x7AE0;&amp;#x4E3B;&amp;#x8981;&amp;#x8BB2;&amp;#x628A;&amp;#x65E5;&amp;#x5FD7;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#xFF08;&amp;#x5982;ext3&amp;#xFF09;&amp;#x4E0E;&amp;#x5E95;&amp;#x5C42;&amp;#x7684;&amp;#x8F6F;raid&amp;#x7ED3;&amp;#x5408;&amp;#x8D77;&amp;#x6765;&amp;#xFF0C;&amp;#x5F15;&amp;#x5165;declared mode&amp;#xFF0C;&amp;#x5728;&amp;#x5199;&amp;#x5165;&amp;#x6570;&amp;#x636E;&amp;#x524D;&amp;#xFF0C;&amp;#x5148;&amp;#x8BB0;&amp;#x5F55;&amp;#x65E5;&amp;#x5FD7;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5728;&amp;#x610F;&amp;#x5916;&amp;#x5D29;&amp;#x6E83;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x80FD;&amp;#x591F;&amp;#x6839;&amp;#x636E;&amp;#x65E5;&amp;#x5FD7;&amp;#x6765;&amp;#x5224;&amp;#x65AD;&amp;#x54EA;&amp;#x4E9B;&amp;#x6570;&amp;#x636E;&amp;#x662F;&amp;#x4E0D;&amp;#x4E00;&amp;#x81F4;&amp;#x7684;&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;&amp;#x51CF;&amp;#x5C11;&amp;#x4E86;&amp;#x5168;&amp;#x91CF;&amp;#x540C;&amp;#x6B65;&amp;#xFF0C;&amp;#x7F29;&amp;#x77ED;&amp;#x4E86;&amp;#x5904;&amp;#x4E8E;&amp;#x6545;&amp;#x969C;&amp;#x6062;&amp;#x590D;&amp;#x72B6;&amp;#x6001;&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x4E3A;&amp;#x4E86;&amp;#x5B9E;&amp;#x73B0;&amp;#x8FD9;&amp;#x4E2A;&amp;#x529F;&amp;#x80FD;&amp;#xFF0C;&amp;#x4E3A;&amp;#x8F6F;raid&amp;#x589E;&amp;#x52A0;&amp;#x4E86;&amp;#x4E00;&amp;#x4E2A;&amp;#x65B0;&amp;#x7684;&amp;#x63A5;&amp;#x53E3;&amp;#xFF0C;verify read&amp;#xFF0C;&amp;#x5728;&amp;#x6536;&amp;#x5230;&amp;#x8FD9;&amp;#x79CD;&amp;#x8BF7;&amp;#x6C42;&amp;#x65F6;&amp;#xFF0C;&amp;#x5148;&amp;#x8FDB;&amp;#x884C;&amp;#x6570;&amp;#x636E;&amp;#x7684;&amp;#x6821;&amp;#x9A8C;&amp;#x5224;&amp;#x65AD;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x6709;&amp;#x4E0D;&amp;#x4E00;&amp;#x81F4;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x5219;&amp;#x91CD;&amp;#x5199;&amp;#x955C;&amp;#x50CF;&amp;#x6216;&amp;#x6821;&amp;#x9A8C;&amp;#x6570;&amp;#x636E;&amp;#x6765;&amp;#x4FDD;&amp;#x6301;&amp;#x4E00;&amp;#x81F4;&amp;#x3002;&lt;br&gt;&amp;#x5982;&amp;#x679C;&amp;#x628A;&amp;#x65E5;&amp;#x5FD7;&amp;#x8BB0;&amp;#x5F55;&amp;#x5230;&amp;#x8BE5;&amp;#x9635;&amp;#x5217;&amp;#x4E2D;&amp;#xFF0C;&amp;#x4F1A;&amp;#x964D;&amp;#x4F4E;&amp;#x9635;&amp;#x5217;&amp;#x7684;&amp;#x6027;&amp;#x80FD;&amp;#xFF0C;&amp;#x9AD8;&amp;#x7AEF;&amp;#x9635;&amp;#x5217;&amp;#x4E00;&amp;#x822C;&amp;#x662F;&amp;#x91C7;&amp;#x7528;&amp;#x4E00;&amp;#x4E2A;NVRAM&amp;#x6765;&amp;#x8BB0;&amp;#x5F55;&amp;#x65E5;&amp;#x5FD7;&amp;#xFF0C;&lt;br&gt;&amp;#x53E6;&amp;#x4E00;&amp;#x79CD;&amp;#x65B9;&amp;#x5F0F;&amp;#x662F;&amp;#x628A;&amp;#x65E5;&amp;#x5FD7;&amp;#x8BB0;&amp;#x5F55;&amp;#x5230;&amp;#x9635;&amp;#x5217;&amp;#x7684;bitmap&amp;#x4E2D;&amp;#xFF0C;&amp;#x4E0D;&amp;#x8FC7;&amp;#x8FD9;&amp;#x6837;&amp;#x90FD;&amp;#x4F1A;&amp;#x5F71;&amp;#x54CD;&amp;#x6027;&amp;#x80FD;&amp;#x3002;&amp;#xFF08;&amp;#x5C31;&amp;#x662F;mdraid&amp;#x7684;bitmap&amp;#x673A;&amp;#x5236;&amp;#xFF0C;&lt;a href=&quot;http://www.linuxsymposium.org/archives/OLS/Reprints-2003/LinuxSymposium2003.pdf#page=109&amp;#xFF09;&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.linuxsymposium.org/archives/OLS/Reprints-2003/LinuxSymposium2003.pdf#page=109&amp;#xFF09;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x8FD9;&amp;#x7BC7;&amp;#x6587;&amp;#x7AE0;&amp;#x4E3B;&amp;#x8981;&amp;#x8BB2;&amp;#x7684;&amp;#x5C31;&amp;#x662F;&amp;#x5229;&amp;#x7528;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x6062;&amp;#x590D;&amp;#x673A;&amp;#x5236;&amp;#xFF0C;&amp;#x6765;&amp;#x89E3;&amp;#x51B3;&amp;#x8F6F;raid&amp;#x5D29;&amp;#x6E83;&amp;#x65F6;&amp;#x5168;&amp;#x91CF;&amp;#x540C;&amp;#x6B65;&amp;#x7684;&amp;#x95EE;&amp;#x9898;&amp;#x3002;&lt;br&gt;&amp;#x8FD9;&amp;#x91CC;&amp;#x662F;&amp;#x57FA;&amp;#x4E8E;&amp;#x65E5;&amp;#x5FD7;&amp;#x7684;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#xFF08;&amp;#x5982;ext3&amp;#x4E4B;&amp;#x7C7B;&amp;#x7684;&amp;#xFF09;&amp;#xFF0C;&amp;#x5728;&amp;#x5199;&amp;#x6570;&amp;#x636E;&amp;#x5230;&amp;#x78C1;&amp;#x76D8;&amp;#x4E4B;&amp;#x524D;&amp;#xFF0C;&amp;#x5148;&amp;#x8BB0;&amp;#x5F55;&amp;#x65E5;&amp;#x5FD7;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x518D;&amp;#x5199;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x5199;&amp;#x6210;&amp;#x529F;&amp;#x540E;&amp;#x518D;&amp;#x8BB0;&amp;#x5F55;commit&amp;#x65E5;&amp;#x5FD7;&amp;#x3002;&lt;br&gt;&amp;#x8FD9;&amp;#x6837;&amp;#x5728;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x5D29;&amp;#x6E83;&amp;#x65F6;&amp;#x53EF;&amp;#x4EE5;&amp;#x6839;&amp;#x636E;&amp;#x65E5;&amp;#x5FD7;&amp;#x6765;&amp;#x8FDB;&amp;#x884C;&amp;#x6062;&amp;#x590D;&amp;#xFF0C;&amp;#x65E5;&amp;#x5FD7;&amp;#x4E2D;&amp;#x5DF2;&amp;#x7ECF;commit&amp;#x6210;&amp;#x529F;&amp;#x7684;&amp;#x662F;&amp;#x4E0D;&amp;#x9700;&amp;#x8981;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x3002;&lt;br&gt;&amp;#x4E3A;&amp;#x4E86;&amp;#x5229;&amp;#x7528;&amp;#x8FD9;&amp;#x4E2A;&amp;#x673A;&amp;#x5236;&amp;#xFF0C;&amp;#x4E3A;&amp;#x8F6F;raid&amp;#x5F15;&amp;#x5165;veryfy read&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x6062;&amp;#x590D;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x5411;&amp;#x8F6F;raid&amp;#x53D1;veryfy read&amp;#x8BF7;&amp;#x6C42;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x5728;buffer head&amp;#x4E2D;&amp;#x589E;&amp;#x52A0;&amp;#x4E00;&amp;#x4E2A;raid synchronize&amp;#x7684;&amp;#x6807;&amp;#x8BB0;&amp;#xFF0C;&amp;#x8F6F;raid&amp;#x5728;&amp;#x6536;&amp;#x5230;&amp;#x5E26;&amp;#x6709;&amp;#x8FD9;&amp;#x4E2A;&amp;#x6807;&amp;#x8BB0;&amp;#x7684;&amp;#x8BF7;&amp;#x6C42;&amp;#x65F6;&amp;#xFF0C;&amp;#x624D;&amp;#x8FDB;&amp;#x884C;&amp;#x68C0;&amp;#x67E5;&amp;#xFF08;raid1&amp;#x662F;&amp;#x68C0;&amp;#x67E5;&amp;#x6E90;&amp;#x76D8;&amp;#x548C;&amp;#x955C;&amp;#x50CF;&amp;#x76D8;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x662F;&amp;#x5426;&amp;#x4E00;&amp;#x81F4;&amp;#xFF0C;raid5&amp;#x662F;&amp;#x68C0;&amp;#x67E5;&amp;#x6821;&amp;#x9A8C;&amp;#x5757;&amp;#x548C;&amp;#x7531;&amp;#x6570;&amp;#x636E;&amp;#x5757;&amp;#x8BA1;&amp;#x7B97;&amp;#x7684;&amp;#x6821;&amp;#x9A8C;&amp;#x503C;&amp;#x662F;&amp;#x5426;&amp;#x4E00;&amp;#x81F4;&amp;#xFF09;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x4E0D;&amp;#x4E00;&amp;#x81F4;&amp;#xFF0C;&amp;#x5C31;&amp;#x8FDB;&amp;#x884C;&amp;#x540C;&amp;#x6B65;&amp;#xFF08;raid1&amp;#x8BA9;&amp;#x5404;&amp;#x4E2A;&amp;#x955C;&amp;#x50CF;&amp;#x76D8;&amp;#x7684;&amp;#x5BF9;&amp;#x5E94;&amp;#x6570;&amp;#x636E;&amp;#x4E00;&amp;#x6837;&amp;#xFF0C;raid5&amp;#x662F;&amp;#x5C06;&amp;#x65B0;&amp;#x8BA1;&amp;#x7B97;&amp;#x7684;&amp;#x6821;&amp;#x9A8C;&amp;#x503C;&amp;#x5199;&amp;#x5165;&amp;#x6821;&amp;#x9A8C;&amp;#x5757;&amp;#x4E2D;&amp;#xFF09;&amp;#x3002;&amp;#x8FD9;&amp;#x6837;&amp;#x5C31;&amp;#x907F;&amp;#x514D;&amp;#x4E86;&amp;#x8F6F;raid&amp;#x5D29;&amp;#x6E83;&amp;#x65F6;&amp;#xFF0C;&amp;#x5168;&amp;#x76D8;&amp;#x626B;&amp;#x63CF;&amp;#x8FDB;&amp;#x884C;&amp;#x6BD4;&amp;#x5BF9;&amp;#x4E86;&amp;#x3002;&lt;br&gt;&amp;#x5C40;&amp;#x9650;&amp;#x5728;&amp;#x4E8E;&amp;#xFF1A;&lt;br&gt;1&amp;#xFF09;&amp;#x5FC5;&amp;#x987B;&amp;#x662F;&amp;#x57FA;&amp;#x4E8E;&amp;#x65E5;&amp;#x5FD7;&amp;#x7684;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#xFF0C;&amp;#x800C;&amp;#x4E14;&amp;#x5FC5;&amp;#x987B;&amp;#x662F;&amp;#x8F6F;raid&amp;#x4E0A;&amp;#x5EFA;&amp;#x7684;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x8F6F;raid&amp;#x4E0A;&amp;#x6CA1;&amp;#x6709;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#xFF0C;&amp;#x800C;&amp;#x76F4;&amp;#x63A5;&amp;#x88F8;&amp;#x76D8;&amp;#x4F7F;&amp;#x7528;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x5C31;&amp;#x4E0D;&amp;#x9002;&amp;#x7528;&amp;#x3002;&lt;br&gt;2&amp;#xFF09;&amp;#x5BF9;&amp;#x4E8E;&amp;#x8DE8;&amp;#x7F51;&amp;#x7EDC;&amp;#x7684;&amp;#x8F6F;raid&amp;#xFF08;&amp;#x4F7F;&amp;#x7528;iscsi&amp;#x6216;nbd&amp;#x7B49;&amp;#x65B9;&amp;#x5F0F;&amp;#xFF09;&amp;#xFF0C;&amp;#x6587;&amp;#x7AE0;&amp;#x4E2D;&amp;#x7684;&amp;#x5728;&amp;#x8BF7;&amp;#x6C42;&amp;#x4E0A;&amp;#x52A0;&amp;#x4E86;&amp;#x4E00;&amp;#x4E2A;synchronize&amp;#x6807;&amp;#x8BB0;&amp;#x8FD8;&amp;#x4E0D;&amp;#x4E00;&amp;#x5B9A;&amp;#x53EF;&amp;#x884C;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x9700;&amp;#x8981;iscsi&amp;#x534F;&amp;#x8BAE;&amp;#x6216;nbd&amp;#x91CC;&amp;#x6709;&amp;#x7A7A;&amp;#x95F2;&amp;#x5B57;&amp;#x6BB5;&amp;#x7528;&amp;#x4E8E;&amp;#x5B58;&amp;#x653E;synchronize&amp;#x6807;&amp;#x8BB0;&amp;#x624D;&amp;#x884C;&amp;#x3002;&lt;br&gt;&amp;#x503C;&amp;#x5F97;&amp;#x501F;&amp;#x9274;&amp;#x7684;&amp;#x5730;&amp;#x65B9;&amp;#xFF1A;&lt;br&gt;1&amp;#xFF09;&amp;#x80FD;&amp;#x591F;&amp;#x6839;&amp;#x636E;&amp;#x8BF7;&amp;#x6C42;&amp;#x7684;&amp;#x7C7B;&amp;#x578B;&amp;#x6765;&amp;#x5224;&amp;#x65AD;&amp;#x662F;&amp;#x5426;&amp;#x8FDB;&amp;#x884C;&amp;#x8F6F;raid&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x6062;&amp;#x590D;&amp;#xFF0C;&amp;#x800C;&amp;#x4E0D;&amp;#x662F;&amp;#x8FDB;&amp;#x884C;&amp;#x5168;&amp;#x76D8;&amp;#x626B;&amp;#x63CF;&amp;#xFF1B;&lt;br&gt;2&amp;#xFF09;&amp;#x5BF9;&amp;#x4E8E;&amp;#x4E91;&amp;#x786C;&amp;#x76D8;&amp;#x6765;&amp;#x8BF4;&amp;#xFF0C;&amp;#x76EE;&amp;#x524D;&amp;#x91C7;&amp;#x7528;&amp;#x7684;bitmap&amp;#x673A;&amp;#x5236;&amp;#x5176;&amp;#x5B9E;&amp;#x5C31;&amp;#x662F;&amp;#x628A;&amp;#x65E5;&amp;#x5FD7;&amp;#x8BB0;&amp;#x5F55;&amp;#x5230;bitmap&amp;#x4E2D;&amp;#xFF08;&amp;#x6587;&amp;#x7AE0;&amp;#x4E2D;&amp;#x4E5F;&amp;#x6709;&amp;#x63D0;&amp;#x5230;&amp;#xFF09;&amp;#xFF0C;&amp;#x4E0D;&amp;#x8FC7;&amp;#x5728;&amp;#x6574;&amp;#x4E2A;&amp;#x673A;&amp;#x623F;&amp;#x65AD;&amp;#x7535;&amp;#x91CD;&amp;#x542F;&amp;#x8FD9;&amp;#x79CD;&amp;#x6781;&amp;#x7AEF;&amp;#x60C5;&amp;#x51B5;&amp;#xFF0C;bitmap&amp;#x4E5F;&amp;#x4E22;&amp;#x5931;&amp;#x4E0D;&amp;#x53EF;&amp;#x7528;&amp;#x4E86;&amp;#xFF0C;&amp;#x76EE;&amp;#x524D;&amp;#x5C31;&amp;#x53EA;&amp;#x80FD;&amp;#x5168;&amp;#x76D8;&amp;#x626B;&amp;#x63CF;&amp;#x8FDB;&amp;#x884C;&amp;#x540C;&amp;#x6B65;&amp;#xFF08;&amp;#x8FD9;&amp;#x91CC;&amp;#x7684;&amp;#x5168;&amp;#x76D8;&amp;#x626B;&amp;#x63CF;&amp;#x8FDB;&amp;#x884C;&amp;#x540C;&amp;#x6B65;&amp;#x662F;&amp;#x76F4;&amp;#x63A5;&amp;#x5C06;&amp;#x4E00;&amp;#x5757;&amp;#x76D8;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x5B8C;&amp;#x5168;&amp;#x62F7;&amp;#x8D1D;&amp;#x5230;&amp;#x53E6;&amp;#x4E00;&amp;#x5757;&amp;#x76D8;&amp;#xFF0C;&amp;#x8FD8;&amp;#x662F;&amp;#x9700;&amp;#x8981;&amp;#x6839;&amp;#x636E;chunk&amp;#x5757;&amp;#x5927;&amp;#x5C0F;&amp;#x8FDB;&amp;#x884C;&amp;#x6BD4;&amp;#x5BF9;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x662F;&amp;#x4E00;&amp;#x6837;&amp;#x7684;&amp;#xFF0C;&amp;#x5C31;&amp;#x4E0D;&amp;#x8FDB;&amp;#x884C;&amp;#x6570;&amp;#x636E;&amp;#x62F7;&amp;#x8D1D;&amp;#xFF0C;&amp;#x4E0D;&amp;#x8FC7;&amp;#x4E5F;&amp;#x5FC5;&amp;#x987B;&amp;#x5148;&amp;#x4ECE;&amp;#x4E24;&amp;#x4E2A;&amp;#x955C;&amp;#x50CF;&amp;#x4E2D;&amp;#x90FD;&amp;#x8BFB;&amp;#x51FA;&amp;#x6570;&amp;#x636E;&amp;#x6765;&amp;#xFF0C;&amp;#x76EE;&amp;#x524D;&amp;#x8BA4;&amp;#x4E3A;&amp;#x662F;&amp;#x7B2C;&amp;#x4E8C;&amp;#x79CD;&amp;#xFF09;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x6211;&amp;#x4EEC;&amp;#x4F7F;&amp;#x7528;&amp;#x7684;extern bitmap&amp;#xFF0C;&amp;#x8FD9;&amp;#x79CD;&amp;#x6781;&amp;#x7AEF;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;&amp;#xFF0C;bitmap&amp;#x4E0D;&amp;#x53EF;&amp;#x7528;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x662F;intern bitmap&amp;#xFF0C;&amp;#x90A3;&amp;#x5BF9;&amp;#x4E8E;&amp;#x8FD9;&amp;#x79CD;&amp;#x60C5;&amp;#x51B5;&amp;#x4E5F;&amp;#x662F;&amp;#x53EF;&amp;#x4EE5;&amp;#x4E0D;&amp;#x7528;&amp;#x5168;&amp;#x91CF;&amp;#x540C;&amp;#x6B65;&amp;#x7684;&amp;#xFF0C;&amp;#x53EA;&amp;#x4E0D;&amp;#x8FC7;intern bitmap&amp;#x662F;&amp;#x5B58;&amp;#x653E;&amp;#x5728;&amp;#x9635;&amp;#x5217;&amp;#x672C;&amp;#x8EAB;&amp;#xFF0C;&amp;#x5BF9;&amp;#x4E8E;&amp;#x6B63;&amp;#x5E38;&amp;#x8BF7;&amp;#x6C42;&amp;#x6765;&amp;#x8BF4;&amp;#x5F00;&amp;#x9500;&amp;#x8F83;&amp;#x5927;&amp;#x3002;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;#x8BE5;&amp;#x6587;&amp;#x7AE0;&amp;#x4E3B;&amp;#x8981;&amp;#x8BB2;&amp;#x628A;&amp;#x65E5;&amp;#x5FD7;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#xFF08;&amp;#x5982;ext3&amp;#xFF09;&amp;#x4E
    
    </summary>
    
      <category term="paper" scheme="http://yoursite.com/categories/paper/"/>
    
    
      <category term="paper" scheme="http://yoursite.com/tags/paper/"/>
    
  </entry>
  
  <entry>
    <title>文件系统磁盘布局与I/O映射</title>
    <link href="http://yoursite.com/2015/08/06/fs-io-map/"/>
    <id>http://yoursite.com/2015/08/06/fs-io-map/</id>
    <published>2015-08-06T14:09:16.000Z</published>
    <updated>2016-05-13T09:04:09.859Z</updated>
    
    <content type="html">&lt;p&gt;&amp;#x672C;&amp;#x6587;&amp;#x4E3B;&amp;#x8981;&amp;#x5BF9;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x78C1;&amp;#x76D8;&amp;#x5E03;&amp;#x5C40;&amp;#x8FDB;&amp;#x884C;&amp;#x6982;&amp;#x8981;&amp;#x7684;&amp;#x68B3;&amp;#x7406;&amp;#xFF0C;&amp;#x5E76;&amp;#x5728;&amp;#x6B64;&amp;#x57FA;&amp;#x7840;&amp;#x4E0A;&amp;#x5206;&amp;#x6790;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;I/O&amp;#x5230;&amp;#x5757;I/O&amp;#x7684;&amp;#x6620;&amp;#x5C04;&amp;#x673A;&amp;#x5236;&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;1-&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x78C1;&amp;#x76D8;&amp;#x5E03;&amp;#x5C40;&quot;&gt;&lt;a href=&quot;#1-&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x78C1;&amp;#x76D8;&amp;#x5E03;&amp;#x5C40;&quot; class=&quot;headerlink&quot; title=&quot;1.&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x78C1;&amp;#x76D8;&amp;#x5E03;&amp;#x5C40;&quot;&gt;&lt;/a&gt;1.&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x78C1;&amp;#x76D8;&amp;#x5E03;&amp;#x5C40;&lt;/h1&gt;&lt;p&gt;&amp;#x9996;&amp;#x5148;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x5C42;&amp;#x9762;&amp;#x6765;&amp;#x9610;&amp;#x8FF0;&amp;#x6587;&amp;#x4EF6;&amp;#x4E0E;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x7684;&amp;#x5173;&amp;#x7CFB;&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;1-1&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x4E0E;inode&quot;&gt;&lt;a href=&quot;#1-1&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x4E0E;inode&quot; class=&quot;headerlink&quot; title=&quot;1.1&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x4E0E;inode&quot;&gt;&lt;/a&gt;1.1&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x4E0E;inode&lt;/h2&gt;&lt;p&gt;&amp;#x5E94;&amp;#x7528;&amp;#x7A0B;&amp;#x5E8F;&amp;#x5728;&amp;#x8BBF;&amp;#x95EE;&amp;#x6587;&amp;#x4EF6;&amp;#x65F6;&amp;#x90FD;&amp;#x4F1A;&amp;#x5148;&amp;#x6253;&amp;#x5F00;&amp;#x6587;&amp;#x4EF6;&amp;#xFF0C;&amp;#x5728;&amp;#x5185;&amp;#x6838;&amp;#x4E2D;&amp;#xFF0C;&amp;#x5BF9;&amp;#x5E94;&amp;#x6BCF;&amp;#x4E2A;&amp;#x8FDB;&amp;#x7A0B;&amp;#xFF0C;&amp;#x90FD;&amp;#x4F1A;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x8868;&amp;#x8868;&amp;#x793A;&amp;#x8FD9;&amp;#x4E2A;&amp;#x8FDB;&amp;#x7A0B;&amp;#x6253;&amp;#x5F00;&amp;#x7684;&amp;#x6587;&amp;#x4EF6;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x7528;&amp;#x6237;&amp;#x7A0B;&amp;#x5E8F;&amp;#x4E0D;&amp;#x80FD;&amp;#x76F4;&amp;#x63A5;&amp;#x8BBF;&amp;#x95EE;&amp;#x5185;&amp;#x6838;&amp;#x4E2D;&amp;#x7684;&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x8868;,&amp;#x800C;&amp;#x53EA;&amp;#x80FD;&amp;#x4F7F;&amp;#x7528;&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x8868;&amp;#x7684;&amp;#x7D22;&amp;#x5F15;&amp;#xFF08;&amp;#x4E00;&amp;#x4E2A;&amp;#x6574;&amp;#x6570;&amp;#xFF09;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E9B;&amp;#x7D22;&amp;#x5F15;&amp;#x5C31;&amp;#x88AB;&amp;#x79F0;&amp;#x4E3A;&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x3002;&amp;#x5F53;&amp;#x8C03;&amp;#x7528;open &amp;#x6253;&amp;#x5F00;&amp;#x4E00;&amp;#x4E2A;&amp;#x6587;&amp;#x4EF6;&amp;#x6216;&amp;#x521B;&amp;#x5EFA;&amp;#x4E00;&amp;#x4E2A;&amp;#x65B0;&amp;#x6587;&amp;#x4EF6;&amp;#x65F6;,&amp;#x5185;&amp;#x6838;&amp;#x5206;&amp;#x914D;&amp;#x4E00;&amp;#x4E2A;&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x5E76;&amp;#x8FD4;&amp;#x56DE;&amp;#x7ED9;&amp;#x7528;&amp;#x6237;&amp;#x7A0B;&amp;#x5E8F;,&amp;#x8BE5;&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x8868;&amp;#x9879;&amp;#x4E2D;&amp;#x7684;&amp;#x6307;&amp;#x9488;&amp;#x6307;&amp;#x5411;&amp;#x65B0;&amp;#x6253;&amp;#x5F00;&amp;#x7684;&amp;#x6587;&amp;#x4EF6;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x8868;&amp;#x4E2D;&amp;#x6BCF;&amp;#x4E00;&amp;#x9879;&amp;#x90FD;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x6307;&amp;#x9488;&amp;#xFF0C;&amp;#x6307;&amp;#x5411;&amp;#x4E00;&amp;#x4E2A;&amp;#x7528;&amp;#x4E8E;&amp;#x63CF;&amp;#x8FF0;&amp;#x6253;&amp;#x5F00;&amp;#x7684;&amp;#x6587;&amp;#x4EF6;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x5757;&amp;#x2013;file&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;file&amp;#x5BF9;&amp;#x8C61;&amp;#x4E2D;&amp;#x63CF;&amp;#x8FF0;&amp;#x4E86;&amp;#x6587;&amp;#x4EF6;&amp;#x7684;&amp;#x6253;&amp;#x5F00;&amp;#x6A21;&amp;#x5F0F;&amp;#xFF0C;&amp;#x8BFB;&amp;#x5199;&amp;#x4F4D;&amp;#x7F6E;&amp;#x7B49;&amp;#x91CD;&amp;#x8981;&amp;#x4FE1;&amp;#x606F;&amp;#xFF0C;&amp;#x5F53;&amp;#x8FDB;&amp;#x7A0B;&amp;#x6253;&amp;#x5F00;&amp;#x4E00;&amp;#x4E2A;&amp;#x6587;&amp;#x4EF6;&amp;#x65F6;&amp;#xFF0C;&amp;#x5185;&amp;#x6838;&amp;#x5C31;&amp;#x4F1A;&amp;#x521B;&amp;#x5EFA;&amp;#x4E00;&amp;#x4E2A;&amp;#x65B0;&amp;#x7684;file&amp;#x5BF9;&amp;#x8C61;&amp;#x3002;&amp;#x9700;&amp;#x8981;&amp;#x6CE8;&amp;#x610F;&amp;#x7684;&amp;#x662F;&amp;#xFF0C;file&amp;#x5BF9;&amp;#x8C61;&amp;#x4E0D;&amp;#x662F;&amp;#x4E13;&amp;#x5C5E;&amp;#x4E8E;&amp;#x67D0;&amp;#x4E2A;&amp;#x8FDB;&amp;#x7A0B;&amp;#x7684;&amp;#xFF0C;&amp;#x4E0D;&amp;#x540C;&amp;#x8FDB;&amp;#x7A0B;&amp;#x7684;&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x8868;&amp;#x4E2D;&amp;#x7684;&amp;#x6307;&amp;#x9488;&amp;#x53EF;&amp;#x4EE5;&amp;#x6307;&amp;#x5411;&amp;#x76F8;&amp;#x540C;&amp;#x7684;file&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;&amp;#x5171;&amp;#x4EAB;&amp;#x8FD9;&amp;#x4E2A;&amp;#x6253;&amp;#x5F00;&amp;#x7684;&amp;#x6587;&amp;#x4EF6;&amp;#x3002;file&amp;#x5BF9;&amp;#x8C61;&amp;#x6709;&amp;#x5F15;&amp;#x7528;&amp;#x8BA1;&amp;#x6570;&amp;#xFF0C;&amp;#x8BB0;&amp;#x5F55;&amp;#x4E86;&amp;#x5F15;&amp;#x7528;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x4E2A;&amp;#x6570;&amp;#xFF0C;&amp;#x53EA;&amp;#x6709;&amp;#x5F53;&amp;#x5F15;&amp;#x7528;&amp;#x8BA1;&amp;#x6570;&amp;#x4E3A;0&amp;#x65F6;&amp;#xFF0C;&amp;#x5185;&amp;#x6838;&amp;#x624D;&amp;#x9500;&amp;#x6BC1;file&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x56E0;&amp;#x6B64;&amp;#x67D0;&amp;#x4E2A;&amp;#x8FDB;&amp;#x7A0B;&amp;#x5173;&amp;#x95ED;&amp;#x6587;&amp;#x4EF6;&amp;#xFF0C;&amp;#x4E0D;&amp;#x5F71;&amp;#x54CD;&amp;#x4E0E;&amp;#x4E4B;&amp;#x5171;&amp;#x4EAB;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;file&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x8FDB;&amp;#x7A0B;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;file&amp;#x5BF9;&amp;#x8C61;&amp;#x4E2D;&amp;#x5305;&amp;#x542B;&amp;#x4E00;&amp;#x4E2A;&amp;#x6307;&amp;#x9488;&amp;#xFF0C;&amp;#x6307;&amp;#x5411;dentry&amp;#x5BF9;&amp;#x8C61;&amp;#x3002;dentry&amp;#x5BF9;&amp;#x8C61;&amp;#x4EE3;&amp;#x8868;&amp;#x4E00;&amp;#x4E2A;&amp;#x72EC;&amp;#x7ACB;&amp;#x7684;&amp;#x6587;&amp;#x4EF6;&amp;#x8DEF;&amp;#x5F84;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x4E00;&amp;#x4E2A;&amp;#x6587;&amp;#x4EF6;&amp;#x8DEF;&amp;#x5F84;&amp;#x88AB;&amp;#x6253;&amp;#x5F00;&amp;#x591A;&amp;#x6B21;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x4F1A;&amp;#x5EFA;&amp;#x7ACB;&amp;#x591A;&amp;#x4E2A;file&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x4F46;&amp;#x5B83;&amp;#x4EEC;&amp;#x90FD;&amp;#x6307;&amp;#x5411;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;dentry&amp;#x5BF9;&amp;#x8C61;&amp;#x3002;inode&amp;#x5BF9;&amp;#x8C61;&amp;#x4EE3;&amp;#x8868;&amp;#x4E00;&amp;#x4E2A;&amp;#x72EC;&amp;#x7ACB;&amp;#x6587;&amp;#x4EF6;&amp;#xFF0C;inode &amp;#x5BF9;&amp;#x8C61;&amp;#x5305;&amp;#x542B;&amp;#x4E86;&amp;#x6700;&amp;#x7EC8;&amp;#x5BF9;&amp;#x6587;&amp;#x4EF6;&amp;#x8FDB;&amp;#x884C;&amp;#x64CD;&amp;#x4F5C;&amp;#x6240;&amp;#x9700;&amp;#x7684;&amp;#x6240;&amp;#x6709;&amp;#x4FE1;&amp;#x606F;&amp;#xFF0C;&amp;#x5982;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7C7B;&amp;#x578B;&amp;#x3001;&amp;#x6587;&amp;#x4EF6;&amp;#x7684;&amp;#x64CD;&amp;#x4F5C;&amp;#x65B9;&amp;#x6CD5;&amp;#x3001;&amp;#x6587;&amp;#x4EF6;&amp;#x7684;&amp;#x6743;&amp;#x9650;&amp;#x3001;&amp;#x8BBF;&amp;#x95EE;&amp;#x65E5;&amp;#x671F;&amp;#x7B49;&amp;#x3002;&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;&lt;img src=&quot;/2015/08/06/fs-io-map/inode.png&quot; alt=&quot;inode&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;1-2&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x78C1;&amp;#x76D8;&amp;#x5E03;&amp;#x5C40;&quot;&gt;&lt;a href=&quot;#1-2&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x78C1;&amp;#x76D8;&amp;#x5E03;&amp;#x5C40;&quot; class=&quot;headerlink&quot; title=&quot;1.2&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x78C1;&amp;#x76D8;&amp;#x5E03;&amp;#x5C40;&quot;&gt;&lt;/a&gt;1.2&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x78C1;&amp;#x76D8;&amp;#x5E03;&amp;#x5C40;&lt;/h2&gt;&lt;p&gt;&amp;#x5728;&amp;#x4E86;&amp;#x89E3;&amp;#x4E86;&amp;#x6587;&amp;#x4EF6;&amp;#x4E0E;inode&amp;#x7684;&amp;#x5BF9;&amp;#x5E94;&amp;#x5173;&amp;#x7CFB;&amp;#x540E;&amp;#xFF0C;&amp;#x4E3A;&amp;#x4E86;&amp;#x9610;&amp;#x8FF0;&amp;#x6587;&amp;#x4EF6;&amp;#x4E0E;&amp;#x5177;&amp;#x4F53;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x5757;&amp;#x7684;&amp;#x6620;&amp;#x5C04;&amp;#x5173;&amp;#x7CFB;&amp;#xFF0C;&amp;#x5FC5;&amp;#x987B;&amp;#x5148;&amp;#x7406;&amp;#x89E3;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x78C1;&amp;#x76D8;&amp;#x5E03;&amp;#x5C40;&amp;#x3002;&amp;#x4E0B;&amp;#x56FE;&amp;#x662F;ext2/ext3&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x78C1;&amp;#x76D8;&amp;#x5E03;&amp;#x5C40;&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2015/08/06/fs-io-map/fs2disk.png&quot; alt=&quot;fs2disk&quot;&gt;&lt;br&gt;ext3&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x5C06;&amp;#x5176;&amp;#x6240;&amp;#x7BA1;&amp;#x7406;&amp;#x7684;&amp;#x78C1;&amp;#x76D8;&amp;#x6216;&amp;#x8005;&amp;#x5206;&amp;#x533A;(&amp;#x5F15;&amp;#x5BFC;&amp;#x5757;&amp;#x9664;&amp;#x5916;)&amp;#x4E2D;&amp;#x7684;&amp;#x5757;&amp;#x5212;&amp;#x5206;&amp;#x5230;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x5757;&amp;#x7EC4;&amp;#x4E2D;&amp;#x3002;&amp;#x6BCF;&amp;#x4E2A;&amp;#x5757;&amp;#x7EC4;&amp;#x5927;&amp;#x5C0F;&amp;#x76F8;&amp;#x540C;&amp;#xFF0C;&amp;#x5F53;&amp;#x7136;&amp;#x6700;&amp;#x540E;&amp;#x4E00;&amp;#x4E2A;&amp;#x5757;&amp;#x7EC4;&amp;#x6240;&amp;#x7BA1;&amp;#x7406;&amp;#x7684;&amp;#x5757;&amp;#x53EF;&amp;#x80FD;&amp;#x4F1A;&amp;#x5C11;&amp;#x4E00;&amp;#x4E9B;&amp;#xFF0C;&amp;#x5176;&amp;#x5927;&amp;#x5C0F;&amp;#x5728;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x521B;&amp;#x5EFA;&amp;#x65F6;&amp;#x51B3;&amp;#x5B9A;&amp;#xFF0C;&amp;#x4E3B;&amp;#x8981;&amp;#x53D6;&amp;#x51B3;&amp;#x4E8E;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x5757;&amp;#x5927;&amp;#x5C0F;&amp;#x3002;&amp;#x6BCF;&amp;#x4E2A;&amp;#x5757;&amp;#x7EC4;&amp;#x5305;&amp;#x542B;&amp;#x4E00;&amp;#x4E2A;&amp;#x5757;&amp;#x4F4D;&amp;#x56FE;&amp;#x5757;&amp;#xFF0C;&amp;#x4E00;&amp;#x4E2A;inode&amp;#x4F4D;&amp;#x56FE;&amp;#x5757;&amp;#xFF0C;&amp;#x4E00;&amp;#x4E2A;&amp;#x6216;&amp;#x591A;&amp;#x4E2A;&amp;#x5757;&amp;#x7528;&amp;#x4E8E;&amp;#x63CF;&amp;#x8FF0; inode &amp;#x8868;&amp;#x548C;&amp;#x7528;&amp;#x4E8E;&amp;#x5B58;&amp;#x50A8;&amp;#x6587;&amp;#x4EF6;&amp;#x6570;&amp;#x636E;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x5757;&amp;#xFF0C;&amp;#x9664;&amp;#x6B64;&amp;#x4E4B;&amp;#x5916;&amp;#xFF0C;&amp;#x8FD8;&amp;#x6709;&amp;#x53EF;&amp;#x80FD;&amp;#x5305;&amp;#x542B;&amp;#x8D85;&amp;#x7EA7;&amp;#x5757;&amp;#x548C;&amp;#x6240;&amp;#x6709;&amp;#x5757;&amp;#x7EC4;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x8868;&amp;#x3002;&lt;br&gt;&amp;#x5757;&amp;#x4F4D;&amp;#x56FE;&amp;#x7528;&amp;#x4E8E;&amp;#x63CF;&amp;#x8FF0;&amp;#x8BE5;&amp;#x5757;&amp;#x7EC4;&amp;#x6240;&amp;#x7BA1;&amp;#x7406;&amp;#x7684;&amp;#x5757;&amp;#x7684;&amp;#x5206;&amp;#x914D;&amp;#x72B6;&amp;#x6001;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x67D0;&amp;#x4E2A;&amp;#x5757;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x4F4D;&amp;#x672A;&amp;#x7F6E;&amp;#x4F4D;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x4EE3;&amp;#x8868;&amp;#x8BE5;&amp;#x5757;&amp;#x672A;&amp;#x5206;&amp;#x914D;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x8FDB;&amp;#x884C;&amp;#x5206;&amp;#x914D;&amp;#x4F7F;&amp;#x7528;&amp;#x3002;inode&amp;#x4F4D;&amp;#x56FE;&amp;#x7528;&amp;#x4E8E;&amp;#x63CF;&amp;#x8FF0;&amp;#x8BE5;&amp;#x5757;&amp;#x7EC4;&amp;#x6240;&amp;#x7BA1;&amp;#x7406;&amp;#x7684;inode&amp;#x7684;&amp;#x5206;&amp;#x914D;&amp;#x72B6;&amp;#x6001;&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;inode&amp;#x5BF9;&amp;#x5E94;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x4E2D;&amp;#x552F;&amp;#x4E00;&amp;#x7684;&amp;#x4E00;&amp;#x4E2A;&amp;#x53F7;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;inode&amp;#x4F4D;&amp;#x56FE;&amp;#x4E2D;&amp;#x76F8;&amp;#x5E94;&amp;#x4F4D;&amp;#x7F6E;&amp;#x4F4D;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x4EE3;&amp;#x8868;&amp;#x8BE5;inode&amp;#x5DF2;&amp;#x7ECF;&amp;#x5206;&amp;#x914D;&amp;#x51FA;&amp;#x53BB;&amp;#xFF1B;&amp;#x5426;&amp;#x5219;&amp;#x53EF;&amp;#x4EE5;&amp;#x4F7F;&amp;#x7528;&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;1-3&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x903B;&amp;#x8F91;&amp;#x5757;&amp;#x6620;&amp;#x5C04;&quot;&gt;&lt;a href=&quot;#1-3&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x903B;&amp;#x8F91;&amp;#x5757;&amp;#x6620;&amp;#x5C04;&quot; class=&quot;headerlink&quot; title=&quot;1.3&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x903B;&amp;#x8F91;&amp;#x5757;&amp;#x6620;&amp;#x5C04;&quot;&gt;&lt;/a&gt;1.3&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x903B;&amp;#x8F91;&amp;#x5757;&amp;#x6620;&amp;#x5C04;&lt;/h2&gt;&lt;p&gt;&amp;#x4E0B;&amp;#x9762;&amp;#x5C31;&amp;#x6765;&amp;#x9610;&amp;#x8FF0;&amp;#x6587;&amp;#x4EF6;&amp;#x4E0E;&amp;#x7269;&amp;#x7406;&amp;#x5757;&amp;#x7684;&amp;#x6620;&amp;#x5C04;&amp;#x5173;&amp;#x7CFB;&amp;#x3002;&lt;br&gt;ext2/ext3&amp;#x91C7;&amp;#x7528;&amp;#x7684;&amp;#x662F;&amp;#x76F4;&amp;#x63A5;+&amp;#x95F4;&amp;#x63A5;&amp;#x65B9;&amp;#x5F0F;&amp;#x6765;&amp;#x5B58;&amp;#x50A8;&amp;#x8FD9;&amp;#x4E9B;&amp;#x5730;&amp;#x5740;&amp;#x6620;&amp;#x5C04;&amp;#xFF1A;&amp;#x5176;&amp;#x4E2D;0~11&amp;#x662F;&amp;#x5B58;&amp;#x50A8;&amp;#x7528;&amp;#x6237;&amp;#x6570;&amp;#x636E;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x5757;&amp;#x53F7;(&amp;#x76F4;&amp;#x63A5;&amp;#x5BFB;&amp;#x5740;)&amp;#xFF0C;12&amp;#x662F;&amp;#x5B58;&amp;#x50A8;&amp;#x4E00;&amp;#x7EA7;&amp;#x5730;&amp;#x5740;&amp;#x6620;&amp;#x5C04;&amp;#x8868;&amp;#x6570;&amp;#x636E;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x5757;&amp;#x5730;&amp;#x5740;(&amp;#x4E00;&amp;#x7EA7;&amp;#x95F4;&amp;#x63A5;&amp;#x5BFB;&amp;#x5740;)&amp;#xFF0C;&amp;#x5730;&amp;#x5740;&amp;#x6620;&amp;#x5C04;&amp;#x8868;&amp;#x4E2D;&amp;#x7684;&amp;#x6BCF;&amp;#x4E00;&amp;#x9879;&amp;#x90FD;&amp;#x662F;&amp;#x53E6;&amp;#x5916;&amp;#x4E00;&amp;#x4E2A;&amp;#x7269;&amp;#x7406;&amp;#x5757;&amp;#x53F7;&amp;#x3002;13&amp;#x5B58;&amp;#x50A8;&amp;#x4E8C;&amp;#x7EA7;&amp;#x5730;&amp;#x5740;&amp;#x6620;&amp;#x5C04;&amp;#x8868;&amp;#x5730;&amp;#x5740;&amp;#xFF0C;14&amp;#x5B58;&amp;#x50A8;&amp;#x4E09;&amp;#x7EA7;&amp;#x5730;&amp;#x5740;&amp;#x6620;&amp;#x5C04;&amp;#x8868;&amp;#x5730;&amp;#x5740;&amp;#x3002;&amp;#x8FD9;&amp;#x79CD;&amp;#x65B9;&amp;#x5F0F;&amp;#x5BF9;&amp;#x4E8E;&amp;#x5C0F;&amp;#x6587;&amp;#x4EF6;&amp;#x6BD4;&amp;#x8F83;&amp;#x5408;&amp;#x9002;&amp;#xFF0C;&amp;#x5BF9;&amp;#x4E8E;&amp;#x5927;&amp;#x6587;&amp;#x4EF6;&amp;#x6765;&amp;#x8BF4;&amp;#x8981;&amp;#x7ECF;&amp;#x8FC7;&amp;#x5F88;&amp;#x591A;&amp;#x6B21;&amp;#x95F4;&amp;#x63A5;&amp;#x5BFB;&amp;#x5740;&amp;#xFF0C;&amp;#x6548;&amp;#x7387;&amp;#x5F88;&amp;#x4F4E;&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2015/08/06/fs-io-map/ext3-map.png&quot; alt=&quot;ext3-map&quot;&gt;&lt;br&gt;&amp;#x800C;ext4&amp;#x5219;&amp;#x91C7;&amp;#x7528;&amp;#x7684;&amp;#x662F;extents&amp;#x7684;&amp;#x6620;&amp;#x5C04;&amp;#x65B9;&amp;#x5F0F;&amp;#xFF1A;[logicalStartBlock,physicalStartBlock, blockCount]&amp;#x3002;ext4&amp;#x4E2D;&amp;#x4E00;&amp;#x4E2A;inode&amp;#x7684;&amp;#x5927;&amp;#x5C0F;&amp;#x662F;256Bytes&amp;#xFF0C;&amp;#x56E0;&amp;#x6B64;&amp;#x4E00;&amp;#x4E2A;inode&amp;#x80FD;&amp;#x5BB9;&amp;#x7EB3;&amp;#x7684;extent&amp;#x6709;&amp;#x9650;&amp;#xFF0C;&amp;#x5F53;&amp;#x6587;&amp;#x4EF6;&amp;#x589E;&amp;#x5927;&amp;#x5230;&amp;#x4E00;&amp;#x5B9A;&amp;#x7A0B;&amp;#x5EA6;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;extent&amp;#x65E0;&amp;#x6CD5;&amp;#x4EE5;&amp;#x6570;&amp;#x7EC4;&amp;#x5F62;&amp;#x5F0F;&amp;#x5B58;&amp;#x653E;&amp;#xFF0C;&amp;#x5C31;&amp;#x4F1A;&amp;#x4EE5;B+tree&amp;#x7684;&amp;#x5F62;&amp;#x5F0F;&amp;#x5B58;&amp;#x653E;&amp;#x3002;&amp;#x76F8;&amp;#x6BD4;&amp;#x4E8E;ext3&amp;#x7684;&amp;#x95F4;&amp;#x63A5;&amp;#x6620;&amp;#x5C04;&amp;#x65B9;&amp;#x5F0F;&amp;#xFF0C;extents&amp;#x7684;&amp;#x65B9;&amp;#x5F0F;&amp;#x589E;&amp;#x52A0;&amp;#x4E86;&amp;#x5927;&amp;#x6587;&amp;#x4EF6;&amp;#x7684;&amp;#x6548;&amp;#x7387;&amp;#x5E76;&amp;#x51CF;&amp;#x5C11;&amp;#x4E86;&amp;#x5206;&amp;#x88C2;&amp;#x6587;&amp;#x4EF6;&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2015/08/06/fs-io-map/ext4-map.png&quot; alt=&quot;ext4-map&quot;&gt;&lt;br&gt;&amp;#x901A;&amp;#x8FC7;&amp;#x4E0A;&amp;#x9762;&amp;#x7684;&amp;#x9610;&amp;#x8FF0;&amp;#xFF0C;&amp;#x6211;&amp;#x4EEC;&amp;#x77E5;&amp;#x9053;&amp;#x4E86;&amp;#x4E00;&amp;#x4E2A;&amp;#x6587;&amp;#x4EF6;&amp;#x548C;&amp;#x5177;&amp;#x4F53;&amp;#x7269;&amp;#x7406;&amp;#x5757;&amp;#x7684;&amp;#x5BF9;&amp;#x5E94;&amp;#x5173;&amp;#x7CFB;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x95EE;&amp;#x9898;&amp;#x6765;&amp;#x4E86;&amp;#xFF1A;&amp;#x7528;&amp;#x6237;&amp;#x4EE5;4KB&amp;#x5927;&amp;#x5C0F;&amp;#x5BF9;&amp;#x6587;&amp;#x4EF6;&amp;#x5199;&amp;#x4E00;&amp;#x4E2A;I/O&amp;#xFF0C;&amp;#x5BF9;&amp;#x4E8E;&amp;#x78C1;&amp;#x76D8;&amp;#x6765;&amp;#x8BF4;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;I/O&amp;#x5417;&amp;#xFF1F;&amp;#x5982;&amp;#x679C;&amp;#x91C7;&amp;#x7528;direct&amp;#x65B9;&amp;#x5F0F;&amp;#x5462;&amp;#xFF1F;&amp;#x5982;&amp;#x679C;&amp;#x662F;16KB&amp;#x5927;&amp;#x5C0F;&amp;#x7684;&amp;#x4E00;&amp;#x4E2A;&amp;#x7528;&amp;#x6237;I/O&amp;#x5462;&amp;#xFF1F;&amp;#x4E0B;&amp;#x9762;&amp;#x5C31;&amp;#x4ECE;&amp;#x6587;&amp;#x4EF6;I/O&amp;#x5230;&amp;#x5757;I/O&amp;#x7684;&amp;#x6620;&amp;#x5C04;&amp;#x673A;&amp;#x5236;&amp;#x6765;&amp;#x8FDB;&amp;#x884C;&amp;#x9610;&amp;#x8FF0;&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;2-&amp;#x6587;&amp;#x4EF6;I-O&amp;#x5230;&amp;#x5757;I-O&amp;#x7684;&amp;#x6620;&amp;#x5C04;&quot;&gt;&lt;a href=&quot;#2-&amp;#x6587;&amp;#x4EF6;I-O&amp;#x5230;&amp;#x5757;I-O&amp;#x7684;&amp;#x6620;&amp;#x5C04;&quot; class=&quot;headerlink&quot; title=&quot;2.&amp;#x6587;&amp;#x4EF6;I/O&amp;#x5230;&amp;#x5757;I/O&amp;#x7684;&amp;#x6620;&amp;#x5C04;&quot;&gt;&lt;/a&gt;2.&amp;#x6587;&amp;#x4EF6;I/O&amp;#x5230;&amp;#x5757;I/O&amp;#x7684;&amp;#x6620;&amp;#x5C04;&lt;/h1&gt;&lt;p&gt;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x521B;&amp;#x5EFA;&amp;#x65F6;&amp;#x4F1A;&amp;#x6307;&amp;#x5B9A;&amp;#x5757;&amp;#x5927;&amp;#x5C0F;&amp;#xFF08;&amp;#x4E00;&amp;#x822C;512,1024,2048,4096&amp;#x5B57;&amp;#x8282;&amp;#xFF09;&amp;#xFF0C;&amp;#x4E00;&amp;#x4E2A;&amp;#x6587;&amp;#x4EF6;&amp;#x4F1A;&amp;#x6839;&amp;#x636E;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x5757;&amp;#x5927;&amp;#x5C0F;&amp;#x548C;&amp;#x6587;&amp;#x4EF6;&amp;#x7684;&amp;#x5927;&amp;#x5C0F;&amp;#x5207;&amp;#x5206;&amp;#x6210;&amp;#x5404;&amp;#x4E2A;&amp;#x903B;&amp;#x8F91;&amp;#x5757;&amp;#xFF0C;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x5C31;&amp;#x4F1A;&amp;#x4E3A;&amp;#x8FD9;&amp;#x4E9B;&amp;#x903B;&amp;#x8F91;&amp;#x5757;&amp;#x5206;&amp;#x914D;&amp;#x7A7A;&amp;#x95F2;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x5757;&amp;#xFF08;ext4&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x662F;&amp;#x5EF6;&amp;#x8FDF;&amp;#x5206;&amp;#x914D;&amp;#x7684;&amp;#xFF09;&amp;#xFF0C;&amp;#x7528;&amp;#x6237;&amp;#x7A0B;&amp;#x5E8F;&amp;#x5BF9;&amp;#x4E00;&amp;#x4E2A;&amp;#x6587;&amp;#x4EF6;&amp;#x8FDB;&amp;#x884C;&amp;#x8BFB;&amp;#x5199;&amp;#x65F6;&amp;#xFF0C;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x5C31;&amp;#x4F1A;&amp;#x6839;&amp;#x636E;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x903B;&amp;#x8F91;&amp;#x5757;&amp;#x627E;&amp;#x5230;&amp;#x5177;&amp;#x4F53;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x5757;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x4E0B;&amp;#x53D1;io&amp;#x8BF7;&amp;#x6C42;&amp;#x5230;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x5C42;&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x7528;&amp;#x6237;&amp;#x8C03;&amp;#x7528;read()&amp;#x6216;write()&amp;#x7CFB;&amp;#x7EDF;&amp;#x8C03;&amp;#x7528;&amp;#x8FDB;&amp;#x884C;io&amp;#x8BFB;&amp;#x5199;&amp;#x65F6;&amp;#xFF0C;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x7F13;&amp;#x51B2;&amp;#x533A;buf&amp;#x662F;&amp;#x7528;&amp;#x6237;&amp;#x8FDB;&amp;#x7A0B;&amp;#x7A7A;&amp;#x95F4;&amp;#x7684;&amp;#x865A;&amp;#x62DF;&amp;#x5730;&amp;#x5740;&amp;#xFF0C;&amp;#x5728;&amp;#x5185;&amp;#x6838;&amp;#x5904;&amp;#x7406;&amp;#x65F6;&amp;#x5C06;&amp;#x865A;&amp;#x62DF;&amp;#x5185;&amp;#x5B58;&amp;#x6620;&amp;#x5C04;&amp;#x5230;&amp;#x5230;&amp;#x7269;&amp;#x7406;&amp;#x5185;&amp;#x5B58;&amp;#x9875;&amp;#x3002;&amp;#x5982;&amp;#x679C;&amp;#x662F;&amp;#x7F13;&amp;#x5B58;I/O&amp;#xFF0C;&amp;#x4F1A;&amp;#x7ECF;&amp;#x8FC7;&amp;#x7528;&amp;#x6237;&amp;#x7F13;&amp;#x51B2;&amp;#x5230;&amp;#x5185;&amp;#x6838;&amp;#x7F13;&amp;#x5B58;&amp;#xFF08;page cache&amp;#xFF09;&amp;#x7684;&amp;#x62F7;&amp;#x8D1D;&amp;#xFF0C;&amp;#x800C;Direct I/O&amp;#x5219;&amp;#x53EF;&amp;#x4EE5;&amp;#x76F4;&amp;#x63A5;&amp;#x8BA9;&amp;#x5185;&amp;#x6838;&amp;#x6001;&amp;#x6620;&amp;#x5C04;&amp;#x7528;&amp;#x6237;&amp;#x6001;&amp;#x865A;&amp;#x62DF;&amp;#x5185;&amp;#x5B58;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x9875;&amp;#xFF0C;&amp;#x5C11;&amp;#x4E86;&amp;#x4E00;&amp;#x6B21;&amp;#x62F7;&amp;#x8D1D;&amp;#x7684;&amp;#x8FC7;&amp;#x7A0B;&amp;#x3002;&amp;#x5728;&amp;#x4ECE;&amp;#x6587;&amp;#x4EF6;I/O&amp;#x5230;&amp;#x5757;I/O&amp;#x7684;&amp;#x6620;&amp;#x5C04;&amp;#x5904;&amp;#x7406;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#xFF0C;&amp;#x7F13;&amp;#x5B58;I/O&amp;#x7684;&amp;#x5237;&amp;#x810F;&amp;#x9875;&amp;#x548C;Direct I/O&amp;#x7684;&amp;#x65B9;&amp;#x5F0F;&amp;#x7C7B;&amp;#x4F3C;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x4EE5;Direct I/O&amp;#x8FDB;&amp;#x884C;&amp;#x7B80;&amp;#x8981;&amp;#x5206;&amp;#x6790;&amp;#xFF0C;&amp;#x8BE6;&amp;#x7EC6;&amp;#x7684;&amp;#x53EF;&amp;#x4EE5;&amp;#x53BB;&amp;#x770B;&amp;#x5185;&amp;#x6838;&amp;#x4EE3;&amp;#x7801;&amp;#x91CC;&amp;#x7684;submit_page_action&amp;#xFF0C;__bio_add_page&amp;#x7B49;&amp;#x51FD;&amp;#x6570;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x7528;&amp;#x6237;&amp;#x7A0B;&amp;#x5E8F;&amp;#x5728;&amp;#x4F7F;&amp;#x7528;Direct I/O&amp;#x65F6;&amp;#xFF0C;&amp;#x4F7F;&amp;#x7528;&amp;#x7684;buffer&amp;#x548C;&amp;#x8BFB;&amp;#x5199;&amp;#x7684;&amp;#x957F;&amp;#x5EA6;&amp;#x9700;&amp;#x8981;512&amp;#x5B57;&amp;#x8282;&amp;#x7684;&amp;#x6574;&amp;#x6570;&amp;#x500D;&amp;#x5BF9;&amp;#x9F50;&amp;#xFF0C;&amp;#x4E4B;&amp;#x6240;&amp;#x4EE5;&amp;#x8FD9;&amp;#x6837;&amp;#x8981;&amp;#x6C42;&amp;#xFF0C;&amp;#x662F;&amp;#x56E0;&amp;#x4E3A;&amp;#x975E;&amp;#x5BF9;&amp;#x9F50;&amp;#x7684;&amp;#x8BF7;&amp;#x6C42;&amp;#x5728;&amp;#x5E95;&amp;#x5C42;&amp;#x6784;&amp;#x9020;bio&amp;#x65F6;&amp;#x6709;&amp;#x53EF;&amp;#x80FD;&amp;#x4F1A;&amp;#x56E0;&amp;#x4E3A;PageSize&amp;#x8FB9;&amp;#x754C;&amp;#x5E26;&amp;#x6765;&amp;#x989D;&amp;#x5916;&amp;#x7684;I/O&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;&amp;#x9700;&amp;#x8981;&amp;#x591A;&amp;#x6B21;&amp;#x4E0B;&amp;#x53D1;&amp;#x8BF7;&amp;#x6C42;&amp;#xFF0C;&amp;#x964D;&amp;#x4F4E;&amp;#x4E86;&amp;#x6548;&amp;#x7387;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x4E00;&amp;#x4E2A;&amp;#x6587;&amp;#x4EF6;I/O&amp;#x4E0B;&amp;#x53D1;&amp;#x5230;&amp;#x5E95;&amp;#x5C42;&amp;#x4F1A;&amp;#x53D8;&amp;#x6210;&amp;#x591A;&amp;#x5C11;&amp;#x4E2A;&amp;#x5757;I/O&amp;#xFF0C;&amp;#x53D6;&amp;#x51B3;&amp;#x4E8E;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x5757;&amp;#x5927;&amp;#x5C0F;&amp;#x548C;&amp;#x7528;&amp;#x6237;&amp;#x7F13;&amp;#x51B2;&amp;#x533A;&amp;#x7684;&amp;#x5BF9;&amp;#x9F50;&amp;#x957F;&amp;#x5EA6;&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;&amp;#x8BE5;&amp;#x6587;&amp;#x4EF6;&amp;#x7684;&amp;#x903B;&amp;#x8F91;&amp;#x5757;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x5757;&amp;#x662F;&amp;#x5426;&amp;#x8FDE;&amp;#x7EED;&amp;#x3002;&amp;#x4E0B;&amp;#x9762;&amp;#x4EE5;&amp;#x5177;&amp;#x4F53;&amp;#x7684;&amp;#x4F8B;&amp;#x5B50;&amp;#x6765;&amp;#x8FDB;&amp;#x884C;&amp;#x8BF4;&amp;#x660E;&amp;#x3002;&lt;br&gt;1&amp;#xFF09;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x5757;&amp;#x5927;&amp;#x5C0F;&amp;#x662F;1KB &amp;#xFF0C;&amp;#x7528;&amp;#x6237;&amp;#x53D1;&amp;#x8D77;&amp;#x4E00;&amp;#x4E2A;4KB&amp;#x7684;&amp;#x8BF7;&amp;#x6C42;&amp;#xFF0C;&amp;#x7533;&amp;#x8BF7;&amp;#x7684;buffer&amp;#x5728;&amp;#x4E00;&amp;#x4E2A;&amp;#x9875;&amp;#x4E2D;&amp;#xFF08;&amp;#x6216;&amp;#x8005;direc io&amp;#x4E0B;&amp;#x7684;&amp;#x6309;&amp;#x7167;4KB&amp;#x5BF9;&amp;#x9F50;&amp;#xFF09;&amp;#x3002;&amp;#x56FE;&amp;#x4E2D;&amp;#x7EFF;&amp;#x8272;&amp;#x548C;&amp;#x7EA2;&amp;#x8272;&amp;#x65B9;&amp;#x5757;&amp;#x91CC;&amp;#x7684;&amp;#x6570;&amp;#x5B57;&amp;#x8868;&amp;#x793A;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x771F;&amp;#x5B9E;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x5757;&amp;#x7684;&amp;#x5757;&amp;#x53F7;&amp;#xFF0C;&amp;#x8981;&amp;#x8BFB;&amp;#x5199;&amp;#x7684;&amp;#x8FD9;&amp;#x4E2A;&amp;#x6587;&amp;#x4EF6;&amp;#x7684;4KB&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x6309;&amp;#x7167;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x5757;&amp;#x5927;&amp;#x5C0F;&amp;#x5207;&amp;#x5206;&amp;#xFF0C;&amp;#x5206;&amp;#x6210;4&amp;#x4E2A;&amp;#x903B;&amp;#x8F91;&amp;#x5757;&amp;#xFF08;0~3&amp;#xFF09;&amp;#xFF0C;&amp;#x5176;&amp;#x4E2D;&amp;#x903B;&amp;#x8F91;&amp;#x5757;0&amp;#x5BF9;&amp;#x5E94;&amp;#x7269;&amp;#x7406;&amp;#x5757;60&amp;#xFF0C;&amp;#x903B;&amp;#x8F91;&amp;#x5757;1&amp;#x5BF9;&amp;#x5E94;&amp;#x7269;&amp;#x7406;&amp;#x5757;61&amp;#xFF0C;&amp;#x903B;&amp;#x8F91;&amp;#x5757;2&amp;#x5BF9;&amp;#x5E94;&amp;#x7269;&amp;#x7406;&amp;#x5757;200&amp;#xFF0C;&amp;#x903B;&amp;#x8F91;&amp;#x5757;3&amp;#x5BF9;&amp;#x5E94;&amp;#x7269;&amp;#x7406;&amp;#x5757;201&amp;#xFF08;&amp;#x8FD9;&amp;#x4E9B;&amp;#x5BF9;&amp;#x5E94;&amp;#x5173;&amp;#x7CFB;&amp;#x662F;&amp;#x7531;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x5206;&amp;#x914D;&amp;#x5757;&amp;#x65F6;&amp;#x786E;&amp;#x5B9A;&amp;#x7684;&amp;#xFF09;&amp;#x3002;&amp;#x903B;&amp;#x8F91;&amp;#x5757;0&amp;#x548C;1&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x5757;&amp;#x662F;&amp;#x8FDE;&amp;#x7EED;&amp;#x7684;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x56E0;&amp;#x4E3A;&amp;#x5757;&amp;#x5927;&amp;#x5C0F;&amp;#x662F;1KB&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x53EF;&amp;#x4EE5;&amp;#x653E;&amp;#x5728;&amp;#x4E00;&amp;#x4E2A;bio&amp;#x91CC;&amp;#xFF0C;&amp;#x800C;&amp;#x903B;&amp;#x8F91;&amp;#x5757;2&amp;#x548C;3&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x5757;&amp;#x4E0E;&amp;#x903B;&amp;#x8F91;&amp;#x5757;0&amp;#x548C;1&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x5757;&amp;#x4E0D;&amp;#x8FDE;&amp;#x7EED;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x4E0D;&amp;#x80FD;&amp;#x653E;&amp;#x5728;&amp;#x4E00;&amp;#x4E2A;bio&amp;#x91CC;&amp;#xFF0C;&amp;#x9700;&amp;#x8981;&amp;#x65B0;&amp;#x751F;&amp;#x6210;&amp;#x4E00;&amp;#x4E2A;bio&amp;#x3002;&amp;#x8FD9;&amp;#x6837;&amp;#x5C31;&amp;#x8C03;&amp;#x7528;&amp;#x4E86;&amp;#x4E24;&amp;#x6B21;submit_bio&amp;#x4E0B;&amp;#x53D1;&amp;#x5230;&amp;#x901A;&amp;#x7528;&amp;#x5757;&amp;#x5C42;&amp;#x53BB;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x7ECF;&amp;#x8FC7;&amp;#x8C03;&amp;#x5EA6;&amp;#x5C42;&amp;#xFF08;&amp;#x6709;&amp;#x53EF;&amp;#x80FD;&amp;#x548C;&amp;#x5176;&amp;#x4ED6;&amp;#x8BF7;&amp;#x6C42;&amp;#x8FDE;&amp;#x7EED;&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;&amp;#x8FDB;&amp;#x884C;&amp;#x5408;&amp;#x5E76;&amp;#xFF09;&amp;#xFF0C;&amp;#x6700;&amp;#x540E;&amp;#x901A;&amp;#x8FC7;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x9A71;&amp;#x52A8;&amp;#x5C42;&amp;#x4E0B;&amp;#x53D1;&amp;#x5230;&amp;#x5E95;&amp;#x5C42;&amp;#x78C1;&amp;#x76D8;&amp;#x4E0A;&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2015/08/06/fs-io-map/block-is-1kb_4kb-io-in-page.png&quot; alt=&quot;block-is-1kb_4kb-io-in-page&quot;&gt;&lt;br&gt;2&amp;#xFF09;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x5757;&amp;#x5927;&amp;#x5C0F;&amp;#x662F;1KB&amp;#xFF0C; &amp;#x7528;&amp;#x6237;&amp;#x53D1;&amp;#x8D77;&amp;#x4E00;&amp;#x4E2A;4KB&amp;#x7684;&amp;#x8BF7;&amp;#x6C42;&amp;#xFF0C;&amp;#x7533;&amp;#x8BF7;&amp;#x7684;buffer&amp;#x4E0D;&amp;#x5728;&amp;#x4E00;&amp;#x4E2A;&amp;#x9875;&amp;#x4E2D;&amp;#xFF08;&amp;#x6216;&amp;#x8005;direc io&amp;#x4E0B;&amp;#x7684;&amp;#x6309;&amp;#x7167;1KB&amp;#x5BF9;&amp;#x9F50;&amp;#xFF09;&amp;#x3002;&amp;#x8BF7;&amp;#x6C42;&amp;#x843D;&amp;#x5230;&amp;#x4E24;&amp;#x4E2A;&amp;#x9875;&amp;#x4E2D;&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x56E0;&amp;#x4E3A;&amp;#x903B;&amp;#x8F91;&amp;#x5757;2&amp;#x548C;&amp;#x903B;&amp;#x8F91;&amp;#x5757;3&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x5757;&amp;#x4E0D;&amp;#x8FDE;&amp;#x7EED;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x6784;&amp;#x9020;bio&amp;#x65F6;&amp;#x53D8;&amp;#x6210;&amp;#x4E86;3&amp;#x4E2A;bio&amp;#xFF08;&amp;#x5982;&amp;#x679C;&amp;#x4E24;&amp;#x4E2A;&amp;#x9875;&amp;#x4E2D;&amp;#x7684;&amp;#x903B;&amp;#x8F91;&amp;#x5757;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x5757;&amp;#x662F;&amp;#x8FDE;&amp;#x7EED;&amp;#x7684;&amp;#xFF0C;&amp;#x5219;&amp;#x4F1A;&amp;#x653E;&amp;#x5230;&amp;#x4E00;&amp;#x4E2A;bio&amp;#x91CC;&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;bio&amp;#x53EF;&amp;#x4EE5;&amp;#x5305;&amp;#x542B;&amp;#x591A;&amp;#x4E2A;&amp;#x9875;&amp;#xFF09;&amp;#x3002;&amp;#x56E0;&amp;#x6B64;&amp;#x5C31;&amp;#x4F1A;&amp;#x6709;3&amp;#x6B21;submit_bio&amp;#x7684;&amp;#x8C03;&amp;#x7528;&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2015/08/06/fs-io-map/block-is-1kb_4kb-io-not-in-page.png&quot; alt=&quot;block-is-1kb_4kb-io-not-in-page&quot;&gt;&lt;br&gt;3&amp;#xFF09;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x5757;&amp;#x5927;&amp;#x5C0F;&amp;#x662F;4KB &amp;#xFF0C;&amp;#x7528;&amp;#x6237;&amp;#x53D1;&amp;#x8D77;&amp;#x4E00;&amp;#x4E2A;4KB&amp;#x7684;&amp;#x8BF7;&amp;#x6C42;&amp;#xFF0C;&amp;#x7533;&amp;#x8BF7;&amp;#x7684;buffer&amp;#x5728;&amp;#x4E00;&amp;#x4E2A;&amp;#x9875;&amp;#x4E2D;&amp;#xFF08;&amp;#x6216;&amp;#x8005;direc io&amp;#x4E0B;&amp;#x7684;&amp;#x6309;&amp;#x7167;4KB&amp;#x5BF9;&amp;#x9F50;&amp;#xFF09;&amp;#x3002;&amp;#x8FD9;&amp;#x91CC;&amp;#x521A;&amp;#x597D;&amp;#x4E00;&amp;#x4E2A;&amp;#x9875;&amp;#x91CC;&amp;#x53EA;&amp;#x6709;1&amp;#x4E2A;&amp;#x903B;&amp;#x8F91;&amp;#x5757;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x53EA;&amp;#x6709;&amp;#x4E00;&amp;#x6B21;submti_bio&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2015/08/06/fs-io-map/block-is-4kb_4kb-io-in-page.png&quot; alt=&quot;block-is-4kb_4kb-io-in-page&quot;&gt;&lt;br&gt;&amp;#x4E0A;&amp;#x9762;&amp;#x7684;&amp;#x51E0;&amp;#x4E2A;&amp;#x793A;&amp;#x4F8B;&amp;#x5C31;&amp;#x89E3;&amp;#x91CA;&amp;#x4E86;&amp;#x7B2C;3&amp;#x8282;&amp;#x672B;&amp;#x5C3E;&amp;#x63D0;&amp;#x51FA;&amp;#x7684;&amp;#x95EE;&amp;#x9898;&amp;#xFF0C;&amp;#x4E00;&amp;#x4E2A;&amp;#x6587;&amp;#x4EF6;I/O&amp;#x4E0B;&amp;#x53D1;&amp;#x5230;&amp;#x5E95;&amp;#x5C42;&amp;#x4F1A;&amp;#x53D8;&amp;#x6210;&amp;#x591A;&amp;#x5C11;&amp;#x4E2A;&amp;#x5757;I/O&amp;#xFF0C;&amp;#x53D6;&amp;#x51B3;&amp;#x4E8E;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x5757;&amp;#x5927;&amp;#x5C0F;&amp;#x548C;&amp;#x7528;&amp;#x6237;&amp;#x7F13;&amp;#x51B2;&amp;#x533A;&amp;#x7684;&amp;#x5BF9;&amp;#x9F50;&amp;#x957F;&amp;#x5EA6;&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;&amp;#x8BE5;&amp;#x6587;&amp;#x4EF6;&amp;#x7684;&amp;#x903B;&amp;#x8F91;&amp;#x5757;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x5757;&amp;#x662F;&amp;#x5426;&amp;#x8FDE;&amp;#x7EED;&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;3-&amp;#x53C2;&amp;#x8003;&amp;#x8D44;&amp;#x6599;&quot;&gt;&lt;a href=&quot;#3-&amp;#x53C2;&amp;#x8003;&amp;#x8D44;&amp;#x6599;&quot; class=&quot;headerlink&quot; title=&quot;3.&amp;#x53C2;&amp;#x8003;&amp;#x8D44;&amp;#x6599;&quot;&gt;&lt;/a&gt;3.&amp;#x53C2;&amp;#x8003;&amp;#x8D44;&amp;#x6599;&lt;/h1&gt;&lt;p&gt;1.&amp;#x300A;&amp;#x6DF1;&amp;#x5165;&amp;#x7406;&amp;#x89E3;linux&amp;#x5185;&amp;#x6838;&amp;#x300B;&lt;br&gt;2.&amp;#x300A;Linux&amp;#x8BBE;&amp;#x5907;&amp;#x9A71;&amp;#x52A8;&amp;#x7A0B;&amp;#x5E8F;&amp;#x300B;&lt;br&gt;3.&amp;#x300A;unix&amp;#x9AD8;&amp;#x7EA7;&amp;#x73AF;&amp;#x5883;&amp;#x7F16;&amp;#x7A0B;&amp;#x300B;&lt;br&gt;4.Linux&amp;#x5185;&amp;#x6838;&amp;#x6E90;&amp;#x7801;3.10.45&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;#x672C;&amp;#x6587;&amp;#x4E3B;&amp;#x8981;&amp;#x5BF9;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x78C1;&amp;#x76D8;&amp;#x5E03;&amp;#x5C40;&amp;#x8FDB;&amp;#x884C;&amp;#x6982;&amp;#x8981;&amp;#x7684;&amp;#x68B3;&amp;#x7406;&amp;#xFF0C;&amp;#x5E76;&amp;#x5728;&amp;#x6B64;&amp;#x57FA;&amp;#x7840;&amp;#x4E0A;&amp;#x5206;&amp;#x6790;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;I/O&amp;#x5230;&amp;#x5757;I/O&amp;#x7684;&amp;#x6620;&amp;#x5C04;&amp;#x673A;&amp;#x5236;&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;1-&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x78C1;&amp;#x76D8;&amp;#x5E03;&amp;#x5C40;&quot;&gt;&lt;a href=&quot;#1-&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x78C1;&amp;#x76D8;&amp;#x5E03;&amp;#x5C40;&quot; class=&quot;headerlink&quot; title=&quot;1.&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x78C1;&amp;#x76D8;&amp;#x5E03;&amp;#x5C40;&quot;&gt;&lt;/a&gt;1.&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x78C1;&amp;#x76D8;&amp;#x5E03;&amp;#x5C40;&lt;/h1&gt;&lt;p&gt;&amp;#x9996;&amp;#x5148;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x5C42;&amp;#x9762;&amp;#x6765;&amp;#x9610;&amp;#x8FF0;&amp;#x6587;&amp;#x4EF6;&amp;#x4E0E;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x7684;&amp;#x5173;&amp;#x7CFB;&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;1-1&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x4E0E;inode&quot;&gt;&lt;a href=&quot;#1-1&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x4E0E;inode&quot; class=&quot;headerlink&quot; title=&quot;1.1&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x4E0E;inode&quot;&gt;&lt;/a&gt;1.1&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x4E0E;inode&lt;/h2&gt;&lt;p&gt;&amp;#x5E94;&amp;#x7528;&amp;#x7A0B;&amp;#x5E8F;&amp;#x5728;&amp;#x8BBF;&amp;#x95EE;&amp;#x6587;&amp;#x4EF6;&amp;#x65F6;&amp;#x90FD;&amp;#x4F1A;&amp;#x5148;&amp;#x6253;&amp;#x5F00;&amp;#x6587;&amp;#x4EF6;&amp;#xFF0C;&amp;#x5728;&amp;#x5185;&amp;#x6838;&amp;#x4E2D;&amp;#xFF0C;&amp;#x5BF9;&amp;#x5E94;&amp;#x6BCF;&amp;#x4E2A;&amp;#x8FDB;&amp;#x7A0B;&amp;#xFF0C;&amp;#x90FD;&amp;#x4F1A;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x8868;&amp;#x8868;&amp;#x793A;&amp;#x8FD9;&amp;#x4E2A;&amp;#x8FDB;&amp;#x7A0B;&amp;#x6253;&amp;#x5F00;&amp;#x7684;&amp;#x6587;&amp;#x4EF6;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x7528;&amp;#x6237;&amp;#x7A0B;&amp;#x5E8F;&amp;#x4E0D;&amp;#x80FD;&amp;#x76F4;&amp;#x63A5;&amp;#x8BBF;&amp;#x95EE;&amp;#x5185;&amp;#x6838;&amp;#x4E2D;&amp;#x7684;&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x8868;,&amp;#x800C;&amp;#x53EA;&amp;#x80FD;&amp;#x4F7F;&amp;#x7528;&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x8868;&amp;#x7684;&amp;#x7D22;&amp;#x5F15;&amp;#xFF08;&amp;#x4E00;&amp;#x4E2A;&amp;#x6574;&amp;#x6570;&amp;#xFF09;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E9B;&amp;#x7D22;&amp;#x5F15;&amp;#x5C31;&amp;#x88AB;&amp;#x79F0;&amp;#x4E3A;&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x3002;&amp;#x5F53;&amp;#x8C03;&amp;#x7528;open &amp;#x6253;&amp;#x5F00;&amp;#x4E00;&amp;#x4E2A;&amp;#x6587;&amp;#x4EF6;&amp;#x6216;&amp;#x521B;&amp;#x5EFA;&amp;#x4E00;&amp;#x4E2A;&amp;#x65B0;&amp;#x6587;&amp;#x4EF6;&amp;#x65F6;,&amp;#x5185;&amp;#x6838;&amp;#x5206;&amp;#x914D;&amp;#x4E00;&amp;#x4E2A;&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x5E76;&amp;#x8FD4;&amp;#x56DE;&amp;#x7ED9;&amp;#x7528;&amp;#x6237;&amp;#x7A0B;&amp;#x5E8F;,&amp;#x8BE5;&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x8868;&amp;#x9879;&amp;#x4E2D;&amp;#x7684;&amp;#x6307;&amp;#x9488;&amp;#x6307;&amp;#x5411;&amp;#x65B0;&amp;#x6253;&amp;#x5F00;&amp;#x7684;&amp;#x6587;&amp;#x4EF6;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x8868;&amp;#x4E2D;&amp;#x6BCF;&amp;#x4E00;&amp;#x9879;&amp;#x90FD;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x6307;&amp;#x9488;&amp;#xFF0C;&amp;#x6307;&amp;#x5411;&amp;#x4E00;&amp;#x4E2A;&amp;#x7528;&amp;#x4E8E;&amp;#x63CF;&amp;#x8FF0;&amp;#x6253;&amp;#x5F00;&amp;#x7684;&amp;#x6587;&amp;#x4EF6;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x5757;&amp;#x2013;file&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;file&amp;#x5BF9;&amp;#x8C61;&amp;#x4E2D;&amp;#x63CF;&amp;#x8FF0;&amp;#x4E86;&amp;#x6587;&amp;#x4EF6;&amp;#x7684;&amp;#x6253;&amp;#x5F00;&amp;#x6A21;&amp;#x5F0F;&amp;#xFF0C;&amp;#x8BFB;&amp;#x5199;&amp;#x4F4D;&amp;#x7F6E;&amp;#x7B49;&amp;#x91CD;&amp;#x8981;&amp;#x4FE1;&amp;#x606F;&amp;#xFF0C;&amp;#x5F53;&amp;#x8FDB;&amp;#x7A0B;&amp;#x6253;&amp;#x5F00;&amp;#x4E00;&amp;#x4E2A;&amp;#x6587;&amp;#x4EF6;&amp;#x65F6;&amp;#xFF0C;&amp;#x5185;&amp;#x6838;&amp;#x5C31;&amp;#x4F1A;&amp;#x521B;&amp;#x5EFA;&amp;#x4E00;&amp;#x4E2A;&amp;#x65B0;&amp;#x7684;file&amp;#x5BF9;&amp;#x8C61;&amp;#x3002;&amp;#x9700;&amp;#x8981;&amp;#x6CE8;&amp;#x610F;&amp;#x7684;&amp;#x662F;&amp;#xFF0C;file&amp;#x5BF9;&amp;#x8C61;&amp;#x4E0D;&amp;#x662F;&amp;#x4E13;&amp;#x5C5E;&amp;#x4E8E;&amp;#x67D0;&amp;#x4E2A;&amp;#x8FDB;&amp;#x7A0B;&amp;#x7684;&amp;#xFF0C;&amp;#x4E0D;&amp;#x540C;&amp;#x8FDB;&amp;#x7A0B;&amp;#x7684;&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x8868;&amp;#x4E2D;&amp;#x7684;&amp;#x6307;&amp;#x9488;&amp;#x53EF;&amp;#x4EE5;&amp;#x6307;&amp;#x5411;&amp;#x76F8;&amp;#x540C;&amp;#x7684;file&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;&amp;#x5171;&amp;#x4EAB;&amp;#x8FD9;&amp;#x4E2A;&amp;#x6253;&amp;#x5F00;&amp;#x7684;&amp;#x6587;&amp;#x4EF6;&amp;#x3002;file&amp;#x5BF9;&amp;#x8C61;&amp;#x6709;&amp;#x5F15;&amp;#x7528;&amp;#x8BA1;&amp;#x6570;&amp;#xFF0C;&amp;#x8BB0;&amp;#x5F55;&amp;#x4E86;&amp;#x5F15;&amp;#x7528;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x4E2A;&amp;#x6570;&amp;#xFF0C;&amp;#x53EA;&amp;#x6709;&amp;#x5F53;&amp;#x5F15;&amp;#x7528;&amp;#x8BA1;&amp;#x6570;&amp;#x4E3A;0&amp;#x65F6;&amp;#xFF0C;&amp;#x5185;&amp;#x6838;&amp;#x624D;&amp;#x9500;&amp;#x6BC1;file&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x56E0;&amp;#x6B64;&amp;#x67D0;&amp;#x4E2A;&amp;#x8FDB;&amp;#x7A0B;&amp;#x5173;&amp;#x95ED;&amp;#x6587;&amp;#x4EF6;&amp;#xFF0C;&amp;#x4E0D;&amp;#x5F71;&amp;#x54CD;&amp;#x4E0E;&amp;#x4E4B;&amp;#x5171;&amp;#x4EAB;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;file&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x8FDB;&amp;#x7A0B;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;file&amp;#x5BF9;&amp;#x8C61;&amp;#x4E2D;&amp;#x5305;&amp;#x542B;&amp;#x4E00;&amp;#x4E2A;&amp;#x6307;&amp;#x9488;&amp;#xFF0C;&amp;#x6307;&amp;#x5411;dentry&amp;#x5BF9;&amp;#x8C61;&amp;#x3002;dentry&amp;#x5BF9;&amp;#x8C61;&amp;#x4EE3;&amp;#x8868;&amp;#x4E00;&amp;#x4E2A;&amp;#x72EC;&amp;#x7ACB;&amp;#x7684;&amp;#x6587;&amp;#x4EF6;&amp;#x8DEF;&amp;#x5F84;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x4E00;&amp;#x4E2A;&amp;#x6587;&amp;#x4EF6;&amp;#x8DEF;&amp;#x5F84;&amp;#x88AB;&amp;#x6253;&amp;#x5F00;&amp;#x591A;&amp;#x6B21;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x4F1A;&amp;#x5EFA;&amp;#x7ACB;&amp;#x591A;&amp;#x4E2A;file&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x4F46;&amp;#x5B83;&amp;#x4EEC;&amp;#x90FD;&amp;#x6307;&amp;#x5411;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;dentry&amp;#x5BF9;&amp;#x8C61;&amp;#x3002;inode&amp;#x5BF9;&amp;#x8C61;&amp;#x4EE3;&amp;#x8868;&amp;#x4E00;&amp;#x4E2A;&amp;#x72EC;&amp;#x7ACB;&amp;#x6587;&amp;#x4EF6;&amp;#xFF0C;inode &amp;#x5BF9;&amp;#x8C61;&amp;#x5305;&amp;#x542B;&amp;#x4E86;&amp;#x6700;&amp;#x7EC8;&amp;#x5BF9;&amp;#x6587;&amp;#x4EF6;&amp;#x8FDB;&amp;#x884C;&amp;#x64CD;&amp;#x4F5C;&amp;#x6240;&amp;#x9700;&amp;#x7684;&amp;#x6240;&amp;#x6709;&amp;#x4FE1;&amp;#x606F;&amp;#xFF0C;&amp;#x5982;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7C7B;&amp;#x578B;&amp;#x3001;&amp;#x6587;&amp;#x4EF6;&amp;#x7684;&amp;#x64CD;&amp;#x4F5C;&amp;#x65B9;&amp;#x6CD5;&amp;#x3001;&amp;#x6587;&amp;#x4EF6;&amp;#x7684;&amp;#x6743;&amp;#x9650;&amp;#x3001;&amp;#x8BBF;&amp;#x95EE;&amp;#x65E5;&amp;#x671F;&amp;#x7B49;&amp;#x3002;&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="storage" scheme="http://yoursite.com/categories/storage/"/>
    
    
      <category term="storage" scheme="http://yoursite.com/tags/storage/"/>
    
      <category term="filesystem" scheme="http://yoursite.com/tags/filesystem/"/>
    
      <category term="io" scheme="http://yoursite.com/tags/io/"/>
    
  </entry>
  
  <entry>
    <title>linux块设备IO栈浅析</title>
    <link href="http://yoursite.com/2015/08/06/linux-io-stack/"/>
    <id>http://yoursite.com/2015/08/06/linux-io-stack/</id>
    <published>2015-08-06T13:54:13.000Z</published>
    <updated>2016-05-13T09:04:36.204Z</updated>
    
    <content type="html">&lt;p&gt;&amp;#x5757;&amp;#x5B58;&amp;#x50A8;&amp;#xFF0C;&amp;#x7B80;&amp;#x5355;&amp;#x6765;&amp;#x8BF4;&amp;#x5C31;&amp;#x662F;&amp;#x4F7F;&amp;#x7528;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x4E3A;&amp;#x7CFB;&amp;#x7EDF;&amp;#x63D0;&amp;#x4F9B;&amp;#x5B58;&amp;#x50A8;&amp;#x670D;&amp;#x52A1;&amp;#x3002;&amp;#x5757;&amp;#x5B58;&amp;#x50A8;&amp;#x5206;&amp;#x591A;&amp;#x79CD;&amp;#x7C7B;&amp;#x578B;&amp;#xFF0C;&amp;#x6709;&amp;#x5355;&amp;#x673A;&amp;#x5757;&amp;#x5B58;&amp;#x50A8;&amp;#xFF0C;&amp;#x7F51;&amp;#x7EDC;&amp;#x5B58;&amp;#x50A8;&amp;#xFF08;&amp;#x5982;NAS&amp;#xFF0C;SAN&amp;#x7B49;&amp;#xFF09;&amp;#xFF0C;&amp;#x5206;&amp;#x5E03;&amp;#x5F0F;&amp;#x5757;&amp;#x5B58;&amp;#x50A8;&amp;#xFF08;&amp;#x76EE;&amp;#x524D;&amp;#x4E3B;&amp;#x6D41;&amp;#x7684;&amp;#x5982;AWS&amp;#x7684;EBS&amp;#xFF0C;&amp;#x9752;&amp;#x4E91;&amp;#x7684;&amp;#x4E91;&amp;#x786C;&amp;#x76D8;&amp;#xFF0C;&amp;#x963F;&amp;#x91CC;&amp;#x4E91;&amp;#x7684;&amp;#x4E91;&amp;#x78C1;&amp;#x76D8;&amp;#xFF0C;&amp;#x7F51;&amp;#x6613;&amp;#x4E91;&amp;#x786C;&amp;#x76D8;&amp;#x7B49;&amp;#xFF09;&amp;#x3002;&amp;#x901A;&amp;#x5E38;&amp;#x5757;&amp;#x5B58;&amp;#x50A8;&amp;#x7684;&amp;#x8868;&amp;#x73B0;&amp;#x5F62;&amp;#x5F0F;&amp;#x5C31;&amp;#x662F;&amp;#x4E00;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#xFF0C;&amp;#x7528;&amp;#x6237;&amp;#x770B;&amp;#x5230;&amp;#x7684;&amp;#x5C31;&amp;#x662F;&amp;#x7C7B;&amp;#x4F3C;&amp;#x4E8E;sda&amp;#xFF0C;sdb&amp;#x8FD9;&amp;#x6837;&amp;#x7684;&amp;#x903B;&amp;#x8F91;&amp;#x8BBE;&amp;#x5907;&amp;#x3002;&amp;#x672C;&amp;#x6587;&amp;#x4E3B;&amp;#x8981;&amp;#x4ECB;&amp;#x7ECD;Linux&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#xFF0C;&amp;#x5BF9;Linux&amp;#x7684;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;I/O&amp;#x6808;&amp;#x8FDB;&amp;#x884C;&amp;#x5206;&amp;#x6790;&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;1-&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x57FA;&amp;#x672C;&amp;#x6982;&amp;#x5FF5;&quot;&gt;&lt;a href=&quot;#1-&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x57FA;&amp;#x672C;&amp;#x6982;&amp;#x5FF5;&quot; class=&quot;headerlink&quot; title=&quot;1.&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x57FA;&amp;#x672C;&amp;#x6982;&amp;#x5FF5;&quot;&gt;&lt;/a&gt;1.&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x57FA;&amp;#x672C;&amp;#x6982;&amp;#x5FF5;&lt;/h1&gt;&lt;p&gt;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x5C06;&amp;#x4FE1;&amp;#x606F;&amp;#x5B58;&amp;#x50A8;&amp;#x5728;&amp;#x56FA;&amp;#x5B9A;&amp;#x5927;&amp;#x5C0F;&amp;#x7684;&amp;#x5757;&amp;#x4E2D;&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;&amp;#x5757;&amp;#x90FD;&amp;#x6709;&amp;#x81EA;&amp;#x5DF1;&amp;#x7684;&amp;#x5730;&amp;#x5740;&amp;#x3002;&amp;#x5BF9;&amp;#x64CD;&amp;#x4F5C;&amp;#x7CFB;&amp;#x7EDF;&amp;#x800C;&amp;#x8A00;&amp;#xFF0C;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x662F;&amp;#x4EE5;&amp;#x5B57;&amp;#x7B26;&amp;#x8BBE;&amp;#x5907;&amp;#x7684;&amp;#x5916;&amp;#x89C2;&amp;#x5C55;&amp;#x73B0;&amp;#x7684;&amp;#xFF0C;&amp;#x4F8B;&amp;#x5982;/dev/sda&amp;#xFF0C;&amp;#x867D;&amp;#x7136;&amp;#x5BF9;&amp;#x8FD9;&amp;#x79CD;&amp;#x5B57;&amp;#x7B26;&amp;#x8BBE;&amp;#x5907;&amp;#x53EF;&amp;#x4EE5;&amp;#x6309;&amp;#x7167;&amp;#x5B57;&amp;#x8282;&amp;#x4E3A;&amp;#x5355;&amp;#x4F4D;&amp;#x8BBF;&amp;#x95EE;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x5B9E;&amp;#x9645;&amp;#x4E0A;&amp;#x5230;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x4E0A;&amp;#x5374;&amp;#x662F;&amp;#x4EE5;&amp;#x5757;&amp;#x4E3A;&amp;#x5355;&amp;#x4F4D;&amp;#xFF08;&amp;#x6700;&amp;#x5C0F;512byte&amp;#xFF0C;&amp;#x5373;&amp;#x4E00;&amp;#x4E2A;&amp;#x6247;&amp;#x533A;&amp;#xFF09;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E4B;&amp;#x95F4;&amp;#x7684;&amp;#x8F6C;&amp;#x6362;&amp;#x662F;&amp;#x7531;&amp;#x64CD;&amp;#x4F5C;&amp;#x7CFB;&amp;#x7EDF;&amp;#x6765;&amp;#x5B9E;&amp;#x73B0;&amp;#x7684;&amp;#x3002;&lt;br&gt;        &amp;#x4E0B;&amp;#x9762;&amp;#x4ECB;&amp;#x7ECD;&amp;#x51E0;&amp;#x4E2A;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x7684;&amp;#x57FA;&amp;#x672C;&amp;#x6982;&amp;#x5FF5;&amp;#xFF1A;&lt;br&gt;        1&amp;#xFF09;&amp;#x6247;&amp;#x533A;&amp;#xFF1A;&amp;#x78C1;&amp;#x76D8;&amp;#x76D8;&amp;#x7247;&amp;#x4E0A;&amp;#x7684;&amp;#x6247;&amp;#x5F62;&amp;#x533A;&amp;#x57DF;&amp;#xFF0C;&amp;#x903B;&amp;#x8F91;&amp;#x5316;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x65B9;&amp;#x4FBF;&amp;#x7BA1;&amp;#x7406;&amp;#x78C1;&amp;#x76D8;&amp;#x7A7A;&amp;#x95F4;&amp;#xFF0C;&amp;#x662F;&amp;#x786C;&amp;#x4EF6;&amp;#x8BBE;&amp;#x5907;&amp;#x6570;&amp;#x636E;&amp;#x4F20;&amp;#x9001;&amp;#x7684;&amp;#x57FA;&amp;#x672C;&amp;#x5355;&amp;#x4F4D;&amp;#xFF0C;&amp;#x4E00;&amp;#x822C;512Byte&amp;#xFF1B;&lt;br&gt;    2&amp;#xFF09;&amp;#x5757;&amp;#xFF1A;&amp;#x5757;&amp;#x662F;VFS&amp;#x548C;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x6570;&amp;#x636E;&amp;#x4F20;&amp;#x9001;&amp;#x7684;&amp;#x57FA;&amp;#x672C;&amp;#x5355;&amp;#x4F4D;&amp;#xFF0C;&amp;#x5FC5;&amp;#x987B;&amp;#x662F;&amp;#x6247;&amp;#x533A;&amp;#x7684;&amp;#x6574;&amp;#x6570;&amp;#x500D;&amp;#xFF0C;&amp;#x683C;&amp;#x5F0F;&amp;#x5316;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x65F6;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x6307;&amp;#x5B9A;&amp;#x5757;&amp;#x5927;&amp;#x5C0F;&amp;#xFF08;&amp;#x4E00;&amp;#x822C;512,1024,2048,4096&amp;#x5B57;&amp;#x8282;&amp;#xFF09;&amp;#xFF1B;&lt;br&gt;       3&amp;#xFF09;&amp;#x6BB5;&amp;#xFF1A;&amp;#x4E00;&amp;#x4E2A;&amp;#x5185;&amp;#x5B58;&amp;#x9875;&amp;#x6216;&amp;#x8005;&amp;#x5185;&amp;#x5B58;&amp;#x9875;&amp;#x4E2D;&amp;#x7684;&amp;#x4E00;&amp;#x90E8;&amp;#x5206;&amp;#xFF0C;&amp;#x5305;&amp;#x542B;&amp;#x4E00;&amp;#x4E9B;&amp;#x76F8;&amp;#x90BB;&amp;#x78C1;&amp;#x76D8;&amp;#x6247;&amp;#x533A;&amp;#x4E2D;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#xFF1B;&amp;#x78C1;&amp;#x76D8;&amp;#x7684;&amp;#x6BCF;&amp;#x4E2A;I/O&amp;#x64CD;&amp;#x4F5C;&amp;#x5C31;&amp;#x662F;&amp;#x5728;&amp;#x78C1;&amp;#x76D8;&amp;#x4E0E;&amp;#x4E00;&amp;#x4E9B;RAM&amp;#x5355;&amp;#x5143;&amp;#x4E4B;&amp;#x95F4;&amp;#x76F8;&amp;#x4E92;&amp;#x4F20;&amp;#x4E00;&amp;#x4E9B;&amp;#x76F8;&amp;#x90BB;&amp;#x6247;&amp;#x533A;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#xFF0C;&amp;#x5927;&amp;#x591A;&amp;#x6570;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;&amp;#xFF0C;&amp;#x78C1;&amp;#x76D8;&amp;#x63A7;&amp;#x5236;&amp;#x5668;&amp;#x91C7;&amp;#x7528;DMA&amp;#x65B9;&amp;#x5F0F;&amp;#x8FDB;&amp;#x884C;&amp;#x6570;&amp;#x636E;&amp;#x4F20;&amp;#x9001;&amp;#x3002;&amp;#x5982;&amp;#x679C;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x6BB5;&amp;#x5728;RAM&amp;#x4E2D;&amp;#x76F8;&amp;#x5E94;&amp;#x7684;&amp;#x9875;&amp;#x6846;&amp;#x662F;&amp;#x8FDE;&amp;#x7EED;&amp;#x7684;&amp;#x5E76;&amp;#x4E14;&amp;#x5728;&amp;#x78C1;&amp;#x76D8;&amp;#x4E0A;&amp;#x76F8;&amp;#x5E94;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x5757;&amp;#x4E5F;&amp;#x662F;&amp;#x76F8;&amp;#x90BB;&amp;#x7684;&amp;#xFF0C;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x5728;&amp;#x901A;&amp;#x7528;&amp;#x5757;&amp;#x5C42;&amp;#x5408;&amp;#x5E76;&amp;#x5B83;&amp;#x4EEC;&amp;#xFF0C;&amp;#x4EA7;&amp;#x751F;&amp;#x66F4;&amp;#x5927;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x533A;&amp;#x57DF;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x533A;&amp;#x57DF;&amp;#x79F0;&amp;#x4E3A;&amp;#x7269;&amp;#x7406;&amp;#x6BB5;&amp;#x3002;&lt;br&gt;&amp;#x901A;&amp;#x5E38;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;&amp;#xFF0C;&amp;#x6211;&amp;#x4EEC;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x6765;&amp;#x8BBF;&amp;#x95EE;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#xFF0C;&amp;#x4E5F;&amp;#x53EF;&amp;#x4EE5;&amp;#x76F4;&amp;#x63A5;&amp;#x4F7F;&amp;#x7528;&amp;#x88F8;&amp;#x8BBE;&amp;#x5907;&amp;#xFF0C;&amp;#x901A;&amp;#x8FC7;&amp;#x6307;&amp;#x5B9A;&amp;#x504F;&amp;#x79FB;&amp;#x548C;&amp;#x5927;&amp;#x5C0F;&amp;#x6765;&amp;#x8BFB;&amp;#x5199;&amp;#x88F8;&amp;#x8BBE;&amp;#x5907;&amp;#x3002;&lt;br&gt;&amp;#x5E38;&amp;#x89C1;&amp;#x7684;&amp;#x5757;&amp;#x5B58;&amp;#x50A8;&amp;#x8BBE;&amp;#x5907;&amp;#x5C31;&amp;#x662F;&amp;#x7269;&amp;#x7406;&amp;#x78C1;&amp;#x76D8;&amp;#xFF0C;&amp;#x5728;Linux&amp;#x7CFB;&amp;#x7EDF;&amp;#x4E0B;&amp;#xFF0C;&amp;#x8FD8;&amp;#x63D0;&amp;#x4F9B;&amp;#x57FA;&amp;#x4E8E;&amp;#x5176;&amp;#x4ED6;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x4E4B;&amp;#x4E0A;&amp;#x7684;&amp;#x903B;&amp;#x8F91;&amp;#x8BBE;&amp;#x5907;&amp;#xFF0C;&amp;#x5982;Device Mapper&amp;#xFF0C;&amp;#x8F6F;RAID&amp;#x7B49;&amp;#x3002;&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;2-&amp;#x5757;&amp;#x8BBE;&amp;#x5907;I-O&amp;#x6808;&quot;&gt;&lt;a href=&quot;#2-&amp;#x5757;&amp;#x8BBE;&amp;#x5907;I-O&amp;#x6808;&quot; class=&quot;headerlink&quot; title=&quot;2.&amp;#x5757;&amp;#x8BBE;&amp;#x5907;I/O&amp;#x6808;&quot;&gt;&lt;/a&gt;2.&amp;#x5757;&amp;#x8BBE;&amp;#x5907;I/O&amp;#x6808;&lt;/h1&gt;&lt;h2 id=&quot;2-1&amp;#x57FA;&amp;#x672C;&amp;#x6982;&amp;#x5FF5;&quot;&gt;&lt;a href=&quot;#2-1&amp;#x57FA;&amp;#x672C;&amp;#x6982;&amp;#x5FF5;&quot; class=&quot;headerlink&quot; title=&quot;2.1&amp;#x57FA;&amp;#x672C;&amp;#x6982;&amp;#x5FF5;&quot;&gt;&lt;/a&gt;2.1&amp;#x57FA;&amp;#x672C;&amp;#x6982;&amp;#x5FF5;&lt;/h2&gt;&lt;p&gt;&amp;#x4ECB;&amp;#x7ECD;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x7684;I/O&amp;#x6808;&amp;#x4E4B;&amp;#x524D;&amp;#xFF0C;&amp;#x6211;&amp;#x4EEC;&amp;#x5148;&amp;#x6765;&amp;#x4E86;&amp;#x89E3;&amp;#x4E00;&amp;#x4E0B;&amp;#x5757;I/O&amp;#x6808;&amp;#x7684;&amp;#x51E0;&amp;#x4E2A;&amp;#x57FA;&amp;#x672C;&amp;#x6982;&amp;#x5FF5;&amp;#x3002;&lt;br&gt;        1&amp;#xFF09;bio&amp;#xFF1A;bio&amp;#x662F;&amp;#x901A;&amp;#x7528;&amp;#x5757;&amp;#x5C42;I/O&amp;#x8BF7;&amp;#x6C42;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#xFF0C;&amp;#x8868;&amp;#x793A;&amp;#x4E0A;&amp;#x5C42;&amp;#x63D0;&amp;#x4EA4;&amp;#x7684;I/O&amp;#x8BF7;&amp;#x6C42;&amp;#xFF0C;&amp;#x4E00;&amp;#x4E2A;bio&amp;#x5305;&amp;#x542B;&amp;#x591A;&amp;#x4E2A;page&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E9B;page&amp;#x5FC5;&amp;#x987B;&amp;#x5BF9;&amp;#x5E94;&amp;#x78C1;&amp;#x76D8;&amp;#x4E0A;&amp;#x4E00;&amp;#x6BB5;&amp;#x8FDE;&amp;#x7EED;&amp;#x7684;&amp;#x7A7A;&amp;#x95F4;&amp;#x3002;&amp;#x7531;&amp;#x4E8E;&amp;#x6587;&amp;#x4EF6;&amp;#x5728;&amp;#x78C1;&amp;#x76D8;&amp;#x4E0A;&amp;#x5E76;&amp;#x4E0D;&amp;#x8FDE;&amp;#x7EED;&amp;#x5B58;&amp;#x653E;&amp;#xFF0C;&amp;#x6587;&amp;#x4EF6;I/O&amp;#x63D0;&amp;#x4EA4;&amp;#x5230;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x4E4B;&amp;#x524D;&amp;#xFF0C;&amp;#x6781;&amp;#x6709;&amp;#x53EF;&amp;#x80FD;&amp;#x88AB;&amp;#x62C6;&amp;#x6210;&amp;#x591A;&amp;#x4E2A;bio&amp;#x7ED3;&amp;#x6784;&amp;#xFF1B;&lt;br&gt;        2&amp;#xFF09;request&amp;#xFF1A;&amp;#x8868;&amp;#x793A;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x9A71;&amp;#x52A8;&amp;#x5C42;I/O&amp;#x8BF7;&amp;#x6C42;&amp;#xFF0C;&amp;#x7ECF;&amp;#x7531;I/O&amp;#x8C03;&amp;#x5EA6;&amp;#x5C42;&amp;#x8F6C;&amp;#x6362;&amp;#x540E;&amp;#x7684;I/O&amp;#x8BF7;&amp;#x6C42;&amp;#xFF0C;&amp;#x5C06;&amp;#x4F1A;&amp;#x53D1;&amp;#x5230;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x9A71;&amp;#x52A8;&amp;#x5C42;&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#xFF1B;&lt;br&gt;        3&amp;#xFF09;request_queue&amp;#xFF1A; &amp;#x7EF4;&amp;#x62A4;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x9A71;&amp;#x52A8;&amp;#x5C42;I/O&amp;#x8BF7;&amp;#x6C42;&amp;#x7684;&amp;#x961F;&amp;#x5217;&amp;#xFF0C;&amp;#x6240;&amp;#x6709;&amp;#x7684;request&amp;#x90FD;&amp;#x63D2;&amp;#x5165;&amp;#x5230;&amp;#x8BE5;&amp;#x961F;&amp;#x5217;&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;&amp;#x78C1;&amp;#x76D8;&amp;#x8BBE;&amp;#x5907;&amp;#x90FD;&amp;#x53EA;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;queue&amp;#xFF08;&amp;#x591A;&amp;#x4E2A;&amp;#x5206;&amp;#x533A;&amp;#x4E5F;&amp;#x53EA;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;&amp;#xFF09;&amp;#xFF1B;&lt;br&gt;        &amp;#x8FD9;3&amp;#x4E2A;&amp;#x7ED3;&amp;#x6784;&amp;#x7684;&amp;#x5173;&amp;#x7CFB;&amp;#x5982;&amp;#x4E0B;&amp;#x56FE;&amp;#x793A;&amp;#xFF1A;&amp;#x4E00;&amp;#x4E2A;request_queue&amp;#x4E2D;&amp;#x5305;&amp;#x542B;&amp;#x591A;&amp;#x4E2A;request&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;request&amp;#x53EF;&amp;#x80FD;&amp;#x5305;&amp;#x542B;&amp;#x591A;&amp;#x4E2A;bio&amp;#xFF0C;&amp;#x8BF7;&amp;#x6C42;&amp;#x7684;&amp;#x5408;&amp;#x5E76;&amp;#x5C31;&amp;#x662F;&amp;#x6839;&amp;#x636E;&amp;#x5404;&amp;#x79CD;&amp;#x539F;&amp;#x5219;&amp;#x5C06;&amp;#x591A;&amp;#x4E2A;bio&amp;#x52A0;&amp;#x5165;&amp;#x5230;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;requesst&amp;#x4E2D;&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2015/08/06/linux-io-stack/bio_req_queue.png&quot; alt=&quot;bio_req_queue&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;2-2-&amp;#x8BF7;&amp;#x6C42;&amp;#x5904;&amp;#x7406;&amp;#x65B9;&amp;#x5F0F;&quot;&gt;&lt;a href=&quot;#2-2-&amp;#x8BF7;&amp;#x6C42;&amp;#x5904;&amp;#x7406;&amp;#x65B9;&amp;#x5F0F;&quot; class=&quot;headerlink&quot; title=&quot;2.2 &amp;#x8BF7;&amp;#x6C42;&amp;#x5904;&amp;#x7406;&amp;#x65B9;&amp;#x5F0F;&quot;&gt;&lt;/a&gt;2.2 &amp;#x8BF7;&amp;#x6C42;&amp;#x5904;&amp;#x7406;&amp;#x65B9;&amp;#x5F0F;&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;/2015/08/06/linux-io-stack/io-stack.png&quot; alt=&quot;io-stack&quot;&gt;&lt;br&gt;&amp;#x5982;&amp;#x56FE;&amp;#x6240;&amp;#x793A;&amp;#x662F;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x7684;I/O&amp;#x6808;&amp;#xFF0C;&amp;#x5176;&amp;#x4E2D;&amp;#x7684;&amp;#x7EA2;&amp;#x8272;&amp;#x6587;&amp;#x5B57;&amp;#x8868;&amp;#x793A;&amp;#x5173;&amp;#x952E;I/O&amp;#x8DEF;&amp;#x5F84;&amp;#x7684;&amp;#x51FD;&amp;#x6570;&amp;#x3002;&lt;br&gt;&amp;#x4E3A;&amp;#x4E86;&amp;#x63CF;&amp;#x8FF0;I/O&amp;#x5904;&amp;#x7406;&amp;#x6D41;&amp;#x7A0B;&amp;#xFF0C;&amp;#x5148;&amp;#x4ECB;&amp;#x7ECD;&amp;#x4E00;&amp;#x4E0B;Direct I/O&amp;#x548C;&amp;#x7F13;&amp;#x5B58;I/O&amp;#x7684;&amp;#x533A;&amp;#x522B;&amp;#xFF1A;&lt;br&gt;        1&amp;#xFF09;Direct I/O&amp;#x7ED5;&amp;#x8FC7;page cache&amp;#xFF0C;&amp;#x800C;&amp;#x7F13;&amp;#x5B58;I/O&amp;#x90FD;&amp;#x662F;&amp;#x5199;&amp;#x5230;page cache&amp;#x91CC;&amp;#x5C31;&amp;#x8868;&amp;#x793A;&amp;#x5199;&amp;#x8BF7;&amp;#x6C42;&amp;#x5B8C;&amp;#x6210;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x7531;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x5237;&amp;#x810F;&amp;#x9875;&amp;#x673A;&amp;#x5236;&amp;#x628A;&amp;#x6570;&amp;#x636E;&amp;#x5237;&amp;#x5230;&amp;#x78C1;&amp;#x76D8;&amp;#x3002;&amp;#x56E0;&amp;#x6B64;&amp;#xFF0C;&amp;#x4F7F;&amp;#x7528;&amp;#x7F13;&amp;#x5B58;I/O&amp;#xFF0C;&amp;#x6389;&amp;#x7535;&amp;#x65F6;&amp;#x6709;&amp;#x53EF;&amp;#x80FD;page cache&amp;#x91CC;&amp;#x7684;&amp;#x810F;&amp;#x6570;&amp;#x636E;&amp;#x672A;&amp;#x5237;&amp;#x5230;&amp;#x78C1;&amp;#x76D8;&amp;#x4E0A;&amp;#xFF0C;&amp;#x9020;&amp;#x6210;&amp;#x6570;&amp;#x636E;&amp;#x4E22;&amp;#x5931;&amp;#xFF1B;&lt;br&gt;        2&amp;#xFF09;&amp;#x7F13;&amp;#x5B58;I/O&amp;#x673A;&amp;#x5236;&amp;#x4E2D;&amp;#xFF0C;DMA&amp;#x65B9;&amp;#x5F0F;&amp;#x53EF;&amp;#x4EE5;&amp;#x5C06;&amp;#x6570;&amp;#x636E;&amp;#x76F4;&amp;#x63A5;&amp;#x4ECE;&amp;#x78C1;&amp;#x76D8;&amp;#x8BFB;&amp;#x5230;page cache&amp;#x4E2D;&amp;#xFF0C;&amp;#x6216;&amp;#x8005;&amp;#x5C06;&amp;#x6570;&amp;#x636E;&amp;#x4ECE;page cache&amp;#x76F4;&amp;#x63A5;&amp;#x5199;&amp;#x56DE;&amp;#x5230;&amp;#x78C1;&amp;#x76D8;&amp;#x4E0A;&amp;#xFF0C;&amp;#x800C;&amp;#x4E0D;&amp;#x80FD;&amp;#x76F4;&amp;#x63A5;&amp;#x5728;&amp;#x5E94;&amp;#x7528;&amp;#x7A0B;&amp;#x5E8F;&amp;#x5730;&amp;#x5740;&amp;#x7A7A;&amp;#x95F4;&amp;#x548C;&amp;#x78C1;&amp;#x76D8;&amp;#x4E4B;&amp;#x95F4;&amp;#x8FDB;&amp;#x884C;&amp;#x6570;&amp;#x636E;&amp;#x4F20;&amp;#x8F93;&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;&amp;#x7684;&amp;#x8BDD;&amp;#xFF0C;&amp;#x6570;&amp;#x636E;&amp;#x5728;&amp;#x4F20;&amp;#x8F93;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#x9700;&amp;#x8981;&amp;#x5728;&amp;#x5E94;&amp;#x7528;&amp;#x7A0B;&amp;#x5E8F;&amp;#x5730;&amp;#x5740;&amp;#x7A7A;&amp;#x95F4;&amp;#x548C;page cache&amp;#x4E4B;&amp;#x95F4;&amp;#x8FDB;&amp;#x884C;&amp;#x591A;&amp;#x6B21;&amp;#x6570;&amp;#x636E;&amp;#x62F7;&amp;#x8D1D;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E9B;&amp;#x6570;&amp;#x636E;&amp;#x62F7;&amp;#x8D1D;&amp;#x64CD;&amp;#x4F5C;&amp;#x6240;&amp;#x5E26;&amp;#x6765;&amp;#x7684;CPU&amp;#x4EE5;&amp;#x53CA;&amp;#x5185;&amp;#x5B58;&amp;#x5F00;&amp;#x9500;&amp;#x662F;&amp;#x975E;&amp;#x5E38;&amp;#x5927;&amp;#x7684;&amp;#x3002;&amp;#x800C;Direct I/O&amp;#x7684;&amp;#x4F18;&amp;#x70B9;&amp;#x5C31;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;&amp;#x51CF;&amp;#x5C11;&amp;#x64CD;&amp;#x4F5C;&amp;#x7CFB;&amp;#x7EDF;&amp;#x5185;&amp;#x6838;&amp;#x7F13;&amp;#x51B2;&amp;#x533A;&amp;#x548C;&amp;#x5E94;&amp;#x7528;&amp;#x7A0B;&amp;#x5E8F;&amp;#x5730;&amp;#x5740;&amp;#x7A7A;&amp;#x95F4;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x62F7;&amp;#x8D1D;&amp;#x6B21;&amp;#x6570;&amp;#xFF0C;&amp;#x964D;&amp;#x4F4E;&amp;#x4E86;&amp;#x5BF9;&amp;#x6587;&amp;#x4EF6;&amp;#x8BFB;&amp;#x53D6;&amp;#x548C;&amp;#x5199;&amp;#x5165;&amp;#x65F6;&amp;#x6240;&amp;#x5E26;&amp;#x6765;&amp;#x7684;CPU&amp;#x7684;&amp;#x4F7F;&amp;#x7528;&amp;#x4EE5;&amp;#x53CA;&amp;#x5185;&amp;#x5B58;&amp;#x5E26;&amp;#x5BBD;&amp;#x7684;&amp;#x5360;&amp;#x7528;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;Direct I/O&amp;#x7684;&amp;#x8BFB;&amp;#x64CD;&amp;#x4F5C;&amp;#x4E0D;&amp;#x80FD;&amp;#x4ECE;page cache&amp;#x4E2D;&amp;#x83B7;&amp;#x53D6;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x4F1A;&amp;#x76F4;&amp;#x63A5;&amp;#x4ECE;&amp;#x78C1;&amp;#x76D8;&amp;#x4E0A;&amp;#x8BFB;&amp;#x53D6;&amp;#xFF0C;&amp;#x5E26;&amp;#x6765;&amp;#x6027;&amp;#x80FD;&amp;#x4E0A;&amp;#x7684;&amp;#x635F;&amp;#x5931;&amp;#x3002;&amp;#x4E00;&amp;#x822C;Direct I/O&amp;#x4E0E;&amp;#x5F02;&amp;#x6B65;I/O&amp;#x7ED3;&amp;#x5408;&amp;#x8D77;&amp;#x6765;&amp;#x4F7F;&amp;#x7528;&amp;#x63D0;&amp;#x9AD8;&amp;#x6027;&amp;#x80FD;&amp;#x3002;&lt;br&gt;        3&amp;#xFF09;Direct I/O&amp;#x8981;&amp;#x6C42;&amp;#x7528;&amp;#x6237;&amp;#x6001;&amp;#x7684;&amp;#x7F13;&amp;#x51B2;&amp;#x533A;&amp;#x5BF9;&amp;#x9F50;&amp;#xFF1B;&lt;br&gt;        4&amp;#xFF09;Direct I/O&amp;#x4E00;&amp;#x822C;&amp;#x7528;&amp;#x4E8E;&amp;#x9700;&amp;#x8981;&amp;#x81EA;&amp;#x5DF1;&amp;#x7BA1;&amp;#x7406;&amp;#x7F13;&amp;#x5B58;&amp;#x7684;&amp;#x5E94;&amp;#x7528;&amp;#x5982;&amp;#x6570;&amp;#x636E;&amp;#x5E93;&amp;#x7CFB;&amp;#x7EDF;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x5BF9;&amp;#x4E8E;I/O&amp;#x7684;&amp;#x8BFB;&amp;#x5199;&amp;#x6D41;&amp;#x7A0B;&amp;#xFF0C;&amp;#x903B;&amp;#x8F91;&amp;#x6BD4;&amp;#x8F83;&amp;#x590D;&amp;#x6742;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x4EE5;&amp;#x5199;&amp;#x6D41;&amp;#x7A0B;&amp;#x7B80;&amp;#x5355;&amp;#x63CF;&amp;#x8FF0;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;br&gt;        1&amp;#xFF09;&amp;#x7528;&amp;#x6237;&amp;#x8C03;&amp;#x7528;&amp;#x7CFB;&amp;#x7EDF;&amp;#x8C03;&amp;#x7528;write&amp;#x5199;&amp;#x4E00;&amp;#x4E2A;&amp;#x6587;&amp;#x4EF6;&amp;#xFF0C;&amp;#x4F1A;&amp;#x8C03;&amp;#x5230;sys_write&amp;#x51FD;&amp;#x6570;&amp;#xFF1B;&lt;br&gt;        2&amp;#xFF09; &amp;#x7ECF;&amp;#x8FC7;VFS&amp;#x865A;&amp;#x62DF;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x5C42;&amp;#xFF0C;&amp;#x8C03;&amp;#x7528;vfs_write&amp;#xFF0C; &amp;#x5982;&amp;#x679C;&amp;#x662F;&amp;#x7F13;&amp;#x5B58;&amp;#x5199;&amp;#x65B9;&amp;#x5F0F;&amp;#xFF0C;&amp;#x5219;&amp;#x5199;&amp;#x5165;page cache&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5C31;&amp;#x8FD4;&amp;#x56DE;&amp;#xFF0C;&amp;#x540E;&amp;#x7EED;&amp;#x5C31;&amp;#x662F;&amp;#x5237;&amp;#x810F;&amp;#x9875;&amp;#x7684;&amp;#x6D41;&amp;#x7A0B;&amp;#xFF1B;&amp;#x5982;&amp;#x679C;&amp;#x662F;Direct I/O&amp;#x7684;&amp;#x65B9;&amp;#x5F0F;&amp;#xFF0C;&amp;#x5C31;&amp;#x4F1A;&amp;#x8D70;&amp;#x5230;do_blockdev_direct_IO&amp;#x7684;&amp;#x6D41;&amp;#x7A0B;&amp;#xFF1B;&lt;br&gt;        3&amp;#xFF09;&amp;#x5982;&amp;#x679C;&amp;#x64CD;&amp;#x4F5C;&amp;#x7684;&amp;#x8BBE;&amp;#x5907;&amp;#x662F;&amp;#x903B;&amp;#x8F91;&amp;#x8BBE;&amp;#x5907;&amp;#x5982;LVM&amp;#xFF0C;MDRAID&amp;#x8BBE;&amp;#x5907;&amp;#x7B49;&amp;#xFF0C;&amp;#x4F1A;&amp;#x8FDB;&amp;#x5165;&amp;#x5230;&amp;#x5BF9;&amp;#x5E94;&amp;#x5185;&amp;#x6838;&amp;#x6A21;&amp;#x5757;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x51FD;&amp;#x6570;&amp;#x91CC;&amp;#x8FDB;&amp;#x884C;&amp;#x4E00;&amp;#x4E9B;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x5426;&amp;#x5219;&amp;#x5C31;&amp;#x76F4;&amp;#x63A5;&amp;#x6784;&amp;#x9020;bio&amp;#x8BF7;&amp;#x6C42;&amp;#xFF0C;&amp;#x8C03;&amp;#x7528;submit_bio&amp;#x5F80;&amp;#x5177;&amp;#x4F53;&amp;#x7684;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x4E0B;&amp;#x53D1;&amp;#x8BF7;&amp;#x6C42;&amp;#xFF0C;submit_bio&amp;#x51FD;&amp;#x6570;&amp;#x901A;&amp;#x8FC7;generic_make_request&amp;#x8F6C;&amp;#x53D1;bio&amp;#xFF0C;generic_make_request&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x5FAA;&amp;#x73AF;&amp;#xFF0C;&amp;#x5176;&amp;#x901A;&amp;#x8FC7;&amp;#x6BCF;&amp;#x4E2A;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x4E0B;&amp;#x6CE8;&amp;#x518C;&amp;#x7684;q-&amp;gt;make_request_fn&amp;#x51FD;&amp;#x6570;&amp;#x4E0E;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x8FDB;&amp;#x884C;&amp;#x4EA4;&amp;#x4E92;&amp;#xFF1B;&lt;br&gt;        4&amp;#xFF09;&amp;#x8BF7;&amp;#x6C42;&amp;#x4E0B;&amp;#x53D1;&amp;#x5230;&amp;#x5E95;&amp;#x5C42;&amp;#x7684;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x4E0A;&amp;#xFF0C;&amp;#x8C03;&amp;#x7528;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x8BF7;&amp;#x6C42;&amp;#x5904;&amp;#x7406;&amp;#x51FD;&amp;#x6570;__make_request&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x5728;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x4E2D;&amp;#x5C31;&amp;#x4F1A;&amp;#x8C03;&amp;#x7528;blk_queue_bio&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x5C31;&amp;#x662F;&amp;#x5408;&amp;#x5E76;bio&amp;#x5230;request&amp;#x4E2D;&amp;#xFF0C;&amp;#x4E5F;&amp;#x5C31;&amp;#x662F;I/O&amp;#x8C03;&amp;#x5EA6;&amp;#x5668;&amp;#x7684;&amp;#x5177;&amp;#x4F53;&amp;#x5B9E;&amp;#x73B0;&amp;#xFF1A;&amp;#x5982;&amp;#x679C;&amp;#x51E0;&amp;#x4E2A;bio&amp;#x8981;&amp;#x8BFB;&amp;#x5199;&amp;#x7684;&amp;#x533A;&amp;#x57DF;&amp;#x662F;&amp;#x8FDE;&amp;#x7EED;&amp;#x7684;&amp;#xFF0C;&amp;#x5C31;&amp;#x5408;&amp;#x5E76;&amp;#x5230;&amp;#x4E00;&amp;#x4E2A;request&amp;#xFF1B;&amp;#x5426;&amp;#x5219;&amp;#x5C31;&amp;#x521B;&amp;#x5EFA;&amp;#x4E00;&amp;#x4E2A;&amp;#x65B0;&amp;#x7684;request&amp;#xFF0C;&amp;#x628A;&amp;#x81EA;&amp;#x5DF1;&amp;#x6302;&amp;#x5230;&amp;#x8FD9;&amp;#x4E2A;request&amp;#x4E0B;&amp;#x3002;&amp;#x5408;&amp;#x5E76;bio&amp;#x8BF7;&amp;#x6C42;&amp;#x4E5F;&amp;#x662F;&amp;#x6709;&amp;#x9650;&amp;#x5EA6;&amp;#x7684;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x5408;&amp;#x5E76;&amp;#x540E;&amp;#x7684;&amp;#x8BF7;&amp;#x6C42;&amp;#x8D85;&amp;#x8FC7;&amp;#x9608;&amp;#x503C;&amp;#xFF08;&amp;#x5728;/sys/block/xxx/queue/max_sectors_kb&amp;#x91CC;&amp;#x8BBE;&amp;#x7F6E;&amp;#xFF09;,&amp;#x5C31;&amp;#x4E0D;&amp;#x80FD;&amp;#x518D;&amp;#x5408;&amp;#x5E76;&amp;#x6210;&amp;#x4E00;&amp;#x4E2A;request&amp;#x4E86;&amp;#xFF0C;&amp;#x800C;&amp;#x4F1A;&amp;#x65B0;&amp;#x5206;&amp;#x914D;&amp;#x4E00;&amp;#x4E2A;request&amp;#xFF1B;&lt;br&gt;        5&amp;#xFF09;&amp;#x63A5;&amp;#x4E0B;&amp;#x6765;&amp;#x7684;I/O&amp;#x64CD;&amp;#x4F5C;&amp;#x5C31;&amp;#x4E0E;&amp;#x5177;&amp;#x4F53;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x8BBE;&amp;#x5907;&amp;#x6709;&amp;#x5173;&amp;#x4E86;&amp;#xFF0C;&amp;#x4EA4;&amp;#x7531;&amp;#x76F8;&amp;#x5E94;&amp;#x7684;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x9A71;&amp;#x52A8;&amp;#x7A0B;&amp;#x5E8F;&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x4EE5;scsi&amp;#x8BBE;&amp;#x5907;&amp;#x4E3A;&amp;#x4F8B;&amp;#x8BF4;&amp;#x660E;&amp;#xFF0C;queue&amp;#x961F;&amp;#x5217;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x51FD;&amp;#x6570;q-&amp;gt;request_fn&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;scsi&amp;#x9A71;&amp;#x52A8;&amp;#x7684;&amp;#x5C31;&amp;#x662F;scsi_request_fn&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&amp;#x5C06;&amp;#x8BF7;&amp;#x6C42;&amp;#x6784;&amp;#x9020;&amp;#x6210;scsi&amp;#x6307;&amp;#x4EE4;&amp;#x4E0B;&amp;#x53D1;&amp;#x5230;scsi&amp;#x8BBE;&amp;#x5907;&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x5904;&amp;#x7406;&amp;#x5B8C;&amp;#x6210;&amp;#x540E;&amp;#x5C31;&amp;#x4F1A;&amp;#x4F9D;&amp;#x6B21;&amp;#x8C03;&amp;#x7528;&amp;#x5404;&amp;#x5C42;&amp;#x7684;&amp;#x56DE;&amp;#x8C03;&amp;#x51FD;&amp;#x6570;&amp;#x8FDB;&amp;#x884C;&amp;#x5B8C;&amp;#x6210;&amp;#x72B6;&amp;#x6001;&amp;#x7684;&amp;#x4E00;&amp;#x4E9B;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x6700;&amp;#x540E;&amp;#x8FD4;&amp;#x56DE;&amp;#x7ED9;&amp;#x4E0A;&amp;#x5C42;&amp;#x7528;&amp;#x6237;&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;2-3-request-based&amp;#x548C;bio-based&quot;&gt;&lt;a href=&quot;#2-3-request-based&amp;#x548C;bio-based&quot; class=&quot;headerlink&quot; title=&quot;2.3 request-based&amp;#x548C;bio-based&quot;&gt;&lt;/a&gt;2.3 request-based&amp;#x548C;bio-based&lt;/h2&gt;&lt;p&gt;&amp;#x5728;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x7684;I/O&amp;#x5904;&amp;#x7406;&amp;#x6D41;&amp;#x7A0B;&amp;#x4E2D;&amp;#xFF0C;&amp;#x4F1A;&amp;#x6D89;&amp;#x53CA;&amp;#x5230;&amp;#x4E24;&amp;#x79CD;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x65B9;&amp;#x5F0F;&amp;#xFF1A;&lt;br&gt;        1&amp;#xFF09;request-based&amp;#xFF1A;&amp;#x8FD9;&amp;#x79CD;&amp;#x5904;&amp;#x7406;&amp;#x65B9;&amp;#x5F0F;&amp;#x4E0B;&amp;#xFF0C;&amp;#x4F1A;&amp;#x8FDB;&amp;#x884C;bio&amp;#x5408;&amp;#x5E76;&amp;#x5230;request&amp;#xFF08;&amp;#x5373;I/O&amp;#x8C03;&amp;#x5EA6;&amp;#x5408;&amp;#x5E76;&amp;#xFF09;&amp;#x7684;&amp;#x6D41;&amp;#x7A0B;&amp;#xFF0C;&amp;#x6700;&amp;#x540E;&amp;#x624D;&amp;#x628A;&amp;#x8BF7;&amp;#x6C42;&amp;#x4E0B;&amp;#x53D1;&amp;#x5230;&amp;#x7269;&amp;#x7406;&amp;#x8BBE;&amp;#x5907;&amp;#x3002;&amp;#x76EE;&amp;#x524D;&amp;#x4F7F;&amp;#x7528;&amp;#x7684;&amp;#x7269;&amp;#x7406;&amp;#x76D8;&amp;#x90FD;&amp;#x662F;request-based&amp;#x7684;&amp;#x8BBE;&amp;#x5907;&amp;#xFF1B;&lt;br&gt;        2&amp;#xFF09;bio-based&amp;#xFF1A;&amp;#x5728;&amp;#x903B;&amp;#x8F91;&amp;#x8BBE;&amp;#x5907;&amp;#x81EA;&amp;#x5DF1;&amp;#x5B9A;&amp;#x4E49;&amp;#x7684;request&amp;#x5904;&amp;#x7406;&amp;#x51FD;&amp;#x6570;make_request_fn&amp;#x91CC;&amp;#x8FDB;&amp;#x884C;&amp;#x5904;&amp;#x7406;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x8C03;&amp;#x7528;generic_make_request&amp;#x4E0B;&amp;#x53D1;&amp;#x5230;&amp;#x5E95;&amp;#x5C42;&amp;#x8BBE;&amp;#x5907;&amp;#x3002;ramdisk&amp;#x8BBE;&amp;#x5907;&amp;#x3001;&amp;#x5927;&amp;#x90E8;&amp;#x5206;Device Mapper&amp;#x8BBE;&amp;#x5907;&amp;#x3001;virtio-blk&amp;#x90FD;&amp;#x662F;bio-based&amp;#xFF1B;&lt;br&gt;&amp;#x4E0B;&amp;#x56FE;&amp;#x4ECE;Device Mapper&amp;#x7684;&amp;#x89D2;&amp;#x5EA6;&amp;#x6765;&amp;#x8BF4;&amp;#x660E;request-based&amp;#x548C;bio-based&amp;#x5904;&amp;#x7406;&amp;#x6D41;&amp;#x7A0B;&amp;#x7684;&amp;#x533A;&amp;#x522B;&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2015/08/06/linux-io-stack/bio-based.png&quot; alt=&quot;bio-based&quot;&gt;&lt;br&gt;&amp;#x4E00;&amp;#x4E2A;&amp;#x9700;&amp;#x8981;&amp;#x6CE8;&amp;#x610F;&amp;#x7684;&amp;#x5730;&amp;#x65B9;&amp;#x662F;&amp;#xFF0C;Device mapper&amp;#x76EE;&amp;#x524D;&amp;#x53EA;&amp;#x6709;multipath&amp;#x63D2;&amp;#x4EF6;&amp;#x662F;request-based&amp;#x7684;&amp;#xFF0C;&amp;#x5176;&amp;#x4ED6;&amp;#x7684;&amp;#x5982;linear&amp;#xFF0C;strip&amp;#x90FD;&amp;#x662F;bio-based&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x5982;&amp;#x679C;&amp;#x662F;linear DM&amp;#x8BBE;&amp;#x5907;&amp;#x4E0A;&amp;#x521B;&amp;#x5EFA;&amp;#x7684;&amp;#x4E00;&amp;#x4E2A;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#xFF0C;&amp;#x5BF9;&amp;#x8FD9;&amp;#x4E2A;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x91CC;&amp;#x7684;&amp;#x6587;&amp;#x4EF6;&amp;#x8FDB;&amp;#x884C;&amp;#x8BFB;&amp;#x5199;&amp;#xFF0C;&amp;#x91C7;&amp;#x7528;&amp;#x7F13;&amp;#x5B58;I/O&amp;#x65F6;&amp;#xFF0C;&amp;#x5373;&amp;#x4F7F;&amp;#x5237;&amp;#x810F;&amp;#x9875;&amp;#x65F6;&amp;#x662F;&amp;#x8FDE;&amp;#x7EED;&amp;#x7684;&amp;#x8BF7;&amp;#x6C42;&amp;#xFF0C;&amp;#x5728;DM&amp;#x8BBE;&amp;#x5907;&amp;#x4E0A;&amp;#x4E5F;&amp;#x4E0D;&amp;#x4F1A;&amp;#x8FDB;&amp;#x884C;&amp;#x5408;&amp;#x5E76;&amp;#xFF0C;&amp;#x53EA;&amp;#x4F1A;&amp;#x5230;&amp;#x5E95;&amp;#x5C42;&amp;#x7684;&amp;#x8BBE;&amp;#x5907;&amp;#xFF08;&amp;#x5982;/dev/sdb&amp;#xFF09;&amp;#x4E0A;&amp;#x624D;&amp;#x8FDB;&amp;#x884C;&amp;#x5408;&amp;#x5E76;&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;4-&amp;#x53C2;&amp;#x8003;&amp;#x6587;&amp;#x732E;&quot;&gt;&lt;a href=&quot;#4-&amp;#x53C2;&amp;#x8003;&amp;#x6587;&amp;#x732E;&quot; class=&quot;headerlink&quot; title=&quot;4.&amp;#x53C2;&amp;#x8003;&amp;#x6587;&amp;#x732E;&quot;&gt;&lt;/a&gt;4.&amp;#x53C2;&amp;#x8003;&amp;#x6587;&amp;#x732E;&lt;/h1&gt;&lt;p&gt;1.&amp;#x300A;&amp;#x6DF1;&amp;#x5165;&amp;#x7406;&amp;#x89E3;LINUX&amp;#x5185;&amp;#x6838;&amp;#x300B;&lt;br&gt;2.&amp;#x300A;LINUX&amp;#x8BBE;&amp;#x5907;&amp;#x9A71;&amp;#x52A8;&amp;#x7A0B;&amp;#x5E8F;&amp;#x300B;&lt;br&gt;3.&amp;#x300A;&lt;a href=&quot;http://www.ibm.com/developerworks/cn/linux/l-cn-directio/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Linux&amp;#x4E2D;&amp;#x76F4;&amp;#x63A5;I/O&amp;#x673A;&amp;#x5236;&amp;#x4ECB;&amp;#x7ECD;&lt;/a&gt;&amp;#x300B;&lt;br&gt;4.&amp;#x300A;&lt;a href=&quot;http://www.thomas-krenn.com/en/wiki/Linux_Storage_Stack_Diagram#Diagram_for_Linux_Kernel_3.17&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Linux I/O stack&lt;/a&gt;&amp;#x300B;&lt;br&gt;5.&amp;#x300A;Request-based Device-mapper multipath and Dynamic load balancing&amp;#x300B;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;#x5757;&amp;#x5B58;&amp;#x50A8;&amp;#xFF0C;&amp;#x7B80;&amp;#x5355;&amp;#x6765;&amp;#x8BF4;&amp;#x5C31;&amp;#x662F;&amp;#x4F7F;&amp;#x7528;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x4E3A;&amp;#x7CFB;&amp;#x7EDF;&amp;#x63D0;&amp;#x4F9B;&amp;#x5B58;&amp;#x50A8;&amp;#x670D;&amp;#x52A1;&amp;#x3002;&amp;#x5757;&amp;#x5B58;&amp;#x50A8;&amp;#x5206;&amp;#x591A;&amp;#x79CD;&amp;#x7C7B;&amp;#x578B;&amp;#xFF0C;&amp;#x6709;&amp;#x5355;&amp;#x673A;&amp;#x5757;&amp;#x5B58;&amp;#x50A8;&amp;#xFF0C;&amp;#x7F51;&amp;#x7EDC;&amp;#x5B58;&amp;#x50A8;&amp;#xFF08;&amp;#x5982;NAS&amp;#xFF0C;SAN&amp;#x7B49;&amp;#xFF09;&amp;#xFF0C;&amp;#x5206;&amp;#x5E03;&amp;#x5F0F;&amp;#x5757;&amp;#x5B58;&amp;#x50A8;&amp;#xFF08;&amp;#x76EE;&amp;#x524D;&amp;#x4E3B;&amp;#x6D41;&amp;#x7684;&amp;#x5982;AWS&amp;#x7684;EBS&amp;#xFF0C;&amp;#x9752;&amp;#x4E91;&amp;#x7684;&amp;#x4E91;&amp;#x786C;&amp;#x76D8;&amp;#xFF0C;&amp;#x963F;&amp;#x91CC;&amp;#x4E91;&amp;#x7684;&amp;#x4E91;&amp;#x78C1;&amp;#x76D8;&amp;#xFF0C;&amp;#x7F51;&amp;#x6613;&amp;#x4E91;&amp;#x786C;&amp;#x76D8;&amp;#x7B49;&amp;#xFF09;&amp;#x3002;&amp;#x901A;&amp;#x5E38;&amp;#x5757;&amp;#x5B58;&amp;#x50A8;&amp;#x7684;&amp;#x8868;&amp;#x73B0;&amp;#x5F62;&amp;#x5F0F;&amp;#x5C31;&amp;#x662F;&amp;#x4E00;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#xFF0C;&amp;#x7528;&amp;#x6237;&amp;#x770B;&amp;#x5230;&amp;#x7684;&amp;#x5C31;&amp;#x662F;&amp;#x7C7B;&amp;#x4F3C;&amp;#x4E8E;sda&amp;#xFF0C;sdb&amp;#x8FD9;&amp;#x6837;&amp;#x7684;&amp;#x903B;&amp;#x8F91;&amp;#x8BBE;&amp;#x5907;&amp;#x3002;&amp;#x672C;&amp;#x6587;&amp;#x4E3B;&amp;#x8981;&amp;#x4ECB;&amp;#x7ECD;Linux&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#xFF0C;&amp;#x5BF9;Linux&amp;#x7684;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;I/O&amp;#x6808;&amp;#x8FDB;&amp;#x884C;&amp;#x5206;&amp;#x6790;&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;1-&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x57FA;&amp;#x672C;&amp;#x6982;&amp;#x5FF5;&quot;&gt;&lt;a href=&quot;#1-&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x57FA;&amp;#x672C;&amp;#x6982;&amp;#x5FF5;&quot; class=&quot;headerlink&quot; title=&quot;1.&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x57FA;&amp;#x672C;&amp;#x6982;&amp;#x5FF5;&quot;&gt;&lt;/a&gt;1.&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x57FA;&amp;#x672C;&amp;#x6982;&amp;#x5FF5;&lt;/h1&gt;&lt;p&gt;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x5C06;&amp;#x4FE1;&amp;#x606F;&amp;#x5B58;&amp;#x50A8;&amp;#x5728;&amp;#x56FA;&amp;#x5B9A;&amp;#x5927;&amp;#x5C0F;&amp;#x7684;&amp;#x5757;&amp;#x4E2D;&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;&amp;#x5757;&amp;#x90FD;&amp;#x6709;&amp;#x81EA;&amp;#x5DF1;&amp;#x7684;&amp;#x5730;&amp;#x5740;&amp;#x3002;&amp;#x5BF9;&amp;#x64CD;&amp;#x4F5C;&amp;#x7CFB;&amp;#x7EDF;&amp;#x800C;&amp;#x8A00;&amp;#xFF0C;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x662F;&amp;#x4EE5;&amp;#x5B57;&amp;#x7B26;&amp;#x8BBE;&amp;#x5907;&amp;#x7684;&amp;#x5916;&amp;#x89C2;&amp;#x5C55;&amp;#x73B0;&amp;#x7684;&amp;#xFF0C;&amp;#x4F8B;&amp;#x5982;/dev/sda&amp;#xFF0C;&amp;#x867D;&amp;#x7136;&amp;#x5BF9;&amp;#x8FD9;&amp;#x79CD;&amp;#x5B57;&amp;#x7B26;&amp;#x8BBE;&amp;#x5907;&amp;#x53EF;&amp;#x4EE5;&amp;#x6309;&amp;#x7167;&amp;#x5B57;&amp;#x8282;&amp;#x4E3A;&amp;#x5355;&amp;#x4F4D;&amp;#x8BBF;&amp;#x95EE;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x5B9E;&amp;#x9645;&amp;#x4E0A;&amp;#x5230;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x4E0A;&amp;#x5374;&amp;#x662F;&amp;#x4EE5;&amp;#x5757;&amp;#x4E3A;&amp;#x5355;&amp;#x4F4D;&amp;#xFF08;&amp;#x6700;&amp;#x5C0F;512byte&amp;#xFF0C;&amp;#x5373;&amp;#x4E00;&amp;#x4E2A;&amp;#x6247;&amp;#x533A;&amp;#xFF09;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E4B;&amp;#x95F4;&amp;#x7684;&amp;#x8F6C;&amp;#x6362;&amp;#x662F;&amp;#x7531;&amp;#x64CD;&amp;#x4F5C;&amp;#x7CFB;&amp;#x7EDF;&amp;#x6765;&amp;#x5B9E;&amp;#x73B0;&amp;#x7684;&amp;#x3002;&lt;br&gt;        &amp;#x4E0B;&amp;#x9762;&amp;#x4ECB;&amp;#x7ECD;&amp;#x51E0;&amp;#x4E2A;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x7684;&amp;#x57FA;&amp;#x672C;&amp;#x6982;&amp;#x5FF5;&amp;#xFF1A;&lt;br&gt;        1&amp;#xFF09;&amp;#x6247;&amp;#x533A;&amp;#xFF1A;&amp;#x78C1;&amp;#x76D8;&amp;#x76D8;&amp;#x7247;&amp;#x4E0A;&amp;#x7684;&amp;#x6247;&amp;#x5F62;&amp;#x533A;&amp;#x57DF;&amp;#xFF0C;&amp;#x903B;&amp;#x8F91;&amp;#x5316;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x65B9;&amp;#x4FBF;&amp;#x7BA1;&amp;#x7406;&amp;#x78C1;&amp;#x76D8;&amp;#x7A7A;&amp;#x95F4;&amp;#xFF0C;&amp;#x662F;&amp;#x786C;&amp;#x4EF6;&amp;#x8BBE;&amp;#x5907;&amp;#x6570;&amp;#x636E;&amp;#x4F20;&amp;#x9001;&amp;#x7684;&amp;#x57FA;&amp;#x672C;&amp;#x5355;&amp;#x4F4D;&amp;#xFF0C;&amp;#x4E00;&amp;#x822C;512Byte&amp;#xFF1B;&lt;br&gt;    2&amp;#xFF09;&amp;#x5757;&amp;#xFF1A;&amp;#x5757;&amp;#x662F;VFS&amp;#x548C;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x6570;&amp;#x636E;&amp;#x4F20;&amp;#x9001;&amp;#x7684;&amp;#x57FA;&amp;#x672C;&amp;#x5355;&amp;#x4F4D;&amp;#xFF0C;&amp;#x5FC5;&amp;#x987B;&amp;#x662F;&amp;#x6247;&amp;#x533A;&amp;#x7684;&amp;#x6574;&amp;#x6570;&amp;#x500D;&amp;#xFF0C;&amp;#x683C;&amp;#x5F0F;&amp;#x5316;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x65F6;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x6307;&amp;#x5B9A;&amp;#x5757;&amp;#x5927;&amp;#x5C0F;&amp;#xFF08;&amp;#x4E00;&amp;#x822C;512,1024,2048,4096&amp;#x5B57;&amp;#x8282;&amp;#xFF09;&amp;#xFF1B;&lt;br&gt;       3&amp;#xFF09;&amp;#x6BB5;&amp;#xFF1A;&amp;#x4E00;&amp;#x4E2A;&amp;#x5185;&amp;#x5B58;&amp;#x9875;&amp;#x6216;&amp;#x8005;&amp;#x5185;&amp;#x5B58;&amp;#x9875;&amp;#x4E2D;&amp;#x7684;&amp;#x4E00;&amp;#x90E8;&amp;#x5206;&amp;#xFF0C;&amp;#x5305;&amp;#x542B;&amp;#x4E00;&amp;#x4E9B;&amp;#x76F8;&amp;#x90BB;&amp;#x78C1;&amp;#x76D8;&amp;#x6247;&amp;#x533A;&amp;#x4E2D;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#xFF1B;&amp;#x78C1;&amp;#x76D8;&amp;#x7684;&amp;#x6BCF;&amp;#x4E2A;I/O&amp;#x64CD;&amp;#x4F5C;&amp;#x5C31;&amp;#x662F;&amp;#x5728;&amp;#x78C1;&amp;#x76D8;&amp;#x4E0E;&amp;#x4E00;&amp;#x4E9B;RAM&amp;#x5355;&amp;#x5143;&amp;#x4E4B;&amp;#x95F4;&amp;#x76F8;&amp;#x4E92;&amp;#x4F20;&amp;#x4E00;&amp;#x4E9B;&amp;#x76F8;&amp;#x90BB;&amp;#x6247;&amp;#x533A;&amp;#x7684;&amp;#x5185;&amp;#x5BB9;&amp;#xFF0C;&amp;#x5927;&amp;#x591A;&amp;#x6570;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;&amp;#xFF0C;&amp;#x78C1;&amp;#x76D8;&amp;#x63A7;&amp;#x5236;&amp;#x5668;&amp;#x91C7;&amp;#x7528;DMA&amp;#x65B9;&amp;#x5F0F;&amp;#x8FDB;&amp;#x884C;&amp;#x6570;&amp;#x636E;&amp;#x4F20;&amp;#x9001;&amp;#x3002;&amp;#x5982;&amp;#x679C;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x6BB5;&amp;#x5728;RAM&amp;#x4E2D;&amp;#x76F8;&amp;#x5E94;&amp;#x7684;&amp;#x9875;&amp;#x6846;&amp;#x662F;&amp;#x8FDE;&amp;#x7EED;&amp;#x7684;&amp;#x5E76;&amp;#x4E14;&amp;#x5728;&amp;#x78C1;&amp;#x76D8;&amp;#x4E0A;&amp;#x76F8;&amp;#x5E94;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x5757;&amp;#x4E5F;&amp;#x662F;&amp;#x76F8;&amp;#x90BB;&amp;#x7684;&amp;#xFF0C;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x5728;&amp;#x901A;&amp;#x7528;&amp;#x5757;&amp;#x5C42;&amp;#x5408;&amp;#x5E76;&amp;#x5B83;&amp;#x4EEC;&amp;#xFF0C;&amp;#x4EA7;&amp;#x751F;&amp;#x66F4;&amp;#x5927;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x533A;&amp;#x57DF;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x533A;&amp;#x57DF;&amp;#x79F0;&amp;#x4E3A;&amp;#x7269;&amp;#x7406;&amp;#x6BB5;&amp;#x3002;&lt;br&gt;&amp;#x901A;&amp;#x5E38;&amp;#x60C5;&amp;#x51B5;&amp;#x4E0B;&amp;#xFF0C;&amp;#x6211;&amp;#x4EEC;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x6765;&amp;#x8BBF;&amp;#x95EE;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#xFF0C;&amp;#x4E5F;&amp;#x53EF;&amp;#x4EE5;&amp;#x76F4;&amp;#x63A5;&amp;#x4F7F;&amp;#x7528;&amp;#x88F8;&amp;#x8BBE;&amp;#x5907;&amp;#xFF0C;&amp;#x901A;&amp;#x8FC7;&amp;#x6307;&amp;#x5B9A;&amp;#x504F;&amp;#x79FB;&amp;#x548C;&amp;#x5927;&amp;#x5C0F;&amp;#x6765;&amp;#x8BFB;&amp;#x5199;&amp;#x88F8;&amp;#x8BBE;&amp;#x5907;&amp;#x3002;&lt;br&gt;&amp;#x5E38;&amp;#x89C1;&amp;#x7684;&amp;#x5757;&amp;#x5B58;&amp;#x50A8;&amp;#x8BBE;&amp;#x5907;&amp;#x5C31;&amp;#x662F;&amp;#x7269;&amp;#x7406;&amp;#x78C1;&amp;#x76D8;&amp;#xFF0C;&amp;#x5728;Linux&amp;#x7CFB;&amp;#x7EDF;&amp;#x4E0B;&amp;#xFF0C;&amp;#x8FD8;&amp;#x63D0;&amp;#x4F9B;&amp;#x57FA;&amp;#x4E8E;&amp;#x5176;&amp;#x4ED6;&amp;#x5757;&amp;#x8BBE;&amp;#x5907;&amp;#x4E4B;&amp;#x4E0A;&amp;#x7684;&amp;#x903B;&amp;#x8F91;&amp;#x8BBE;&amp;#x5907;&amp;#xFF0C;&amp;#x5982;Device Mapper&amp;#xFF0C;&amp;#x8F6F;RAID&amp;#x7B49;&amp;#x3002;&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="storage" scheme="http://yoursite.com/categories/storage/"/>
    
    
      <category term="storage" scheme="http://yoursite.com/tags/storage/"/>
    
      <category term="io stack" scheme="http://yoursite.com/tags/io-stack/"/>
    
  </entry>
  
</feed>
